(function(z){var B=window.AmazonUIPageJS||window.P,u=B._namespace||B.attributeErrors,l=u?u("ProductCustomizationSingleTextAssets"):B;l.guardFatal?l.guardFatal(z)(l,window):l.execute(function(){z(l,window)})})(function(z,B,u){z.when("A","ac-widget","ac-ajax-fetcher","ready").register("ac-ajax-customizer",function(l,n,g){var e=l.$;return function(c){var d=this;d.viewName=c.viewName;d.viewFactory=c.viewFactory;d.deviceType=c.deviceType;var b=new g("#a-popover-"+d.viewName,d.deviceType),a=[],k=function(f){l.each(f.states,
function(f,a){l.state.replace(a,f)})},f=function(){var f=!!e("html").hasClass("a-canvas");l.declarative("pc-customization-button","click",function(c){"function"===typeof B.uet&&B.uet("bb","amazonCustomOLP",{wb:1});var p=c.data,t=p.asin,g=p.merchantID,p=p.refTag,m=c.$target,v=d.viewFactory.get(m);l.trigger("amazon-custom-log-ref-tag","CustomizeNowClick");if(null===v){if(0<a.length){for(c=0;c<a.length;c++)d.viewFactory.remove(a[c]);a.length=0}b.fetch(t,g,p,function(b){0<a.length||(k(b),e("#pc-custom-popover-injection").length||
e("body").append(e("<div>").attr("id","pc-custom-popover-injection").addClass("aok-hidden")),e("#pc-custom-popover-injection").empty().append(b.popoverHtml),v=d.viewFactory.create(m,{name:d.viewName,header:b.header,activate:"onclick",popoverLabel:"customize now popover"}),v.lock().show(),a.push(v),f&&(new n).init())})}"function"===typeof B.uet&&B.uex("ld","amazonCustomOLP",{wb:1})})};d.init=function(a){a&&(a=e("span.a-declarative[data-action='pc-customization-button']").first(),a.length&&(a=a.data("pc-customization-button"))&&
b.fetch(a.asin,a.merchantID,a.refTag));f()}}});z.when("A").register("ac-ajax-fetcher",function(l){var n=l.$;return function(g,e){var c={},d=function(b){var a=n(b);if(!a.find(g).length){a=n("span.a-declarative[data-action='pc-customization-button']").first();a.addClass("a-button-disabled");if(1===a.children().length){var c=n("<div>");c.appendTo(a);c.text("This product is not available for customization at this moment.")}B.console&&console.log("Missing popover html",b);throw"Missing popover html";
}b=a.find(".pc-popover-header").remove().text();var c=a.find(g).append(a.find("input#amazonCustomUseCaseId")).wrapAll("<div>").parent().html(),f={states:{},header:b,popoverHtml:c,disabledMessage:a.find(".pc-customization-disabled div:first").html()};a.find("script").each(function(){var a=n(this).data("a-state");a&&a.key&&(f.states[a.key]=JSON.parse(n(this).text()))});return f};this.fetch=function(b,a,k,f){f||(f=function(){});var h="a:"+b+"-m:"+a+"-refTag:"+k;h in c?f(c[h]):l.get("/gp/product/features/pc-buybox.html",
{params:{asin:b,merchantID:a,refTag:k,deviceType:e},success:function(a){a=d(a);c[h]=a;f(a)},error:function(f,h,c){f="Failed to fetch popover data for asin:'"+b+"' and merchantID:'"+a+"'";B.console&&console.log(f,c);throw f;}})}}});(function(){z.when("A","acc-weblab","ready").register("ac-base",function(l,n){var g=l.$;l.on("pc-single-text-loaded",function(){g("html").hasClass("a-canvas")||(g(".pc-customization-disabled").addClass("active"),g(".pc-customization-enabled").remove())});return{getASIN:function(){return 1<=
g(".ac-mobile-app").length?g(".ac-meta-data").find("#asin").val():g("#ASIN").val()},getOfferListingID:function(){return g("#offerListingID").val()},getMerchantID:function(){return 1<=g(".ac-mobile-app").length?g(".ac-meta-data").find("#merchantID").val():g("#merchantID").val()},isApp:function(){return n.isT1("AC_PRODUCT_TABLETAPP_75334")?1<=g(".ac-mobile-app").length||1<=g(".ac-tablet-app").length:1<=g(".ac-mobile-app").length}}});z.when("A","ac-base","ready").execute(function(l,n){function g(a){var b=
"/gp/product/features/log-message.html/ref="+a.refTag,f;c++;f="ajax_amzon_custom_log"+c;if(B.ue){var h=B.uet;h("tc",f)}e.ajax({type:"POST",url:b,dataType:"json",data:{component:a.component,message:a.msg,isMetricsNeeded:a.isMetricsNeeded},success:function(a){a=a.result.rid;if(B.ue){var h=B.ues,b=B.uet,c=B.uex;h("id",f,a);h("t0",f,new Date);h("ctb",f,"1");b("cf",f);b("be",f);c("ld",f)}}})}var e=l.$,c=0,d=n.getASIN(),b={CustomizeNowClick:{refTag:"amz_custom_cn_clk_"+d,component:"Amazon Custom customize now button",
msg:"Amazon Custom customize now button clicked",isMetricsNeeded:!1},AddToCartClick:{refTag:"amz_custom_atc_clk_"+d,component:"Amazon Custom Add to cart",msg:"Amazon Custom add to cart clicked",isMetricsNeeded:!1},CloseClick:{refTag:"amz_custom_cls_clk_"+d,component:"Amazon Custom Add to cart",msg:"Amazon Custom close button clicked",isMetricsNeeded:!1},FontChange:{refTag:"amz_custom_font_chg_"+d,component:"Font drop down list",msg:"Font selected from drop down list",isMetricsNeeded:!1},FontColorChange:{refTag:"amz_custom_color_chg_"+
d,component:"Font drop down list",msg:"Font selected from drop down list",isMetricsNeeded:!1},logCustomImageTabClick:{refTag:"pc_ci_tab_clk",component:"Custom image",msg:"Custom Image click",isMetricsNeeded:!1},logVendorGalleryTabClick:{refTag:"pc_ig_tab_clk",component:"Vendor image gallery",msg:"Vendor image gallery click",isMetricsNeeded:!1},logAddTextTabClick:{refTag:"pc_at_tab_clk",component:"Add Text",msg:"Add Text Click",isMetricsNeeded:!1},logUseThisDesignClick:{refTag:"pc_utdbtn_clk_"+d,component:"UseThisDesignClick",
msg:"Use this design click",isMetricsNeeded:!0},logS3TextUploadError:{refTag:"pc_s3_txt_err",component:"S3TextUploadError",msg:"S3 error on text upload",isMetricsNeeded:!0},logS3ImageUploadError:{refTag:"pc_s3_img_pst_err",component:"S3ImageUploadError",msg:"S3 error on image upload",isMetricsNeeded:!0},logUseThisDesignKindleHucClick:{refTag:"pc_utdgbtn_clk_kin_huc_"+d,component:"UseThisDesignKindleHucClick",msg:"Use this Design From Kindle Click",isMetricsNeeded:!1},hasNonASCII:{refTag:"amz_custom_has_non_ASCII",
component:"Text",msg:"Added Non ASCII. PC-Token - ",isMetricsNeeded:!0}};l.on("amazon-custom-popup-open",function(){this.popupOpenTime=new Date});l.on("amazon-custom-popup-close",function(a){a-=this.popupOpenTime;B.ue.count("pcSingleTextTimer",a/1E3);B.ue.count("pcSingleTextTimer")});l.on("logVendor-ref-Click",function(a){a={refTag:"pc_vi_"+a.categoryName.substring(0,4)+"_"+d,component:"theme for selected vendor image",msg:"Theme selected for vendor image is "+a.categoryName,isMetricsNeeded:!1};g(a)});
l.on("amazon-custom-log-ref-tag",function(a,c){if(a!==u){var f=b[a];f!==u&&(c&&c.msg&&(f.msg+=c.msg),g(f))}})})})();(function(){z.when("A","fabric-js","ac-base","ac-utils","ac-constants","ac-configurator-picker","ac-simple-textInput","ac-gallery","ac-image-gallery","ac-text-image","ac-error-handling","acc-weblab","ready").register("ac-canvas",function(l,n,g,e,c,d,b,a,k,f,h,q){var p=l.$;return function(a,k){var m=this;m.isActive=!1;m.surface=k;m.childCanvas=[];m.canvas=a;m.isChild=m.canvas.isChild?
m.canvas.isChild:!1;m.controls={};m.canvasObjects=[];m.name="";m.data;m.canvas.index!==u?(m.id=m.surface.id+"-area-"+m.canvas.index,m.data=k.data.areas[m.canvas.index],m.name=m.data.name):(m.id=m.surface.id+"-primary",m.isChild=!1);m.currentSelectedObject=null;m.enableBuyBox=!1;m.hasRequiredField=function(){return"TextPrinting"===m.data.customizationType?m.controls&&m.controls.simpleTextInput&&m.controls.simpleTextInput.hasRequiredField():"Options"===m.data.customizationType&&(q.isT1("AC_PRODUCT_CONFIGURATOR_DP_75265")||
q.isT1("AC_PRODUCT_CONFIGURATOR_DP_MOBILE_83123"))?m.controls&&m.controls.configurator&&m.controls.configurator.hasRequiredField():!1};m.requiredFieldsAreValid=function(){return"TextPrinting"===m.data.customizationType?m.controls&&m.controls.simpleTextInput&&m.controls.simpleTextInput.requiredFieldsAreValid():"Options"===m.data.customizationType&&(q.isT1("AC_PRODUCT_CONFIGURATOR_DP_75265")||q.isT1("AC_PRODUCT_CONFIGURATOR_DP_MOBILE_83123"))?m.controls&&m.controls.configurator&&m.controls.configurator.requiredFieldsAreValid():
!0};m.isValid=function(){if(q.isT1("AC_PRODUCT_CONFIGURATOR_DP_75265")||q.isT1("AC_PRODUCT_CONFIGURATOR_DP_MOBILE_83123"))return"TextPrinting"===m.data.customizationType?m.controls&&m.controls.simpleTextInput&&m.controls.simpleTextInput.isValid():"Options"===m.data.customizationType?m.controls&&m.controls.configurator&&m.controls.configurator.isValid():!0};m.emphasizeMissingField=function(){"TextPrinting"===m.data.customizationType&&m.controls&&m.controls.simpleTextInput&&p.isFunction(m.controls.simpleTextInput.emphasizeMissingField)&&
m.controls.simpleTextInput.emphasizeMissingField();"Options"===m.data.customizationType&&(q.isT1("AC_PRODUCT_CONFIGURATOR_DP_75265")||q.isT1("AC_PRODUCT_CONFIGURATOR_DP_MOBILE_83123"))&&m.controls&&m.controls.configurator&&p.isFunction(m.controls.configurator.emphasizeMissingField)&&m.controls.configurator.emphasizeMissingField()};m.containsEmoji=function(){var f=!1;"TextPrinting"===m.data.customizationType&&(f=m.controls&&m.controls.simpleTextInput&&m.controls.simpleTextInput.containsEmoji());"ImagePrinting"===
m.data.customizationType&&(f=m.controls&&m.controls.textInput&&m.controls.textInput.imgText&&m.controls.textInput.imgText.containsEmoji());return f};m.renderAll=function(f){f=f?f:1;m.isChild?(m.canvas.renderAll(),q.isT1("AC_THUMBNAIL_NEW_84598")?setTimeout(function(){e.debounce(m.surface.updateActiveCanvas(m.canvas.index),25)},f):setTimeout(function(){e.debounce(m.surface.updatePrimaryCanvas(m.canvas.index),25)},f)):m.canvas.renderAll()};m.getObjects=function(){return m.canvas.getObjects()};m.toDataURL=
function(){try{m.canvas.toDataURL()}catch(f){return null}};m.verifyScaling=function(){m.canvas.off("object:modified");m.canvas.on("object:modified",function(f){f=f.target;m.renderAll();"text"!==f.type&&(1.5<f.scaleX||1.5<f.scaleY?h.show("pc-scale-warning-message"):h.hide(),m.canvas.calcOffset());m.dragResetObject()})};m.dragResetObject=function(){var f=m.canvas.getActiveObject();if(f){var a=parseInt(m.canvas.width,10),b=parseInt(m.canvas.height,10),c=new n.Rect({left:0,top:0,width:a,height:b,opacity:0}),
k=new n.Point(0,0),d=new n.Point(0+a,0+b);m.canvas.add(c);k=f.intersectsWithObject(c)||c.isContainedWithinObject(f)||f.isContainedWithinRect(k,d);m.canvas.remove(c);k||(f.set({left:0+(a/2-f.width/2),top:0+(b/2-f.height/2),scaleX:1,scaleY:1,angle:0}),h.hide(),f.setCoords(),m.canvas.calcOffset(),m.renderAll(50))}};m.clear=function(){m.canvas.clear();for(var f in m.controls)m.controls.hasOwnProperty(f)&&m.controls[f].cleared&&(m.controls[f].cleared(),m.controls[f].isControlActive=!1);m.renderAll()};
m.childCanvas=[];m.addGalleryImage=function(f){var a=m.getObjects();e.imageLoading.show();for(var h=m.canvas.size()-1;0<=h;h--)if(a[h].name&&"galImage"===a[h].name||a[h].name&&"cusImage"===a[h].name||"text"===a[h].type)m.canvas.remove(a[h]),m.controls.gallery;m.controls.textInput&&m.controls.textInput.imgText&&(m.controls.textInput.imgText.resetControl(),m.controls.textInput.isControlActive=!1);p("#pcTextArea").val("");p(".ac-upload-tnC").fadeOut();n.Image.fromURL(f.imageUrl,function(a){m.canvas.add(a);
a.name="galImage";e.imageLoading.hide();m.renderAll();a.vendorGalleryFileId=f.vendorGalleryFileId;a.vendorGalleryId=f.vendorGalleryId;a.originalURL=f.originalURL;p(".pc-two-column-layout .ac-delete-button").fadeIn()},{height:m.canvas.height,width:m.canvas.width,selectable:!1,crossOrigin:"anonymous"})};m.addConfiguratorImage=function(f){(q.isT1("AC_PRODUCT_CONFIGURATOR_DP_75265")||q.isT1("AC_PRODUCT_CONFIGURATOR_DP_MOBILE_83123"))&&n.Image.fromURL(f.imageUrl,function(f){m.canvas.add(f);f.name="configuratorImg";
e.imageLoading.hide();f.sendToBack();m.renderAll()},{height:m.canvas.height,width:m.canvas.width,selectable:!1,crossOrigin:"anonymous"})};m.addCustomerImage=function(f){var a=m.canvas,h=parseInt(p(f.element).attr("data-original-width"),10),b=parseInt(p(f.element).attr("data-original-height"),10);a.deactivateAll();l.each(m.getObjects(),function(f){"galImage"!==f.name&&"cusImage"!==f.name||a.remove(f)});n.Image.fromURL(function(f){var a=Math.max(h/(c.outputSVGDimention.width/c.scaleRatio),b/(c.outputSVGDimention.height/
c.scaleRatio)),a=h*(1<a?1/a:1),k=/[.]/.exec(f.imageUrl)?/[^.]+$/.exec(f.imageUrl):u;f=f.imageUrl.split(k[0]);var k=k[0],d="";"png"===k.toLowerCase()&&(d="_AL__FMPng_");return f[0]+"_SX"+a+"_"+d+"."+k}(f),function(f){a.add(f);f.width=h/c.scaleRatio;f.height=b/c.scaleRatio;var k=Math.max(f.height/a.height,f.width/a.width);1<k&&(f.width/=1.1*k,f.height/=1.1*k);f.left=(a.width-f.width)/2;f.top=(a.height-f.height)/2;a.calcOffset();f.setCoords();e.imageLoading.hide();f.name="cusImage";f.sendToBack();a.setActiveObject(f);
m.renderAll()},{crossOrigin:"anonymous",transparentCorners:!1,centeredScaling:!0,lockUniScaling:!0});p(".ac-upload-tnC").fadeIn()};m.setActiveControl=function(f){for(var a in m.controls)m.controls.hasOwnProperty(a)&&m.controls[a]&&(m.controls[a].isControlActive=!1);m.controls[f].isControlActive=!0};m.resetControls=function(){var f=!1,a;a=function(){p(".ac-btn-makeOwn.ac-imageUpload").trigger("click")};for(var h in m.controls)if(m.controls.hasOwnProperty(h)&&m.controls[h].isControlActive)switch(h){case "textInput":p(".ac-btn-makeOwn.ac-textInput").trigger("click");
f=!0;break;case "imageUpload":p(".ac-btn-makeOwn.ac-imageUpload").trigger("click"),f=!0}f?null:a()};m.activate=function(){};m.bindEvents={commonEvent:function(){m.canvas.off("canvas:cleared");m.canvas.on("canvas:cleared",function(){for(var f=0;f<=m.controls.length;f++)m.controls[f].cleared&&m.controls[f].cleared()});m.canvas.off("object:modified");m.canvas.on("object:modified",function(f){f=f.target;m.controls.textInput?("text"!==f.type&&((1.5<f.scaleX||1.5<f.scaleY)&&h.show("pc-scale-warning-message"),
(1.5>f.scaleX||1.5>f.scaleY)&&h.hide(),m.canvas.calcOffset()),m.dragResetObject(),m.renderAll()):m.controls.imageUpload&&(m.dragResetObject(),m.renderAll())})},hoverAndSelect:function(){var f=p(m.canvas.getSelectionElement()),a=[4,4],h=function(f){var h=f.canvas,b={};l.each({borderStrokeDashArray:a,borderScaleFactor:.5,hasControls:!1,active:!0},function(a,h){b[h]=f[h];f[h]=a});var c=h._activeObject;h._activeObject=f;f._renderControls(h.getContext());l.each(b,function(a,h){f[h]=a});h._activeObject=
c};m.canvas.on("object:selected",function(h){h=h.target;h.borderStrokeDashArray=a;h.borderScaleFactor=.5;h.hasControls=!0;h.canvas.renderAll();f.closest(".canvas-container").addClass("show-border")});m.canvas.on("mouse:over",function(f){f=f.target;f.active||h(f)});m.canvas.on("mouse:out",function(f){f=f.target;f.active||f.canvas.renderAll()});f.bind("mouseleave",function(){m.canvas._fireOverOutEvents(null)});m.canvas.on("selection:cleared",function(){f.closest(".canvas-container").removeClass("show-border")});
p(".ac-preview-container").bind("click",function(f){f=f.target;p(f).is("canvas")&&p.contains(m.canvas.wrapperEl,f)||(m.canvas.deactivateAllWithDispatch(),m.canvas.renderAll())})},imageUpload:function(){m.controls.imageUpload.cleared=function(){h.hide();p(".ac-upload-tnC").fadeOut()}},imageAndText:function(){m.controls.textInput={};m.canvas.off("object:selected");m.canvas.on("object:selected",function(f){if(f=f.target)"text"===f.type?(m.currentSelectedObject="text",""!==f.text&&p(".pc-two-column-layout .ac-delete-button").fadeIn(),
l.trigger("slideUpTextArea")):(m.currentSelectedObject="other",l.trigger("slideDownTextArea"),p(".pc-two-column-layout .ac-delete-button").fadeIn())});m.canvas.off("selection:cleared");m.canvas.on("selection:cleared",function(){"text"===m.currentSelectedObject&&(m.currentSelectedObject="other",l.trigger("slideDownTextArea"));p(".pc-two-column-layout .ac-delete-button").fadeOut()});m.controls.textInput.cleared=function(){p("#pcTextArea").val("");m.controls.textInput.imgText.cleared();l.each(m.getObjects(),
function(f){"text"===f.type&&f.remove()});l.trigger("slideDownTextArea")}}};m.bindControls=function(){var a=p(".ac-area-control."+m.id+", .ac-area-control.ac-widget-control"),h;p.each(a,function(a,c){h=p(c).attr("data-control-template");switch(h){case "simple-textInput":var k=new b(c,m,{});m.controls.simpleTextInput=k;break;case "imageUpload":"ImagePrinting"===m.surface.customizationType&&(m.verifyScaling(),m.controls.imageUpload={isControlActive:!0},m.bindEvents.imageUpload());break;case "textInput":"ImagePrinting"===
m.surface.customizationType&&m.data.customizationTypeSettings.ImagePrinting.isCustomTextSupported&&(m.bindEvents.imageAndText(),m.controls.textInput.imgText=new f(m,{}));break;case "configuratorpicker":if(q.isT1("AC_PRODUCT_CONFIGURATOR_DP_75265")||q.isT1("AC_PRODUCT_CONFIGURATOR_DP_MOBILE_83123"))k=new d(c,m),m.controls.configurator=k}})};m.controlRenderingHandle=function(){var f,a,h;if("ImagePrinting"===m.surface.customizationType){var b,c,k,d,q=!1;h=a=f=!1;p(".ac-imageUpload-control");b=p(".ac-btn-makeOwn.ac-imageUpload");
p(".ac-textInput-control");c=p(".ac-btn-makeOwn.ac-textInput");k=p('.a-tab-heading[data-a-tab-name="gallery"]');d=p('.a-tab-heading[data-a-tab-name="makeOwn"]');m.data.customizationTypeSettings.ImagePrinting&&(m.data.customizationTypeSettings.ImagePrinting.isGallerySupported&&m.data.customizationTypeSettings.ImagePrinting.galleries&&m.data.customizationTypeSettings.ImagePrinting.galleries.length&&(f=!0),m.data.customizationTypeSettings.ImagePrinting.isCustomerUploadSupported&&(a=!0),m.data.customizationTypeSettings.ImagePrinting.isCustomTextSupported&&
(h=!0));k.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-hidden");b.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-hidden");c.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-hidden");d.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-list-item");
f?k.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-list-item"):d.trigger("click");a?b.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-inline"):(p(".ac-imageUpload-control").removeClass("active"),p(".ac-btn-makeOwn.ac-imageUpload").removeClass("active"));h&&(c.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-inline"),
a||(m.surface.widget.surfaceList.forEach(function(f){f.childCanvasList.forEach(function(f){f=f.getObjects();for(var a=0;a<f.length;a++)f[a].name&&"galImage"===f[a].name&&(q=!0)})}),q||setTimeout(function(){c.trigger("click")},50)));a||h||(d.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-hidden"),k.addClass("a-active"),k.parents(".a-tab-container").find('.a-tab-content[data-a-name="makeOwn"]').addClass("a-hidden").siblings('.a-tab-content[data-a-name="gallery"]').removeClass("a-hidden").addClass("a-active"))}};
m.fulfillmentJSON=function(){var f={},a=m.getObjects(),h,b;m.canvas.deactivateAll();b=function(){var f,a;a={};if("TextPrinting"===m.data.customizationType){for(a=0;a<m.surface.data.FontSettings.colors.length;a++)if(m.surface.data.FontSettings.colors[a].value===m.surface.color){f=m.surface.data.FontSettings.colors[a].name;break}a=m.data.customizationTypeSettings.TextPrinting.placeHolderText;a={fontFamily:m.surface.fontName,text:m.controls.simpleTextInput.inputBox.val(),fill:m.surface.color,customizationType:"TextPrinting",
label:a?a:""};f&&(a.colorName=f)}else"Options"===m.data.customizationType&&(q.isT1("AC_PRODUCT_CONFIGURATOR_DP_75265")||q.isT1("AC_PRODUCT_CONFIGURATOR_DP_MOBILE_83123"))&&(a=m.data.customizationTypeSettings.Options.label,a={optionId:m.controls.configurator.optionId,optionValue:m.controls.configurator.selectedConfigurator?m.controls.configurator.selectedConfigurator:"notSelected",optionImage:m.controls.configurator.configuratorImageUrl,label:a?a:"",priceDelta:m.controls.configurator.priceDelta,customizationType:"Options"});
return a};f.name=m.name;"Options"!==m.data.customizationType&&(f.Position=m.data.specifications.position,f.Dimensions=m.data.specifications.dimension);if("ImagePrinting"===m.surface.customizationType){for(b=0;b<a.length;b++)if(a[b].name&&"galImage"===a[b].name){var c=a[b].originalURL;h="VendorGallery";f.vendorGalleryImagePath=c;f.vendorGalleryFileId=a[b].vendorGalleryFileId;f.vendorGalleryId=a[b].vendorGalleryId;f.customizationType="ImagePrinting"}else"text"!==a[b].type||a[b].text.replace(" ","").length||
a[b].remove();h||(h="SVG",f.canvas=m.canvas,f.customizationType="ImagePrinting")}else h="JSON",f=p.extend(f,b());"AC_ImgTxtPersonalization_3"===p("#amazonCustomUseCaseId").val()&&(f.id=m.id);f.fulfillmentType=h;return f};m.init=function(){m.isChild&&(m.bindControls(),m.bindEvents.hoverAndSelect(),m.controlRenderingHandle());if(1<=p(".ac-mobile-app").length)l.on("resize-preview-text",function(){m.controls.simpleTextInput&&m.controls.simpleTextInput.inputBox&&m.controls.simpleTextInput.inputBox.trigger("keyup");
m.controls.configurator&&q.isT1("AC_PRODUCT_CONFIGURATOR_DP_MOBILE_83123")&&m.controls.configurator.resizeConfiguratorPreview()});m.controls.simpleTextInput&&!m.controls.simpleTextInput.hasRequiredField()&&m.controls.simpleTextInput.hideIsRequiredLabel();(q.isT1("AC_PRODUCT_CONFIGURATOR_DP_75265")||q.isT1("AC_PRODUCT_CONFIGURATOR_DP_MOBILE_83123"))&&m.controls.configurator&&!m.controls.configurator.hasRequiredField()&&m.controls.configurator.hideIsRequiredLabel()}}})})();(function(){z.when("A","ac-base",
"fabric-js","ac-utils","ac-canvas","ac-color-picker","ac-font-picker","ac-configurator-picker","ac-constants","ac-base","acc-weblab","ready").register("ac-surface",function(l,n,g,e,c,d,b,a,k,f,h){var q=l.$;return function(a,t,r){var m={},v,E,D,x,H,I,J,y=[];m.isActive=!1;m.name="";m.productImageUrl="";m.maskImageUrl="";m.primaryCanvas=null;m.thumbnail=null;m.childCanvasList=[];m.controls={};m.id;m.font=n.getMerchantID()+"-Arial";m.customizationType=a.areas[0].customizationType;m.data=a;m.widget=t;
m.isApp=f.isApp();J=q("html.a-ie9").length||l.capabilities.isIE10;m.miniThumbnailCanvas=[];v=function(a,h){var b=new c(a,m);b.init();if(f.isApp())l.on("resize-preview-text",function(){if(h!==u){var f=e.getScaleRatio(),b;"Options"===h.customizationType?(b=k.optionImageDefaults.imageHeight*f,f*=k.optionImageDefaults.imageWidth):(b=h.specifications.dimension.height*f+5,f*=h.specifications.dimension.width);a.setWidth(f);a.setHeight(b)}});return b};D=function(){if(h.isT1("AC_PRODUCT_CONFIGURATOR_DP_75265")||
h.isT1("AC_PRODUCT_CONFIGURATOR_DP_MOBILE_83123")){if(m.hasRequiredField()&&m.requiredFieldsAreValid())return!0;if(!m.hasRequiredField())return m.hasFilledField()}else for(var f=q('.ac-controls-container[data-surface="surface-'+a.index+'"]').find('[type="text"]'),b=0;b<f.length;b++)if(f[b].value.length)return!0;return!1};E=function(f,a){var h,b,c,d,p,t,r=m.isApp,v;if(a.isChild)return null;"Options"===f.customizationType?(b=k.optionImageDefaults.imageTop,c=k.optionImageDefaults.imageLeft,d=k.optionImageDefaults.canvasHeight,
p=k.optionImageDefaults.imageWidth,t=k.optionImageDefaults.angle):(b=f.specifications.position.y,c=f.specifications.position.x,d=f.specifications.dimension.height,p=f.specifications.dimension.width,t=f.specifications.angle?f.specifications.angle:0);h=document.createElement("canvas");h.id=m.id+"-area-"+f.index;h.className+=" canvasArea";r?(v=e.getScaleRatio(),h.setAttribute("data-left",c*v),h.setAttribute("data-top",b*v),h.setAttribute("data-initial-left",c),h.setAttribute("data-initial-top",b),h.setAttribute("data-initial-width",
p),h.setAttribute("data-initial-height",d),h.setAttribute("data-angle",t),h.height=d*v+5,h.width=p*v):(h.setAttribute("data-left",c),h.setAttribute("data-top",b),h.setAttribute("data-angle",t),h.height=d+5,h.width=p);q('.ac-preview-container[data-surface="'+m.id+'"]').append(h);h.getContext("2d");var E=new g.Canvas(h.id,{allowTouchScrolling:!0});t="rotate("+t+"deg)";r?q(h).parent(".canvas-container").css({width:p*v,height:d*v,position:"absolute",top:b*v+"px",left:c*v+"px","-ms-transform":t,"-webkit-transform":t,
transform:t}):q(h).parent(".canvas-container").css({position:"absolute",top:b+"px",left:c+"px","-ms-transform":t,"-webkit-transform":t,transform:t});E.isChild=!0;E.parent=a;E.index=f.index;return E};x=function(f){var b=new Image;b.crossOrigin="anonymous";b.src=a.preview.url;b.onload=function(){f.canvas.setBackgroundImage(new g.Image(b,{originX:"left",originY:"top",left:0,top:0}),function(){f.renderAll.bind(f.canvas);h.isT1("AC_THUMBNAIL_NEW_84598")||e.debounce(m.updateThumbnail(),50)})};if(a.mask&&
a.mask.url){var c=new Image;c.crossOrigin="anonymous";c.src=a.mask.url;c.style.top="-"+a.areas[0].specifications.position.y+"px";c.style.left="-"+a.areas[0].specifications.position.x+"px";c.style.width=k.defaults.maskWidth+"px";c.style.height=k.defaults.maskHeight+"px";c.style.maxWidth="none";c.onload=function(){f.canvas.setOverlayImage(new g.Image(c,{originY:"top",originX:"left",left:0,top:0}),function(){f.renderAll.bind(f.canvas);h.isT1("AC_THUMBNAIL_NEW_84598")||e.debounce(m.updateThumbnail(),
25)});q("#"+m.id+"-area-0").after(c)}}};H=function(f){for(var b,c=0,k=0;k<a.areas.length;k++)if("Options"===a.areas[k].customizationType){if(h.isT1("AC_PRODUCT_CONFIGURATOR_DP_75265")||h.isT1("AC_PRODUCT_CONFIGURATOR_DP_MOBILE_83123"))y.splice(c,0,k),c++}else y.push(k);for(k=0;k<y.length;k++)c=y[k],b=a.areas[c],b.index=c,b=m.isApp?v(E(b,f),b):v(E(b,f)),0===c&&m.setActiveArea(b),f.childCanvas.push(b);x(f);return f.childCanvas};I=function(){var f,a=m.data.areas[0].customizationTypeSettings.ImagePrinting.galleries,
h,b=!1,c,k;q("#ac-gallery.vendor-categories > .vendor-category").css({display:"none"});m.data.areas[0].customizationTypeSettings.ImagePrinting.defaultGallery&&(h=m.data.areas[0].customizationTypeSettings.ImagePrinting.defaultGallery);for(var d=0;d<a.length;d++)if(f="",f="/"===a[d].charAt(0)?a[d].substr(1,a[d].length):a[d])c=q('#ac-gallery.vendor-categories > .vendor-category > a[data-themename="'+f+'"]'),k=q('#ac-gallery.vendor-categories > .vendor-category > a[data-categoryid="'+f+'"]'),c.length?
(c.parent(".vendor-category").css({display:"block"}),h&&h.substr(1,h.length)===f&&(c.trigger("click"),b=!0)):k.length&&(k.parent(".vendor-category").css({display:"block"}),h&&h.substr(1,h.length)===f&&(k.trigger("click"),b=!0));b||q("#ac-gallery.vendor-categories > .vendor-category > a").each(function(f,a){"block"===q(a).parent(".vendor-category").css("display")&&q(a).trigger("click")})};m.setActiveArea=function(f){for(var a=0;a<m.childCanvasList.length;a++)m.childCanvasList[a].isActive=!1;f.isActive=
!0;return f};m.updateTickerOnTab=function(){D()?q(".pc-surface-nav-carousel").find('[data-surface-num="'+(a.index+1)+'"]').addClass("customized"):q(".pc-surface-nav-carousel").find('[data-surface-num="'+(a.index+1)+'"]').removeClass("customized")};m.getActiveArea=function(){var f,a;for(f=0;f<m.childCanvasList.length;f++)!0===m.childCanvasList[f].isActive&&(a=m.childCanvasList[f]);return a};m.hasRequiredField=function(){return l.reduce(m.childCanvasList,function(f,a){return f||a.hasRequiredField()},
!1)};m.requiredFieldsAreValid=function(){return l.reduce(m.childCanvasList,function(f,a){return f&&a.requiredFieldsAreValid()},!0)};m.hasFilledField=function(){return l.reduce(m.childCanvasList,function(f,a){return f||a.isValid()},!1)};m.emphasizeMissingFields=function(){l.each(m.childCanvasList,function(f){f.requiredFieldsAreValid()||f.emphasizeMissingField()});var f=m.getThumbnailImage().parent();f.hasClass("active")||f.addClass("error")};m.containsEmoji=function(){return l.reduce(m.childCanvasList,
function(f,a){return f||a.containsEmoji()},!1)};m.enableBuyBox=function(){for(var f=!1,a=0;a<m.childCanvasList.length;a++)if(!0===m.childCanvasList[a].enableBuyBox||"Options"===m.childCanvasList[a].data.customizationType){f=!0;break}return f};m.getThumbnailImage=function(){return q(".thumbnail-container").find('.thumbnail-image[ac-target="'+m.id+'"]')};m.setPrimaryCanvas=function(){var f;f=v(new g.Canvas("ac-preview-canvas-"+m.id,{allowTouchScrolling:!0}));f.isChild=!1;return f};m.updatePrimaryCanvas=
function(f){if(!h.isT1("AC_THUMBNAIL_NEW_84598")){for(var a,b,c,k,d=!1,p=0,r=0;r<y.length;r++)if(y[r]===f){p=r;break}a=function(){var a={};a.height=m.primaryCanvas.childCanvas[p].canvas.height;a.width=m.primaryCanvas.childCanvas[p].canvas.width;a.top=q("canvas#"+m.id+"-area-"+f).data("top");a.left=q("canvas#"+m.id+"-area-"+f).data("left");a.angle=q("canvas#"+m.id+"-area-"+f).data("angle");return a};if(m.primaryCanvas.childCanvas[p]){var v=m.primaryCanvas.childCanvas[p].getObjects(),E;k=m.primaryCanvas.getObjects();
for(r=m.primaryCanvas.canvas.size()-1;0<=r;r--)k[r].areaId!==u&&k[r].areaId===p&&m.primaryCanvas.canvas.remove(k[r]);if(v.length)if(1!==v.length||"text"!==v[0].type||""!==v[0].text&&" "!==v[0].text){d=!0;for(r=m.primaryCanvas.childCanvas[p].canvas.size()-1;0<=r;r--)v[r].active&&(E=v[r]);c=a();var D=function(f){var a={},h=!1,a={left:-f.width/2,top:-f.height/2,width:f.width,height:f.height};0>f.left?(h=!0,a.left=-f.width/2-f.left,f.width+f.left>c.width&&(a.width=c.width)):f.width+f.left>c.width&&(h=
!0,a.left=-f.width/2-(f.width+f.left-c.width));0>f.top?(h=!0,a.top=-f.height/2-f.top,f.height+f.top>c.height&&(a.height=c.height)):f.height+f.top>c.height&&(h=!0,a.top=-f.height/2-(f.height+f.top-c.height));a.clipNeeded=h;return a};a=function(){m.primaryCanvas.canvas.forEachObject(function(f){f.areaId===p&&f.remove()});J?m.primaryCanvas.childCanvas[p].canvas.forEachObject(function(a){var h=g.util.object.clone(a);m.primaryCanvas.canvas.calcOffset();m.primaryCanvas.canvas.add(h);if("image"===h.type){h.sendToBack();
try{var k={},d,q,t,r;d=h.getBoundingRect();k=D(d);q=new g.Rect({left:c.left,top:c.top,height:c.height,width:c.width,selectable:!1,fill:"none",strokeWidth:0,opacity:0});m.primaryCanvas.canvas.add(q);t=function(f){return Math.PI/180*f};r=function(f,a){a.setCoords();f.save();f.translate(-(a.width/2)+q.strokeWidth,-(a.height/2)+q.strokeWidth);f.rotate(t(-1*a.angle));f.scale(1,1);f.beginPath();f.rect(q.left-a.oCoords.tl.x,q.top-a.oCoords.tl.y,q.width,q.height);f.closePath();f.restore()};h.clipTo=function(f){return r(f,
h)}}catch(v){}}"text"===h.type?""===h.text.replace(/\s/g,"")?m.primaryCanvas.canvas.remove(h):(k={},d=h.getBoundingRect(),k=D(d),k.clipNeeded?(b=h.toDataURL(),g.Image.fromURL(b,function(a){a.set({top:d.top+c.top,left:d.left+c.left,selectable:!1,areaId:f});m.primaryCanvas.canvas.remove(h);h=a;m.primaryCanvas.canvas.add(a);a.clipTo=function(f){f.rect(k.left,k.top,k.width,k.height)};m.primaryCanvas.canvas.renderAll();e.debounce(m.updateThumbnail(),50)})):(h.left+=c.left,h.top+=c.top,h.areaId=f)):(h.left+=
c.left,h.top+=c.top,h.areaId=p);h.setCoords()}):(b=m.primaryCanvas.childCanvas[p].canvas.toDataURL("png"),g.Image.fromURL(b,function(f){f.set({height:c.height,width:c.width,top:c.top,left:c.left,selectable:!1});f.areaId=p;m.primaryCanvas.canvas.add(f);m.primaryCanvas.canvas.renderAll();e.debounce(m.updateThumbnail(),50)}));m.primaryCanvas.canvas.renderAll()};E?(m.primaryCanvas.childCanvas[p].canvas.deactivateAll(),a(),m.primaryCanvas.childCanvas[p].canvas.setActiveObject(E)):a()}else m.primaryCanvas.childCanvas[p].canvas.deactivateAll();
e.debounce(m.updateThumbnail(),50);m.primaryCanvas.childCanvas[p].enableBuyBox=!!d;t.buybox.verify()}}};m.updateActiveCanvas=function(f){var a=!1;if(m.primaryCanvas.childCanvas[f]){var h=m.primaryCanvas.childCanvas[f].getObjects(),b;if(h.length)if(1===h.length&&"text"===h[0].type&&""===h[0].text.replace(" ",""))m.primaryCanvas.childCanvas[f].canvas.deactivateAll();else{for(var a=!0,c=m.primaryCanvas.childCanvas[f].canvas.size()-1;0<=c;c--)h[c].active&&(b=h[c]);b&&(m.primaryCanvas.childCanvas[f].canvas.deactivateAll(),
m.primaryCanvas.childCanvas[f].canvas.setActiveObject(b))}m.primaryCanvas.childCanvas[f].enableBuyBox=!!a;t.buybox.verify()}};m.updateThumbnail=function(){if(!h.isT1("AC_THUMBNAIL_NEW_84598")){if(!m.widget.showThumbnail||"Options"===m.customizationType&&!h.isT1("AC_PRODUCT_CONFIGURATOR_DP_75265")&&!h.isT1("AC_PRODUCT_CONFIGURATOR_DP_MOBILE_83123"))return null;try{if("TextPrinting"!==m.customizationType&&"Options"!==m.customizationType||J){var f,a,b,c,d;f=k.defaults.thumbnailHeight/k.defaults.galHeight;
d=m.getThumbnailImage();d.find(".ieThumbnail-bg").length||(a=q("<img />",{"class":"ieThumbnail-bg",src:m.data.preview.url,alt:"Thumbnail Image",height:k.defaults.thumbnailHeight+"px",width:k.defaults.thumbnailWidth+"px"}));d.html(a);b=function(a,h){var b,c,k,d,e,p;c=a.position.y*f;k=a.position.x*f;d=a.dimension.height*f;e=a.dimension.width*f;p=a.angle?r.specifications.angle:0;b=document.createElement("canvas");b.id="thumbnail-"+m.id+"-area-"+h;b.className+="thumbnail-canvasArea";b.height=d;b.width=
e;m.getThumbnailImage().append(b);b.getContext("2d");d=new g.Canvas(b.id);p="rotate("+p+"deg)";q(b).parent(".canvas-container").css({position:"absolute",top:c+"px",left:k+"px","-ms-transform":p,"-webkit-transform":p,transform:p});return d};for(a=0;a<m.childCanvasList.length;a++){if(q("#thumbnail-"+m.id+"-area-"+a).length)c=m.miniThumbnailCanvas[a],c.clear();else{if("Options"===m.childCanvasList[a].data.customizationType){var e={position:{}};e.position.x=k.optionImageDefaults.imageLeft;e.position.y=
k.optionImageDefaults.imageTop;e.dimension={};e.dimension.height=k.optionImageDefaults.imageHeight;e.dimension.width=k.optionImageDefaults.imageWidth;c=b(e,a)}else c=b(m.childCanvasList[a].data.specifications,a);m.miniThumbnailCanvas[a]=c}"ImagePrinting"===m.customizationType?m.childCanvasList[a].canvas.forEachObject(function(a){var h=g.util.object.clone(a);c.calcOffset();c.add(h);h.top=a.top*f;h.left=a.left*f;h.scaleX*=f;h.scaleY*=f;h.selectable=!1;c.deactivateAll();"text"!==h.type&&h.sendToBack();
h.setCoords();c.renderAll()}):"TextPrinting"===m.customizationType&&function(a,h){g.Image.fromURL(a,function(a){h.add(a);a.scaleX=f;a.scaleY=f;a.selectable=!1;h.renderAll()})}(m.childCanvasList[a].canvas.toDataURL("png"),c)}if(m.data.mask&&m.data.mask.url&&!d.find(".ieThumbnail-mask").length){var p=q("<img />",{"class":"ieThumbnail-mask",src:m.data.mask.url,alt:"Thumbnail Mask Image"});q(p).load(function(){var a,h;a=this.naturalHeight;h=this.naturalWidth;q(this).height(a*f).width(h*f)});d.find(".canvas-container").after(p)}}else e=
m.primaryCanvas.canvas.toDataURL("png"),m.getThumbnailImage().html("<img src='"+e+"' class='thumbnail-image "+m.id+"' />")}catch(t){return console.log(t),null}}};m.activateSurface=function(){t.setActiveSurface(m.id);"ImagePrinting"===m.customizationType&&(m.getActiveArea().resetControls(),m.getActiveArea().controlRenderingHandle());"TextPrinting"===m.customizationType&&q("#ac-simple-text-font-picker",q("div[data-surface='"+m.id+"']")).val(m.font)};m.bindEvents=function(){q(".thumbnail-container .ac-thumbnail.surface-0").addClass("active");
q(".thumbnail-container").delegate('[ac-target="'+m.id+'"]',"click",function(){if("block"===q('.ac-preview-container[data-surface="'+m.id+'"]').css("display").toLowerCase())return null;q(".ac-thumbnail").removeClass("active");q(".ac-thumbnail."+m.id).addClass("active");q(".ac-thumbnail."+m.id).removeClass("error");q(".ac-preview-container").css("display","none").parent().find('[data-surface="'+m.id+'"]').css("display","block");"ImagePrinting"===m.customizationType?(q(".ac-controls-container").css("display",
"none").parent().find(".ac-controls-container.ac-image-text-control").css("display","block"),m.data.areas[0].customizationTypeSettings.ImagePrinting.galleries&&I(),q(".ac-single-text-preview-guideline").css({display:"none"})):(q(".ac-controls-container").css("display","none").parent().find('[data-surface="'+m.id+'"]').css("display","block"),q(".pc-two-column-layout .ac-delete-button").fadeOut(),q(".ac-single-text-preview-guideline").css({display:"block"}));m.activateSurface()});return I};m.notifySubscribers=
function(f,a){switch(f){case "colorpicker":m.color=a;for(var h=0;h<m.childCanvasList.length;h++)m.childCanvasList[h].controls.simpleTextInput&&(m.childCanvasList[h].controls.simpleTextInput.changePreview(),l.trigger("amazon-custom-log-ref-tag","FontColorChange"));break;case "fontpicker":for(m.font=a,h=0;h<m.childCanvasList.length;h++)m.childCanvasList[h].controls.simpleTextInput&&(m.childCanvasList[h].controls.simpleTextInput.changePreview(),l.trigger("amazon-custom-log-ref-tag","FontChange"))}};
m.bindControls=function(){var f=q(".ac-surface-control."+m.id),a;l.each(f,function(f){a=q(f).attr("data-control-template");switch(a){case "colorpicker":f=new d(f,m);m.controls.colorPicker=f;break;case "fontpicker":f=new b(f,m),m.controls.fontPicker=f}})};m.initiateEvents=function(){};m.fulfillmentJSON=function(){var f={},h=[];f.name=m.name;if(q("#amazonCustomUseCaseId").length&&"AC_ImgTxtPersonalization_3"===q("#amazonCustomUseCaseId").val()){f.images={};a.preview&&a.preview.url&&(f.images.previewUrl=
a.preview.url);a.mask&&a.mask.url&&(f.images.maskUrl=a.mask.url);if("TextPrinting"===m.customizationType){f.font={};if("ac_"===m.font.substring(0,3)){f.font.isDefault=0;var b=m.data.FontSettings.fonts.filter(function(f){if(f.name===m.fontName)return!0});1===b.length&&(f.font.fontUrl=b[0].fontURL)}else f.font.isDefault=1;f.font.fontName=m.fontName}f.id=m.id}for(b=0;b<m.childCanvasList.length;b++)h.push(m.childCanvasList[b].fulfillmentJSON());f.areas=h;return f};m.init=function(){m.name=a.name;m.isActive=
a.isActive;m.id="surface-"+a.index;m.productImageUrl=a.preview.productImageUrl;m.maskImageUrl=a.preview.maskImageUrl;m.primaryCanvas=m.setPrimaryCanvas();m.childCanvasList=H(m.primaryCanvas);m.bindEvents();m.bindControls();m.initiateEvents()};m.init();return m}})})();(function(){z.when("A","ac-base","ready").register("ac-utils",function(l,n){var g=l.$,e,c,d,b;e={};c=function(a){var b=null;try{b=l.state(a)?l.state(a):null}catch(f){b=null}finally{return b}};b=function(){for(var a=g(".pc-customization-enabled script"),
b=0,f=a.length;b<f;b++)if(!g.data(a[b],"a-eval")){var h=g(a[b]),c=h.attr("data-a-state");c&&(c=l.parseJSON(c),c.key&&(h=l.parseJSON(h.html()),l.state.replace(c.key,h)))}return!0};e.init=function(){b();d=c("wssStringArray")};e.getState=function(a,k){if(k){var f=!1,f=b();if(!f)return}d||(d=c("wssStringArray"));return c(a)};e.validator=function(){var a={AlphaNumeric:function(a){return!0},Digits:function(a){return/^[\s\d]*$/.test(a)}};return{Validate:function(b,f){return a[f]!==u&&"function"===typeof a[f]?
a[f](b):!0}}};e.debounce=function(a,b,f){var h;return function(){var c=this,d=arguments,e=f&&!h;clearTimeout(h);h=setTimeout(function(){h=null;f||a.apply(c,d)},b);e&&a.apply(c,d)}};e.showDialog={show:function(a,b,f){f&&f.ok?g(".ac-btn.ac-btn-dialog-ok").text(f.ok):null;f&&f.cancel?g(".ac-btn.ac-btn-dialog-cancel").text(f.cancel):null;a?g("#ac-dialog-confirm p").html(a):null;g("#ac-dialog-confirm").fadeIn();g(".ac-image-backdrop").fadeIn();g("#ac-dialog-confirm").undelegate(".ac-btn-dialog-ok","click");
g("#ac-dialog-confirm").delegate(".ac-btn-dialog-ok","click",function(){g("#ac-dialog-confirm").fadeOut();g(".ac-image-backdrop").fadeOut();b()});g("#ac-dialog-confirm").undelegate(".ac-btn-dialog-cancel","click");g("#ac-dialog-confirm").delegate(".ac-btn-dialog-cancel","click",function(){g("#ac-dialog-confirm").fadeOut();g(".ac-image-backdrop").fadeOut();f&&f.cancelCallBack?f.cancelCallBack():null;e.imageLoading.hide()})}};e.imageLoading={show:function(){g(".ac-image-loader").fadeIn();g(".ac-image-backdrop").fadeIn()},
hide:function(){g(".ac-image-loader").fadeOut();g(".ac-image-backdrop").fadeOut()}};e.arrFilterUnique=function(a){return a.filter(function(a,f,h){return h.indexOf(a)===f})};e.stringHandler=function(a){return d&&d[a]?d[a]:""};e.getScaleRatio=function(){var a=1;if(n.isApp()){var b=g(".ac-surface-background-image"),a=b.width();b.height();b=b.get()[0].naturalWidth;a/=b}return a};return e})})();(function(){z.when("A","fabric-js","ac-base","BuyBox","ac-constants","ac-surface","ac-utils","ac-gallery","ac-image-gallery",
"acc-weblab","ready").register("ac-widget",function(l,n,g,e,c,d,b,a,k,f){var h=l.$;return function(){var f=this,k,t;f.surfaceList=[];f.data={};f.showThumbnail=!0;f.acTempCanvas=new n.Canvas("acTempCanvas",{allowTouchScrolling:!0});t=function(){h(".pc-two-column-layout").delegate(".ac-delete-button","click",function(){var a=f.getActiveArea();a.canvas.forEachObject(function(f){var h;if(f&&f.active||f&&f.name&&"galImage"===f.name)f.type&&"text"===f.type&&(h=a.controls.textInput.cleared),f.name&&"cusImage"===
f.name&&(h=a.controls.imageUpload.cleared),h&&h(),a.canvas.remove(f)});a.canvas.discardActiveGroup();h(".pc-two-column-layout .ac-delete-button").fadeOut();a.renderAll()})};f.getActiveSurface=function(){for(var a=null,h=0;h<f.surfaceList.length;h++)!0===f.surfaceList[h].isActive&&(a=f.surfaceList[h]);return a};f.setActiveSurface=function(a){for(var h=0;h<f.surfaceList.length;h++)f.surfaceList[h].isActive=!1,f.surfaceList[h].id===a&&(f.surfaceList[h].isActive=!0)};f.getActiveArea=function(){return f.getActiveSurface().getActiveArea()};
f.fulfillmentJSON=function(){var a={},b=[],k=[],d,e;e=f.acTempCanvas;e.setDimensions(c.outputSVGDimention);d=function(f){var a=c.scaleRatio,b,k,d,q;d=parseInt(h(f.lowerCanvasEl).parent(f.wrapperEl).css("top").replace("px",""),10);q=parseInt(h(f.lowerCanvasEl).parent(f.wrapperEl).css("left").replace("px",""),10);e.clear();f.forEachObject(function(f){f=n.util.object.clone(f);"rect"!==f.type&&(e.calcOffset(),e.add(f),"image"===f.type&&(f.sendToBack(),b=f.getSrc()),"text"===f.type&&""===f.text.replace(/\s/g,
"")&&e.remove(f),f.top+=d,f.left+=q,f.scaleX*=a,f.scaleY*=a,f.left*=a,f.top*=a,f.setCoords())});e.renderAll();b&&-1!==b.indexOf("._")&&-1!==b.indexOf("._")?(k=b.split("._")[0]+"."+b.split("_.")[1],f=e.toSVG(null,function(f){return f.replace(new RegExp(/xlink:href=\"\S*\"/),'xlink:href="'+k+'"').replace(/(<tspan\s(.*?)>)(.*?)(<\/tspan>)/g,"$1<![CDATA[$3]]\x3e$4")})):f=e.toSVG(null,function(f){return f.replace(/(<tspan\s(.*?)>)(.*?)(<\/tspan>)/g,"$1<![CDATA[$3]]\x3e$4")});return f};a.customizationInfo=
{fulfillmentDetails:f.data.fulfillmentDetails,"version3.0":{surfaces:[]}};a.merchantId=g.getMerchantID();for(var p=0;p<f.surfaceList.length;p++)b.push(f.surfaceList[p].fulfillmentJSON());for(p=0;p<b.length;p++)for(var t=0;t<b[p].areas.length;t++)"SVG"===b[p].areas[t].fulfillmentType?(b[p].areas[t].svgImage=d(b[p].areas[t].canvas),delete b[p].areas[t].canvas):b[p].areas[t].fulfillmentType||b[p].areas.splice(t,1);for(p=0;p<b.length;p++)b[p].areas.length&&k.push(b[p]);a.customizationInfo["version3.0"].surfaces=
k;return a};f.bindControls={galleryImage:function(){l.on("addGalleryImage",function(a){var h,c,k,d=!1;h=f.getActiveSurface();l.trigger("amazon-custom-log-ref-tag","logVendorGalleryTabClick");c=h.getActiveArea();if(1===c.getObjects().length&&"galImage"===c.getObjects()[0].name&&c.getObjects()[0].getSrc()===a.imageUrl)return null;h=b.stringHandler("pc-clear-custom-msg");k=function(){f.surfaceList.forEach(function(f){f.childCanvasList.forEach(function(f){for(var h=f.getObjects(),b=!1,c=0;c<h.length;c++)h[c].name&&
"galImage"===h[c].name&&h[c].getSrc()===a.imageUrl&&(b=!0);b?null:f.clear()})});c.addGalleryImage(a)};for(var e=0;e<f.surfaceList.length;e++){for(var p=0;p<f.surfaceList[e].childCanvasList.length;p++){var t,g=f.surfaceList[e].childCanvasList[p];t=g.getObjects();for(var n=g.canvas.size()-1;0<=n;n--)if("text"===t[n].type&&!t[n].text.replace(" ","").length)t[n].remove(),g.controls.textInput.isControlActive=!1;else if(t[n].name&&"cusImage"===t[n].name||"text"===t[n].type){d=!0;break}if(d)break}if(d)break}d?
b.showDialog.show(h,k,{ok:"Clear"}):k()})},uploadImage:function(){l.off("addCustomerImage");l.on("addCustomerImage",function(a){var h,c,k,d=!1;h=f.getActiveSurface().getActiveArea();h.getObjects();c=b.stringHandler("pc-clear-design-msg");k=function(){f.surfaceList.forEach(function(f){f.childCanvasList.forEach(function(f){for(var a=f.getObjects(),h=0;h<a.length;h++)a[h].name&&"galImage"===a[h].name&&f.clear()})});h.addCustomerImage(a)};f.surfaceList.forEach(function(f){f.childCanvasList.forEach(function(f){f=
f.getObjects();for(var a=0;a<f.length;a++)if(f[a].name&&"galImage"===f[a].name){d=!0;break}})});d?b.showDialog.show(c,k,{ok:"Clear"}):k()});h(".ac-image-text-container").delegate(".ac-btn-makeOwn.ac-imageUpload","click",function(){h(".ac-imageUpload-control").addClass("active");h(".ac-btn-makeOwn.ac-imageUpload").addClass("active");h(".ac-textInput-control").removeClass("active");h(".ac-btn-makeOwn.ac-textInput").removeClass("active");f.getActiveSurface().getActiveArea().setActiveControl("imageUpload");
l.trigger("amazon-custom-log-ref-tag","logCustomImageTabClick")})},textOnImage:function(){(function(){h("#pcTextArea").unbind().bind("keyup",function(a){a=h(this).val().replace('"',"''");h(this).val(a);if(50<a.length)return a=a.substring(0,50),h(this).val(a),null;f.getActiveArea().controls.textInput.imgText.updateText(a);h(this).val()});h(".pc-textArea-fontStyle-li").unbind().bind("click",function(){h(this).toggleClass("button-active");var a=h(this).attr("data-style"),a=h(this).hasClass("button-active")?
a+"on":a+"off";f.getActiveArea().controls.textInput.imgText.toggleStyle(a)});h(".pc-textArea-fontAlign-li").unbind().bind("click",function(){h(".pc-textArea-fontAlign-li").removeClass("button-active");h(this).addClass("button-active");var a=h(this).attr("data-align");f.getActiveArea().controls.textInput.imgText.changeAlign(a)});l.off("a:dropdown:fontPicker:select");l.on("a:dropdown:fontPicker:select",function(a){f.getActiveArea().controls.textInput.imgText.changeFont(a.value)});h(".pc-textArea-fontColor-li").unbind().bind("click",
function(){f.getActiveArea().controls.textInput.imgText.changeTextColor(h(this).find("div").attr("data-color"))});l.off("a:popover:show:text-color");l.on("a:popover:show:text-color",function(f){f.popover.$popover.css("z-index",999999)});l.off("slideUpTextArea");l.on("slideUpTextArea",function(){var f=h(".pc-textArea-overlay");f.parents().is(":hidden")?f.hide():f.slideUp(100,function(){h("#pcTextArea").focus()})});l.off("slideDownTextArea");l.on("slideDownTextArea",function(){h(".pc-textArea-overlay").slideDown()})})();
h(".ac-image-text-container").delegate(".ac-btn-makeOwn.ac-textInput","click",function(){var a;h(".ac-imageUpload-control").removeClass("active");h(".ac-btn-makeOwn.ac-imageUpload").removeClass("active");h(".ac-textInput-control").addClass("active");h(".ac-btn-makeOwn.ac-textInput").addClass("active");a=f.getActiveArea();a.controls.textInput.imgText.updateControl();a.controls.textInput.imgText.select();a.setActiveControl("textInput");l.trigger("slideUpTextArea");l.trigger("amazon-custom-log-ref-tag",
"logAddTextTabClick")})}};f.initiateBuyBox=function(){(new e({controller:{getJSON:f.fulfillmentJSON}})).Init()};f.buybox={enable:function(){l.trigger("enableBuybox")},disable:function(){l.trigger("disableBuybox")},block:function(f){l.trigger("blockBuybox",f)},unblock:function(){l.trigger("unblockBuybox")},showMissingCustomization:function(f){l.trigger("showMissingCustomization",f)},hideMissingCustomization:function(){l.trigger("hideMissingCustomization")},showMissingRequiredFields:function(f){l.trigger("showMissingRequiredFields",
f)},hideMissingRequiredFields:function(){l.trigger("hideMissingRequiredFields")},showContainingEmoji:function(f){l.trigger("showContainingEmoji",f)},hideContainingEmoji:function(){l.trigger("hideContainingEmoji")}};f.buybox.verify=function(){var a=!1,h,b,c=[];f.buybox.unblock();f.buybox.hideMissingRequiredFields();f.buybox.hideMissingCustomization();f.buybox.hideContainingEmoji();if(l.reduce(f.surfaceList,function(f,a){return f||a.hasRequiredField()},!1)){a=!0;for(h=0;h<f.surfaceList.length;h++){b=
f.surfaceList[h];var k=b.requiredFieldsAreValid();k||c.push(b);a=a&&k}a=!a;h=function(){l.each(c,function(f){f.emphasizeMissingFields()});f.buybox.showMissingRequiredFields({error:!0})}}else a=!l.reduce(f.surfaceList,function(f,a){return f||a.enableBuyBox()},!1),h=function(){f.buybox.showMissingCustomization({error:!0})};(b=l.reduce(f.surfaceList,function(f,a){return f||a.containsEmoji()},!1))&&(h=function(){f.buybox.showContainingEmoji({error:!0})});(a||b)&&f.buybox.block({callback:h});f.buybox.enable()};
f.init=function(){var c,e,g=!1,E=[],D;b.init();e=b.getState("ctsStateData",!0);f.data=e;for(var x=0;x<e.surfaces.length;x++){c=e.surfaces[x];c.index=x;0===x?c.isActive=!0:c.isActive=!1;c=new d(c,f);0===x&&(c.isActive=!0,"ImagePrinting"===c.customizationType?(h(".ac-single-text-preview-guideline").css({display:"none"}),h(".ac-image-text-preview-guideline").css({display:"block"})):h(".ac-single-text-preview-guideline").css({display:"block"}));if("ImagePrinting"===c.customizationType){var g=!0,H=c.data.areas[0].customizationTypeSettings.ImagePrinting.galleries;
H&&H.length&&(E=E.concat(H),!D&&c.data.areas[0].customizationTypeSettings.ImagePrinting.defaultGallery&&(D=c.data.areas[0].customizationTypeSettings.ImagePrinting.defaultGallery))}f.surfaceList.push(c)}1!==e.surfaces.length||"TextPrinting"!==e.surfaces[0].areas[0].customizationType&&"Options"!==e.surfaces[0].areas[0].customizationType||(h(".thumbnail-container").fadeOut("fast"),h(".ac-image-text-preview-guideline").fadeOut("fast"),h(".pc-two-column-layout .pc-input-controls").addClass("ac-single-text-only"),
h(".pc-two-column-layout .ac-controls-container").addClass("ac-single-text-only"),h(".pc-two-column-layout").addClass("ac-single-text-only"),h(".pc-atc-wrapper").addClass("a-button-span12"),h(".ac-price").addClass("ac-single-text-only"),h(".ac-quantity").addClass("ac-single-text-only"),f.showThumbnail=!1);E=b.arrFilterUnique(E);t();f.initiateBuyBox();!0===g&&(E.length&&(k=new a(null,E,D),k.Fetch()),f.bindControls.galleryImage(),f.bindControls.uploadImage(),f.bindControls.textOnImage())}}})})();z.when("A",
"ready").execute(function(l){function n(){g("html").hasClass("a-canvas")||(g(".pc-customization-disabled").addClass("active"),g(".pc-customization-enabled").remove())}var g=l.$;l.on("pc-single-text-loaded",function(){n()});n()});z.when("A","a-modal","ac-utils","ac-widget","ac-base","acc-weblab","ready").execute(function(l,n,g,e,c,d){var b=l.$,a=[],k=function(){if(1<=b(".ac-mobile-app").length){var f=b(".ac-surface-background-image"),a=f.width(),f=f.height();g.getScaleRatio();b(".canvas-container > .ac-parent-canvas").attr({width:a,
height:f}).css({width:a+"px",height:f+"px"});b(".canvas-container .canvasArea").each(function(f,a){var h=b(a).attr("data-initial-top"),c=b(a).attr("data-initial-left"),k=b(a).attr("data-initial-width"),d=b(a).attr("data-initial-height"),q=g.getScaleRatio();h!==u&&c!==u&&(b(a).attr({"data-top":parseInt(h,10)*q,"data-left":parseInt(c,10)*q}),b(a).parent().css({top:parseInt(h,10)*q,left:parseInt(c,10)*q,width:k+"px",height:d+"px"}))});b(".ac-preview-container").css({"min-height":f+10});l.trigger("resize-preview-text")}};
if(d.isT1("AMAZON_CUSTOM_BBQ_UPDATES_70086"))var f=function(){var f=b(".ac-surface-background-image"),a=f.width(),f=f.height();g.getScaleRatio();a?(b(".canvas-container > .ac-parent-canvas").attr({width:a,height:f}).css({width:a+"px",height:f+"px"}),b(".canvas-container .canvasArea").each(function(f,a){var h=b(a).attr("data-initial-top"),c=b(a).attr("data-initial-left"),k=b(a).attr("data-initial-width"),d=b(a).attr("data-initial-height"),q=g.getScaleRatio();h!==u&&c!==u&&(b(a).attr({"data-top":parseInt(h,
10)*q,"data-left":parseInt(c,10)*q}),b(a).parent().css({top:parseInt(h,10)*q,left:parseInt(c,10)*q,width:k+"px",height:d+"px"}))}),b(".ac-preview-container").css({"min-height":f+10}),l.trigger("resize-preview-text")):B.console&&console.log("Will not resize acWidget because .ac-surface-background-image has no size.")},k=l.debounce(function(){if(b(".ac-mobile-app").length){var a=b(".ac-surface-background-image");a.length?a[0].complete?f():a.first().load(k):B.console&&console.log(".ac-surface-background-image not found on page.")}},
25);l.on("a:popover:afterShow:pc-buybox-secondary-view",function(f){k();"false"===b("#pc-customize-now-div").attr("data-customization-clicked")&&((new e).init(),b("#pc-customize-now-div").attr("data-customization-clicked","true"));l.on("resize-preview",function(){k()})});l.on("a:popover:afterHide:pc-popover-content",function(f){l.trigger("amazon-custom-log-ref-tag","CloseClick");l.trigger("amazon-custom-popup-close",new Date)});d.isT1("AMAZON_CUSTOM_BBQ_UPDATES_70086")&&(l.on("a:popover:beforeShow:pc-popover-content",
function(){b(".pc-popover-footer-wrapper").hide()}),l.on("a:popover:afterShow:pc-popover-content",function(){b(".pc-popover-footer-wrapper").show()}));b("html").hasClass("a-canvas")&&(b(".pc-customization-disabled").remove(),l.declarative("popover-trigger","click",function(f){f=b(".pc-popover-button");var c=n.get(f);l.trigger("amazon-custom-log-ref-tag","CustomizeNowClick");if(null===c){if(0<a.length){for(c=0;c<a.length;c++)n.remove(a[c]);a.length=0}c=n.create(f,{name:"pc-popover-content",header:b(".pc-popover-header").html(),
activate:"onclick"});b(".pc-popover-header").remove();c.lock().show();a.push(c);f=b("#ASIN",b(".pc-buy-box",b(".pc-two-column-layout"))).val();b(".pc-two-column-layout").attr("asin",f);(new e).init()}}))});(function(){z.when("A","fabric-js","ac-utils","ac-base","ac-constants","acc-weblab","ready").register("ac-simple-textInput",function(l,n,g,e,c,d){var b=l.$;return function(a,k,f){var h={},d,p,t;e.isApp()?(h.inputBox=b(a).find(".pc-simple-text-input input"),h.errorClassTarget=b(a).find("div.pc-simple-text-input")):
(h.inputBox=b(a).find("input.pc-simple-text-input"),h.errorClassTarget=h.inputBox);h.isRequiredLabel=b(a).find(".isRequiredLabel");h.maxLength=parseInt(h.inputBox.attr("maxLength"),10);h.textLimitElement=b(a).find(".pc-char-limit-length");h.charType=b(h.inputBox).data("input-type");h.acCanvas=k;h.options=f;h.isEmpty=function(){var f=!1;""===h.inputBox.val().replace(/\s/g,"")&&(f=!0);return f};h.isValid=function(){return g.validator().Validate(h.inputBox.val(),h.charType)&&!h.isEmpty()};h.detectEmoji=
function(){return c.emojiMatchPattern.test(h.inputBox.val())};h.cleared=function(){h.inputBox.val("")};h.hasRequiredField=function(){return k.data&&k.data.customizationTypeSettings&&k.data.customizationTypeSettings.TextPrinting&&!!k.data.customizationTypeSettings.TextPrinting.isRequired};h.requiredFieldsAreValid=function(){return h.hasRequiredField()?h.isValid():!0};h.hideIsRequiredLabel=function(){b(h.isRequiredLabel).hide()};h.emphasizeMissingField=function(){h.addErrorClass();b(h.isRequiredLabel).addClass("a-color-error")};
h.containsEmoji=function(){return h.isValid()&&h.detectEmoji()};h.addErrorClass=function(){h.errorClassTarget.addClass("a-form-error")};h.removeErrorClass=function(){h.errorClassTarget.removeClass("a-form-error")};h.changePreview=function(f){f?f:f=h.inputBox.val();if(h.acCanvas.canvasObjects[h.acCanvas.id]!==u){var a=h.acCanvas.canvasObjects[h.acCanvas.id];a.forEachObject(function(f){h.acCanvas.canvasObjects[h.acCanvas.id].removeWithUpdate(f)});h.acCanvas.canvas.remove(a)}if(f&&f.replace(/\s+/g,"").length){a=
{fontFamily:h.acCanvas.surface.font,fontSize:h.acCanvas.canvas.height,fill:h.acCanvas.surface.color,selectable:!1,textAlign:"center",originX:"center",originY:"center",lockMovementX:!0,lockMovementY:!0,lineHeight:1.3/1.13};e.isApp()&&(a.fontSize=Math.round(h.acCanvas.canvas.height));f=new n.Text(f,a);a={originX:"center",originY:"center",fill:"",opacity:0,width:h.acCanvas.canvas.width,height:h.acCanvas.canvas.height,selectable:!1,lockMovementX:!0,lockMovementY:!0,clipTo:function(f){f.rect(-(h.acCanvas.canvas.width/
2),-(h.acCanvas.canvas.height/2),h.acCanvas.canvas.width,h.acCanvas.canvas.height+5)}};e.isApp()&&(a.width=Math.round(h.acCanvas.canvas.width),a.height=Math.round(h.acCanvas.canvas.height));var a=new n.Rect(a),b={left:0,top:0,width:h.acCanvas.canvas.width,height:h.acCanvas.canvas.height,lockScalingX:!0,lockScalingY:!0,lockMovementX:!0,lockMovementY:!0,selectable:!1,name:"simple-text"};e.isApp()&&(b.width=Math.round(h.acCanvas.canvas.width),b.height=Math.round(h.acCanvas.canvas.height));b=new n.Group([a,
f],b);h.acCanvas.canvasObjects[h.acCanvas.id]=b;h.acCanvas.canvas.add(b);p(f,a)}else h.acCanvas.renderAll();e.isApp()&&h.acCanvas.surface.updateTickerOnTab()};p=function(f,a){var c,k;b(".parentReferenceDiv").length?c=b(".parentReferenceDiv"):(c=b(document.createElement("div")),b(".ac-image-backdrop").after(b(c)));k=b(".referenceDiv").length?b(".referenceDiv"):b(document.createElement("div"));b(c).addClass("parentReferenceDiv");b(k).addClass("referenceDiv");b(k).css({"font-family":h.acCanvas.surface.font,
"font-size":f.getFontSize()});b(k).text(f.text);for(b(c).html(b(k));f.getWidth()>h.acCanvas.canvas.width-.1*h.acCanvas.canvas.width||b(k).height()>h.acCanvas.canvas.height-.1*h.acCanvas.canvas.height;)if(c=f.getFontSize(),2<c)--c,f.setFontSize(c-1),b(k).css({"font-size":c+"px"}),f.set({top:1.3/1.13*-c*(1-1/1.13)*.5}),f.setCoords();else break;h.acCanvas.renderAll()};t=function(){var f=h.inputBox.val(),a=parseInt(f.length,10),c=parseInt(h.maxLength,10),k=c;0<h.textLimitElement.length&&(k=c-a,0>k?(h.textLimitElement.html(0),
h.inputBox.val(f.substring(0,c))):h.textLimitElement.html(k));h.isValid()?(h.removeErrorClass(),b(h.isRequiredLabel).removeClass("a-color-error"),h.inputBox.siblings(".pc-input-invalid").removeClass("active"),h.changePreview(f)):(h.isEmpty()&&h.changePreview(f),h.isEmpty()?(h.inputBox.siblings(".pc-input-invalid").removeClass("active"),h.removeErrorClass()):(h.inputBox.siblings(".pc-input-invalid").addClass("active"),h.addErrorClass()),h.changePreview(""))};d=function(){h.inputBox.bind("keyup",function(f){t()});
h.inputBox.bind("change",function(f){t()});h.inputBox.bind("cut",function(f){setTimeout(function(){t()},100)});h.inputBox.bind("paste",function(f){setTimeout(function(){t()},100)})};h.init=function(){d()};h.init();return h}})})();(function(){z.when("A","a-popover","ac-utils","ac-base","ready").register("ac-color-picker",function(l,n,g,e){var c=l.$;return function(d,b){var a={};a.elem=d;a.notify=function(a){b.notifySubscribers("colorpicker",a)};a.bindEvents=function(){c(".ac-color-li",a.elem).bind("click",
function(){var b=c(this).find("div").attr("data-color"),f=n.get(c(".ac-color-picker-trigger",a.elem).parent());c(".ac-simplecolorpicker",a.elem).css("background-color",b);a.notify(b);f.hide()})};a.init=function(){c(".ac-is-single-color").length===c(".ac-controls-container").length?(a.notify(c(".ac-is-single-color").attr("data-color")),e.isApp()&&c(".ac-colorpicker").hide()):(a.bindEvents(),a.notify(c(".ac-color-li",a.elem).find("div").attr("data-color")))};a.init();return a}})})();(function(){z.when("A",
"a-dropdown","ac-utils","ready").register("ac-font-picker",function(l,n,g){var e=l.$;return function(c,d){var b={};b.elem=c;b.notify=function(a){d.notifySubscribers("fontpicker",a)};b.init=function(){e(".ac-simple-text-font-picker",c);var a;1<=e(".ac-mobile-app").length&&(a="pcFont"+e("#a",e("#addToCart")).val(),a=n.getSelect(a),a.update({option_prompt:a.getOption(0).info()[0].text}),1===a.getOptions().size()&&(a.update({status:"disabled"}),e(".ac-fontpicker").hide()));e("select",e(".ac-simple-text-font-picker",
e("div[data-surface='"+d.id+"']"))).change(function(){var a=e(this).val();d.fontName=e(this).find("option:selected").text();b.notify(a)});e("select option:first-child",e(".ac-simple-text-font-picker")).click().change()};b.init();return b}})})();(function(){z.when("A","a-dropdown","ac-utils","ac-base","ready").register("ac-configurator-picker",function(l,n,g,e){var c=l.$;return function(d,b){var a={};a.elem=d;a.acCanvas=b;a.selectedConfigurator="notSelected";a.configuratorImageUrl="";a.optionId="";
a.priceDelta={};a.priceDelta.value=0;a.priceDelta.currency="USD";a.preSelected="notSelected";var k={imageUrl:""};a.isRequiredLabel=c(d).find(".isRequiredLabel");a.errorClassTarget=c(d).find(".ac-configurator-dropdown");a.cleared=function(){for(var f=b.canvas.getObjects(),h=f.length-1;0<=h;h--)a.acCanvas.canvas.remove(f[h])};a.changePreview=function(f){a.cleared();var h=b.data.customizationTypeSettings.Options.possibleValues,c=0;if(f){for(var d=!1,t=0;t<h.length;t++)h[t].optionName===f&&(d=!0,k.imageUrl=
h[t].optionImage,a.configuratorImageUrl=h[t].optionImage,a.optionId=h[t].optionId,a.priceDelta.value=h[t].priceDelta.value,a.priceDelta.currency=h[t].priceDelta.currency,b.addConfiguratorImage(k)),h[t].optionName===a.preSelected&&(c=h[t].priceDelta.value);d||(a.selectedConfigurator="notSelected",a.configuratorImageUrl="",a.optionId="",a.priceDelta.value=0,a.priceDelta.currency="USD");e.isApp()&&a.acCanvas.surface.updateTickerOnTab()}a.changePrice(a.priceDelta,c);a.preSelected=f};a.resizeConfiguratorPreview=
function(){a.cleared();k&&k.imageUrl&&k.imageUrl!==u&&0<k.imageUrl.length&&b.addConfiguratorImage(k)};a.changePrice=function(f,a){if(null!==f&&null!==f.value){var b=parseFloat(c(".ac-price").find(".ac-price-value").text().replace(/[^0-9\.]+/g,"")),b=b+f.value-a,b=b.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g,"$1,");c(".ac-price").find(".ac-price-value").html("$"+b)}};a.emphasizeMissingField=function(){a.addErrorClass();c(a.isRequiredLabel).addClass("a-color-error")};a.hideIsRequiredLabel=function(){c(a.isRequiredLabel).hide()};
a.addErrorClass=function(){a.errorClassTarget.addClass("pc-drop-down-error")};a.removeErrorClass=function(){a.errorClassTarget.removeClass("pc-drop-down-error");c(a.isRequiredLabel).removeClass("a-color-error")};a.hasRequiredField=function(){return b.data&&b.data.customizationTypeSettings&&b.data.customizationTypeSettings.Options&&!!b.data.customizationTypeSettings.Options.isRequired};a.requiredFieldsAreValid=function(){return a.hasRequiredField()?a.isValid():!0};a.isValid=function(){return a.selectedConfigurator&&
"notSelected"!==a.selectedConfigurator};a.init=function(){b.renderAll();c("select",c(".ac-configurator-picker",".ac-area-control."+a.acCanvas.id)).change(function(){var f=c(this).val();a.selectedConfigurator=f;c(this).find("option:selected").text();a.changePreview(f);a.removeErrorClass()});c("select option:first-child",c(".ac-configurator-picker")).click().change()};a.init();return a}})})();(function(){z.when("A","ready").register("ac-constants",function(l){return{AssetType:{IMAGE:"image"},StatusCode:{NON_HTML5_BROWSER:"NON-HTML5-BROWSER",
NON_IMAGE_TYPE:"NON-IMAGE-TYPE",INVALID_FILE_TYPE:"INVALID_FILE_TYPE",READ_SUCCESS:"READ-SUCCESS",READ_NOT_REQUIRED:"READ_NOT_REQUIRED",INVALIDFILESIZE:"INVALID-FILE-SIZE"},defaults:{thumbnailWidth:80,thumbnailHeight:80,thresholdImageWidth:50,thresholdImageHeight:50,galWidth:400,galHeight:400,maskWidth:400,maskHeight:400},scaleRatio:8,outputSVGDimention:{height:3200,width:3200},textDefaults:{fontFamily:"Arial, Helvetica, sans-serif",fontWeight:"normal",fontStyle:"normal",textDecoration:"none",textAlign:"left",
fill:"#FF9900",text:"",angle:0,opacity:1,fontSize:20},optionImageDefaults:{imageWidth:400,imageHeight:400,canvasHeight:395,imageLeft:0,imageTop:0,angle:0},emojiMatchPattern:/[\u2600-\u27BF]|\uD83C[\uDDE0-\uDFFF]|\uD83D[\uDC00-\uDE4F]|\uD83E[\uDD00-\uDDFF]|\uD83D[\uDE80-\uDEFF]/}})})();(function(){z.when("A","ac-utils","ac-gallery-base","ac-constants","ac-error-handling","ready").register("ac-image-gallery",function(l,n,g,e,c){var d=l.$,b=function(){};b.prototype=new g;b.prototype.Init=function(){};
d.extend(b.prototype,{getMediaServerUrl:function(){var a="",a="._SL80_";return"https://images-na.ssl-images-amazon.com/images/S/"+this.bucket+"/"+this.getResourcePath()+a+this.extension},isValidFile:function(a,b){var f=e.StatusCode;if("undefined"!==typeof FileReader){var h=a.name.toLowerCase();if(/(jpg|jpeg|png)$/i.test(h)){var c=new FileReader;c.onload=function(h){var d=new Image,e=a.size/1024;7168<e?b({statusCode:f.INVALIDFILESIZE}):(d.onload=function(){b&&"function"===typeof b&&b({statusCode:f.READ_SUCCESS,
imageHeight:d.height,imageWidth:d.width,imageSize:e})},d.onerror=function(){b&&"function"===typeof b&&b({statusCode:f.INVALID_FILE_TYPE})},d.src=c.result)};c.readAsDataURL(a)}else b&&"function"===typeof b&&b({statusCode:f.INVALID_FILE_TYPE})}else b&&"function"===typeof b&&b({statusCode:f.NON_HTML5_BROWSER})},setKey:function(a){this.resourcePath=this.getResourcePath();this.extension=this.getFileExtension();this.key=this.resourcePath+this.extension},isValidFileType:function(a){return/(jpg|jpeg|png)$/i.test(a.name.toLowerCase())?
!0:!1},createResourceStub:function(a,b){var f=d(".ac-custom-image-container").clone();f.find("img").attr("id","ac-custom-image-"+b);a.parent().find("#ac-custom-upload-preview-container").append(f)},updateView:function(a,b){b===e.StatusCode.NON_HTML5_BROWSER?this.validateImage(a):this.updateImage(a)},displayWarningIfRequired:function(a){var b=e.defaults.thresholdImageWidth,f=e.defaults.thresholdImageHeight,h=a.imageHeight,d=a.imageWidth;a=h>d?h:d;h=h>d?d:h;c.hide();h<b||a<f?c.show("pc-resolution-warning"):
c.hide()},updateImage:function(a){var b=this.getMediaServerUrl(),f,h;f=d("<div>").addClass("customer-image-container");h=d("<img>").addClass("a-declarative customer-uploaded-image");h.attr({id:"#ac-custom-image-"+a.resourceIndex,src:b,"data-original-url":a.pcImageUrl,"data-original-width":a.imageWidth,"data-original-height":a.imageHeight,"data-preview-url":a.pcImageUrl,"data-action":"customer-uploaded-image","data-token":a.imageToken});a=d("<div>").addClass("swatch-arrow");f.append(h);f.append(a);
h.load(function(){h.trigger("click");d(".ac-uploaded-image").prepend(f);d(".ac-select-uploaded-image").fadeIn()}).error(function(){h.parent(".customer-image-container").remove();c.show("pc-image-mime-type-incorrect");d(".ac-select-uploaded-image").fadeOut();n.imageLoading.hide()})},validateImage:function(a){var b={bucketName:this.getBucket(),fileKey:a.imageToken.split("/")[1]},f=this;n.imageLoading.show();l.ajax("/gp/product/features/callValidateImage.html/ref=dp_pc_val_img",{method:"POST",params:b,
success:function(h){"1"===h.result.isValid?(a.imageWidth=h.result.width,a.imageHeight=h.result.height,f.updateImage(a)):(n.imageLoading.hide(),h.result.errorString&&h.result.errorString.length?c.show(null,{type:"error",message:h.result.errorString}):c.show("pc-upload-error-message"))},error:function(){c.show("pc-upload-error-message");n.imageLoading.hide()}})},populateImageObject:function(a,b){var f={};f.imageUrl=a.attr("data-preview-url");f.isCustomerImage=b;f.element=a;return f},imageSelection:function(){var a=
this.populateImageObject,b=this.displayWarningIfRequired;l.declarative.remove("customer-uploaded-image","click");l.declarative("customer-uploaded-image","click",function(f){var h=a(f.$currentTarget,!0);d(".selected.customer-image-container").removeClass("selected");f.$currentTarget.parent().addClass("selected");l.trigger("addCustomerImage",h);b({imageWidth:f.$currentTarget.attr("data-original-width"),imageHeight:f.$currentTarget.attr("data-original-height")});n.imageLoading.show()})}});return b})})();
(function(){z.when("A","ac-base").register("ac-gallery",function(l,n){var g=l.$,e;e=function(c,d,b){var a=this;this.options=g.extend({thumbnailWidth:80,thumbnailHeight:80,pageSize:100,categoryContainerSelector:"#ac-gallery",enableLazyLoading:!0,confineToContainerSelector:"body"},c);var k=g(a.options.confineToContainerSelector),f,h={checkIfCategoryAlreadyLoaded:function(f){var a=!1,h="";0<g('.theme-image-container[data-theme="'+f+'"]').length?(h=g('.theme-image-container[data-theme="'+f+'"]'),a=!0):
h=g("<div>").addClass("theme-image-container").attr({"data-theme":f});return{container:h,isEmpty:!a}},checkIfCategoryExistsInObject:function(a){for(var h=f.contentLibraryList.length,b=0,c=!1,b=0;b<h;b+=1)if(f.contentLibraryList[b].title===a||f.contentLibraryList[b].contentLibraryId===a){c=!0;break}return c},formatResponseObject:function(f){f.inlineData!==u&&(f.contentLibraryList=f.inlineData.contentLibraryList,f.contentLibraryIds=f.inlineData.contentLibraryIds);for(var a=0;a<f.contentLibraryIds.length;a++){var b=
f.contentLibraryIds[a];f.contentLibraryIds[a]=h.getFormattedName(b)}for(a=0;a<f.contentLibraryList.length;a++){var c=f.contentLibraryList[a],b=c.title;c.title=h.getFormattedName(b)}f.defaultLibrary=h.getFormattedName(f.defaultLibrary);return f},formatNewResponseObject:function(f){f.contentList.length&&(f.contentLibraryList=[f],f.contentLibraryIds="/"+f.title);for(var a=0;a<f.contentLibraryIds.length;a++){var b=f.contentLibraryIds[a];f.contentLibraryIds[a]=h.getFormattedName(b)}for(a=0;a<f.contentLibraryList.length;a++){var c=
f.contentLibraryList[a],b=c.title;c.title=h.getFormattedName(b)}f.defaultLibrary=h.getFormattedName(f.defaultLibrary);return f},getFormattedName:function(f){if(!f)return null;var a=f;"/"===f.charAt(0)&&(a=f.substr(1,f.length));return a},getGalleryInputData:function(f){var a={};n.getOfferListingID()!==u&&(a.url="/gp/product/features/getContentLibrary.html",a.data={merchantId:n.getMerchantID(),contentLibraryName:String(f)});return a},getContentLibraryObject:function(a){if(f===u)return u;a=h.getIndexOfCategory(f.contentLibraryList,
a);return-1===a?u:f.contentLibraryList[a]},getIndexOfCategory:function(f,a){var h=f.length,b;for(b=0;b<h;b+=1)if(f[b].title.toLowerCase()===a.toLowerCase())return b;return-1},lazyload:function(){var f=g(".ac-gallery-container"),a=g(".pc-lazyload-error-message");return{success:function(){a.removeClass("active");f.show()},error:function(){f.hide();a.addClass("active");h.loading.hide()}}}(),loading:function(){var f=g(".pc-lazyload-image");return{show:function(){f.addClass("active")},hide:function(){f.removeClass("active")}}}(),
populateImageObject:function(f,a){var h={},b=f.data("original-url"),b=b.substr(b.lastIndexOf("."),b.length);h.imageUrl=f.data("preview-url");h.isCustomerImage=a;h.token=g(".pc-category-name.active").attr("data-themename")+"/"+f.attr("data-token")+b;return h}},q=u,e=function(){var f={categorySelection:function(){l.declarative.remove("category-selection","click");l.declarative("category-selection","click",function(f){var h=f.$currentTarget.attr("data-themename"),b=f.$currentTarget.attr("data-categoryid");
r.BuildGallery(h);g(".ac-selected-gallery-name").html(h).attr({"data-contentId":b,title:h});g("a",g(a.options.categoryContainerSelector)).removeClass("active");f.$currentTarget.addClass("active");g(".vendor-category",g(a.options.categoryContainerSelector)).removeClass("a-active");f.$currentTarget.parent(".vendor-category").addClass("a-active");q!==u&&q.hide()})},imageContainerScroll:function(){if(a.options.enableLazyLoading){var f=g(".ac-gallery-container");f.scroll(function(a){a.preventDefault();
if(f.scrollTop()>=g(".ac-gallery-content").height()-f.height()){a=g("a.active",g(".vendor-categories")).attr("data-themename");var b=h.checkIfCategoryAlreadyLoaded(a);r.AppendImages(a,b,!1)}})}},imageSelection:function(){l.declarative.remove("ac-gallery-content-image","click");l.declarative("ac-gallery-content-image","click",function(f){var a=h.populateImageObject(f.$currentTarget,!1);a.vendorGalleryFileId=g(f.$target).attr("data-contentid");a.vendorGalleryId=g(".vendor-category .pc-category-name.active").attr("data-categoryid");
a.originalURL=g(f.$target).attr("data-original-url");g(".selected.ac-gallery-content-container").removeClass("selected");f.$currentTarget.parent().addClass("selected");l.trigger("hideWarningMessage");l.trigger("addGalleryImage",a);g("a.active",g(".vendor-category")).attr("data-themename")})},popover:function(){l.off("a:popover:show:vendor-categories");l.on("a:popover:show:vendor-categories",function(f){q=f.popover})}};return{Init:function(){f.categorySelection();f.imageSelection();f.imageContainerScroll();
f.popover()}}}(),t=function(){function b(f,a,h){var c=g("<li>"),k=g("<a>");k.attr({"data-themename":f,"data-action":"category-selection","data-categoryId":a?a:f,title:f});c.addClass("a-tab-heading vendor-category");k.addClass(" a-declarative ");k.attr("href","#").addClass("pc-category-name").html(f);c.append(k);h.append(c)}var c={defaultCategory:function(){g(".pc-category-name").each(function(a,h){if(g(h).attr("data-themename")===f.defaultLibrary||g(h).attr("data-categoyid")===f.defaultLibraryId)return setTimeout(function(){g(h).trigger("click");
g("#gallerySpinner").css("display","none")},2E3),!1});g(".ac-selected-gallery-name").text(f.defaultLibrary).attr({"data-categoryid":f.defaultLibraryId,title:f.defaultLibrary})}};return{Build:function(){var d;h.loading.hide();try{for(var q=f.contentLibraryIds.length,m=g("<div>"),t,r=0;r<f.contentLibraryList.length;r++)f.contentLibraryList[r].contentLibraryId=h.getFormattedName(f.contentLibraryList[r].contentLibraryId),f.contentLibraryList[r].contentLibraryId&&f.contentLibraryList[r].contentLibraryId===
f.defaultLibrary&&(f.defaultLibraryId=f.contentLibraryList[r].contentLibraryId,f.defaultLibrary=f.contentLibraryList[r].title),f.contentLibraryList[r].contentLibraryId||(f.contentLibraryList[r].contentLibraryId=f.contentLibraryList[r].title);f.defaultLibraryId||(f.defaultLibraryId=f.defaultLibrary);h.checkIfCategoryExistsInObject(f.defaultLibrary)&&b(f.defaultLibrary,f.defaultLibraryId,m);for(t=0;t<q;t+=1)d=f.contentLibraryList[t].title,d!==f.defaultLibrary&&h.checkIfCategoryExistsInObject(f.defaultLibrary)&&
b(d,f.contentLibraryList[t].contentLibraryId,m);g(a.options.categoryContainerSelector,k).append(m.html());e.Init();c.defaultCategory()}catch(l){h.lazyload.error()}}}}(),r=function(){function f(b,c,k){var d=h.getContentLibraryObject(b);b=d.contentList;var d=d.contentList.length,q=g("<div>"),e;if(a.options.enableLazyLoading||k){a.options.enableLazyLoading?k?(e=0,k=d<a.options.pageSize?d:a.options.pageSize):(k=c.container.data("endIndex"),e=k+1,k=d<k+a.options.pageSize?d:k+a.options.pageSize):(e=0,k=
d);for(;e<k;e+=1){var m=b[e],p=g("<div>").addClass("ac-gallery-content-container"),t=g("<img>"),r=g("<div>").addClass("swatch-arrow");m.status&&"Active"!==m.status||!m.isActive||!m.info||(t.attr({src:m.info.thumbnailURL,"data-original-url":m.info.url,alt:m.description,"data-original-width":m.width?m.width:2500,"data-original-height":m.height?m.height:3500,"data-preview-url":m.info.previewURL,"data-thumbnail-url":m.info.thumbnailURL,"data-action":"ac-gallery-content-image","data-token":m.title,"data-contentId":m.ContentId?
m.ContentId:m.title,isExclusive:1}),t.addClass("ac-gallery-content-image a-declarative"),p.append(t),p.append(r),q.append(p))}b=q.html();c.isEmpty?(g(".ac-gallery-content").append(c.container.append(b)),c.container.data("endIndex",k),c.container.data("length",d)):(c.container.data("endIndex",k),c.container.append(b))}}return{AppendImages:f,BuildGallery:function(a){var b=h.checkIfCategoryAlreadyLoaded(a);g(".theme-image-container",k).hide();g(".ac-gallery-container").scrollTop(0);b.isEmpty?f(a,b,!0):
(g(".ac-gallery-container").scrollTop(0),g('.theme-image-container[data-theme="'+a+'"]',k).show())}}}(),m=function(a,b){var c=h.getGalleryInputData(a),k=g.Deferred();c.data.contentLibraryName="/"+c.data.contentLibraryName.replace("/","");g.ajax({type:"GET",url:c.url,dataType:"json",data:c.data,success:function(a){h.lazyload.success();f=g.parseJSON(a.result);if(null===f||"Error"===f.Status)h.lazyload.error();else return k.resolve(f,b)},error:function(f){return k.reject(f,b)}});return k.promise()};
return{Fetch:function(){var a=[],c={},k=0,q;q=function(){++k;if(k===d.length){for(var q=0;q<a.length;q++)a[q]||(a.splice(q,1),d.splice(q,1));c.inlineData={contentLibraryList:a,contentLibraryIds:d};q=!1;if(b)for(var e=0;e<c.inlineData.contentLibraryList.length;e++)if(c.inlineData.contentLibraryList[e].contentLibraryId===b||c.inlineData.contentLibraryList[e].title===b){q=!0;break}c.defaultLibrary=q?b:d[0];f=h.formatResponseObject(c);t.Build()}};for(var e=0;e<d.length;e++)g.when(m(d[e],e)).then(function(f,
h){a[h]=f.status&&"Active"===f.status&&f.contentList||f.isActive&&f.contentList?f:null;q()},function(f,h){a[h]=null;q()})}}};e.prototype=n;return e})})();(function(){z.when("A","ac-utils","ac-constants","ac-image-gallery","ac-error-handling","ready").register("AssetUploader",function(l,n,g,e,c){var d=l.$,b=function(a){this.assetType=a.assetType;this.$form=a.$form;this.mediaServer=a.mediaServer;this.index=0};b.prototype.getComponentName=function(){return"AssetUploader"};b.prototype.getUploadTypeObject=
function(a){var b;"image"===a&&(b=new e);b.index=this.index++;return b};b.prototype.Init=function(){var a=this.$form,b=this.getUploadTypeObject(this.assetType);a.find("input[type='file']").attr("multiple",!1);b.imageSelection();a.fileupload({autoUpload:!0,url:d(".ac-custom-upload-form").attr("action"),dataType:"json",type:"POST",add:function(f,h){var q=h.files[0];h.resourceIndex=b.index;b.isValidFile(q,function(f){d.extend(h,f);h.statusCode===g.StatusCode.INVALID_FILE_TYPE?c.show("pc-image-mime-type-incorrect",
{timeOut:"6000"}):h.statusCode===g.StatusCode.INVALIDFILESIZE?c.show("pc-image-size-incorrect",{timeOut:"6000"}):(b.createResourceStub(a,h.resourceIndex),l.post("/gp/features/fetch-imageUpload-s3post-parameters.html",{dataType:"json",params:{contentType:"image",csrfToken:d(".ac-custom-upload-form").attr("data-csrf"),uid:b.getResourcePath(),extension:"."+h.fileInput.val().split(".").pop().toLowerCase(),isDPX:1},success:function(f){h.uploadObject=b;b.setBucket(f.imageToken.split("/")[0]);b.setFileName(q.name);
b.setKey(h.resourceIndex);b.setResourcePath(f.key.split(".")[0]);b.getKey();a.attr("action",f.action);d("#key",a).val(f.key);d("#AWSAccessKeyId",a).val(f.AWSAccessKeyId);d("#policy",a).val(f.policy);d("#signature",a).val(f.signature);d("#success_action_status",a).val(f.statusCode);d("#expires",a).val(f.expires);h.pcImageUrl=f.thumbnailUrl;h.imageName=f.key;h.imageToken=f.imageToken;h.submit()},error:function(f){c.show("pc-upload-error-message",{timeOut:"6000"});l.trigger("amazon-custom-log-ref-tag",
"logS3TextUploadError")}}))})},send:function(f,a){d(".ac-upload-progress").text("0%");n.imageLoading.show()},fail:function(f,a){n.imageLoading.hide();c.show("pc-upload-error-message",{timeOut:"6000"});d(".ac-upload-progress").text("");l.trigger("amazon-custom-log-ref-tag","logS3ImageUploadError")},done:function(f,a){d(".ac-upload-progress").text("100%");n.imageLoading.hide();a.uploadObject.updateView(a,a.statusCode);d(".ac-upload-progress").text("")},progress:function(f,a){var b=parseInt(a.loaded/
a.total*100,10);d(".ac-upload-progress").text(b+"%")}})};return b});z.when("A","AssetUploader","ac-constants","ready").execute(function(l,n,g){l.declarative("asset-upload","click",function(e){var c;e.$target.data("asset-upload")===u&&(c=new n({$form:e.$target.parentsUntil(".ac-custom-upload-container","form"),assetType:"image",uploadType:e.data["upload-type"],mediaServer:"https://images-na.ssl-images-amazon.com/images/S/"}),c.Init(),e.$target.data("asset-upload",c))})})})();(function(){z.when("A",
"ready").register("ac-gallery-base",function(l){l=function(){};l.prototype={generateUUID:function(){function l(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return l()+l()+"-"+l()+"-"+l()+"-"+l()+"-"+l()+l()+l()},getTimeStamp:function(){var l=new Date;return l.getUTCFullYear()+"-"+l.getUTCMonth()+"-"+l.getUTCDate()+"-"+l.getUTCHours()+"-"+l.getUTCMinutes()},getFileExtension:function(){var l=/^.+\.([^.]+)$/.exec(this.fileName);return null===l?"":"."+l[1].toLowerCase()},getFileNameWithoutExtension:function(){var l=
this.fileName.split(".")[0];return null===l?"":l.toLowerCase()},getKey:function(){return this.key},isValidFile:function(){console.log("No Implementation - isValidFile")},setBucket:function(l){this.bucket=l},getBucket:function(){return this.bucket},setFileName:function(l){this.fileName=l},updateView:function(){console.log("No Implementation - ValidateAndUpdate")},setResourcePath:function(l){this.ResourcePath=l},getResourcePath:function(){return this.ResourcePath}};return l})})();(function(){z.when("A",
"ac-base","ac-utils","ready").register("ac-error-handling",function(l,n,g){var e=l.$,c,d,b,a,k;c=function(){return e(".ac-error-container")};d=function(){return e(".ac-error-container .a-alert-heading")};b=function(){return e(".ac-error-container .a-alert-content")};a=function(f){var a;a={type:f.type?f.type:"error",message:f.message};-1!==k.indexOf(f.id)&&(a.type="warning");return a};k=["pc-error-generic-text","pc-resolution-warning","pc-scale-warning-message","pc-generic-warning-text"];return{show:function(f,
h){var k={};f?k=a({id:f,message:g.stringHandler(f)}):(k.type=h.type,k.message=h.message);c().removeClass("a-alert-warning a-alert-error a-alert-success a-alert-info").addClass("a-alert-"+k.type);d().text(k.type.charAt(0).toUpperCase()+k.type.slice(1)+" Message");b().html(k.message);c().addClass("active");h&&h.timeOut&&setTimeout(function(){c().removeClass("active")},parseInt(h.timeOut,10))},hide:function(){c().removeClass("active")}}})})();(function(){z.when("A","a-dropdown","ac-base","ac-utils",
"fabric-js","ac-constants","ready").register("ac-text-image",function(l,n,g,e,c,d){var b=l.$;return function(a,k){var f=this,h,q,p={},t;t=function(){p=b.extend({},d.textDefaults);q&&q.setText("")};f.isInitialized=!1;f.changeFont=function(a){f.updateText({fontFamily:a})};f.toggleStyle=function(a){var h={};switch(a){case "boldoff":h.fontWeight="normal";f.updateText(h);break;case "boldon":h.fontWeight="bold";f.updateText(h);break;case "italicson":h.fontStyle="italic";f.updateText(h);break;case "italicsoff":h.fontStyle=
"normal";f.updateText(h);break;case "underlineon":h.textDecoration="underline";f.updateText(h);break;case "underlineoff":h.textDecoration="normal",f.updateText(h)}};f.style=function(f){};f.changeAlign=function(a){var h={};switch(a){case "left":h.textAlign="left";f.updateText(h);break;case "center":h.textAlign="center";f.updateText(h);break;case "right":h.textAlign="right",f.updateText(h)}};f.changeTextColor=function(a){b(".simplecolorpicker.icon").css("background-color",a);f.updateText({fill:a})};
f.editText=function(a){q.setText(a);f.updateText(null)};f.resetControl=function(){b("#pcTextArea").val("");b(".pc-textArea-fontStyle-li").removeClass("button-active");b(".pc-textArea-fontAlign-li").removeClass("button-active");b('.pc-textArea-fontAlign-li[data-align="left"]').addClass("button-active");n.getSelect("fontPicker").setValue("Arial");b(".simplecolorpicker.icon").css({"background-color":b("ul.pc-textArea-fontColor-ul li.pc-textArea-fontColor-li:first-child div").css("background-color")})};
f.updateControl=function(){if(f.isInitialized){f.resetControl();var h=a.getObjects();p.text="";for(var c=0;c<h.length;c++)"text"===h[c].type&&(p.text=h[c].text);b("#pcTextArea").val(p.text);"bold"===p.fontWeight&&b('.pc-textArea-fontStyle-li[data-style="bold"]').addClass("button-active");"underline"===p.textDecoration&&b('.pc-textArea-fontStyle-li[data-style="underline"]').addClass("button-active");"italic"===p.fontStyle&&b('.pc-textArea-fontStyle-li[data-style="italics"]').addClass("button-active");
"right"===p.textAlign?(b(".pc-textArea-fontAlign-li").removeClass("button-active"),b('.pc-textArea-fontAlign-li[data-align="right"]').addClass("button-active")):"center"===p.textAlign&&(b(".pc-textArea-fontAlign-li").removeClass("button-active"),b('.pc-textArea-fontAlign-li[data-align="center"]').addClass("button-active"));n.getSelect(b("#fontPicker")).setValue(p.fontFamily);b(".simplecolorpicker.icon").css({"background-color":p.fill})}else f.init(),f.resetControl()};f.select=function(){l.each(a.getObjects(),
function(f){"text"===f.type&&a.canvas.setActiveObject(f)})};h=function(h){for(var k,q=a.getObjects(),e=a.canvas.size()-1;0<=e;e--)if(q[e].id&&q[e].id===h.id)return null;k=function(f){a.canvas.add(f);f.bringToFront();a.canvas.calcOffset();f.setCoords();a.canvas.setActiveObject(f);a.renderAll()};h=function(f){var h={};b.extend(h,f,d.textDefaults);h.id="text-"+a.id;return p=h}(h?h:{});h.fontSize=a.canvas.width/5;h.fill=a.surface.data.FontSettings.colors[0].value;b("#pcTextArea").val("");f.updateText(null);
return function(){var f=new c.Text(h.text,{angle:h.angle,opacity:h.opacity,fontFamily:h.fontFamily,fontSize:h.fontSize,fontWeight:h.fontWeight,fontStyle:h.fontStyle,id:h.id,cursorColor:"#ffffff",fill:h.fill,transparentCorners:!1,centeredRotation:!0,centeredScaling:!0,padding:5,originX:"left",originY:"top",selectable:!0,textAlign:h.textAlign});f.set({left:20,top:a.canvas.height/2-h.fontSize/2});k(f);return f}()};var g=function(f){for(var h=a.getObjects(),c=h.length-1;0<=c;c--)h[c].name&&"galImage"===
h[c].name&&a.canvas.remove(h[c]);q&&(q.bringToFront(),a.canvas.calcOffset(),"object"===typeof f?(q.set(f),b.extend(p,p,f)):"string"===typeof f&&(q.setText(f),p.text=f,b("#pcTextArea").val(f)),q.setCoords(),a.canvas.setActiveObject(q),""===p.text?b(".pc-two-column-layout .ac-delete-button").fadeOut():b(".pc-two-column-layout .ac-delete-button").fadeIn());a.renderAll()};f.updateText=function(h){var b,c,k,d,q=!1;b=a.getObjects();c=e.stringHandler("pc-clear-design-msg");k=function(){a.surface.widget.surfaceList.forEach(function(f){f.childCanvasList.forEach(function(f){for(var a=
f.getObjects(),h=0;h<a.length;h++)a[h].name&&"galImage"===a[h].name&&f.clear()})});g(h)};d=function(){for(var h=a.canvas.size()-1;0<=h;h--)if("text"===b[h].type){b[h].remove();break}f.cleared();a.controls.textInput.isControlActive=!1};a.surface.widget.surfaceList.forEach(function(f){f.childCanvasList.forEach(function(f){f=f.getObjects();for(var a=0;a<f.length;a++)if(f[a].name&&"galImage"===f[a].name){q=!0;break}})});q?e.showDialog.show(c,k,{ok:"Clear",cancelCallBack:d}):k()};f.cleared=function(){f.resetControl();
t();f.isInitialized=!1};f.hasRequiredField=function(){return!1};f.requiredFieldsAreValid=function(){return!0};f.containsEmoji=function(){var f=b("#pcTextArea").val();return d.emojiMatchPattern.test(f)};f.init=function(){f.isInitialized=!0;q=h()}}})})()});
(function(z){var B=window.AmazonUIPageJS||window.P,u=B._namespace||B.attributeErrors,l=u?u("ProductCustomizationFileUploadAssets"):B;l.guardFatal?l.guardFatal(z)(l,window):l.execute(function(){z(l,window)})})(function(z,B,u){z.when("A","jQuery").register("jq-ui-widget",function(l,n){(function(g){g(n)})(function(g,e){var c=0,d=Array.prototype.slice,b=g.cleanData;g.cleanData=function(a){for(var c=0,f;null!=(f=a[c]);c++)try{g(f).triggerHandler("remove")}catch(h){}b(a)};g.widget=function(a,b,f){var h,
c,d,e,r={},m=a.split(".")[0];a=a.split(".")[1];h=m+"-"+a;f||(f=b,b=g.Widget);g.expr[":"][h.toLowerCase()]=function(f){return!!g.data(f,h)};g[m]=g[m]||{};c=g[m][a];d=g[m][a]=function(f,a){if(!this._createWidget)return new d(f,a);arguments.length&&this._createWidget(f,a)};g.extend(d,c,{version:f.version,_proto:g.extend({},f),_childConstructors:[]});e=new b;e.options=g.widget.extend({},e.options);g.each(f,function(f,a){g.isFunction(a)?r[f]=function(){var h=function(){return b.prototype[f].apply(this,
arguments)},c=function(a){return b.prototype[f].apply(this,a)};return function(){var f=this._super,b=this._superApply,k;this._super=h;this._superApply=c;k=a.apply(this,arguments);this._super=f;this._superApply=b;return k}}():r[f]=a});d.prototype=g.widget.extend(e,{widgetEventPrefix:c?e.widgetEventPrefix||a:a},r,{constructor:d,namespace:m,widgetName:a,widgetFullName:h});c?(g.each(c._childConstructors,function(f,a){var h=a.prototype;g.widget(h.namespace+"."+h.widgetName,d,a._proto)}),delete c._childConstructors):
b._childConstructors.push(d);g.widget.bridge(a,d)};g.widget.extend=function(a){for(var b=d.call(arguments,1),f=0,h=b.length,c,p;f<h;f++)for(c in b[f])p=b[f][c],b[f].hasOwnProperty(c)&&p!==e&&(g.isPlainObject(p)?a[c]=g.isPlainObject(a[c])?g.widget.extend({},a[c],p):g.widget.extend({},p):a[c]=p);return a};g.widget.bridge=function(a,b){var f=b.prototype.widgetFullName||a;g.fn[a]=function(h){var c="string"===typeof h,p=d.call(arguments,1),t=this;h=!c&&p.length?g.widget.extend.apply(null,[h].concat(p)):
h;c?this.each(function(){var b,c=g.data(this,f);if(!c)return g.error("cannot call methods on "+a+" prior to initialization; attempted to call method '"+h+"'");if(!g.isFunction(c[h])||"_"===h.charAt(0))return g.error("no such method '"+h+"' for "+a+" widget instance");b=c[h].apply(c,p);if(b!==c&&b!==e)return t=b&&b.jquery?t.pushStack(b.get()):b,!1}):this.each(function(){var a=g.data(this,f);a?a.option(h||{})._init():g.data(this,f,new b(h,this))});return t}};g.Widget=function(){};g.Widget._childConstructors=
[];g.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(a,b){b=g(b||this.defaultElement||this)[0];this.element=g(b);this.uuid=c++;this.eventNamespace="."+this.widgetName+this.uuid;this.options=g.widget.extend({},this.options,this._getCreateOptions(),a);this.bindings=g();this.hoverable=g();this.focusable=g();b!==this&&(g.data(b,this.widgetFullName,this),this._on(!0,this.element,{remove:function(f){f.target===b&&
this.destroy()}}),this.document=g(b.style?b.ownerDocument:b.document||b),this.window=g(this.document[0].defaultView||this.document[0].parentWindow));this._create();this._trigger("create",null,this._getCreateEventData());this._init()},_getCreateOptions:g.noop,_getCreateEventData:g.noop,_create:g.noop,_init:g.noop,destroy:function(){this._destroy();this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(g.camelCase(this.widgetFullName));this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+
"-disabled ui-state-disabled");this.bindings.unbind(this.eventNamespace);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")},_destroy:g.noop,widget:function(){return this.element},option:function(a,b){var f=a,h,c,d;if(0===arguments.length)return g.widget.extend({},this.options);if("string"===typeof a)if(f={},h=a.split("."),a=h.shift(),h.length){c=f[a]=g.widget.extend({},this.options[a]);for(d=0;d<h.length-1;d++)c[h[d]]=c[h[d]]||{},c=c[h[d]];a=h.pop();if(1===
arguments.length)return c[a]===e?null:c[a];c[a]=b}else{if(1===arguments.length)return this.options[a]===e?null:this.options[a];f[a]=b}this._setOptions(f);return this},_setOptions:function(a){for(var b in a)this._setOption(b,a[b]);return this},_setOption:function(a,b){this.options[a]=b;"disabled"===a&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!b).attr("aria-disabled",b),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"));return this},
enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(a,b,f){var h,c=this;"boolean"!==typeof a&&(f=b,b=a,a=!1);f?(b=h=g(b),this.bindings=this.bindings.add(b)):(f=b,b=this.element,h=this.widget());g.each(f,function(f,d){function e(){if(a||!0!==c.options.disabled&&!g(this).hasClass("ui-state-disabled"))return("string"===typeof d?c[d]:d).apply(c,arguments)}"string"!==typeof d&&(e.guid=d.guid=d.guid||e.guid||g.guid++);var m=f.match(/^(\w+)\s*(.*)$/),
v=m[1]+c.eventNamespace;(m=m[2])?h.delegate(m,v,e):b.bind(v,e)})},_off:function(a,b){b=(b||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace;a.unbind(b).undelegate(b)},_delay:function(a,b){var f=this;return setTimeout(function(){return("string"===typeof a?f[a]:a).apply(f,arguments)},b||0)},_hoverable:function(a){this.hoverable=this.hoverable.add(a);this._on(a,{mouseenter:function(a){g(a.currentTarget).addClass("ui-state-hover")},mouseleave:function(a){g(a.currentTarget).removeClass("ui-state-hover")}})},
_focusable:function(a){this.focusable=this.focusable.add(a);this._on(a,{focusin:function(a){g(a.currentTarget).addClass("ui-state-focus")},focusout:function(a){g(a.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(a,b,f){var h,c=this.options[a];f=f||{};b=g.Event(b);b.type=(a===this.widgetEventPrefix?a:this.widgetEventPrefix+a).toLowerCase();b.target=this.element[0];if(a=b.originalEvent)for(h in a)h in b||(b[h]=a[h]);this.element.trigger(b,f);return!(g.isFunction(c)&&!1===c.apply(this.element[0],
[b].concat(f))||b.isDefaultPrevented())}};g.each({show:"fadeIn",hide:"fadeOut"},function(a,b){g.Widget.prototype["_"+a]=function(f,h,c){"string"===typeof h&&(h={effect:h});var d,e=h?!0===h||"number"===typeof h?b:h.effect||b:a;h=h||{};"number"===typeof h&&(h={duration:h});d=!g.isEmptyObject(h);h.complete=c;h.delay&&f.delay(h.delay);if(d&&g.effects&&g.effects.effect[e])f[a](h);else if(e!==a&&f[e])f[e](h.duration,h.easing,c);else f.queue(function(h){g(this)[a]();c&&c.call(f[0]);h()})}})})});z.when("A",
"jQuery").register("jq-IframeTransport",function(l,n){(function(g){g(n)})(function(g){var e=0;g.ajaxTransport("iframe",function(c){if(c.async){var d=c.initialIframeSrc||"javascript:false;",b,a,k;return{send:function(f,h){b=g('<form style="display:none;"></form>');b.attr("accept-charset",c.formAcceptCharset);k=/\?/.test(c.url)?"&":"?";"DELETE"===c.type?(c.url=c.url+k+"_method=DELETE",c.type="POST"):"PUT"===c.type?(c.url=c.url+k+"_method=PUT",c.type="POST"):"PATCH"===c.type&&(c.url=c.url+k+"_method=PATCH",
c.type="POST");e+=1;a=g('<iframe src="'+d+'" name="iframe-transport-'+e+'"></iframe>').bind("load",function(){var f,k=g.isArray(c.paramName)?c.paramName:[c.paramName];a.unbind("load").bind("load",function(){var f;try{if(f=a.contents(),!f.length||!f[0].firstChild)throw Error();}catch(c){f=u}h(200,"success",{iframe:f});g('<iframe src="'+d+'"></iframe>').appendTo(b);B.setTimeout(function(){b.remove()},0)});b.prop("target",a.prop("name")).prop("action",c.url).prop("method",c.type);c.formData&&g.each(c.formData,
function(f,a){"file"!==a.name&&g('<input type="hidden"/>').prop("name",a.name).val(a.value).appendTo(b)});c.fileInput&&c.fileInput.length&&"POST"===c.type&&(f=c.fileInput.clone(),c.fileInput.after(function(a){return f[a]}),c.paramName&&c.fileInput.each(function(f){g(this).prop("name",k[f]||c.paramName)}),b.append(c.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data"),c.fileInput.removeAttr("form"));b.submit();f&&f.length&&c.fileInput.each(function(a,h){var b=g(f[a]);
g(h).prop("name",b.prop("name")).attr("form",b.attr("form"));b.replaceWith(h)})});b.append(a).appendTo(document.body)},abort:function(){a&&a.unbind("load").prop("src",d);b&&b.remove()}}}});g.ajaxSetup({converters:{"iframe text":function(c){return c&&g(c[0].body).text()},"iframe json":function(c){return c&&g.parseJSON(g(c[0].body).text())},"iframe html":function(c){return c&&g(c[0].body).html()},"iframe xml":function(c){return(c=c&&c[0])&&g.isXMLDoc(c)?c:g.parseXML(c.XMLDocument&&c.XMLDocument.xml||
g(c.body).html())},"iframe script":function(c){return c&&g.globalEval(g(c[0].body).text())}}})})});z.when("A","jQuery","jq-ui-widget").register("jq-fileupload",function(l,n,g){(function(e){e(n)})(function(e){e.support.fileInput=!(/(Android (1\.[0156]|2\.[01]))|(Windows Phone (OS 7|8\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle\/(1\.0|2\.[05]|3\.0))/.test(B.navigator.userAgent)||e('<input type="file">').prop("disabled"));e.support.xhrFileUpload=!(!B.ProgressEvent||!B.FileReader);
e.support.xhrFormDataFileUpload=!!B.FormData;e.support.blobSlice=B.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);e.widget("blueimp.fileupload",{options:{dropZone:e(document),pasteZone:e(document),fileInput:u,replaceFileInput:!0,paramName:u,singleFileUploads:!0,limitMultiFileUploads:u,limitMultiFileUploadSize:u,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:u,forceIframeTransport:!1,redirect:u,redirectParamName:u,postMessage:u,multipart:!0,
maxChunkSize:u,uploadedBytes:u,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(c,d){c=this.messages[c]||c.toString();d&&e.each(d,function(b,a){c=c.replace("{"+b+"}",a)});return c},formData:function(c){return c.serializeArray()},add:function(c,d){if(c.isDefaultPrevented())return!1;(d.autoUpload||!1!==d.autoUpload&&e(this).fileupload("option","autoUpload"))&&d.process().done(function(){d.submit()})},
processData:!1,contentType:!1,cache:!1},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:e.support.blobSlice&&function(){return(this.slice||this.webkitSlice||this.mozSlice).apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime();this.bitrate=this.loaded=0;this.getBitrate=function(c,d,b){var a=c-this.timestamp;if(!this.bitrate||!b||a>b)this.bitrate=1E3/a*(d-this.loaded)*8,this.loaded=d,this.timestamp=
c;return this.bitrate}},_isXHRUpload:function(c){return!c.forceIframeTransport&&(!c.multipart&&e.support.xhrFileUpload||e.support.xhrFormDataFileUpload)},_getFormData:function(c){var d;return"function"===e.type(c.formData)?c.formData(c.form):e.isArray(c.formData)?c.formData:"object"===e.type(c.formData)?(d=[],e.each(c.formData,function(b,a){d.push({name:b,value:a})}),d):[]},_getTotal:function(c){var d=0;e.each(c,function(b,a){d+=a.size||1});return d},_initProgressObject:function(c){var d={loaded:0,
total:0,bitrate:0};c._progress?e.extend(c._progress,d):c._progress=d},_initResponseObject:function(c){var d;if(c._response)for(d in c._response)c._response.hasOwnProperty(d)&&delete c._response[d];else c._response={}},_onProgress:function(c,d){if(c.lengthComputable){var b=Date.now?Date.now():(new Date).getTime(),a;d._time&&d.progressInterval&&b-d._time<d.progressInterval&&c.loaded!==c.total||(d._time=b,a=Math.floor(c.loaded/c.total*(d.chunkSize||d._progress.total))+(d.uploadedBytes||0),this._progress.loaded+=
a-d._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(b,this._progress.loaded,d.bitrateInterval),d._progress.loaded=d.loaded=a,d._progress.bitrate=d.bitrate=d._bitrateTimer.getBitrate(b,a,d.bitrateInterval),this._trigger("progress",e.Event("progress",{delegatedEvent:c}),d),this._trigger("progressall",e.Event("progressall",{delegatedEvent:c}),this._progress))}},_initProgressListener:function(c){var d=this,b=c.xhr?c.xhr():e.ajaxSettings.xhr();b.upload&&(e(b.upload).bind("progress",
function(a){var b=a.originalEvent;a.lengthComputable=b.lengthComputable;a.loaded=b.loaded;a.total=b.total;d._onProgress(a,c)}),c.xhr=function(){return b})},_isInstanceOf:function(c,d){return Object.prototype.toString.call(d)==="[object "+c+"]"},_initXHRData:function(c){var d=this,b,a=c.files[0],k=c.multipart||!e.support.xhrFileUpload,f="array"===e.type(c.paramName)?c.paramName[0]:c.paramName;c.headers=e.extend({},c.headers);c.contentRange&&(c.headers["Content-Range"]=c.contentRange);k&&!c.blob&&this._isInstanceOf("File",
a)||(c.headers["Content-Disposition"]='attachment; filename="'+encodeURI(a.name)+'"');k?e.support.xhrFormDataFileUpload&&(c.postMessage?(b=this._getFormData(c),c.blob?b.push({name:f,value:c.blob}):e.each(c.files,function(a,k){b.push({name:"array"===e.type(c.paramName)&&c.paramName[a]||f,value:k})})):(d._isInstanceOf("FormData",c.formData)?b=c.formData:(b=new FormData,e.each(this._getFormData(c),function(f,a){b.append(a.name,a.value)})),c.blob?b.append(f,c.blob,a.name):e.each(c.files,function(a,k){(d._isInstanceOf("File",
k)||d._isInstanceOf("Blob",k))&&b.append("array"===e.type(c.paramName)&&c.paramName[a]||f,k,k.uploadName||k.name)})),c.data=b):(c.contentType=a.type||"application/octet-stream",c.data=c.blob||a);c.blob=null},_initIframeSettings:function(c){var d=e("<a></a>").prop("href",c.url).prop("host");c.dataType="iframe "+(c.dataType||"");c.formData=this._getFormData(c);c.redirect&&d&&d!==location.host&&c.formData.push({name:c.redirectParamName||"redirect",value:c.redirect})},_initDataSettings:function(c){this._isXHRUpload(c)?
(this._chunkedUpload(c,!0)||(c.data||this._initXHRData(c),this._initProgressListener(c)),c.postMessage&&(c.dataType="postmessage "+(c.dataType||""))):this._initIframeSettings(c)},_getParamName:function(c){var d=e(c.fileInput),b=c.paramName;b?e.isArray(b)||(b=[b]):(b=[],d.each(function(){for(var a=e(this),c=a.prop("name")||"files[]",a=(a.prop("files")||[1]).length;a;)b.push(c),--a}),b.length||(b=[d.prop("name")||"files[]"]));return b},_initFormSettings:function(c){c.form&&c.form.length||(c.form=e(c.fileInput.prop("form")),
c.form.length||(c.form=e(this.options.fileInput.prop("form"))));c.paramName=this._getParamName(c);c.url||(c.url=c.form.prop("action")||location.href);c.type=(c.type||"string"===e.type(c.form.prop("method"))&&c.form.prop("method")||"").toUpperCase();"POST"!==c.type&&"PUT"!==c.type&&"PATCH"!==c.type&&(c.type="POST");c.formAcceptCharset||(c.formAcceptCharset=c.form.attr("accept-charset"))},_getAJAXSettings:function(c){c=e.extend({},this.options,c);this._initFormSettings(c);this._initDataSettings(c);
return c},_getDeferredState:function(c){return c.state?c.state():c.isResolved()?"resolved":c.isRejected()?"rejected":"pending"},_enhancePromise:function(c){c.success=c.done;c.error=c.fail;c.complete=c.always;return c},_getXHRPromise:function(c,d,b){var a=e.Deferred(),k=a.promise();d=d||this.options.context||k;!0===c?a.resolveWith(d,b):!1===c&&a.rejectWith(d,b);k.abort=a.promise;return this._enhancePromise(k)},_addConvenienceMethods:function(c,d){var b=this,a=function(a){return e.Deferred().resolveWith(b,
a).promise()};d.process=function(c,f){if(c||f)d._processQueue=this._processQueue=(this._processQueue||a([this])).pipe(function(){return d.errorThrown?e.Deferred().rejectWith(b,[d]).promise():a(arguments)}).pipe(c,f);return this._processQueue||a([this])};d.submit=function(){"pending"!==this.state()&&(d.jqXHR=this.jqXHR=!1!==b._trigger("submit",e.Event("submit",{delegatedEvent:c}),this)&&b._onSend(c,this));return this.jqXHR||b._getXHRPromise()};d.abort=function(){if(this.jqXHR)return this.jqXHR.abort();
this.errorThrown="abort";b._trigger("fail",null,this);return b._getXHRPromise(!1)};d.state=function(){if(this.jqXHR)return b._getDeferredState(this.jqXHR);if(this._processQueue)return b._getDeferredState(this._processQueue)};d.processing=function(){return!this.jqXHR&&this._processQueue&&"pending"===b._getDeferredState(this._processQueue)};d.progress=function(){return this._progress};d.response=function(){return this._response}},_getUploadedBytes:function(c){return(c=(c=(c=c.getResponseHeader("Range"))&&
c.split("-"))&&1<c.length&&parseInt(c[1],10))&&c+1},_chunkedUpload:function(c,d){c.uploadedBytes=c.uploadedBytes||0;var b=this,a=c.files[0],k=a.size,f=c.uploadedBytes,h=c.maxChunkSize||k,q=this._blobSlice,p=e.Deferred(),t=p.promise(),g,m;if(!(this._isXHRUpload(c)&&q&&(f||h<k))||c.data)return!1;if(d)return!0;if(f>=k)return a.error=c.i18n("uploadedBytes"),this._getXHRPromise(!1,c.context,[null,"error",a.error]);m=function(){var d=e.extend({},c),t=d._progress.loaded;d.blob=q.call(a,f,f+h,a.type);d.chunkSize=
d.blob.size;d.contentRange="bytes "+f+"-"+(f+d.chunkSize-1)+"/"+k;b._initXHRData(d);b._initProgressListener(d);g=(!1!==b._trigger("chunksend",null,d)&&e.ajax(d)||b._getXHRPromise(!1,d.context)).done(function(a,h,q){f=b._getUploadedBytes(q)||f+d.chunkSize;t+d.chunkSize-d._progress.loaded&&b._onProgress(e.Event("progress",{lengthComputable:!0,loaded:f-d.uploadedBytes,total:f-d.uploadedBytes}),d);c.uploadedBytes=d.uploadedBytes=f;d.result=a;d.textStatus=h;d.jqXHR=q;b._trigger("chunkdone",null,d);b._trigger("chunkalways",
null,d);f<k?m():p.resolveWith(d.context,[a,h,q])}).fail(function(f,a,h){d.jqXHR=f;d.textStatus=a;d.errorThrown=h;b._trigger("chunkfail",null,d);b._trigger("chunkalways",null,d);p.rejectWith(d.context,[f,a,h])})};this._enhancePromise(t);t.abort=function(){return g.abort()};m();return t},_beforeSend:function(c,d){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0);this._initResponseObject(d);this._initProgressObject(d);
d._progress.loaded=d.loaded=d.uploadedBytes||0;d._progress.total=d.total=this._getTotal(d.files)||1;d._progress.bitrate=d.bitrate=0;this._active+=1;this._progress.loaded+=d.loaded;this._progress.total+=d.total},_onDone:function(c,d,b,a){var k=a._progress.total,f=a._response;a._progress.loaded<k&&this._onProgress(e.Event("progress",{lengthComputable:!0,loaded:k,total:k}),a);f.result=a.result=c;f.textStatus=a.textStatus=d;f.jqXHR=a.jqXHR=b;this._trigger("done",null,a)},_onFail:function(c,d,b,a){var k=
a._response;a.recalculateProgress&&(this._progress.loaded-=a._progress.loaded,this._progress.total-=a._progress.total);k.jqXHR=a.jqXHR=c;k.textStatus=a.textStatus=d;k.errorThrown=a.errorThrown=b;this._trigger("fail",null,a)},_onAlways:function(c,d,b,a){this._trigger("always",null,a)},_onSend:function(c,d){d.submit||this._addConvenienceMethods(c,d);var b=this,a,k,f,h,q=b._getAJAXSettings(d),p=function(){b._sending+=1;q._bitrateTimer=new b._BitrateTimer;return a=a||((k||!1===b._trigger("send",e.Event("send",
{delegatedEvent:c}),q))&&b._getXHRPromise(!1,q.context,k)||b._chunkedUpload(q)||e.ajax(q)).done(function(f,a,h){b._onDone(f,a,h,q)}).fail(function(f,a,h){b._onFail(f,a,h,q)}).always(function(f,a,h){b._onAlways(f,a,h,q);--b._sending;--b._active;if(q.limitConcurrentUploads&&q.limitConcurrentUploads>b._sending)for(f=b._slots.shift();f;){if("pending"===b._getDeferredState(f)){f.resolve();break}f=b._slots.shift()}0===b._active&&b._trigger("stop")})};this._beforeSend(c,q);return this.options.sequentialUploads||
this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(1<this.options.limitConcurrentUploads?(f=e.Deferred(),this._slots.push(f),h=f.pipe(p)):h=this._sequence=this._sequence.pipe(p,p),h.abort=function(){k=[u,"abort","abort"];return a?a.abort():(f&&f.rejectWith(q.context,k),p())},this._enhancePromise(h)):p()},_onAdd:function(c,d){var b=this,a=!0,k=e.extend({},this.options,d),f=d.files,h=f.length,q=k.limitMultiFileUploads,p=k.limitMultiFileUploadSize,t=k.limitMultiFileUploadSizeOverhead,
g=0,m=this._getParamName(k),v,E,D=0;!p||h&&f[0].size!==u||(p=u);if((k.singleFileUploads||q||p)&&this._isXHRUpload(k))if(k.singleFileUploads||p||!q)if(!k.singleFileUploads&&p)for(E=[],v=[],k=0;k<h;k+=1){if(g+=f[k].size+t,k+1===h||g+f[k+1].size+t>p||q&&k+1-D>=q)E.push(f.slice(D,k+1)),g=m.slice(D,k+1),g.length||(g=m),v.push(g),D=k+1,g=0}else v=m;else for(E=[],v=[],k=0;k<h;k+=q)E.push(f.slice(k,k+q)),g=m.slice(k,k+q),g.length||(g=m),v.push(g);else E=[f],v=[m];d.originalFiles=f;e.each(E||f,function(f,
h){var k=e.extend({},d);k.files=E?h:[h];k.paramName=v[f];b._initResponseObject(k);b._initProgressObject(k);b._addConvenienceMethods(c,k);return a=b._trigger("add",e.Event("add",{delegatedEvent:c}),k)});return a},_replaceFileInput:function(c){var d=c.clone(!0);e("<form></form>").append(d)[0].reset();c.after(d).detach();e.cleanData(c.unbind("remove"));this.options.fileInput=this.options.fileInput.map(function(b,a){return a===c[0]?d[0]:a});c[0]===this.element[0]&&(this.element=d)},_handleFileTreeEntry:function(c,
d){var b=this,a=e.Deferred(),k=function(f){f&&!f.entry&&(f.entry=c);a.resolve([f])},f;d=d||"";c.isFile?c._file?(c._file.relativePath=d,a.resolve(c._file)):c.file(function(f){f.relativePath=d;a.resolve(f)},k):c.isDirectory?(f=c.createReader(),f.readEntries(function(f){b._handleFileTreeEntries(f,d+c.name+"/").done(function(f){a.resolve(f)}).fail(k)},k)):a.resolve([]);return a.promise()},_handleFileTreeEntries:function(c,d){var b=this;return e.when.apply(e,e.map(c,function(a){return b._handleFileTreeEntry(a,
d)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(c){c=c||{};var d=c.items;return d&&d.length&&(d[0].webkitGetAsEntry||d[0].getAsEntry)?this._handleFileTreeEntries(e.map(d,function(b){var a;if(b.webkitGetAsEntry){if(a=b.webkitGetAsEntry())a._file=b.getAsFile();return a}return b.getAsEntry()})):e.Deferred().resolve(e.makeArray(c.files)).promise()},_getSingleFileInputFiles:function(c){c=e(c);var d=c.prop("webkitEntries")||c.prop("entries");if(d&&d.length)return this._handleFileTreeEntries(d);
d=e.makeArray(c.prop("files"));if(d.length)d[0].name===u&&d[0].fileName&&e.each(d,function(b,a){a.name=a.fileName;a.size=a.fileSize});else{c=c.prop("value");if(!c)return e.Deferred().resolve([]).promise();d=[{name:c.replace(/^.*\\/,"")}]}return e.Deferred().resolve(d).promise()},_getFileInputFiles:function(c){return c instanceof e&&1!==c.length?e.when.apply(e,e.map(c,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(c)},
_onChange:function(c){var d=this,b={fileInput:e(c.target),form:e(c.target.form)};this._getFileInputFiles(b.fileInput).always(function(a){b.files=a;d.options.replaceFileInput&&d._replaceFileInput(b.fileInput);!1!==d._trigger("change",e.Event("change",{delegatedEvent:c}),b)&&d._onAdd(c,b)})},_onPaste:function(c){var d=c.originalEvent&&c.originalEvent.clipboardData&&c.originalEvent.clipboardData.items,b={files:[]};d&&d.length&&(e.each(d,function(a,c){var f=c.getAsFile&&c.getAsFile();f&&b.files.push(f)}),
!1!==this._trigger("paste",e.Event("paste",{delegatedEvent:c}),b)&&this._onAdd(c,b))},_onDrop:function(c){c.dataTransfer=c.originalEvent&&c.originalEvent.dataTransfer;var d=this,b=c.dataTransfer,a={};b&&b.files&&b.files.length&&(c.preventDefault(),this._getDroppedFiles(b).always(function(b){a.files=b;!1!==d._trigger("drop",e.Event("drop",{delegatedEvent:c}),a)&&d._onAdd(c,a)}))},_onDragOver:function(c){c.dataTransfer=c.originalEvent&&c.originalEvent.dataTransfer;var d=c.dataTransfer;d&&-1!==e.inArray("Files",
d.types)&&!1!==this._trigger("dragover",e.Event("dragover",{delegatedEvent:c}))&&(c.preventDefault(),d.dropEffect="copy")},_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop}),this._on(this.options.pasteZone,{paste:this._onPaste}));e.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragover drop");this._off(this.options.pasteZone,
"paste");this._off(this.options.fileInput,"change")},_setOption:function(c,d){var b=-1!==e.inArray(c,this._specialOptions);b&&this._destroyEventHandlers();this._super(c,d);b&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var c=this.options;c.fileInput===u?c.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):c.fileInput instanceof e||(c.fileInput=e(c.fileInput));c.dropZone instanceof e||(c.dropZone=e(c.dropZone));
c.pasteZone instanceof e||(c.pasteZone=e(c.pasteZone))},_getRegExp:function(c){c=c.split("/");var d=c.pop();c.shift();return new RegExp(c.join("/"),d)},_isRegExpOption:function(c,d){return"url"!==c&&"string"===e.type(d)&&/^\/.*\/[igm]{0,3}$/.test(d)},_initDataAttributes:function(){var c=this,d=this.options,b=e(this.element[0].cloneNode(!1));e.each(b.data(),function(a,k){var f="data-"+a.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();b.attr(f)&&(c._isRegExpOption(a,k)&&(k=c._getRegExp(k)),d[a]=k)})},
_create:function(){this._initDataAttributes();this._initSpecialOptions();this._slots=[];this._sequence=this._getXHRPromise(!0);this._sending=this._active=0;this._initProgressObject(this);this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(c){var d=this;c&&!this.options.disabled&&(c.fileInput&&!c.files?this._getFileInputFiles(c.fileInput).always(function(b){c.files=b;d._onAdd(null,c)}):(c.files=e.makeArray(c.files),this._onAdd(null,
c)))},send:function(c){if(c&&!this.options.disabled){if(c.fileInput&&!c.files){var d=this,b=e.Deferred(),a=b.promise(),k,f;a.abort=function(){f=!0;if(k)return k.abort();b.reject(null,"abort","abort");return a};this._getFileInputFiles(c.fileInput).always(function(a){f||(a.length?(c.files=a,k=d._onSend(null,c).then(function(f,a,h){b.resolve(f,a,h)},function(f,a,h){b.reject(f,a,h)})):b.reject())});return this._enhancePromise(a)}c.files=e.makeArray(c.files);if(c.files.length)return this._onSend(null,
c)}return this._getXHRPromise(!1,c&&c.context)}})})})});
(function(z){var B=window.AmazonUIPageJS||window.P,u=B._namespace||B.attributeErrors,l=u?u("AmazonCustomFabricJS"):B;l.guardFatal?l.guardFatal(z)(l,window):l.execute(function(){z(l,window)})})(function(z,B,u){z.when("A").register("fabric-js",function(l){var n=n||{};if(!l.capabilities.canvas)return{};var g=g||{version:"1.6.0"};"undefined"!==typeof n&&(n.fabric=g);"undefined"!==typeof document&&"undefined"!==typeof B?(g.document=document,g.window=B,B.fabric=g):(g.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>"),
g.window=g.document.createWindow?g.document.createWindow():g.document.parentWindow);g.isTouchSupported="ontouchstart"in g.document.documentElement;g.isLikelyNode="undefined"!==typeof Buffer&&"undefined"===typeof B;g.SHARED_ATTRIBUTES="display transform fill fill-opacity fill-rule opacity stroke stroke-dasharray stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width id".split(" ");g.DPI=96;g.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)";g.fontPaths={};g.devicePixelRatio=
g.window.devicePixelRatio||g.window.webkitDevicePixelRatio||g.window.mozDevicePixelRatio||1;"object"!==typeof JSON&&(JSON={});(function(){function e(f){return 10>f?"0"+f:f}function c(f){a.lastIndex=0;return a.test(f)?'"'+f.replace(a,function(f){var a=h[f];return"string"===typeof a?a:"\\u"+("0000"+f.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+f+'"'}function d(a,h){var b,e,g,E,D=k,x,H=h[a];H&&"object"===typeof H&&"function"===typeof H.toJSON&&(H=H.toJSON(a));"function"===typeof q&&(H=q.call(h,a,
H));switch(typeof H){case "string":return c(H);case "number":return isFinite(H)?String(H):"null";case "boolean":case "null":return String(H);case "object":if(!H)return"null";k+=f;x=[];if("[object Array]"===Object.prototype.toString.apply(H)){E=H.length;for(b=0;b<E;b+=1)x[b]=d(b,H)||"null";g=0===x.length?"[]":k?"[\n"+k+x.join(",\n"+k)+"\n"+D+"]":"["+x.join(",")+"]";k=D;return g}if(q&&"object"===typeof q)for(E=q.length,b=0;b<E;b+=1)"string"===typeof q[b]&&(e=q[b],(g=d(e,H))&&x.push(c(e)+(k?": ":":")+
g));else for(e in H)Object.prototype.hasOwnProperty.call(H,e)&&(g=d(e,H))&&x.push(c(e)+(k?": ":":")+g);g=0===x.length?"{}":k?"{\n"+k+x.join(",\n"+k)+"\n"+D+"}":"{"+x.join(",")+"}";k=D;return g}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=
Boolean.prototype.toJSON=function(){return this.valueOf()});var b,a,k,f,h,q;"function"!==typeof JSON.stringify&&(a=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,h={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(a,h,b){var c;f=k="";if("number"===typeof b)for(c=0;c<b;c+=1)f+=" ";else"string"===typeof b&&(f=b);if((q=h)&&"function"!==typeof h&&("object"!==typeof h||"number"!==
typeof h.length))throw Error("JSON.stringify");return d("",{"":a})});"function"!==typeof JSON.parse&&(b=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,JSON.parse=function(f,a){function h(f,b){var c,k,d=f[b];if(d&&"object"===typeof d)for(c in d)Object.prototype.hasOwnProperty.call(d,c)&&(k=h(d,c),k!==u?d[c]=k:delete d[c]);return a.call(f,b,d)}var c;f=String(f);b.lastIndex=0;b.test(f)&&(f=f.replace(b,function(f){return"\\u"+("0000"+f.charCodeAt(0).toString(16)).slice(-4)}));
if(/^[\],:{}\s]*$/.test(f.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return c=eval("("+f+")"),"function"===typeof a?h({"":c},""):c;throw new SyntaxError("JSON.parse");})})();(function(){function e(a,b){this.__eventListeners[a]&&(b?g.util.removeFromArray(this.__eventListeners[a],b):this.__eventListeners[a].length=0)}function c(a,b){this.__eventListeners||(this.__eventListeners=
{});if(1===arguments.length)for(var f in a)this.on(f,a[f]);else this.__eventListeners[a]||(this.__eventListeners[a]=[]),this.__eventListeners[a].push(b);return this}function d(a,b){if(this.__eventListeners){if(0===arguments.length)this.__eventListeners={};else if(1===arguments.length&&"object"===typeof arguments[0])for(var f in a)e.call(this,f,a[f]);else e.call(this,a,b);return this}}function b(a,b){if(this.__eventListeners){var f=this.__eventListeners[a];if(f){for(var h=0,c=f.length;h<c;h++)f[h].call(this,
b||{});return this}}}g.Observable={observe:c,stopObserving:d,fire:b,on:c,off:d,trigger:b}})();g.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var e=0,c=arguments.length;e<c;e++)this._onObjectAdded(arguments[e]);this.renderOnAddRemove&&this.renderAll();return this},insertAt:function(e,c,d){var b=this.getObjects();d?b[c]=e:b.splice(c,0,e);this._onObjectAdded(e);this.renderOnAddRemove&&this.renderAll();return this},remove:function(){for(var e=this.getObjects(),c,d=
0,b=arguments.length;d<b;d++)c=e.indexOf(arguments[d]),-1!==c&&(e.splice(c,1),this._onObjectRemoved(arguments[d]));this.renderOnAddRemove&&this.renderAll();return this},forEachObject:function(e,c){for(var d=this.getObjects(),b=d.length;b--;)e.call(c,d[b],b,d);return this},getObjects:function(e){return"undefined"===typeof e?this._objects:this._objects.filter(function(c){return c.type===e})},item:function(e){return this.getObjects()[e]},isEmpty:function(){return 0===this.getObjects().length},size:function(){return this.getObjects().length},
contains:function(e){return-1<this.getObjects().indexOf(e)},complexity:function(){return this.getObjects().reduce(function(e,c){return e+=c.complexity?c.complexity():0},0)}};(function(e){var c=Math.sqrt,d=Math.atan2,b=Math.pow,a=Math.abs,k=Math.PI/180;g.util={removeFromArray:function(f,a){var b=f.indexOf(a);-1!==b&&f.splice(b,1);return f},getRandomInt:function(f,a){return Math.floor(Math.random()*(a-f+1))+f},degreesToRadians:function(f){return f*k},radiansToDegrees:function(f){return f/k},rotatePoint:function(f,
a,b){f.subtractEquals(a);f=g.util.rotateVector(f,b);return(new g.Point(f.x,f.y)).addEquals(a)},rotateVector:function(f,a){var b=Math.sin(a),c=Math.cos(a);return{x:f.x*c-f.y*b,y:f.x*b+f.y*c}},transformPoint:function(f,a,b){return b?new g.Point(a[0]*f.x+a[2]*f.y,a[1]*f.x+a[3]*f.y):new g.Point(a[0]*f.x+a[2]*f.y+a[4],a[1]*f.x+a[3]*f.y+a[5])},makeBoundingBoxFromPoints:function(f){var a=[f[0].x,f[1].x,f[2].x,f[3].x],b=g.util.array.min(a),a=g.util.array.max(a),a=Math.abs(b-a),c=[f[0].y,f[1].y,f[2].y,f[3].y];
f=g.util.array.min(c);c=g.util.array.max(c);c=Math.abs(f-c);return{left:b,top:f,width:a,height:c}},invertTransform:function(f){var a=1/(f[0]*f[3]-f[1]*f[2]),a=[a*f[3],-a*f[1],-a*f[2],a*f[0]];f=g.util.transformPoint({x:f[4],y:f[5]},a,!0);a[4]=-f.x;a[5]=-f.y;return a},toFixed:function(f,a){return parseFloat(Number(f).toFixed(a))},parseUnit:function(f,a){var b=/\D{0,2}$/.exec(f),c=parseFloat(f);a||(a=g.Text.DEFAULT_SVG_FONT_SIZE);switch(b[0]){case "mm":return c*g.DPI/25.4;case "cm":return c*g.DPI/2.54;
case "in":return c*g.DPI;case "pt":return c*g.DPI/72;case "pc":return c*g.DPI/72*12;case "em":return c*a;default:return c}},falseFunction:function(){return!1},getKlass:function(f,a){f=g.util.string.camelize(f.charAt(0).toUpperCase()+f.slice(1));return g.util.resolveNamespace(a)[f]},resolveNamespace:function(f){if(!f)return g;f=f.split(".");for(var a=f.length,b=e||g.window,c=0;c<a;++c)b=b[f[c]];return b},loadImage:function(f,a,b,c){if(f){var k=g.util.createImage();k.onload=function(){a&&a.call(b,k);
k=k.onload=k.onerror=null};k.onerror=function(){g.log("Error loading "+k.src);a&&a.call(b,null,!0);k=k.onload=k.onerror=null};0!==f.indexOf("data")&&c&&(k.crossOrigin=c);k.src=f}else a&&a.call(b,f)},enlivenObjects:function(f,a,b,c){function k(){++e===v&&a&&a(d)}f=f||[];var d=[],e=0,v=f.length;v?f.forEach(function(f,a){if(f&&f.type){var h=g.util.getKlass(f.type,b);h.async?h.fromObject(f,function(h,b){b||(d[a]=h,c&&c(f,d[a]));k()}):(d[a]=h.fromObject(f),c&&c(f,d[a]),k())}else k()}):a&&a(d)},groupSVGElements:function(f,
a,b){f=new g.PathGroup(f,a);"undefined"!==typeof b&&f.setSourcePath(b);return f},populateWithProperties:function(f,a,b){if(b&&"[object Array]"===Object.prototype.toString.call(b))for(var c=0,k=b.length;c<k;c++)b[c]in f&&(a[b[c]]=f[b[c]])},drawDashedLine:function(f,a,b,k,e,g){k-=a;var m=e-b;e=c(k*k+m*m);k=d(m,k);var m=g.length,v=0,E=!0;f.save();f.translate(a,b);f.moveTo(0,0);f.rotate(k);for(a=0;e>a;)a+=g[v++%m],a>e&&(a=e),f[E?"lineTo":"moveTo"](a,0),E=!E;f.restore()},createCanvasElement:function(f){f||
(f=g.document.createElement("canvas"));f.getContext||"undefined"===typeof G_vmlCanvasManager||G_vmlCanvasManager.initElement(f);return f},createImage:function(){return g.isLikelyNode?new (require("canvas").Image):g.document.createElement("img")},createAccessors:function(f){f=f.prototype;for(var a=f.stateProperties.length;a--;){var b=f.stateProperties[a],c=b.charAt(0).toUpperCase()+b.slice(1),k="set"+c,c="get"+c;f[c]||(f[c]=new Function('return this.get("'+b+'")'));f[k]||(f[k]=new Function("value",
'return this.set("'+b+'", value)'))}},clipContext:function(f,a){a.save();a.beginPath();f.clipTo(a);a.clip()},multiplyTransformMatrices:function(f,a,b){return[f[0]*a[0]+f[2]*a[1],f[1]*a[0]+f[3]*a[1],f[0]*a[2]+f[2]*a[3],f[1]*a[2]+f[3]*a[3],b?0:f[0]*a[4]+f[2]*a[5]+f[4],b?0:f[1]*a[4]+f[3]*a[5]+f[5]]},qrDecompose:function(f){var a=d(f[1],f[0]),q=b(f[0],2)+b(f[1],2),e=c(q),g=(f[0]*f[3]-f[2]*f[1])/e,q=d(f[0]*f[2]+f[1]*f[3],q);return{angle:a/k,scaleX:e,scaleY:g,skewX:q/k,skewY:0,translateX:f[4],translateY:f[5]}},
customTransformMatrix:function(f,h,b){b=[1,0,a(Math.tan(b*k)),1];f=[a(f),0,0,a(h)];return g.util.multiplyTransformMatrices(f,b,!0)},resetObjectTransform:function(f){f.scaleX=1;f.scaleY=1;f.skewX=0;f.skewY=0;f.flipX=!1;f.flipY=!1;f.setAngle(0)},getFunctionBody:function(f){return(String(f).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(f,a,b,c){0<c&&(a=a>c?a-c:0,b=b>c?b-c:0);var k=!0;f=f.getImageData(a,b,2*c||1,2*c||1);a=3;for(b=f.data.length;a<b&&(k=0>=f.data[a],!1!==k);a+=4);
return k},parsePreserveAspectRatioAttribute:function(f){var a="meet",b="Mid",c="Mid";f=f.split(" ");var k;f&&f.length&&(a=f.pop(),"meet"!==a&&"slice"!==a?(k=a,a="meet"):f.length&&(k=f.pop()));b="none"!==k?k.slice(1,4):"none";c="none"!==k?k.slice(5,8):"none";return{meetOrSlice:a,alignX:b,alignY:c}}}})("undefined"!==typeof n?n:this);(function(){function e(f,b,k,e,m,g,E){var D=h.call(arguments);if(a[D])return a[D];var x=Math.PI,H=E*x/180,I=Math.sin(H),H=Math.cos(H),l=0,n=0;k=Math.abs(k);e=Math.abs(e);
var w=-H*f*.5-I*b*.5,C=-H*b*.5+I*f*.5,A=k*k,G=e*e,N=C*C,F=w*w,K=A*G-A*N-G*F,L=0;0>K?(A=Math.sqrt(1-K/(A*G)),k*=A,e*=A):L=(m===g?-1:1)*Math.sqrt(K/(A*N+G*F));N=L*k*C/e;F=-L*e*w/k;L=H*N-I*F+.5*f;A=I*N+H*F+.5*b;G=d(1,0,(w-N)/k,(C-F)/e);C=d((w-N)/k,(C-F)/e,(-w-N)/k,(-C-F)/e);0===g&&0<C?C-=2*x:1===g&&0>C&&(C+=2*x);x=Math.ceil(Math.abs(C/x*2));w=[];C/=x;N=8/3*Math.sin(C/4)*Math.sin(C/4)/Math.sin(C/2);F=G+C;for(K=0;K<x;K++)w[K]=c(G,F,H,I,k,e,L,A,N,l,n),l=w[K][4],n=w[K][5],G=F,F+=C;return a[D]=w}function c(f,
a,b,c,d,e,g,D,x,H,I){var l=h.call(arguments);if(k[l])return k[l];var n=Math.cos(f),w=Math.sin(f),C=Math.cos(a),A=Math.sin(a),G=b*d*C-c*e*A+g,N=c*d*C+b*e*A+D;k[l]=[H+x*(-b*d*w-c*e*n),I+x*(-c*d*w+b*e*n),G+x*(b*d*A+c*e*C),N+x*(c*d*A-b*e*C),G,N];return k[l]}function d(f,a,h,b){f=Math.atan2(a,f);h=Math.atan2(b,h);return h>=f?h-f:2*Math.PI-(f-h)}function b(a,b,c,k,d,e,g,D){var x=h.call(arguments);if(f[x])return f[x];var H=Math.sqrt,I=Math.min,l=Math.max,n=Math.abs,w=[],C=[[],[]],A,G,N,F,K;G=6*a-12*c+6*
d;A=-3*a+9*c-9*d+3*g;N=3*c-3*a;for(var L=0;2>L;++L)0<L&&(G=6*b-12*k+6*e,A=-3*b+9*k-9*e+3*D,N=3*k-3*b),1E-12>n(A)?1E-12>n(G)||(F=-N/G,0<F&&1>F&&w.push(F)):(F=G*G-4*N*A,0>F||(K=H(F),F=(-G+K)/(2*A),0<F&&1>F&&w.push(F),F=(-G-K)/(2*A),0<F&&1>F&&w.push(F)));for(n=H=w.length;H--;)F=w[H],G=1-F,A=G*G*G*a+3*G*G*F*c+3*G*F*F*d+F*F*F*g,C[0][H]=A,A=G*G*G*b+3*G*G*F*k+3*G*F*F*e+F*F*F*D,C[1][H]=A;C[0][n]=a;C[1][n]=b;C[0][n+1]=g;C[1][n+1]=D;I=[{x:I.apply(null,C[0]),y:I.apply(null,C[1])},{x:l.apply(null,C[0]),y:l.apply(null,
C[1])}];return f[x]=I}var a={},k={},f={},h=Array.prototype.join;g.util.drawArc=function(f,a,h,b){var c=[[],[],[],[]];b=e(b[5]-a,b[6]-h,b[0],b[1],b[3],b[4],b[2]);for(var k=0,d=b.length;k<d;k++)c[k][0]=b[k][0]+a,c[k][1]=b[k][1]+h,c[k][2]=b[k][2]+a,c[k][3]=b[k][3]+h,c[k][4]=b[k][4]+a,c[k][5]=b[k][5]+h,f.bezierCurveTo.apply(f,c[k])};g.util.getBoundsOfArc=function(f,a,h,c,k,d,g,D,x){var H=0,I=0,l=[],n=[];h=e(D-f,x-a,h,c,d,g,k);c=[[],[]];k=0;for(d=h.length;k<d;k++)l=b(H,I,h[k][0],h[k][1],h[k][2],h[k][3],
h[k][4],h[k][5]),c[0].x=l[0].x+f,c[0].y=l[0].y+a,c[1].x=l[1].x+f,c[1].y=l[1].y+a,n.push(c[0]),n.push(c[1]),H=h[k][4],I=h[k][5];return n};g.util.getBoundsOfCurve=b})();(function(){function e(c,b,a){if(c&&0!==c.length){var k=c.length-1,f=b?c[k][b]:c[k];if(b)for(;k--;)a(c[k][b],f)&&(f=c[k][b]);else for(;k--;)a(c[k],f)&&(f=c[k]);return f}}var c=Array.prototype.slice;Array.prototype.indexOf||(Array.prototype.indexOf=function(c){if(void 0===this||null===this)throw new TypeError;var b=Object(this),a=b.length>>>
0;if(0===a)return-1;var k=0;0<arguments.length&&(k=Number(arguments[1]),k!==k?k=0:0!==k&&k!==Number.POSITIVE_INFINITY&&k!==Number.NEGATIVE_INFINITY&&(k=(0<k||-1)*Math.floor(Math.abs(k))));if(k>=a)return-1;for(k=0<=k?k:Math.max(a-Math.abs(k),0);k<a;k++)if(k in b&&b[k]===c)return k;return-1});Array.prototype.forEach||(Array.prototype.forEach=function(c,b){for(var a=0,k=this.length>>>0;a<k;a++)a in this&&c.call(b,this[a],a,this)});Array.prototype.map||(Array.prototype.map=function(c,b){for(var a=[],
k=0,f=this.length>>>0;k<f;k++)k in this&&(a[k]=c.call(b,this[k],k,this));return a});Array.prototype.every||(Array.prototype.every=function(c,b){for(var a=0,k=this.length>>>0;a<k;a++)if(a in this&&!c.call(b,this[a],a,this))return!1;return!0});Array.prototype.some||(Array.prototype.some=function(c,b){for(var a=0,k=this.length>>>0;a<k;a++)if(a in this&&c.call(b,this[a],a,this))return!0;return!1});Array.prototype.filter||(Array.prototype.filter=function(c,b){for(var a=[],k,f=0,h=this.length>>>0;f<h;f++)f in
this&&(k=this[f],c.call(b,k,f,this)&&a.push(k));return a});Array.prototype.reduce||(Array.prototype.reduce=function(c){var b=this.length>>>0,a=0,k;if(1<arguments.length)k=arguments[1];else{do{if(a in this){k=this[a++];break}if(++a>=b)throw new TypeError;}while(1)}for(;a<b;a++)a in this&&(k=c.call(null,k,this[a],a,this));return k});g.util.array={invoke:function(d,b){for(var a=c.call(arguments,2),k=[],f=0,h=d.length;f<h;f++)k[f]=a.length?d[f][b].apply(d[f],a):d[f][b].call(d[f]);return k},min:function(c,
b){return e(c,b,function(a,b){return a<b})},max:function(c,b){return e(c,b,function(a,b){return a>=b})}}})();(function(){function e(c,d){for(var b in d)c[b]=d[b];return c}g.util.object={extend:e,clone:function(c){return e({},c)}}})();(function(){String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")});g.util.string={camelize:function(e){return e.replace(/-+(.)?/g,function(c,d){return d?d.toUpperCase():""})},capitalize:function(e,c){return e.charAt(0).toUpperCase()+
(c?e.slice(1):e.slice(1).toLowerCase())},escapeXml:function(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}})();(function(){var e=Array.prototype.slice,c=Function.prototype.apply,d=function(){};Function.prototype.bind||(Function.prototype.bind=function(b){var a=this,k=e.call(arguments,1),f;f=k.length?function(){return c.call(a,this instanceof d?this:b,k.concat(e.call(arguments)))}:function(){return c.call(a,this instanceof
d?this:b,arguments)};d.prototype=this.prototype;f.prototype=new d;return f})})();(function(){function e(){}function c(f){var a=this.constructor.superclass.prototype[f];return 1<arguments.length?a.apply(this,d.call(arguments,1)):a.call(this)}var d=Array.prototype.slice,b=function(){},a=function(){for(var f in{toString:1})if("toString"===f)return!1;return!0}(),k=function(f,h,b){for(var c in h)c in f.prototype&&"function"===typeof f.prototype[c]&&-1<(h[c]+"").indexOf("callSuper")?f.prototype[c]=function(f){return function(){var a=
this.constructor.superclass;this.constructor.superclass=b;var c=h[f].apply(this,arguments);this.constructor.superclass=a;if("initialize"!==f)return c}}(c):f.prototype[c]=h[c],a&&(h.toString!==Object.prototype.toString&&(f.prototype.toString=h.toString),h.valueOf!==Object.prototype.valueOf&&(f.prototype.valueOf=h.valueOf))};g.util.createClass=function(){function f(){this.initialize.apply(this,arguments)}var a=null,q=d.call(arguments,0);"function"===typeof q[0]&&(a=q.shift());f.superclass=a;f.subclasses=
[];a&&(e.prototype=a.prototype,f.prototype=new e,a.subclasses.push(f));for(var p=0,g=q.length;p<g;p++)k(f,q[p],a);f.prototype.initialize||(f.prototype.initialize=b);f.prototype.constructor=f;f.prototype.callSuper=c;return f}})();(function(){function e(f){var a=Array.prototype.slice.call(arguments,1),h,b,c=a.length;for(b=0;b<c;b++)if(h=typeof f[a[b]],!/^(?:function|object|unknown)$/.test(h))return!1;return!0}function c(f,h){return function(b){h.call(a(f),b||g.window.event)}}function d(f,a){return function(h){if(t[f]&&
t[f][a])for(var b=t[f][a],c=0,k=b.length;c<k;c++)b[c].call(this,h||g.window.event)}}function b(f,a,h){var b="touchend"===f.type?"changedTouches":"touches";return f[b]&&f[b][0]?f[b][0][a]-(f[b][0][a]-f[b][0][h])||f[h]:f[h]}var a,k,f=function(){var f=0;return function(a){return a.__uniqueID||(a.__uniqueID="uniqueID__"+f++)}}();(function(){var f={};a=function(a){return f[a]};k=function(a,h){f[a]=h}})();var h=e(g.document.documentElement,"addEventListener","removeEventListener")&&e(g.window,"addEventListener",
"removeEventListener"),q=e(g.document.documentElement,"attachEvent","detachEvent")&&e(g.window,"attachEvent","detachEvent"),p={},t={};h?(h=function(f,a,h){f.addEventListener(a,h,!1)},q=function(f,a,h){f.removeEventListener(a,h,!1)}):q?(h=function(a,h,b){var d=f(a);k(d,a);p[d]||(p[d]={});p[d][h]||(p[d][h]=[]);b={handler:b,wrappedHandler:c(d,b)};p[d][h].push(b);a.attachEvent("on"+h,b.wrappedHandler)},q=function(a,h,b){var c=f(a),k;if(p[c]&&p[c][h])for(var d=0,q=p[c][h].length;d<q;d++)(k=p[c][h][d])&&
k.handler===b&&(a.detachEvent("on"+h,k.wrappedHandler),p[c][h][d]=null)}):(h=function(a,h,b){var c=f(a);t[c]||(t[c]={});if(!t[c][h]){t[c][h]=[];var k=a["on"+h];k&&t[c][h].push(k);a["on"+h]=d(c,h)}t[c][h].push(b)},q=function(a,h,b){a=f(a);if(t[a]&&t[a][h]){h=t[a][h];a=0;for(var c=h.length;a<c;a++)h[a]===b&&h.splice(a,1)}});g.util.addListener=h;g.util.removeListener=q;var r=function(f){return"unknown"!==typeof f.clientX?f.clientX:0},m=function(f){return"unknown"!==typeof f.clientY?f.clientY:0};g.isTouchSupported&&
(r=function(f){return b(f,"pageX","clientX")},m=function(f){return b(f,"pageY","clientY")});g.util.getPointer=function(f){f||(f=g.window.event);var a=g.util.getScrollLeftTop(f.target||("unknown"!==typeof f.srcElement?f.srcElement:null));return{x:r(f)+a.left,y:m(f)+a.top}};g.util.object.extend(g.util,g.Observable)})();(function(){var e=g.document.createElement("div"),c="string"===typeof e.style.filter,d=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,b=function(a){return a};"string"===typeof e.style.opacity?
b=function(a,b){a.style.opacity=b;return a}:c&&(b=function(a,b){var f=a.style;a.currentStyle&&!a.currentStyle.hasLayout&&(f.zoom=1);d.test(f.filter)?f.filter=f.filter.replace(d,.9999<=b?"":"alpha(opacity="+100*b+")"):f.filter+=" alpha(opacity="+100*b+")";return a});g.util.setStyle=function(a,c){var f=a.style;if(!f)return a;if("string"===typeof c)return a.style.cssText+=";"+c,-1<c.indexOf("opacity")?b(a,c.match(/opacity:\s*(\d?\.?\d*)/)[1]):a;for(var h in c)"opacity"===h?b(a,c[h]):f["float"===h||"cssFloat"===
h?"undefined"===typeof f.styleFloat?"cssFloat":"styleFloat":h]=c[h];return a}})();(function(){function e(f,a){var b=g.document.createElement(f),c;for(c in a)"class"===c?b.className=a[c]:"for"===c?b.htmlFor=a[c]:b.setAttribute(c,a[c]);return b}function c(f){for(var a=0,b=0,c=g.document.documentElement,k=g.document.body||{scrollLeft:0,scrollTop:0};f&&(f.parentNode||f.host)&&(f=f.parentNode||f.host,f===g.document?(a=k.scrollLeft||c.scrollLeft||0,b=k.scrollTop||c.scrollTop||0):(a+=f.scrollLeft||0,b+=
f.scrollTop||0),1!==f.nodeType||"fixed"!==g.util.getElementStyle(f,"position")););return{left:a,top:b}}var d=Array.prototype.slice,b,a=function(f){return d.call(f,0)};try{b=a(g.document.childNodes)instanceof Array}catch(k){}b||(a=function(f){for(var a=Array(f.length),b=f.length;b--;)a[b]=f[b];return a});var f;f=g.document.defaultView&&g.document.defaultView.getComputedStyle?function(f,a){var b=g.document.defaultView.getComputedStyle(f,null);return b?b[a]:u}:function(f,a){var b=f.style[a];!b&&f.currentStyle&&
(b=f.currentStyle[a]);return b};(function(){var f=g.document.documentElement.style,a="userSelect"in f?"userSelect":"MozUserSelect"in f?"MozUserSelect":"WebkitUserSelect"in f?"WebkitUserSelect":"KhtmlUserSelect"in f?"KhtmlUserSelect":"";g.util.makeElementUnselectable=function(f){"undefined"!==typeof f.onselectstart&&(f.onselectstart=g.util.falseFunction);a?f.style[a]="none":"string"===typeof f.unselectable&&(f.unselectable="on");return f};g.util.makeElementSelectable=function(f){"undefined"!==typeof f.onselectstart&&
(f.onselectstart=null);a?f.style[a]="":"string"===typeof f.unselectable&&(f.unselectable="");return f}})();(function(){g.util.getScript=function(f,a){var b=g.document.getElementsByTagName("head")[0],c=g.document.createElement("script"),k=!0;c.onload=c.onreadystatechange=function(f){!k||"string"===typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(k=!1,a(f||g.window.event),c=c.onload=c.onreadystatechange=null)};c.src=f;b.appendChild(c)}})();g.util.getById=function(f){return"string"===
typeof f?g.document.getElementById(f):f};g.util.toArray=a;g.util.makeElement=e;g.util.addClass=function(f,a){f&&-1===(" "+f.className+" ").indexOf(" "+a+" ")&&(f.className+=(f.className?" ":"")+a)};g.util.wrapElement=function(f,a,b){"string"===typeof a&&(a=e(a,b));f.parentNode&&f.parentNode.replaceChild(a,f);a.appendChild(f);return a};g.util.getScrollLeftTop=c;g.util.getElementOffset=function(a){var b;b=a&&a.ownerDocument;var k={left:0,top:0},d={left:0,top:0},e={borderLeftWidth:"left",borderTopWidth:"top",
paddingLeft:"left",paddingTop:"top"};if(!b)return d;for(var m in e)d[e[m]]+=parseInt(f(a,m),10)||0;b=b.documentElement;"undefined"!==typeof a.getBoundingClientRect&&(k=a.getBoundingClientRect());a=c(a);return{left:k.left+a.left-(b.clientLeft||0)+d.left,top:k.top+a.top-(b.clientTop||0)+d.top}};g.util.getElementStyle=f})();(function(){function e(b,a){return b+(/\?/.test(b)?"&":"?")+a}function c(){}var d=function(){for(var b=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},
function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],a=b.length;a--;)try{if(b[a]())return b[a]}catch(c){}}();g.util.request=function(b,a){a||(a={});var k=a.method?a.method.toUpperCase():"GET",f=a.onComplete||function(){},h=d(),q;h.onreadystatechange=function(){4===h.readyState&&(f(h),h.onreadystatechange=c)};"GET"===k&&(q=null,"string"===typeof a.parameters&&(b=e(b,a.parameters)));h.open(k,b,!0);"POST"!==k&&"PUT"!==k||h.setRequestHeader("Content-Type",
"application/x-www-form-urlencoded");h.send(q);return h}})();g.log=function(){};g.warn=function(){};"undefined"!==typeof console&&["log","warn"].forEach(function(e){"undefined"!==typeof console[e]&&"function"===typeof console[e].apply&&(g[e]=function(){return console[e].apply(console,arguments)})});(function(){function e(){return c.apply(g.window,arguments)}var c=g.window.requestAnimationFrame||g.window.webkitRequestAnimationFrame||g.window.mozRequestAnimationFrame||g.window.oRequestAnimationFrame||
g.window.msRequestAnimationFrame||function(c){g.window.setTimeout(c,1E3/60)};g.util.animate=function(c){e(function(b){c||(c={});var a=b||+new Date,k=c.duration||500,f=a+k,h,q=c.onChange||function(){},p=c.abort||function(){return!1},g=c.easing||function(f,a,h,b){return-h*Math.cos(f/b*(Math.PI/2))+h+a},r="startValue"in c?c.startValue:0;b="endValue"in c?c.endValue:100;var m=c.byValue||b-r;c.onStart&&c.onStart();(function E(b){h=b||+new Date;b=h>f?k:h-a;p()?c.onComplete&&c.onComplete():(q(g(b,r,m,k)),
h>f?c.onComplete&&c.onComplete():e(E))})(a)})};g.util.requestAnimFrame=e})();(function(){function e(a,b,f,h){a<Math.abs(b)?(a=b,h=f/4):h=f/(2*Math.PI)*Math.asin(b/a);return{a:a,c:b,p:f,s:h}}function c(a,b,f){return a.a*Math.pow(2,10*--b)*Math.sin(2*(b*f-a.s)*Math.PI/a.p)}function d(a,c,f,h){return f-b(h-a,0,f,h)+c}function b(a,b,f,h){return(a/=h)<1/2.75?7.5625*f*a*a+b:a<2/2.75?f*(7.5625*(a-=1.5/2.75)*a+.75)+b:a<2.5/2.75?f*(7.5625*(a-=2.25/2.75)*a+.9375)+b:f*(7.5625*(a-=2.625/2.75)*a+.984375)+b}g.util.ease=
{easeInQuad:function(a,b,f,h){return f*(a/=h)*a+b},easeOutQuad:function(a,b,f,h){return-f*(a/=h)*(a-2)+b},easeInOutQuad:function(a,b,f,h){a/=h/2;return 1>a?f/2*a*a+b:-f/2*(--a*(a-2)-1)+b},easeInCubic:function(a,b,f,h){return f*(a/=h)*a*a+b},easeOutCubic:function(a,b,f,h){return f*((a=a/h-1)*a*a+1)+b},easeInOutCubic:function(a,b,f,h){a/=h/2;return 1>a?f/2*a*a*a+b:f/2*((a-=2)*a*a+2)+b},easeInQuart:function(a,b,f,h){return f*(a/=h)*a*a*a+b},easeOutQuart:function(a,b,f,h){return-f*((a=a/h-1)*a*a*a-1)+
b},easeInOutQuart:function(a,b,f,h){a/=h/2;return 1>a?f/2*a*a*a*a+b:-f/2*((a-=2)*a*a*a-2)+b},easeInQuint:function(a,b,f,h){return f*(a/=h)*a*a*a*a+b},easeOutQuint:function(a,b,f,h){return f*((a=a/h-1)*a*a*a*a+1)+b},easeInOutQuint:function(a,b,f,h){a/=h/2;return 1>a?f/2*a*a*a*a*a+b:f/2*((a-=2)*a*a*a*a+2)+b},easeInSine:function(a,b,f,h){return-f*Math.cos(a/h*(Math.PI/2))+f+b},easeOutSine:function(a,b,f,h){return f*Math.sin(a/h*(Math.PI/2))+b},easeInOutSine:function(a,b,f,h){return-f/2*(Math.cos(Math.PI*
a/h)-1)+b},easeInExpo:function(a,b,f,h){return 0===a?b:f*Math.pow(2,10*(a/h-1))+b},easeOutExpo:function(a,b,f,h){return a===h?b+f:f*(-Math.pow(2,-10*a/h)+1)+b},easeInOutExpo:function(a,b,f,h){if(0===a)return b;if(a===h)return b+f;a/=h/2;return 1>a?f/2*Math.pow(2,10*(a-1))+b:f/2*(-Math.pow(2,-10*--a)+2)+b},easeInCirc:function(a,b,f,h){return-f*(Math.sqrt(1-(a/=h)*a)-1)+b},easeOutCirc:function(a,b,f,h){return f*Math.sqrt(1-(a=a/h-1)*a)+b},easeInOutCirc:function(a,b,f,h){a/=h/2;return 1>a?-f/2*(Math.sqrt(1-
a*a)-1)+b:f/2*(Math.sqrt(1-(a-=2)*a)+1)+b},easeInElastic:function(a,b,f,h){var d=0;if(0===a)return b;a/=h;if(1===a)return b+f;d||(d=.3*h);f=e(f,f,d,1.70158);return-c(f,a,h)+b},easeOutElastic:function(a,b,f,h){var c=0;if(0===a)return b;a/=h;if(1===a)return b+f;c||(c=.3*h);f=e(f,f,c,1.70158);return f.a*Math.pow(2,-10*a)*Math.sin(2*(a*h-f.s)*Math.PI/f.p)+f.c+b},easeInOutElastic:function(a,b,f,h){var d=0;if(0===a)return b;a/=h/2;if(2===a)return b+f;d||(d=.3*h*1.5);f=e(f,f,d,1.70158);return 1>a?-.5*c(f,
a,h)+b:f.a*Math.pow(2,-10*--a)*Math.sin(2*(a*h-f.s)*Math.PI/f.p)*.5+f.c+b},easeInBack:function(a,b,f,h,c){c===u&&(c=1.70158);return f*(a/=h)*a*((c+1)*a-c)+b},easeOutBack:function(a,b,f,h,c){c===u&&(c=1.70158);return f*((a=a/h-1)*a*((c+1)*a+c)+1)+b},easeInOutBack:function(a,b,f,h,c){c===u&&(c=1.70158);a/=h/2;return 1>a?f/2*a*a*(((c*=1.525)+1)*a-c)+b:f/2*((a-=2)*a*(((c*=1.525)+1)*a+c)+2)+b},easeInBounce:d,easeOutBounce:b,easeInOutBounce:function(a,c,f,h){return a<h/2?.5*d(2*a,0,f,h)+c:.5*b(2*a-h,0,
f,h)+.5*f+c}}})();(function(e){function c(f){return f in C?C[f]:f}function d(f,a,h,b){var c="[object Array]"===Object.prototype.toString.call(a),k;"fill"!==f&&"stroke"!==f||"none"!==a?"strokeDashArray"===f?a=a.replace(/,/g," ").split(/\s+/).map(function(f){return parseFloat(f)}):"transformMatrix"===f?a=h&&h.transformMatrix?H(h.transformMatrix,r.parseTransformAttribute(a)):r.parseTransformAttribute(a):"visible"===f?(a="none"===a||"hidden"===a?!1:!0,h&&!1===h.visible&&(a=!1)):"originX"===f?a="start"===
a?"left":"end"===a?"right":"center":k=c?a.map(x):x(a,b):a="";return!c&&isNaN(k)?a:k}function b(f){for(var a in A)if("undefined"!==typeof f[A[a]]){if(!f[a]){if(!r.Object.prototype[a])continue;f[a]=r.Object.prototype[a]}if(0!==f[a].indexOf("url(")){var h=new r.Color(f[a]);f[a]=h.setAlpha(D(h.getAlpha()*f[A[a]],2)).toRgba()}}return f}function a(f,a){var h,b;f.replace(/;\s*$/,"").split(";").forEach(function(f){f=f.split(":");h=c(f[0].trim().toLowerCase());b=d(h,f[1].trim());a[h]=b})}function k(a,h){var b=
{},c;for(c in r.cssRules[h]){var k=a,d=c.split(" "),q=void 0,e=!0;if((q=f(k,d.pop()))&&d.length){for(var e=d,m=void 0,p=!0;k.parentNode&&1===k.parentNode.nodeType&&e.length;)p&&(m=e.pop()),k=k.parentNode,p=f(k,m);e=0===e.length}if(q&&e&&0===d.length)for(var g in r.cssRules[h][c])b[g]=r.cssRules[h][c][g]}return b}function f(f,a){var h=f.nodeName,b=f.getAttribute("class"),c=f.getAttribute("id"),h=new RegExp("^"+h,"i");a=a.replace(h,"");c&&a.length&&(h=new RegExp("#"+c+"(?![a-zA-Z\\-]+)","i"),a=a.replace(h,
""));if(b&&a.length)for(b=b.split(" "),c=b.length;c--;)h=new RegExp("\\."+b[c]+"(?![a-zA-Z\\-]+)","i"),a=a.replace(h,"");return 0===a.length}function h(f){for(var a=f.getElementsByTagName("use"),h=0;a.length&&h<a.length;){var b=a[h],c=b.getAttribute("xlink:href").substr(1),k=b.getAttribute("x")||0,d=b.getAttribute("y")||0,e;a:{e=f;var m=void 0;e.getElementById&&(m=e.getElementById(c));if(m)e=m;else{var p=m=void 0;e=e.getElementsByTagName("*");for(p=0;p<e.length;p++)if(m=e[p],c===m.getAttribute("id")){e=
m;break a}e=void 0}}e=e.cloneNode(!0);var k=(e.getAttribute("transform")||"")+" translate("+k+", "+d+")",d=a.length,g;q(e);if(/^svg$/i.test(e.nodeName)){var t=e.ownerDocument.createElement("g"),m=0,p=e.attributes;for(g=p.length;m<g;m++)c=p.item(m),t.setAttribute(c.nodeName,c.nodeValue);for(;null!=e.firstChild;)t.appendChild(e.firstChild);e=t}m=0;p=b.attributes;for(g=p.length;m<g;m++)c=p.item(m),"x"!==c.nodeName&&"y"!==c.nodeName&&"xlink:href"!==c.nodeName&&("transform"===c.nodeName?k=c.nodeValue+
" "+k:e.setAttribute(c.nodeName,c.nodeValue));e.setAttribute("transform",k);e.setAttribute("instantiated_by_use","1");e.removeAttribute("id");b.parentNode.replaceChild(e,b);a.length===d&&h++}}function q(f){var a=f.getAttribute("viewBox"),h=1,b=1,c=0,k=0,d,q=f.getAttribute("width"),e=f.getAttribute("height"),m=f.getAttribute("x")||0,p=f.getAttribute("y")||0,g=f.getAttribute("preserveAspectRatio")||"",c=!a||!l.test(f.tagName)||!(a=a.match(G)),t=!q||!e||"100%"===q||"100%"===e,k=c&&t,v={},E="";v.width=
0;v.height=0;if(v.toBeParsed=k)return v;if(c)return v.width=x(q),v.height=x(e),v;c=-parseFloat(a[1]);k=-parseFloat(a[2]);d=parseFloat(a[3]);a=parseFloat(a[4]);t?(v.width=d,v.height=a):(v.width=x(q),v.height=x(e),h=v.width/d,b=v.height/a);g=r.util.parsePreserveAspectRatioAttribute(g);"none"!==g.alignX&&(b=h=h>b?b:h);if(1===h&&1===b&&0===c&&0===k&&0===m&&0===p)return v;if(m||p)E=" translate("+x(m)+" "+x(p)+") ";h=E+" matrix("+h+" 0 0 "+b+" "+c*h+" "+k*b+") ";if("svg"===f.tagName){for(b=f.ownerDocument.createElement("g");null!=
f.firstChild;)b.appendChild(f.firstChild);f.appendChild(b)}else b=f,h=b.getAttribute("transform")+h;b.setAttribute("transform",h);return v}function p(f){var a=f.objects;f=f.options;a=a.map(function(f){return r[v(f.type)].fromObject(f)});return{objects:a,options:f}}function g(f,a,h){a[h]&&a[h].toSVG&&f.push('\t<pattern x="0" y="0" id="',h,'Pattern" ','width="',a[h].source.width,'" height="',a[h].source.height,'" patternUnits="userSpaceOnUse">\n','\t\t<image x="0" y="0" ','width="',a[h].source.width,
'" height="',a[h].source.height,'" xlink:href="',a[h].source.src,'"></image>\n\t</pattern>\n')}var r=e.fabric||(e.fabric={}),m=r.util.object.extend,v=r.util.string.capitalize,E=r.util.object.clone,D=r.util.toFixed,x=r.util.parseUnit,H=r.util.multiplyTransformMatrices,I=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/i,l=/^(symbol|image|marker|pattern|view|svg)$/i,n=/^(?:pattern|defs|symbol|metadata)$/i,w=/^(symbol|g|a|svg)$/i,C={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",
visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"originX"},A={stroke:"strokeOpacity",fill:"fillOpacity"};
r.cssRules={};r.gradientDefs={};r.parseTransformAttribute=function(){function f(a,h){var b=h[0],c=3===h.length?h[1]:0,k=3===h.length?h[2]:0;a[0]=Math.cos(b);a[1]=Math.sin(b);a[2]=-Math.sin(b);a[3]=Math.cos(b);a[4]=c-(a[0]*c+a[2]*k);a[5]=k-(a[1]*c+a[3]*k)}function a(f,h){var b=2===h.length?h[1]:h[0];f[0]=h[0];f[3]=b}function h(f,a){f[4]=a[0];2===a.length&&(f[5]=a[1])}var b=[1,0,0,1,0,0],c=r.reNum,k="(?:"+("(?:(matrix)\\s*\\(\\s*("+c+")(?:\\s+,?\\s*|,\\s*)("+c+")(?:\\s+,?\\s*|,\\s*)("+c+")(?:\\s+,?\\s*|,\\s*)("+
c+")(?:\\s+,?\\s*|,\\s*)("+c+")(?:\\s+,?\\s*|,\\s*)("+c+")\\s*\\))")+"|"+("(?:(translate)\\s*\\(\\s*("+c+")(?:(?:\\s+,?\\s*|,\\s*)("+c+"))?\\s*\\))")+"|"+("(?:(scale)\\s*\\(\\s*("+c+")(?:(?:\\s+,?\\s*|,\\s*)("+c+"))?\\s*\\))")+"|"+("(?:(rotate)\\s*\\(\\s*("+c+")(?:(?:\\s+,?\\s*|,\\s*)("+c+")(?:\\s+,?\\s*|,\\s*)("+c+"))?\\s*\\))")+"|"+("(?:(skewX)\\s*\\(\\s*("+c+")\\s*\\))")+"|"+("(?:(skewY)\\s*\\(\\s*("+c+")\\s*\\))")+")",d=new RegExp("^\\s*(?:"+("(?:"+k+"(?:(?:\\s+,?\\s*|,\\s*)*"+k+")*)")+"?)\\s*$"),
q=new RegExp(k,"g");return function(c){var e=b.concat(),m=[];if(!c||c&&!d.test(c))return e;c.replace(q,function(c){var d=(new RegExp(k)).exec(c).filter(function(f){return""!==f&&null!=f});c=d[1];d=d.slice(2).map(parseFloat);switch(c){case "translate":h(e,d);break;case "rotate":d[0]=r.util.degreesToRadians(d[0]);f(e,d);break;case "scale":a(e,d);break;case "skewX":e[2]=Math.tan(r.util.degreesToRadians(d[0]));break;case "skewY":e[1]=Math.tan(r.util.degreesToRadians(d[0]));break;case "matrix":e=d}m.push(e.concat());
e=b.concat()});for(c=m[0];1<m.length;)m.shift(),c=r.util.multiplyTransformMatrices(c,m[0]);return c}}();var G=new RegExp("^\\s*("+r.reNum+"+)\\s*,?\\s*("+r.reNum+"+)\\s*,?\\s*("+r.reNum+"+)\\s*,?\\s*("+r.reNum+"+)\\s*$");r.parseSVGDocument=function(){return function(f,a,b){if(f){h(f);var c=new Date,k=r.Object.__uid++,d=q(f),e=r.util.toArray(f.getElementsByTagName("*"));d.svgUid=k;if(0===e.length&&r.isLikelyNode){for(var e=f.selectNodes('//*[name(.)!="svg"]'),m=[],p=0,g=e.length;p<g;p++)m[p]=e[p];
e=m}e=e.filter(function(f){q(f);var a;if(a=I.test(f.tagName)){a:{for(;f&&(f=f.parentNode);)if(n.test(f.nodeName)&&!f.getAttribute("instantiated_by_use")){f=!0;break a}f=!1}a=!f}return a});!e||e&&!e.length?a&&a([],{}):(r.gradientDefs[k]=r.getGradientDefs(f),r.cssRules[k]=r.getCSSRules(f),r.parseElements(e,function(f){r.documentParsingTime=new Date-c;a&&a(f,d)},E(d),b))}}}();var N={has:function(f,a){a(!1)},get:function(){},set:function(){}},F=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+
r.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+r.reNum+"))?\\s+(.*)");m(r,{parseFontDeclaration:function(f,a){var h=f.match(F);if(h){var b=h[1],c=h[3],k=h[4],d=h[5],h=h[6];b&&(a.fontStyle=b);c&&(a.fontWeight=isNaN(parseFloat(c))?c:parseFloat(c));k&&(a.fontSize=x(k));h&&(a.fontFamily=h);d&&(a.lineHeight="normal"===d?1:d)}},getGradientDefs:function(f){var a=f.getElementsByTagName("linearGradient"),h=f.getElementsByTagName("radialGradient"),b,c=0,k,d=[];f={};var q={};d.length=a.length+h.length;for(b=
a.length;b--;)d[c++]=a[b];for(b=h.length;b--;)d[c++]=h[b];for(;c--;)a=d[c],h=a.getAttribute("xlink:href"),k=a.getAttribute("id"),h&&(q[k]=h.substr(1)),f[k]=a;for(k in q)for(c=f[q[k]].cloneNode(!0),a=f[k];c.firstChild;)a.appendChild(c.firstChild);return f},parseAttributes:function(f,a,h){if(f){var q,e={},p;"undefined"===typeof h&&(h=f.getAttribute("svgUid"));f.parentNode&&w.test(f.parentNode.nodeName)&&(e=r.parseAttributes(f.parentNode,a,h));p=e&&e.fontSize||f.getAttribute("font-size")||r.Text.DEFAULT_SVG_FONT_SIZE;
a=a.reduce(function(a,h){if(q=f.getAttribute(h))h=c(h),q=d(h,q,e,p),a[h]=q;return a},{});a=m(a,m(k(f,h),r.parseStyleAttribute(f)));a.font&&r.parseFontDeclaration(a.font,a);return b(m(e,a))}},parseElements:function(f,a,h,b){(new r.ElementsParser(f,a,h,b)).parse()},parseStyleAttribute:function(f){var h={};f=f.getAttribute("style");if(!f)return h;if("string"===typeof f)a(f,h);else{var b,k,q;for(q in f)"undefined"!==typeof f[q]&&(b=c(q.toLowerCase()),k=d(b,f[q]),h[b]=k)}return h},parsePointsAttribute:function(f){if(!f)return null;
f=f.replace(/,/g," ").trim();f=f.split(/\s+/);var a=[],h,b;h=0;for(b=f.length;h<b;h+=2)a.push({x:parseFloat(f[h]),y:parseFloat(f[h+1])});return a},getCSSRules:function(f){f=f.getElementsByTagName("style");for(var a={},h,b=0,k=f.length;b<k;b++)h=f[b].textContent||f[b].text,h=h.replace(/\/\*[\s\S]*?\*\//g,""),""!==h.trim()&&(h=h.match(/[^{]*\{[\s\S]*?\}/g),h=h.map(function(f){return f.trim()}),h.forEach(function(f){f=f.match(/([\s\S]*?)\s*\{([^}]*)\}/);for(var h={},b=f[2].trim().replace(/;$/,"").split(/\s*;\s*/),
k=0,q=b.length;k<q;k++){var e=b[k].split(/\s*:\s*/),m=c(e[0]),e=d(m,e[1],e[0]);h[m]=e}f=f[1];f.split(",").forEach(function(f){f=f.replace(/^svg/i,"").trim();""!==f&&(a[f]=r.util.object.clone(h))})}));return a},loadSVGFromURL:function(f,a,h){function b(c){var k=c.responseXML;k&&!k.documentElement&&r.window.ActiveXObject&&c.responseText&&(k=new ActiveXObject("Microsoft.XMLDOM"),k.async="false",k.loadXML(c.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));k&&k.documentElement&&r.parseSVGDocument(k.documentElement,
function(h,b){N.set(f,{objects:r.util.array.invoke(h,"toObject"),options:b});a(h,b)},h)}f=f.replace(/^\n\s*/,"").trim();N.has(f,function(h){h?N.get(f,function(f){f=p(f);a(f.objects,f.options)}):new r.util.request(f,{method:"get",onComplete:b})})},loadSVGFromString:function(f,a,h){f=f.trim();var b;if("undefined"!==typeof DOMParser){var c=new DOMParser;c&&c.parseFromString&&(b=c.parseFromString(f,"text/xml"))}else r.window.ActiveXObject&&(b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(f.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,
"")));r.parseSVGDocument(b.documentElement,function(f,h){a(f,h)},h)},createSVGFontFacesMarkup:function(f){for(var a="",h={},b,c,k,d,q=r.fontPaths,e=0,m=f.length;e<m;e++)if(b=f[e],c=b.fontFamily,-1!==b.type.indexOf("text")&&!h[c]&&q[c]&&(h[c]=!0,b.styles))for(k in b=b.styles,b)for(d in void 0)b=(void 0)[d],c=b.fontFamily,!h[c]&&q[c]&&(h[c]=!0);for(var p in h)a+=["\t\t@font-face {\n\t\t\tfont-family: '",p,"';\n\t\t\tsrc: url('",q[p],"');\n\t\t}\n"].join("");a&&(a=['\t<style type="text/css"><![CDATA[\n',
a,"]]\x3e</style>\n"].join(""));return a},createSVGRefElementsMarkup:function(f){var a=[];g(a,f,"backgroundColor");g(a,f,"overlayColor");return a.join("")}})})("undefined"!==typeof n?n:this);g.ElementsParser=function(e,c,d,b){this.elements=e;this.callback=c;this.options=d;this.reviver=b;this.svgUid=d&&d.svgUid||0};g.ElementsParser.prototype.parse=function(){this.instances=Array(this.elements.length);this.numElements=this.elements.length;this.createObjects()};g.ElementsParser.prototype.createObjects=
function(){for(var e=0,c=this.elements.length;e<c;e++)this.elements[e].setAttribute("svgUid",this.svgUid),function(c,b){setTimeout(function(){c.createObject(c.elements[b],b)},0)}(this,e)};g.ElementsParser.prototype.createObject=function(e,c){var d=g[g.util.string.capitalize(e.tagName)];if(d&&d.fromElement)try{this._createObject(d,e,c)}catch(b){g.log(b)}else this.checkIfDone()};g.ElementsParser.prototype._createObject=function(e,c,d){e.async?e.fromElement(c,this.createCallback(d,c),this.options):(e=
e.fromElement(c,this.options),this.resolveGradient(e,"fill"),this.resolveGradient(e,"stroke"),this.reviver&&this.reviver(c,e),this.instances[d]=e,this.checkIfDone())};g.ElementsParser.prototype.createCallback=function(e,c){var d=this;return function(b){d.resolveGradient(b,"fill");d.resolveGradient(b,"stroke");d.reviver&&d.reviver(c,b);d.instances[e]=b;d.checkIfDone()}};g.ElementsParser.prototype.resolveGradient=function(e,c){var d=e.get(c);/^url\(/.test(d)&&(d=d.slice(5,d.length-1),g.gradientDefs[this.svgUid][d]&&
e.set(c,g.Gradient.fromElement(g.gradientDefs[this.svgUid][d],e)))};g.ElementsParser.prototype.checkIfDone=function(){0===--this.numElements&&(this.instances=this.instances.filter(function(e){return null!=e}),this.callback(this.instances))};(function(e){function c(c,b){this.x=c;this.y=b}e=e.fabric||(e.fabric={});e.Point?e.warn("fabric.Point is already defined"):(e.Point=c,c.prototype={constructor:c,add:function(d){return new c(this.x+d.x,this.y+d.y)},addEquals:function(c){this.x+=c.x;this.y+=c.y;
return this},scalarAdd:function(d){return new c(this.x+d,this.y+d)},scalarAddEquals:function(c){this.x+=c;this.y+=c;return this},subtract:function(d){return new c(this.x-d.x,this.y-d.y)},subtractEquals:function(c){this.x-=c.x;this.y-=c.y;return this},scalarSubtract:function(d){return new c(this.x-d,this.y-d)},scalarSubtractEquals:function(c){this.x-=c;this.y-=c;return this},multiply:function(d){return new c(this.x*d,this.y*d)},multiplyEquals:function(c){this.x*=c;this.y*=c;return this},divide:function(d){return new c(this.x/
d,this.y/d)},divideEquals:function(c){this.x/=c;this.y/=c;return this},eq:function(c){return this.x===c.x&&this.y===c.y},lt:function(c){return this.x<c.x&&this.y<c.y},lte:function(c){return this.x<=c.x&&this.y<=c.y},gt:function(c){return this.x>c.x&&this.y>c.y},gte:function(c){return this.x>=c.x&&this.y>=c.y},lerp:function(d,b){return new c(this.x+(d.x-this.x)*b,this.y+(d.y-this.y)*b)},distanceFrom:function(c){var b=this.x-c.x;c=this.y-c.y;return Math.sqrt(b*b+c*c)},midPointFrom:function(d){return new c(this.x+
(d.x-this.x)/2,this.y+(d.y-this.y)/2)},min:function(d){return new c(Math.min(this.x,d.x),Math.min(this.y,d.y))},max:function(d){return new c(Math.max(this.x,d.x),Math.max(this.y,d.y))},toString:function(){return this.x+","+this.y},setXY:function(c,b){this.x=c;this.y=b},setFromPoint:function(c){this.x=c.x;this.y=c.y},swap:function(c){var b=this.x,a=this.y;this.x=c.x;this.y=c.y;c.x=b;c.y=a}})})("undefined"!==typeof n?n:this);(function(e){function c(b){this.status=b;this.points=[]}var d=e.fabric||(e.fabric=
{});d.Intersection?d.warn("fabric.Intersection is already defined"):(d.Intersection=c,d.Intersection.prototype={appendPoint:function(b){this.points.push(b)},appendPoints:function(b){this.points=this.points.concat(b)}},d.Intersection.intersectLineLine=function(b,a,k,f){var h,q=(f.x-k.x)*(b.y-k.y)-(f.y-k.y)*(b.x-k.x);h=(a.x-b.x)*(b.y-k.y)-(a.y-b.y)*(b.x-k.x);k=(f.y-k.y)*(a.x-b.x)-(f.x-k.x)*(a.y-b.y);0!==k?(q/=k,h/=k,0<=q&&1>=q&&0<=h&&1>=h?(h=new c("Intersection"),h.points.push(new d.Point(b.x+q*(a.x-
b.x),b.y+q*(a.y-b.y)))):h=new c):h=0===q||0===h?new c("Coincident"):new c("Parallel");return h},d.Intersection.intersectLinePolygon=function(b,a,k){for(var f=new c,h=k.length,d=0;d<h;d++){var e=c.intersectLineLine(b,a,k[d],k[(d+1)%h]);f.appendPoints(e.points)}0<f.points.length&&(f.status="Intersection");return f},d.Intersection.intersectPolygonPolygon=function(b,a){for(var k=new c,f=b.length,h=0;h<f;h++){var d=c.intersectLinePolygon(b[h],b[(h+1)%f],a);k.appendPoints(d.points)}0<k.points.length&&(k.status=
"Intersection");return k},d.Intersection.intersectPolygonRectangle=function(b,a,k){var f=a.min(k),h=a.max(k);k=new d.Point(h.x,f.y);var q=new d.Point(f.x,h.y);a=c.intersectLinePolygon(f,k,b);k=c.intersectLinePolygon(k,h,b);h=c.intersectLinePolygon(h,q,b);b=c.intersectLinePolygon(q,f,b);f=new c;f.appendPoints(a.points);f.appendPoints(k.points);f.appendPoints(h.points);f.appendPoints(b.points);0<f.points.length&&(f.status="Intersection");return f})})("undefined"!==typeof n?n:this);(function(e){function c(a){a?
this._tryParsingColor(a):this.setSource([0,0,0,1])}function d(a,b,f){0>f&&(f+=1);1<f&&--f;return f<1/6?a+6*(b-a)*f:.5>f?b:f<2/3?a+(b-a)*(2/3-f)*6:a}var b=e.fabric||(e.fabric={});b.Color?b.warn("fabric.Color is already defined."):(b.Color=c,b.Color.prototype={_tryParsingColor:function(a){var b;a in c.colorNameMap&&(a=c.colorNameMap[a]);"transparent"===a?this.setSource([255,255,255,0]):((b=c.sourceFromHex(a))||(b=c.sourceFromRgb(a)),b||(b=c.sourceFromHsl(a)),b&&this.setSource(b))},_rgbToHsl:function(a,
c,f){a/=255;c/=255;f/=255;var h,d,e,g=b.util.array.max([a,c,f]);d=b.util.array.min([a,c,f]);e=(g+d)/2;if(g===d)h=d=0;else{var r=g-d;d=.5<e?r/(2-g-d):r/(g+d);switch(g){case a:h=(c-f)/r+(c<f?6:0);break;case c:h=(f-a)/r+2;break;case f:h=(a-c)/r+4}h/=6}return[Math.round(360*h),Math.round(100*d),Math.round(100*e)]},getSource:function(){return this._source},setSource:function(a){this._source=a},toRgb:function(){var a=this.getSource();return"rgb("+a[0]+","+a[1]+","+a[2]+")"},toRgba:function(){var a=this.getSource();
return"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")"},toHsl:function(){var a=this.getSource(),a=this._rgbToHsl(a[0],a[1],a[2]);return"hsl("+a[0]+","+a[1]+"%,"+a[2]+"%)"},toHsla:function(){var a=this.getSource(),b=this._rgbToHsl(a[0],a[1],a[2]);return"hsla("+b[0]+","+b[1]+"%,"+b[2]+"%,"+a[3]+")"},toHex:function(){var a=this.getSource(),b,f;b=a[0].toString(16);b=1===b.length?"0"+b:b;f=a[1].toString(16);f=1===f.length?"0"+f:f;a=a[2].toString(16);a=1===a.length?"0"+a:a;return b.toUpperCase()+f.toUpperCase()+
a.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(a){var b=this.getSource();b[3]=a;this.setSource(b);return this},toGrayscale:function(){var a=this.getSource(),b=parseInt((.3*a[0]+.59*a[1]+.11*a[2]).toFixed(0),10);this.setSource([b,b,b,a[3]]);return this},toBlackWhite:function(a){var b=this.getSource(),f=(.3*b[0]+.59*b[1]+.11*b[2]).toFixed(0),b=b[3],f=Number(f)<Number(a||127)?0:255;this.setSource([f,f,f,b]);return this},overlayWith:function(a){a instanceof c||(a=new c(a));
var b=[],f=this.getAlpha(),h=this.getSource();a=a.getSource();for(var d=0;3>d;d++)b.push(Math.round(.5*h[d]+.5*a[d]));b[3]=f;this.setSource(b);return this}},b.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,b.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,b.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i,b.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",
blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},b.Color.fromRgb=function(a){return c.fromSource(c.sourceFromRgb(a))},b.Color.sourceFromRgb=function(a){if(a=a.match(c.reRGBa)){var b=parseInt(a[1],10)/(/%$/.test(a[1])?100:1)*(/%$/.test(a[1])?255:1),f=parseInt(a[2],10)/(/%$/.test(a[2])?100:1)*(/%$/.test(a[2])?
255:1),h=parseInt(a[3],10)/(/%$/.test(a[3])?100:1)*(/%$/.test(a[3])?255:1);return[parseInt(b,10),parseInt(f,10),parseInt(h,10),a[4]?parseFloat(a[4]):1]}},b.Color.fromRgba=c.fromRgb,b.Color.fromHsl=function(a){return c.fromSource(c.sourceFromHsl(a))},b.Color.sourceFromHsl=function(a){if(a=a.match(c.reHSLa)){var b=(parseFloat(a[1])%360+360)%360/360,f=parseFloat(a[2])/(/%$/.test(a[2])?100:1),h=parseFloat(a[3])/(/%$/.test(a[3])?100:1);if(0===f)h=f=b=h;else var q=.5>=h?h*(f+1):h+f-h*f,e=2*h-q,h=d(e,q,
b+1/3),f=d(e,q,b),b=d(e,q,b-1/3);return[Math.round(255*h),Math.round(255*f),Math.round(255*b),a[4]?parseFloat(a[4]):1]}},b.Color.fromHsla=c.fromHsl,b.Color.fromHex=function(a){return c.fromSource(c.sourceFromHex(a))},b.Color.sourceFromHex=function(a){if(a.match(c.reHex)){var b=a.slice(a.indexOf("#")+1),f=3===b.length;a=f?b.charAt(0)+b.charAt(0):b.substring(0,2);var h=f?b.charAt(1)+b.charAt(1):b.substring(2,4),b=f?b.charAt(2)+b.charAt(2):b.substring(4,6);return[parseInt(a,16),parseInt(h,16),parseInt(b,
16),1]}},b.Color.fromSource=function(a){var b=new c;b.setSource(a);return b})})("undefined"!==typeof n?n:this);(function(){function e(c){var b=c.getAttribute("style"),a=c.getAttribute("offset")||0,k,f,a=parseFloat(a)/(/%$/.test(a)?100:1),a=0>a?0:1<a?1:a;if(b){b=b.split(/\s*;\s*/);""===b[b.length-1]&&b.pop();for(var h=b.length;h--;){var q=b[h].split(/\s*:\s*/),e=q[0].trim(),q=q[1].trim();"stop-color"===e?k=q:"stop-opacity"===e&&(f=q)}}k||(k=c.getAttribute("stop-color")||"rgb(0,0,0)");f||(f=c.getAttribute("stop-opacity"));
k=new g.Color(k);c=k.getAlpha();f=isNaN(parseFloat(f))?1:parseFloat(f);f*=c;return{offset:a,color:k.toRgb(),opacity:f}}function c(c,b,a){var k,f=0,h=1,q="",e;for(e in b){k=parseFloat(b[e],10);h="string"===typeof b[e]&&/^\d+%$/.test(b[e])?.01:1;if("x1"===e||"x2"===e||"r2"===e)h*="objectBoundingBox"===a?c.width:1,f="objectBoundingBox"===a?c.left||0:0;else if("y1"===e||"y2"===e)h*="objectBoundingBox"===a?c.height:1,f="objectBoundingBox"===a?c.top||0:0;b[e]=k*h+f}"ellipse"===c.type&&null!==b.r2&&"objectBoundingBox"===
a&&c.rx!==c.ry&&(c=c.ry/c.rx,q=" scale(1, "+c+")",b.y1&&(b.y1/=c),b.y2&&(b.y2/=c));return q}g.Gradient=g.util.createClass({offsetX:0,offsetY:0,initialize:function(c){c||(c={});var b={};this.id=g.Object.__uid++;this.type=c.type||"linear";b={x1:c.coords.x1||0,y1:c.coords.y1||0,x2:c.coords.x2||0,y2:c.coords.y2||0};"radial"===this.type&&(b.r1=c.coords.r1||0,b.r2=c.coords.r2||0);this.coords=b;this.colorStops=c.colorStops.slice();c.gradientTransform&&(this.gradientTransform=c.gradientTransform);this.offsetX=
c.offsetX||this.offsetX;this.offsetY=c.offsetY||this.offsetY},addColorStop:function(c){for(var b in c){var a=new g.Color(c[b]);this.colorStops.push({offset:b,color:a.toRgb(),opacity:a.getAlpha()})}return this},toObject:function(){return{type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform}},toSVG:function(c){var b=g.util.object.clone(this.coords),a;this.colorStops.sort(function(f,
a){return f.offset-a.offset});if(!c.group||"path-group"!==c.group.type)for(var k in b)if("x1"===k||"x2"===k||"r2"===k)b[k]+=this.offsetX-c.width/2;else if("y1"===k||"y2"===k)b[k]+=this.offsetY-c.height/2;c='id="SVGID_'+this.id+'" gradientUnits="userSpaceOnUse"';this.gradientTransform&&(c+=' gradientTransform="matrix('+this.gradientTransform.join(" ")+')" ');"linear"===this.type?a=["<linearGradient ",c,' x1="',b.x1,'" y1="',b.y1,'" x2="',b.x2,'" y2="',b.y2,'">\n']:"radial"===this.type&&(a=["<radialGradient ",
c,' cx="',b.x2,'" cy="',b.y2,'" r="',b.r2,'" fx="',b.x1,'" fy="',b.y1,'">\n']);for(b=0;b<this.colorStops.length;b++)a.push("<stop ",'offset="',100*this.colorStops[b].offset+"%",'" style="stop-color:',this.colorStops[b].color,null!=this.colorStops[b].opacity?";stop-opacity: "+this.colorStops[b].opacity:";",'"/>\n');a.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n");return a.join("")},toLive:function(c,b){var a,k,f=g.util.object.clone(this.coords);if(this.type){if(b.group&&"path-group"===
b.group.type)for(k in f)if("x1"===k||"x2"===k)f[k]+=-this.offsetX+b.width/2;else if("y1"===k||"y2"===k)f[k]+=-this.offsetY+b.height/2;"linear"===this.type?a=c.createLinearGradient(f.x1,f.y1,f.x2,f.y2):"radial"===this.type&&(a=c.createRadialGradient(f.x1,f.y1,f.r1,f.x2,f.y2,f.r2));k=0;for(f=this.colorStops.length;k<f;k++){var h=this.colorStops[k].color,q=this.colorStops[k].opacity,e=this.colorStops[k].offset;"undefined"!==typeof q&&(h=(new g.Color(h)).setAlpha(q).toRgba());a.addColorStop(parseFloat(e),
h)}return a}}});g.util.object.extend(g.Gradient,{fromElement:function(d,b){var a=d.getElementsByTagName("stop"),k="linearGradient"===d.nodeName?"linear":"radial",f=d.getAttribute("gradientUnits")||"objectBoundingBox",h=d.getAttribute("gradientTransform"),q=[],p={};"linear"===k?p={x1:d.getAttribute("x1")||0,y1:d.getAttribute("y1")||0,x2:d.getAttribute("x2")||"100%",y2:d.getAttribute("y2")||0}:"radial"===k&&(p={x1:d.getAttribute("fx")||d.getAttribute("cx")||"50%",y1:d.getAttribute("fy")||d.getAttribute("cy")||
"50%",r1:0,x2:d.getAttribute("cx")||"50%",y2:d.getAttribute("cy")||"50%",r2:d.getAttribute("r")||"50%"});for(var t=a.length;t--;)q.push(e(a[t]));a=c(b,p,f);k=new g.Gradient({type:k,coords:p,colorStops:q,offsetX:-b.left,offsetY:-b.top});if(h||""!==a)k.gradientTransform=g.parseTransformAttribute((h||"")+a);return k},forObject:function(d,b){b||(b={});c(d,b.coords,"userSpaceOnUse");return new g.Gradient(b)}})})();g.Pattern=g.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(e){e||
(e={});this.id=g.Object.__uid++;if(e.source)if("string"===typeof e.source)if("undefined"!==typeof g.util.getFunctionBody(e.source))this.source=new Function(g.util.getFunctionBody(e.source));else{var c=this;this.source=g.util.createImage();g.util.loadImage(e.source,function(d){c.source=d})}else this.source=e.source;e.repeat&&(this.repeat=e.repeat);e.offsetX&&(this.offsetX=e.offsetX);e.offsetY&&(this.offsetY=e.offsetY)},toObject:function(){var e;"function"===typeof this.source?e=String(this.source):
"string"===typeof this.source.src?e=this.source.src:"object"===typeof this.source&&this.source.toDataURL&&(e=this.source.toDataURL());return{source:e,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(e){var c="function"===typeof this.source?this.source():this.source,d=c.width/e.getWidth(),b=c.height/e.getHeight(),a=this.offsetX/e.getWidth();e=this.offsetY/e.getHeight();var k="";if("repeat-x"===this.repeat||"no-repeat"===this.repeat)b=1;if("repeat-y"===this.repeat||"no-repeat"===
this.repeat)d=1;c.src?k=c.src:c.toDataURL&&(k=c.toDataURL());return'<pattern id="SVGID_'+this.id+'" x="'+a+'" y="'+e+'" width="'+d+'" height="'+b+'">\n<image x="0" y="0" width="'+c.width+'" height="'+c.height+'" xlink:href="'+k+'"></image>\n</pattern>\n'},toLive:function(e){var c="function"===typeof this.source?this.source():this.source;return c&&("undefined"===typeof c.src||c.complete&&0!==c.naturalWidth&&0!==c.naturalHeight)?e.createPattern(c,this.repeat):""}});(function(e){var c=e.fabric||(e.fabric=
{}),d=c.util.toFixed;c.Shadow?c.warn("fabric.Shadow is already defined."):(c.Shadow=c.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(b){"string"===typeof b&&(b=this._parseShadow(b));for(var a in b)this[a]=b[a];this.id=c.Object.__uid++},_parseShadow:function(b){b=b.trim();var a=c.Shadow.reOffsetsAndBlur.exec(b)||[];return{color:(b.replace(c.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseInt(a[1],10)||0,offsetY:parseInt(a[2],
10)||0,blur:parseInt(a[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(b){var a=40,k=40,f=c.Object.NUM_FRACTION_DIGITS,h=c.util.rotateVector({x:this.offsetX,y:this.offsetY},c.util.degreesToRadians(-b.angle));b.width&&b.height&&(a=100*d((Math.abs(h.x)+this.blur)/b.width,f)+20,k=100*d((Math.abs(h.y)+this.blur)/b.height,f)+20);b.flipX&&(h.x*=-1);b.flipY&&(h.y*=-1);return'<filter id="SVGID_'+this.id+'" y="-'+k+'%" height="'+(100+2*k)+
'%" x="-'+a+'%" width="'+(100+2*a)+'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+d(this.blur?this.blur/2:0,f)+'"></feGaussianBlur>\n\t<feOffset dx="'+d(h.x,f)+'" dy="'+d(h.y,f)+'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="'+this.color+'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,
blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke};var b={},a=c.Shadow.prototype;["color","blur","offsetX","offsetY","affectStroke"].forEach(function(c){this[c]!==a[c]&&(b[c]=this[c])},this);return b}}),c.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/)})("undefined"!==typeof n?n:this);(function(){if(g.StaticCanvas)g.warn("fabric.StaticCanvas is already defined.");else{var e=g.util.object.extend,
c=g.util.getElementOffset,d=g.util.removeFromArray,b=g.util.toFixed,a=Error("Could not initialize `canvas` element");g.StaticCanvas=g.util.createClass({initialize:function(a,f){f||(f={});this._initStatic(a,f)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!0,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,preserveObjectStacking:!1,viewportTransform:[1,0,0,1,0,0],onBeforeScaleRotate:function(){},
enableRetinaScaling:!0,_initStatic:function(a,f){this._objects=[];this._createLowerCanvas(a);this._initOptions(f);this._setImageSmoothing();this.interactive||this._initRetinaScaling();f.overlayImage&&this.setOverlayImage(f.overlayImage,this.renderAll.bind(this));f.backgroundImage&&this.setBackgroundImage(f.backgroundImage,this.renderAll.bind(this));f.backgroundColor&&this.setBackgroundColor(f.backgroundColor,this.renderAll.bind(this));f.overlayColor&&this.setOverlayColor(f.overlayColor,this.renderAll.bind(this));
this.calcOffset()},_isRetinaScaling:function(){return 1!==g.devicePixelRatio&&this.enableRetinaScaling},_initRetinaScaling:function(){this._isRetinaScaling()&&(this.lowerCanvasEl.setAttribute("width",this.width*g.devicePixelRatio),this.lowerCanvasEl.setAttribute("height",this.height*g.devicePixelRatio),this.contextContainer.scale(g.devicePixelRatio,g.devicePixelRatio))},calcOffset:function(){this._offset=c(this.lowerCanvasEl);return this},setOverlayImage:function(a,f,h){return this.__setBgOverlayImage("overlayImage",
a,f,h)},setBackgroundImage:function(a,f,h){return this.__setBgOverlayImage("backgroundImage",a,f,h)},setOverlayColor:function(a,f){return this.__setBgOverlayColor("overlayColor",a,f)},setBackgroundColor:function(a,f){return this.__setBgOverlayColor("backgroundColor",a,f)},_setImageSmoothing:function(){var a=this.getContext();"undefined"!==typeof a.imageSmoothingEnabled?a.imageSmoothingEnabled=this.imageSmoothingEnabled:(a.webkitImageSmoothingEnabled=this.imageSmoothingEnabled,a.mozImageSmoothingEnabled=
this.imageSmoothingEnabled,a.msImageSmoothingEnabled=this.imageSmoothingEnabled,a.oImageSmoothingEnabled=this.imageSmoothingEnabled)},__setBgOverlayImage:function(a,f,h,b){"string"===typeof f?g.util.loadImage(f,function(f){this[a]=new g.Image(f,b);h&&h(f)},this,b&&b.crossOrigin):(b&&f.setOptions(b),this[a]=f,h&&h(f));return this},__setBgOverlayColor:function(a,f,h){if(f&&f.source){var b=this;g.util.loadImage(f.source,function(c){b[a]=new g.Pattern({source:c,repeat:f.repeat,offsetX:f.offsetX,offsetY:f.offsetY});
h&&h()})}else this[a]=f,h&&h();return this},_createCanvasElement:function(){var b=g.document.createElement("canvas");b.style||(b.style={});if(!b)throw a;this._initCanvasElement(b);return b},_initCanvasElement:function(b){g.util.createCanvasElement(b);if("undefined"===typeof b.getContext)throw a;},_initOptions:function(a){for(var f in a)this[f]=a[f];this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0;this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0;this.lowerCanvasEl.style&&
(this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(a){this.lowerCanvasEl=g.util.getById(a)||this._createCanvasElement();this._initCanvasElement(this.lowerCanvasEl);g.util.addClass(this.lowerCanvasEl,"lower-canvas");this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl);this.contextContainer=
this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(a,f){return this.setDimensions({width:a},f)},setHeight:function(a,f){return this.setDimensions({height:a},f)},setDimensions:function(a,f){var h;f=f||{};for(var b in a)h=a[b],f.cssOnly||(this._setBackstoreDimension(b,a[b]),h+="px"),f.backstoreOnly||this._setCssDimension(b,h);this._initRetinaScaling();this._setImageSmoothing();this.calcOffset();f.cssOnly||this.renderAll();
return this},_setBackstoreDimension:function(a,f){this.lowerCanvasEl[a]=f;this.upperCanvasEl&&(this.upperCanvasEl[a]=f);this.cacheCanvasEl&&(this.cacheCanvasEl[a]=f);this[a]=f;return this},_setCssDimension:function(a,f){this.lowerCanvasEl.style[a]=f;this.upperCanvasEl&&(this.upperCanvasEl.style[a]=f);this.wrapperEl&&(this.wrapperEl.style[a]=f);return this},getZoom:function(){return Math.sqrt(this.viewportTransform[0]*this.viewportTransform[3])},setViewportTransform:function(a){var f=this.getActiveGroup();
this.viewportTransform=a;this.renderAll();a=0;for(var h=this._objects.length;a<h;a++)this._objects[a].setCoords();f&&f.setCoords();return this},zoomToPoint:function(a,f){var h=a;a=g.util.transformPoint(a,g.util.invertTransform(this.viewportTransform));this.viewportTransform[0]=f;this.viewportTransform[3]=f;var b=g.util.transformPoint(a,this.viewportTransform);this.viewportTransform[4]+=h.x-b.x;this.viewportTransform[5]+=h.y-b.y;this.renderAll();h=0;for(b=this._objects.length;h<b;h++)this._objects[h].setCoords();
return this},setZoom:function(a){this.zoomToPoint(new g.Point(0,0),a);return this},absolutePan:function(a){this.viewportTransform[4]=-a.x;this.viewportTransform[5]=-a.y;this.renderAll();a=0;for(var f=this._objects.length;a<f;a++)this._objects[a].setCoords();return this},relativePan:function(a){return this.absolutePan(new g.Point(-a.x-this.viewportTransform[4],-a.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},
_onObjectAdded:function(a){this.stateful&&a.setupState();a._set("canvas",this);a.setCoords();this.fire("object:added",{target:a});a.fire("added")},_onObjectRemoved:function(a){this.getActiveObject()===a&&(this.fire("before:selection:cleared",{target:a}),this._discardActiveObject(),this.fire("selection:cleared"));this.fire("object:removed",{target:a});a.fire("removed")},clearContext:function(a){a.clearRect(0,0,this.width,this.height);return this},getContext:function(){return this.contextContainer},
clear:function(){this._objects.length=0;this.discardActiveGroup&&this.discardActiveGroup();this.discardActiveObject&&this.discardActiveObject();this.clearContext(this.contextContainer);this.contextTop&&this.clearContext(this.contextTop);this.fire("canvas:cleared");this.renderAll();return this},_chooseObjectsToRender:function(){var a=this.getActiveGroup(),f,h=[],b=[];if(a&&!this.preserveObjectStacking){for(var c=0,d=this._objects.length;c<d;c++)f=this._objects[c],a.contains(f)?b.push(f):h.push(f);
a._set("_objects",b)}else h=this._objects;return h},renderAll:function(){var a=this.contextContainer,f;this.contextTop&&this.selection&&!this._groupSelector&&this.clearContext(this.contextTop);this.clearContext(a);this.fire("before:render");this.clipTo&&g.util.clipContext(this,a);this._renderBackground(a);a.save();f=this._chooseObjectsToRender();a.transform.apply(a,this.viewportTransform);this._renderObjects(a,f);this.preserveObjectStacking||this._renderObjects(a,[this.getActiveGroup()]);a.restore();
!this.controlsAboveOverlay&&this.interactive&&this.drawControls(a);this.clipTo&&a.restore();this._renderOverlay(a);this.controlsAboveOverlay&&this.interactive&&this.drawControls(a);this.fire("after:render");return this},_renderObjects:function(a,f){for(var h=0,b=f.length;h<b;++h)f[h]&&f[h].render(a)},_renderBackgroundOrOverlay:function(a,f){var h=this[f+"Color"];h&&(a.fillStyle=h.toLive?h.toLive(a):h,a.fillRect(h.offsetX||0,h.offsetY||0,this.width,this.height));(h=this[f+"Image"])&&h.render(a)},_renderBackground:function(a){this._renderBackgroundOrOverlay(a,
"background")},_renderOverlay:function(a){this._renderBackgroundOrOverlay(a,"overlay")},renderTop:function(){this.clearContext(this.contextTop||this.contextContainer);this.selection&&this._groupSelector&&this._drawSelection();this.fire("after:render");return this},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(a){this._centerObject(a,new g.Point(this.getCenter().left,a.getCenterPoint().y));this.renderAll();return this},centerObjectV:function(a){this._centerObject(a,
new g.Point(a.getCenterPoint().x,this.getCenter().top));this.renderAll();return this},centerObject:function(a){var f=this.getCenter();this._centerObject(a,new g.Point(f.left,f.top));this.renderAll();return this},_centerObject:function(a,f){a.setPositionByOrigin(f,"center","center");return this},toDatalessJSON:function(a){return this.toDatalessObject(a)},toObject:function(a){return this._toObjectMethod("toObject",a)},toDatalessObject:function(a){return this._toObjectMethod("toDatalessObject",a)},_toObjectMethod:function(a,
f){var h={objects:this._toObjects(a,f)};e(h,this.__serializeBgOverlay());g.util.populateWithProperties(this,h,f);return h},_toObjects:function(a,f){return this.getObjects().map(function(h){return this._toObject(h,a,f)},this)},_toObject:function(a,f,h){var b;this.includeDefaultValues||(b=a.includeDefaultValues,a.includeDefaultValues=!1);var c=this._realizeGroupTransformOnObject(a);f=a[f](h);this.includeDefaultValues||(a.includeDefaultValues=b);this._unwindGroupTransformOnObject(a,c);return f},_realizeGroupTransformOnObject:function(a){var f=
"angle flipX flipY height left scaleX scaleY top width".split(" ");if(a.group&&a.group===this.getActiveGroup()){var h={};f.forEach(function(f){h[f]=a[f]});this.getActiveGroup().realizeTransform(a);return h}return null},_unwindGroupTransformOnObject:function(a,f){f&&a.set(f)},__serializeBgOverlay:function(){var a={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():this.backgroundColor};this.overlayColor&&(a.overlay=this.overlayColor.toObject?this.overlayColor.toObject():
this.overlayColor);this.backgroundImage&&(a.backgroundImage=this.backgroundImage.toObject());this.overlayImage&&(a.overlayImage=this.overlayImage.toObject());return a},svgViewportTransformation:!0,toSVG:function(a,f){a||(a={});var h=[];this._setSVGPreamble(h,a);this._setSVGHeader(h,a);this._setSVGBgOverlayColor(h,"backgroundColor");this._setSVGBgOverlayImage(h,"backgroundImage");this._setSVGObjects(h,f);this._setSVGBgOverlayColor(h,"overlayColor");this._setSVGBgOverlayImage(h,"overlayImage");h.push("</svg>");
return h.join("")},_setSVGPreamble:function(a,f){f.suppressPreamble||a.push('<?xml version="1.0" encoding="',f.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(a,f){var h=f.width||this.width,c=f.height||this.height,d;d='viewBox="0 0 '+this.width+" "+this.height+'" ';var e=g.Object.NUM_FRACTION_DIGITS;f.viewBox?d='viewBox="'+f.viewBox.x+" "+f.viewBox.y+" "+f.viewBox.width+" "+
f.viewBox.height+'" ':this.svgViewportTransformation&&(d=this.viewportTransform,d='viewBox="'+b(-d[4]/d[0],e)+" "+b(-d[5]/d[3],e)+" "+b(this.width/d[0],e)+" "+b(this.height/d[3],e)+'" ');a.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',h,'" ','height="',c,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null,d,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",
g.version,"</desc>\n","<defs>",g.createSVGFontFacesMarkup(this.getObjects()),g.createSVGRefElementsMarkup(this),"</defs>\n")},_setSVGObjects:function(a,f){for(var h=0,b=this.getObjects(),c=b.length;h<c;h++){var d=b[h],e=this._realizeGroupTransformOnObject(d);a.push(d.toSVG(f));this._unwindGroupTransformOnObject(d,e)}},_setSVGBgOverlayImage:function(a,f){this[f]&&this[f].toSVG&&a.push(this[f].toSVG())},_setSVGBgOverlayColor:function(a,f){this[f]&&this[f].source?a.push('<rect x="',this[f].offsetX,'" y="',
this[f].offsetY,'" ','width="',"repeat-y"===this[f].repeat||"no-repeat"===this[f].repeat?this[f].source.width:this.width,'" height="',"repeat-x"===this[f].repeat||"no-repeat"===this[f].repeat?this[f].source.height:this.height,'" fill="url(#'+f+'Pattern)"',"></rect>\n"):this[f]&&"overlayColor"===f&&a.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[f],'"',"></rect>\n")},sendToBack:function(a){d(this._objects,a);this._objects.unshift(a);return this.renderAll&&
this.renderAll()},bringToFront:function(a){d(this._objects,a);this._objects.push(a);return this.renderAll&&this.renderAll()},sendBackwards:function(a,f){var h=this._objects.indexOf(a);0!==h&&(h=this._findNewLowerIndex(a,h,f),d(this._objects,a),this._objects.splice(h,0,a),this.renderAll&&this.renderAll());return this},_findNewLowerIndex:function(a,f,h){if(h)for(h=f,--f;0<=f;--f){if(a.intersectsWithObject(this._objects[f])||a.isContainedWithinObject(this._objects[f])||this._objects[f].isContainedWithinObject(a)){h=
f;break}}else h=f-1;return h},bringForward:function(a,f){var h=this._objects.indexOf(a);h!==this._objects.length-1&&(h=this._findNewUpperIndex(a,h,f),d(this._objects,a),this._objects.splice(h,0,a),this.renderAll&&this.renderAll());return this},_findNewUpperIndex:function(a,f,h){if(h)for(h=f,f+=1;f<this._objects.length;++f){if(a.intersectsWithObject(this._objects[f])||a.isContainedWithinObject(this._objects[f])||this._objects[f].isContainedWithinObject(a)){h=f;break}}else h=f+1;return h},moveTo:function(a,
f){d(this._objects,a);this._objects.splice(f,0,a);return this.renderAll&&this.renderAll()},dispose:function(){this.clear();return this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}});e(g.StaticCanvas.prototype,g.Observable);e(g.StaticCanvas.prototype,g.Collection);e(g.StaticCanvas.prototype,g.DataURLExporter);e(g.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(a){var f=g.util.createCanvasElement();
if(!f||!f.getContext)return null;var h=f.getContext("2d");if(!h)return null;switch(a){case "getImageData":return"undefined"!==typeof h.getImageData;case "setLineDash":return"undefined"!==typeof h.setLineDash;case "toDataURL":return"undefined"!==typeof f.toDataURL;case "toDataURLWithQuality":try{return f.toDataURL("image/jpeg",0),!0}catch(b){}return!1;default:return null}}});g.StaticCanvas.prototype.toJSON=g.StaticCanvas.prototype.toObject}})();g.BaseBrush=g.util.createClass({color:"rgb(0, 0, 0)",
width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeDashArray:null,setShadow:function(e){this.shadow=new g.Shadow(e);return this},_setBrushStyles:function(){var e=this.canvas.contextTop;e.strokeStyle=this.color;e.lineWidth=this.width;e.lineCap=this.strokeLineCap;e.lineJoin=this.strokeLineJoin;this.strokeDashArray&&g.StaticCanvas.supports("setLineDash")&&e.setLineDash(this.strokeDashArray)},_setShadow:function(){if(this.shadow){var e=this.canvas.contextTop;e.shadowColor=this.shadow.color;
e.shadowBlur=this.shadow.blur;e.shadowOffsetX=this.shadow.offsetX;e.shadowOffsetY=this.shadow.offsetY}},_resetShadow:function(){var e=this.canvas.contextTop;e.shadowColor="";e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0}});(function(){g.PencilBrush=g.util.createClass(g.BaseBrush,{initialize:function(e){this.canvas=e;this._points=[]},onMouseDown:function(e){this._prepareForDrawing(e);this._captureDrawingPath(e);this._render()},onMouseMove:function(e){this._captureDrawingPath(e);this.canvas.clearContext(this.canvas.contextTop);
this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(e){e=new g.Point(e.x,e.y);this._reset();this._addPoint(e);this.canvas.contextTop.moveTo(e.x,e.y)},_addPoint:function(e){this._points.push(e)},_reset:function(){this._points.length=0;this._setBrushStyles();this._setShadow()},_captureDrawingPath:function(e){e=new g.Point(e.x,e.y);this._addPoint(e)},_render:function(){var e=this.canvas.contextTop,c=this.canvas.viewportTransform,d=this._points[0],b=this._points[1];
e.save();e.transform(c[0],c[1],c[2],c[3],c[4],c[5]);e.beginPath();2===this._points.length&&d.x===b.x&&d.y===b.y&&(d.x-=.5,b.x+=.5);e.moveTo(d.x,d.y);for(var c=1,a=this._points.length;c<a;c++)b=d.midPointFrom(b),e.quadraticCurveTo(d.x,d.y,b.x,b.y),d=this._points[c],b=this._points[c+1];e.lineTo(d.x,d.y);e.stroke();e.restore()},convertPointsToSVGPath:function(e){var c=[],d=new g.Point(e[0].x,e[0].y),b=new g.Point(e[1].x,e[1].y);c.push("M ",e[0].x," ",e[0].y," ");for(var a=1,k=e.length;a<k;a++){var f=
d.midPointFrom(b);c.push("Q ",d.x," ",d.y," ",f.x," ",f.y," ");d=new g.Point(e[a].x,e[a].y);a+1<e.length&&(b=new g.Point(e[a+1].x,e[a+1].y))}c.push("L ",d.x," ",d.y," ");return c},createPath:function(e){e=new g.Path(e,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray,originX:"center",originY:"center"});this.shadow&&(this.shadow.affectStroke=!0,e.setShadow(this.shadow));return e},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath();
var e=this.convertPointsToSVGPath(this._points).join("");"M 0 0 Q 0 0 0 0 L 0 0"===e?this.canvas.renderAll():(e=this.createPath(e),this.canvas.add(e),e.setCoords(),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderAll(),this.canvas.fire("path:created",{path:e}))}})})();g.CircleBrush=g.util.createClass(g.BaseBrush,{width:10,initialize:function(e){this.canvas=e;this.points=[]},drawDot:function(e){e=this.addPoint(e);var c=this.canvas.contextTop,d=this.canvas.viewportTransform;
c.save();c.transform(d[0],d[1],d[2],d[3],d[4],d[5]);c.fillStyle=e.fill;c.beginPath();c.arc(e.x,e.y,e.radius,0,2*Math.PI,!1);c.closePath();c.fill();c.restore()},onMouseDown:function(e){this.points.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.drawDot(e)},onMouseMove:function(e){this.drawDot(e)},onMouseUp:function(){var e=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var c=[],d=0,b=this.points.length;d<b;d++){var a=this.points[d],a=new g.Circle({radius:a.radius,
left:a.x,top:a.y,originX:"center",originY:"center",fill:a.fill});this.shadow&&a.setShadow(this.shadow);c.push(a)}c=new g.Group(c,{originX:"center",originY:"center"});c.canvas=this.canvas;this.canvas.add(c);this.canvas.fire("path:created",{path:c});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=e;this.canvas.renderAll()},addPoint:function(e){e=new g.Point(e.x,e.y);var c=g.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,d=(new g.Color(this.color)).setAlpha(g.util.getRandomInt(0,
100)/100).toRgba();e.radius=c;e.fill=d;this.points.push(e);return e}});g.SprayBrush=g.util.createClass(g.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(e){this.canvas=e;this.sprayChunks=[]},onMouseDown:function(e){this.sprayChunks.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.addSprayChunk(e);this.render()},onMouseMove:function(e){this.addSprayChunk(e);this.render()},onMouseUp:function(){var e=
this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var c=[],d=0,b=this.sprayChunks.length;d<b;d++)for(var a=this.sprayChunks[d],k=0,f=a.length;k<f;k++){var h=new g.Rect({width:a[k].width,height:a[k].width,left:a[k].x+1,top:a[k].y+1,originX:"center",originY:"center",fill:this.color});this.shadow&&h.setShadow(this.shadow);c.push(h)}this.optimizeOverlapping&&(c=this._getOptimizedRects(c));c=new g.Group(c,{originX:"center",originY:"center"});c.canvas=this.canvas;this.canvas.add(c);this.canvas.fire("path:created",
{path:c});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=e;this.canvas.renderAll()},_getOptimizedRects:function(e){for(var c={},d,b=0,a=e.length;b<a;b++)d=e[b].left+""+e[b].top,c[d]||(c[d]=e[b]);e=[];for(d in c)e.push(c[d]);return e},render:function(){var e=this.canvas.contextTop;e.fillStyle=this.color;var c=this.canvas.viewportTransform;e.save();e.transform(c[0],c[1],c[2],c[3],c[4],c[5]);for(var c=0,d=this.sprayChunkPoints.length;c<d;c++){var b=
this.sprayChunkPoints[c];"undefined"!==typeof b.opacity&&(e.globalAlpha=b.opacity);e.fillRect(b.x,b.y,b.width,b.width)}e.restore()},addSprayChunk:function(e){this.sprayChunkPoints=[];for(var c,d,b,a=this.width/2,k=0;k<this.density;k++)c=g.util.getRandomInt(e.x-a,e.x+a),d=g.util.getRandomInt(e.y-a,e.y+a),b=this.dotWidthVariance?g.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth,c=new g.Point(c,d),c.width=b,this.randomOpacity&&(c.opacity=
g.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(c);this.sprayChunks.push(this.sprayChunkPoints)}});g.PatternBrush=g.util.createClass(g.PencilBrush,{getPatternSrc:function(){var e=g.document.createElement("canvas"),c=e.getContext("2d");e.width=e.height=25;c.fillStyle=this.color;c.beginPath();c.arc(10,10,10,0,2*Math.PI,!1);c.closePath();c.fill();return e},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||
this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles");this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(e){e=this.callSuper("createPath",e);e.stroke=new g.Pattern({source:this.source||this.getPatternSrcFunction()});return e}});(function(){var e=g.util.getPointer,c=g.util.degreesToRadians,d=g.util.radiansToDegrees,b=Math.atan2,a=Math.abs;g.Canvas=g.util.createClass(g.StaticCanvas,{initialize:function(f,a){a||(a={});this._initStatic(f,a);
this._initInteractive();this._createCacheCanvas()},uniScaleTransform:!1,centeredScaling:!1,centeredRotation:!1,interactive:!0,selection:!0,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,
_initInteractive:function(){this._groupSelector=this._currentTransform=null;this._initWrapperElement();this._createUpperCanvas();this._initEventListeners();this._initRetinaScaling();this.freeDrawingBrush=g.PencilBrush&&new g.PencilBrush(this);this.calcOffset()},_resetCurrentTransform:function(){var f=this._currentTransform;f.target.set({scaleX:f.original.scaleX,scaleY:f.original.scaleY,skewX:f.original.skewX,skewY:f.original.skewY,left:f.original.left,top:f.original.top});this._shouldCenterTransform(f.target)?
"rotate"===f.action?this._setOriginToCenter(f.target):("center"!==f.originX&&(f.mouseXSign="right"===f.originX?-1:1),"center"!==f.originY&&(f.mouseYSign="bottom"===f.originY?-1:1),f.originX="center",f.originY="center"):(f.originX=f.original.originX,f.originY=f.original.originY)},containsPoint:function(f,a){var b=this.getPointer(f,!0),c=this._normalizePointer(a,b);return a.containsPoint(c)||a._findTargetCorner(b)},_normalizePointer:function(f,a){var b=this.getActiveGroup(),c;b&&"group"!==f.type&&b.contains(f)&&
(c=g.util.multiplyTransformMatrices(this.viewportTransform,b.calcTransformMatrix()),c=g.util.invertTransform(c),a=g.util.transformPoint(a,c,!1),b=g.util.transformPoint(b.getCenterPoint(),c,!1),a.x-=b.x,a.y-=b.y);return{x:a.x,y:a.y}},isTargetTransparent:function(f,a,b){var c=f.hasBorders,k=f.transparentCorners;f.hasBorders=f.transparentCorners=!1;f.render(this.contextCache);f._renderControls(this.contextCache);f.hasBorders=c;f.transparentCorners=k;f=g.util.isTransparent(this.contextCache,a,b,this.targetFindTolerance);
this.clearContext(this.contextCache);return f},_shouldClearSelection:function(f,a){var b=this.getActiveGroup(),c=this.getActiveObject();return!a||a&&b&&!b.contains(a)&&b!==a&&!f.shiftKey||a&&!a.evented||a&&!a.selectable&&c&&c!==a},_shouldCenterTransform:function(f){if(f){var a=this._currentTransform,b;"scale"===a.action||"scaleX"===a.action||"scaleY"===a.action?b=this.centeredScaling||f.centeredScaling:"rotate"===a.action&&(b=this.centeredRotation||f.centeredRotation);return b?!a.altKey:a.altKey}},
_getOriginFromCorner:function(f,a){var b={x:f.originX,y:f.originY};if("ml"===a||"tl"===a||"bl"===a)b.x="right";else if("mr"===a||"tr"===a||"br"===a)b.x="left";if("tl"===a||"mt"===a||"tr"===a)b.y="bottom";else if("bl"===a||"mb"===a||"br"===a)b.y="top";return b},_getActionFromCorner:function(f,a,b){if(!a)return"drag";switch(a){case "mtr":return"rotate";case "ml":case "mr":return b.shiftKey?"skewY":"scaleX";case "mt":case "mb":return b.shiftKey?"skewX":"scaleY";default:return"scale"}},_setupCurrentTransform:function(f,
a){if(a){var b=this.getPointer(f),k=a._findTargetCorner(this.getPointer(f,!0)),d=this._getActionFromCorner(a,k,f),e=this._getOriginFromCorner(a,k);this._currentTransform={target:a,action:d,corner:k,scaleX:a.scaleX,scaleY:a.scaleY,skewX:a.skewX,skewY:a.skewY,offsetX:b.x-a.left,offsetY:b.y-a.top,originX:e.x,originY:e.y,ex:b.x,ey:b.y,lastX:b.x,lastY:b.y,left:a.left,top:a.top,theta:c(a.angle),width:a.width*a.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:f.shiftKey,altKey:f.altKey};this._currentTransform.original=
{left:a.left,top:a.top,scaleX:a.scaleX,scaleY:a.scaleY,skewX:a.skewX,skewY:a.skewY,originX:e.x,originY:e.y};this._resetCurrentTransform()}},_translateObject:function(f,a){var b=this._currentTransform.target;b.get("lockMovementX")||b.set("left",f-this._currentTransform.offsetX);b.get("lockMovementY")||b.set("top",a-this._currentTransform.offsetY)},_changeSkewTransformOrigin:function(f,a,b){var c="originX",k={0:"center"},d=a.target.skewX,e="left",g="right",E="mt"===a.corner||"ml"===a.corner?1:-1,D=
1;f=0<f?1:-1;"y"===b&&(d=a.target.skewY,e="top",g="bottom",c="originY");k[-1]=e;k[1]=g;a.target.flipX&&(D*=-1);a.target.flipY&&(D*=-1);0===d?(a.skewSign=-E*f*D,a[c]=k[-f]):(d=0<d?1:-1,a.skewSign=d,a[c]=k[d*E*D])},_skewObject:function(f,a,b){var c=this._currentTransform,k=c.target,d=k.get("lockSkewingX"),e=k.get("lockSkewingY");if(!(d&&"x"===b||e&&"y"===b)){var e=k.getCenterPoint(),v=k.toLocalPoint(new g.Point(f,a),"center","center")[b],E=k.toLocalPoint(new g.Point(c.lastX,c.lastY),"center","center")[b],
d=k._getTransformedDimensions();this._changeSkewTransformOrigin(v-E,c,b);v=k.toLocalPoint(new g.Point(f,a),c.originX,c.originY)[b];e=k.translateToOriginPoint(e,c.originX,c.originY);this._setObjectSkew(v,c,b,d);c.lastX=f;c.lastY=a;k.setPositionByOrigin(e,c.originX,c.originY)}},_setObjectSkew:function(f,a,b,c){var k=a.target,d=a.skewSign,e,v,E,D;"x"===b?(a="y",E="Y",e="X",v=0,D=k.skewY):(a="x",E="X",e="Y",v=k.skewX,D=0);v=k._getTransformedDimensions(v,D);f=2*Math.abs(f)-v[b];2>=f?f=0:(f=d*Math.atan(f/
k["scale"+e]/(v[a]/k["scale"+E])),f=g.util.radiansToDegrees(f));k.set("skew"+e,f);0!==k["skew"+E]&&(e=k._getTransformedDimensions(),f=c[a]/e[a]*k["scale"+E],k.set("scale"+E,f))},_scaleObject:function(f,a,b){var c=this._currentTransform,k=c.target,d=k.get("lockScalingX"),e=k.get("lockScalingY"),v=k.get("lockScalingFlip");if(!d||!e){var E=k.translateToOriginPoint(k.getCenterPoint(),c.originX,c.originY);f=k.toLocalPoint(new g.Point(f,a),c.originX,c.originY);a=k._getTransformedDimensions();this._setLocalMouse(f,
c);this._setObjectScale(f,c,d,e,b,v,a);k.setPositionByOrigin(E,c.originX,c.originY)}},_setObjectScale:function(f,a,b,c,k,d,e){var g=a.target,E=!1,D=!1;a.newScaleX=f.x*g.scaleX/e.x;a.newScaleY=f.y*g.scaleY/e.y;d&&0>=a.newScaleX&&a.newScaleX<g.scaleX&&(E=!0);d&&0>=a.newScaleY&&a.newScaleY<g.scaleY&&(D=!0);"equally"!==k||b||c?k?"x"!==k||g.get("lockUniScaling")?"y"!==k||g.get("lockUniScaling")||D||c||g.set("scaleY",a.newScaleY):E||b||g.set("scaleX",a.newScaleX):(E||b||g.set("scaleX",a.newScaleX),D||c||
g.set("scaleY",a.newScaleY)):E||D||this._scaleObjectEqually(f,g,a,e);E||D||this._flipObject(a,k)},_scaleObjectEqually:function(f,a,b,c){f=f.y+f.x;c=c.y*b.original.scaleY/a.scaleY+c.x*b.original.scaleX/a.scaleX;b.newScaleX=b.original.scaleX*f/c;b.newScaleY=b.original.scaleY*f/c;a.set("scaleX",b.newScaleX);a.set("scaleY",b.newScaleY)},_flipObject:function(f,a){0>f.newScaleX&&"y"!==a&&("left"===f.originX?f.originX="right":"right"===f.originX&&(f.originX="left"));0>f.newScaleY&&"x"!==a&&("top"===f.originY?
f.originY="bottom":"bottom"===f.originY&&(f.originY="top"))},_setLocalMouse:function(f,h){var b=h.target;"right"===h.originX?f.x*=-1:"center"===h.originX&&(f.x=2*f.x*h.mouseXSign,0>f.x&&(h.mouseXSign=-h.mouseXSign));"bottom"===h.originY?f.y*=-1:"center"===h.originY&&(f.y=2*f.y*h.mouseYSign,0>f.y&&(h.mouseYSign=-h.mouseYSign));a(f.x)>b.padding?f.x=0>f.x?f.x+b.padding:f.x-b.padding:f.x=0;a(f.y)>b.padding?f.y=0>f.y?f.y+b.padding:f.y-b.padding:f.y=0},_rotateObject:function(f,a){var c=this._currentTransform;
if(!c.target.get("lockRotation")){var k=b(c.ey-c.top,c.ex-c.left),e=b(a-c.top,f-c.left),k=d(e-k+c.theta);0>k&&(k=360+k);c.target.angle=k%360}},setCursor:function(f){this.upperCanvasEl.style.cursor=f},_resetObjectTransform:function(f){f.scaleX=1;f.scaleY=1;f.skewX=0;f.skewY=0;f.setAngle(0)},_drawSelection:function(){var f=this.contextTop,h=this._groupSelector,b=h.left,c=h.top,k=a(b),d=a(c);f.fillStyle=this.selectionColor;f.fillRect(h.ex-(0<b?0:-b),h.ey-(0<c?0:-c),k,d);f.lineWidth=this.selectionLineWidth;
f.strokeStyle=this.selectionBorderColor;1<this.selectionDashArray.length?(b=h.ex+.5-(0<b?0:k),h=h.ey+.5-(0<c?0:d),f.beginPath(),g.util.drawDashedLine(f,b,h,b+k,h,this.selectionDashArray),g.util.drawDashedLine(f,b,h+d-1,b+k,h+d-1,this.selectionDashArray),g.util.drawDashedLine(f,b,h,b,h+d,this.selectionDashArray),g.util.drawDashedLine(f,b+k-1,h,b+k-1,h+d,this.selectionDashArray),f.closePath(),f.stroke()):f.strokeRect(h.ex+.5-(0<b?0:k),h.ey+.5-(0<c?0:d),k,d)},_isLastRenderedObject:function(f){return this.controlsAboveOverlay&&
this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(f,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(this.getPointer(f,!0))},findTarget:function(f,a){if(!this.skipTargetFind){if(this._isLastRenderedObject(f))return this.lastRenderedObjectWithControlsAboveOverlay;var b=this.getActiveGroup();if(b&&!a&&this.containsPoint(f,b))return b;b=this._searchPossibleTargets(f,
a);this._fireOverOutEvents(b,f);return b}},_fireOverOutEvents:function(f,a){f?this._hoveredTarget!==f&&(this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget,e:a}),this._hoveredTarget.fire("mouseout")),this.fire("mouse:over",{target:f,e:a}),f.fire("mouseover"),this._hoveredTarget=f):this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget,e:a}),this._hoveredTarget.fire("mouseout"),this._hoveredTarget=null)},_checkTarget:function(f,a,b){if(a&&a.visible&&a.evented&&
this.containsPoint(f,a)&&(!this.perPixelTargetFind&&!a.perPixelTargetFind||a.isEditing||!this.isTargetTransparent(a,b.x,b.y)))return!0},_searchPossibleTargets:function(f,a){for(var b,c=this.getPointer(f,!0),k=this._objects.length;k--;)if((!this._objects[k].group||a)&&this._checkTarget(f,this._objects[k],c)){this.relatedTarget=this._objects[k];b=this._objects[k];break}return b},getPointer:function(f,a,b){b||(b=this.upperCanvasEl);f=e(f);var c=b.getBoundingClientRect(),k=c.width||0,d=c.height||0;k&&
d||("top"in c&&"bottom"in c&&(d=Math.abs(c.top-c.bottom)),"right"in c&&"left"in c&&(k=Math.abs(c.right-c.left)));this.calcOffset();f.x-=this._offset.left;f.y-=this._offset.top;a||(f=g.util.transformPoint(f,g.util.invertTransform(this.viewportTransform)));0===k||0===d?b=a=1:(a=b.width/k,b=b.height/d);return{x:f.x*a,y:f.y*b}},_createUpperCanvas:function(){var f=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement();g.util.addClass(this.upperCanvasEl,
"upper-canvas "+f);this.wrapperEl.appendChild(this.upperCanvasEl);this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl);this._applyCanvasStyle(this.upperCanvasEl);this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();this.cacheCanvasEl.setAttribute("width",this.width);this.cacheCanvasEl.setAttribute("height",this.height);this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=
g.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass});g.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"});g.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(f){var a=this.getWidth()||f.width,b=this.getHeight()||f.height;g.util.setStyle(f,{position:"absolute",width:a+"px",height:b+"px",left:0,top:0});f.width=a;f.height=b;g.util.makeElementUnselectable(f)},_copyCanvasStyle:function(f,a){a.style.cssText=
f.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(f){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=f;f.set("active",!0)},setActiveObject:function(f,a){this._setActiveObject(f);this.renderAll();this.fire("object:selected",{target:f,e:a});f.fire("selected",{e:a});return this},getActiveObject:function(){return this._activeObject},_discardActiveObject:function(){this._activeObject&&
this._activeObject.set("active",!1);this._activeObject=null},discardActiveObject:function(f){this._discardActiveObject();this.renderAll();this.fire("selection:cleared",{e:f});return this},_setActiveGroup:function(f){(this._activeGroup=f)&&f.set("active",!0)},setActiveGroup:function(f,a){this._setActiveGroup(f);f&&(this.fire("object:selected",{target:f,e:a}),f.fire("selected",{e:a}));return this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var f=this.getActiveGroup();
f&&f.destroy();this.setActiveGroup(null)},discardActiveGroup:function(f){this._discardActiveGroup();this.fire("selection:cleared",{e:f});return this},deactivateAll:function(){for(var f=this.getObjects(),a=0,b=f.length;a<b;a++)f[a].set("active",!1);this._discardActiveGroup();this._discardActiveObject();return this},deactivateAllWithDispatch:function(f){var a=this.getActiveGroup()||this.getActiveObject();a&&this.fire("before:selection:cleared",{target:a,e:f});this.deactivateAll();a&&this.fire("selection:cleared",
{e:f});return this},dispose:function(){this.callSuper("dispose");var f=this.wrapperEl;this.removeListeners();f.removeChild(this.upperCanvasEl);f.removeChild(this.lowerCanvasEl);delete this.upperCanvasEl;f.parentNode&&f.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl);delete this.wrapperEl;return this},drawControls:function(f){var a=this.getActiveGroup();a?a._renderControls(f):this._drawObjectsControls(f)},_drawObjectsControls:function(f){for(var a=0,b=this._objects.length;a<b;++a)this._objects[a]&&
this._objects[a].active&&(this._objects[a]._renderControls(f),this.lastRenderedObjectWithControlsAboveOverlay=this._objects[a])}});for(var k in g.StaticCanvas)"prototype"!==k&&(g.Canvas[k]=g.StaticCanvas[k]);g.isTouchSupported&&(g.Canvas.prototype._setCursorFromEvent=function(){});g.Element=g.Canvas})();(function(){var e={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},c=g.util.addListener,d=g.util.removeListener;g.util.object.extend(g.Canvas.prototype,{cursorMap:"n-resize ne-resize e-resize se-resize s-resize sw-resize w-resize nw-resize".split(" "),
_initEventListeners:function(){this._bindEvents();c(g.window,"resize",this._onResize);c(this.upperCanvasEl,"mousedown",this._onMouseDown);c(this.upperCanvasEl,"mousemove",this._onMouseMove);c(this.upperCanvasEl,"mousewheel",this._onMouseWheel);c(this.upperCanvasEl,"touchstart",this._onMouseDown);c(this.upperCanvasEl,"touchmove",this._onMouseMove);"undefined"!==typeof eventjs&&"add"in eventjs&&(eventjs.add(this.upperCanvasEl,"gesture",this._onGesture),eventjs.add(this.upperCanvasEl,"drag",this._onDrag),
eventjs.add(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.add(this.upperCanvasEl,"shake",this._onShake),eventjs.add(this.upperCanvasEl,"longpress",this._onLongPress))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this);this._onMouseMove=this._onMouseMove.bind(this);this._onMouseUp=this._onMouseUp.bind(this);this._onResize=this._onResize.bind(this);this._onGesture=this._onGesture.bind(this);this._onDrag=this._onDrag.bind(this);this._onShake=this._onShake.bind(this);
this._onLongPress=this._onLongPress.bind(this);this._onOrientationChange=this._onOrientationChange.bind(this);this._onMouseWheel=this._onMouseWheel.bind(this)},removeListeners:function(){d(g.window,"resize",this._onResize);d(this.upperCanvasEl,"mousedown",this._onMouseDown);d(this.upperCanvasEl,"mousemove",this._onMouseMove);d(this.upperCanvasEl,"mousewheel",this._onMouseWheel);d(this.upperCanvasEl,"touchstart",this._onMouseDown);d(this.upperCanvasEl,"touchmove",this._onMouseMove);"undefined"!==typeof eventjs&&
"remove"in eventjs&&(eventjs.remove(this.upperCanvasEl,"gesture",this._onGesture),eventjs.remove(this.upperCanvasEl,"drag",this._onDrag),eventjs.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.remove(this.upperCanvasEl,"shake",this._onShake),eventjs.remove(this.upperCanvasEl,"longpress",this._onLongPress))},_onGesture:function(b,a){this.__onTransformGesture&&this.__onTransformGesture(b,a)},_onDrag:function(b,a){this.__onDrag&&this.__onDrag(b,a)},_onMouseWheel:function(b,
a){this.__onMouseWheel&&this.__onMouseWheel(b,a)},_onOrientationChange:function(b,a){this.__onOrientationChange&&this.__onOrientationChange(b,a)},_onShake:function(b,a){this.__onShake&&this.__onShake(b,a)},_onLongPress:function(b,a){this.__onLongPress&&this.__onLongPress(b,a)},_onMouseDown:function(b){this.__onMouseDown(b);c(g.document,"touchend",this._onMouseUp);c(g.document,"touchmove",this._onMouseMove);d(this.upperCanvasEl,"mousemove",this._onMouseMove);d(this.upperCanvasEl,"touchmove",this._onMouseMove);
"touchstart"===b.type?d(this.upperCanvasEl,"mousedown",this._onMouseDown):(c(g.document,"mouseup",this._onMouseUp),c(g.document,"mousemove",this._onMouseMove))},_onMouseUp:function(b){this.__onMouseUp(b);d(g.document,"mouseup",this._onMouseUp);d(g.document,"touchend",this._onMouseUp);d(g.document,"mousemove",this._onMouseMove);d(g.document,"touchmove",this._onMouseMove);c(this.upperCanvasEl,"mousemove",this._onMouseMove);c(this.upperCanvasEl,"touchmove",this._onMouseMove);if("touchend"===b.type){var a=
this;setTimeout(function(){c(a.upperCanvasEl,"mousedown",a._onMouseDown)},400)}},_onMouseMove:function(b){!this.allowTouchScrolling&&b.preventDefault&&b.preventDefault();this.__onMouseMove(b)},_onResize:function(){this.calcOffset()},_shouldRender:function(b,a){var c=this.getActiveGroup()||this.getActiveObject();return!!(b&&(b.isMoving||b!==c)||!b&&c||!b&&!c&&!this._groupSelector||a&&this._previousPointer&&this.selection&&(a.x!==this._previousPointer.x||a.y!==this._previousPointer.y))},__onMouseUp:function(b){var a;
if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(b);else{this._currentTransform?(this._finalizeCurrentTransform(),a=this._currentTransform.target):a=this.findTarget(b,!0);var c=this._shouldRender(a,this.getPointer(b));this._maybeGroupObjects(b);a&&(a.isMoving=!1);c&&this.renderAll();this._handleCursorAndEvent(b,a)}},_handleCursorAndEvent:function(b,a){this._setCursorFromEvent(b,a);var c=this;setTimeout(function(){c._setCursorFromEvent(b,a)},50);this.fire("mouse:up",{target:a,
e:b});a&&a.fire("mouseup",{e:b})},_finalizeCurrentTransform:function(){var b=this._currentTransform.target;b._scaling&&(b._scaling=!1);b.setCoords();this.stateful&&b.hasStateChanged()&&(this.fire("object:modified",{target:b}),b.fire("modified"));this._restoreOriginXY(b)},_restoreOriginXY:function(b){if(this._previousOriginX&&this._previousOriginY){var a=b.translateToOriginPoint(b.getCenterPoint(),this._previousOriginX,this._previousOriginY);b.originX=this._previousOriginX;b.originY=this._previousOriginY;
b.left=a.x;b.top=a.y;this._previousOriginY=this._previousOriginX=null}},_onMouseDownInDrawingMode:function(b){this._isCurrentlyDrawing=!0;this.discardActiveObject(b).renderAll();this.clipTo&&g.util.clipContext(this,this.contextTop);var a=g.util.invertTransform(this.viewportTransform),a=g.util.transformPoint(this.getPointer(b,!0),a);this.freeDrawingBrush.onMouseDown(a);this.fire("mouse:down",{e:b});a=this.findTarget(b);"undefined"!==typeof a&&a.fire("mousedown",{e:b,target:a})},_onMouseMoveInDrawingMode:function(b){if(this._isCurrentlyDrawing){var a=
g.util.invertTransform(this.viewportTransform),a=g.util.transformPoint(this.getPointer(b,!0),a);this.freeDrawingBrush.onMouseMove(a)}this.setCursor(this.freeDrawingCursor);this.fire("mouse:move",{e:b});a=this.findTarget(b);"undefined"!==typeof a&&a.fire("mousemove",{e:b,target:a})},_onMouseUpInDrawingMode:function(b){this._isCurrentlyDrawing=!1;this.clipTo&&this.contextTop.restore();this.freeDrawingBrush.onMouseUp();this.fire("mouse:up",{e:b});var a=this.findTarget(b);"undefined"!==typeof a&&a.fire("mouseup",
{e:b,target:a})},__onMouseDown:function(b){if(("which"in b?1===b.which:0===b.button)||g.isTouchSupported)if(this.isDrawingMode)this._onMouseDownInDrawingMode(b);else if(!this._currentTransform){var a=this.findTarget(b),c=this.getPointer(b,!0);this._previousPointer=c;var f=this._shouldRender(a,c),h=this._shouldGroup(b,a);this._shouldClearSelection(b,a)?this._clearSelection(b,a,c):h&&(this._handleGrouping(b,a),a=this.getActiveGroup());a&&a.selectable&&(a.__corner||!h)&&(this._beforeTransform(b,a),this._setupCurrentTransform(b,
a));f&&this.renderAll();this.fire("mouse:down",{target:a,e:b});a&&a.fire("mousedown",{e:b})}},_beforeTransform:function(b,a){this.stateful&&a.saveState();if(a._findTargetCorner(this.getPointer(b)))this.onBeforeScaleRotate(a);a!==this.getActiveGroup()&&a!==this.getActiveObject()&&(this.deactivateAll(),this.setActiveObject(a,b))},_clearSelection:function(b,a,c){this.deactivateAllWithDispatch(b);a&&a.selectable?this.setActiveObject(a,b):this.selection&&(this._groupSelector={ex:c.x,ey:c.y,top:0,left:0})},
_setOriginToCenter:function(b){this._previousOriginX=this._currentTransform.target.originX;this._previousOriginY=this._currentTransform.target.originY;var a=b.getCenterPoint();b.originX="center";b.originY="center";b.left=a.x;b.top=a.y;this._currentTransform.left=b.left;this._currentTransform.top=b.top},_setCenterToOrigin:function(b){var a=b.translateToOriginPoint(b.getCenterPoint(),this._previousOriginX,this._previousOriginY);b.originX=this._previousOriginX;b.originY=this._previousOriginY;b.left=
a.x;b.top=a.y;this._previousOriginY=this._previousOriginX=null},__onMouseMove:function(b){var a,c;if(this.isDrawingMode)this._onMouseMoveInDrawingMode(b);else if(!("undefined"!==typeof b.touches&&1<b.touches.length)){var f=this._groupSelector;f?(c=this.getPointer(b,!0),f.left=c.x-f.ex,f.top=c.y-f.ey,this.renderTop()):this._currentTransform?this._transformObject(b):(a=this.findTarget(b),!a||a&&!a.selectable?this.setCursor(this.defaultCursor):this._setCursorFromEvent(b,a));this.fire("mouse:move",{target:a,
e:b});a&&a.fire("mousemove",{e:b})}},_transformObject:function(b){var a=this.getPointer(b),c=this._currentTransform;c.reset=!1;c.target.isMoving=!0;this._beforeScaleTransform(b,c);this._performTransformAction(b,c,a);this.renderAll()},_performTransformAction:function(b,a,c){var f=c.x;c=c.y;var h=a.target,d=a.action;"rotate"===d?(this._rotateObject(f,c),this._fire("rotating",h,b)):"scale"===d?(this._onScale(b,a,f,c),this._fire("scaling",h,b)):"scaleX"===d?(this._scaleObject(f,c,"x"),this._fire("scaling",
h,b)):"scaleY"===d?(this._scaleObject(f,c,"y"),this._fire("scaling",h,b)):"skewX"===d?(this._skewObject(f,c,"x"),this._fire("skewing",h,b)):"skewY"===d?(this._skewObject(f,c,"y"),this._fire("skewing",h,b)):(this._translateObject(f,c),this._fire("moving",h,b),this.setCursor(this.moveCursor))},_fire:function(b,a,c){this.fire("object:"+b,{target:a,e:c});a.fire(b,{e:c})},_beforeScaleTransform:function(b,a){if("scale"===a.action||"scaleX"===a.action||"scaleY"===a.action){var c=this._shouldCenterTransform(a.target);
if(c&&("center"!==a.originX||"center"!==a.originY)||!c&&"center"===a.originX&&"center"===a.originY)this._resetCurrentTransform(),a.reset=!0}},_onScale:function(b,a,c,f){!b.shiftKey&&!this.uniScaleTransform||a.target.get("lockUniScaling")?(a.reset||"scale"!==a.currentAction||this._resetCurrentTransform(),a.currentAction="scaleEqually",this._scaleObject(c,f,"equally")):(a.currentAction="scale",this._scaleObject(c,f))},_setCursorFromEvent:function(b,a){if(a&&a.selectable){var c=this.getActiveGroup();
(c=a._findTargetCorner&&(!c||!c.contains(a))&&a._findTargetCorner(this.getPointer(b,!0)))?this._setCornerCursor(c,a,b):this.setCursor(a.hoverCursor||this.hoverCursor)}else return this.setCursor(this.defaultCursor),!1;return!0},_setCornerCursor:function(b,a,c){if(b in e)this.setCursor(this._getRotatedCornerCursor(b,a,c));else if("mtr"===b&&a.hasRotatingPoint)this.setCursor(this.rotationCursor);else return this.setCursor(this.defaultCursor),!1},_getRotatedCornerCursor:function(b,a,c){a=Math.round(a.getAngle()%
360/45);0>a&&(a+=8);a+=e[b];c.shiftKey&&0===e[b]%2&&(a+=2);return this.cursorMap[a%8]}})})();(function(){var e=Math.min,c=Math.max;g.util.object.extend(g.Canvas.prototype,{_shouldGroup:function(c,b){var a=this.getActiveObject();return c.shiftKey&&b&&b.selectable&&(this.getActiveGroup()||a&&a!==b)&&this.selection},_handleGrouping:function(c,b){if(b===this.getActiveGroup()&&(b=this.findTarget(c,!0),!b||b.isType("group")))return;this.getActiveGroup()?this._updateActiveGroup(b,c):this._createActiveGroup(b,
c);this._activeGroup&&this._activeGroup.saveCoords()},_updateActiveGroup:function(c,b){var a=this.getActiveGroup();if(a.contains(c)){if(a.removeWithUpdate(c),c.set("active",!1),1===a.size()){this.discardActiveGroup(b);this.setActiveObject(a.item(0));return}}else a.addWithUpdate(c);this.fire("selection:created",{target:a,e:b});a.set("active",!0)},_createActiveGroup:function(c,b){if(this._activeObject&&c!==this._activeObject){var a=this._createGroup(c);a.addWithUpdate();this.setActiveGroup(a);this._activeObject=
null;this.fire("selection:created",{target:a,e:b})}c.set("active",!0)},_createGroup:function(c){var b=this.getObjects();c=b.indexOf(this._activeObject)<b.indexOf(c)?[this._activeObject,c]:[c,this._activeObject];return new g.Group(c,{canvas:this})},_groupSelectedObjects:function(c){var b=this._collectObjects();1===b.length?this.setActiveObject(b[0],c):1<b.length&&(b=new g.Group(b.reverse(),{canvas:this}),b.addWithUpdate(),this.setActiveGroup(b,c),b.saveCoords(),this.fire("selection:created",{target:b}),
this.renderAll())},_collectObjects:function(){var d=[],b;b=this._groupSelector.ex;for(var a=this._groupSelector.ey,k=b+this._groupSelector.left,f=a+this._groupSelector.top,h=new g.Point(e(b,k),e(a,f)),q=new g.Point(c(b,k),c(a,f)),a=b===k&&a===f,k=this._objects.length;k--&&!((b=this._objects[k])&&b.selectable&&b.visible&&(b.intersectsWithRect(h,q)||b.isContainedWithinRect(h,q)||b.containsPoint(h)||b.containsPoint(q))&&(b.set("active",!0),d.push(b),a)););return d},_maybeGroupObjects:function(c){this.selection&&
this._groupSelector&&this._groupSelectedObjects(c);if(c=this.getActiveGroup())c.setObjectsCoords().setCoords(),c.isMoving=!1,this.setCursor(this.defaultCursor);this._currentTransform=this._groupSelector=null}})})();g.util.object.extend(g.StaticCanvas.prototype,{toDataURL:function(e){e||(e={});var c=e.format||"png",d=e.quality||1,b=e.multiplier||1;e={left:e.left,top:e.top,width:e.width,height:e.height};this._isRetinaScaling()&&(b*=g.devicePixelRatio);return 1!==b?this.__toDataURLWithMultiplier(c,d,
e,b):this.__toDataURL(c,d,e)},__toDataURL:function(e,c,d){this.renderAll();var b=this.contextContainer.canvas;d=this.__getCroppedCanvas(b,d);"jpg"===e&&(e="jpeg");return g.StaticCanvas.supports("toDataURLWithQuality")?(d||b).toDataURL("image/"+e,c):(d||b).toDataURL("image/"+e)},__getCroppedCanvas:function(e,c){var d,b;if("left"in c||"top"in c||"width"in c||"height"in c)d=g.util.createCanvasElement(),b=d.getContext("2d"),d.width=c.width||this.width,d.height=c.height||this.height,b.drawImage(e,-c.left||
0,-c.top||0);return d},__toDataURLWithMultiplier:function(e,c,d,b){var a=this.getWidth(),k=this.getHeight(),f=a*b,h=k*b,q=this.getActiveObject(),p=this.getActiveGroup(),t=this.contextContainer;1<b&&this.setDimensions({width:f,height:h});t.save();t.scale(b/g.devicePixelRatio,b/g.devicePixelRatio);d.left&&(d.left*=b);d.top&&(d.top*=b);d.width?d.width*=b:1>b&&(d.width=f);d.height?d.height*=b:1>b&&(d.height=h);p?this._tempRemoveBordersControlsFromGroup(p):q&&this.deactivateAll&&this.deactivateAll();e=
this.__toDataURL(e,c,d);this.width=a;this.height=k;this.setDimensions({width:a,height:k});p?this._restoreBordersControlsOnGroup(p):q&&this.setActiveObject&&this.setActiveObject(q);this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return e},toDataURLWithMultiplier:function(e,c,d){return this.toDataURL({format:e,multiplier:c,quality:d})},_tempRemoveBordersControlsFromGroup:function(e){e.origHasControls=e.hasControls;e.origBorderColor=e.borderColor;e.hasControls=!0;e.borderColor="rgba(0,0,0,0)";
e.forEachObject(function(c){c.origBorderColor=c.borderColor;c.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(e){e.hideControls=e.origHideControls;e.borderColor=e.origBorderColor;e.forEachObject(function(c){c.borderColor=c.origBorderColor;delete c.origBorderColor})}});g.util.object.extend(g.StaticCanvas.prototype,{loadFromDatalessJSON:function(e,c,d){return this.loadFromJSON(e,c,d)},loadFromJSON:function(e,c,d){if(e){var b="string"===typeof e?JSON.parse(e):e;this.clear();var a=
this;this._enlivenObjects(b.objects,function(){a._setBgOverlay(b,c)},d);return this}},_setBgOverlay:function(e,c){var d=this,b={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(e.backgroundImage||e.overlayImage||e.background||e.overlay){var a=function(){b.backgroundImage&&b.overlayImage&&b.backgroundColor&&b.overlayColor&&(d.renderAll(),c&&c())};this.__setBgOverlay("backgroundImage",e.backgroundImage,b,a);this.__setBgOverlay("overlayImage",e.overlayImage,b,a);this.__setBgOverlay("backgroundColor",
e.background,b,a);this.__setBgOverlay("overlayColor",e.overlay,b,a);a()}else c&&c()},__setBgOverlay:function(e,c,d,b){var a=this;if(c)if("backgroundImage"===e||"overlayImage"===e)g.Image.fromObject(c,function(c){a[e]=c;d[e]=!0;b&&b()});else this["set"+g.util.string.capitalize(e,!0)](c,function(){d[e]=!0;b&&b()});else d[e]=!0},_enlivenObjects:function(e,c,d){var b=this;if(e&&0!==e.length){var a=this.renderOnAddRemove;this.renderOnAddRemove=!1;g.util.enlivenObjects(e,function(k){k.forEach(function(f,
a){b.insertAt(f,a,!0)});b.renderOnAddRemove=a;c&&c()},null,d)}else c&&c()},_toDataURL:function(e,c){this.clone(function(d){c(d.toDataURL(e))})},_toDataURLWithMultiplier:function(e,c,d){this.clone(function(b){d(b.toDataURLWithMultiplier(e,c))})},clone:function(e,c){var d=JSON.stringify(this.toJSON(c));this.cloneWithoutData(function(b){b.loadFromJSON(d,function(){e&&e(b)})})},cloneWithoutData:function(e){var c=g.document.createElement("canvas");c.width=this.getWidth();c.height=this.getHeight();var d=
new g.Canvas(c);d.clipTo=this.clipTo;this.backgroundImage?(d.setBackgroundImage(this.backgroundImage.src,function(){d.renderAll();e&&e(d)}),d.backgroundImageOpacity=this.backgroundImageOpacity,d.backgroundImageStretch=this.backgroundImageStretch):e&&e(d)}});(function(e){var c=e.fabric||(e.fabric={});e=c.util.object.extend;var d=c.util.toFixed,b=c.util.string.capitalize,a=c.util.degreesToRadians,k=c.StaticCanvas.supports("setLineDash");c.Object||(c.Object=c.util.createClass({type:"object",originX:"left",
originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:12,transparentCorners:!0,hoverCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,
borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule globalCompositeOperation shadow clipTo visible backgroundColor alignX alignY meetOrSlice skewX skewY".split(" "),
initialize:function(f){f&&this.setOptions(f)},_initGradient:function(f){!f.fill||!f.fill.colorStops||f.fill instanceof c.Gradient||this.set("fill",new c.Gradient(f.fill));!f.stroke||!f.stroke.colorStops||f.stroke instanceof c.Gradient||this.set("stroke",new c.Gradient(f.stroke))},_initPattern:function(f){!f.fill||!f.fill.source||f.fill instanceof c.Pattern||this.set("fill",new c.Pattern(f.fill));!f.stroke||!f.stroke.source||f.stroke instanceof c.Pattern||this.set("stroke",new c.Pattern(f.stroke))},
_initClipping:function(f){f.clipTo&&"string"===typeof f.clipTo&&(f=c.util.getFunctionBody(f.clipTo),"undefined"!==typeof f&&(this.clipTo=new Function("ctx",f)))},setOptions:function(f){for(var a in f)this.set(a,f[a]);this._initGradient(f);this._initPattern(f);this._initClipping(f)},transform:function(f,h){this.group&&this.canvas.preserveObjectStacking&&this.group===this.canvas._activeGroup&&this.group.transform(f);var b=h?this._getLeftTopCoords():this.getCenterPoint();f.translate(b.x,b.y);f.rotate(a(this.angle));
f.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1));f.transform(1,0,Math.tan(a(this.skewX)),1,0,0);f.transform(1,Math.tan(a(this.skewY)),0,1,0,0)},toObject:function(f){var a=c.Object.NUM_FRACTION_DIGITS,a={type:this.type,originX:this.originX,originY:this.originY,left:d(this.left,a),top:d(this.top,a),width:d(this.width,a),height:d(this.height,a),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,
strokeWidth:d(this.strokeWidth,a),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:d(this.strokeMiterLimit,a),scaleX:d(this.scaleX,a),scaleY:d(this.scaleY,a),angle:d(this.getAngle(),a),flipX:this.flipX,flipY:this.flipY,opacity:d(this.opacity,a),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),
backgroundColor:this.backgroundColor,fillRule:this.fillRule,globalCompositeOperation:this.globalCompositeOperation,transformMatrix:this.transformMatrix?this.transformMatrix.concat():this.transformMatrix,skewX:d(this.skewX,a),skewY:d(this.skewY,a)};this.includeDefaultValues||(a=this._removeDefaultValues(a));c.util.populateWithProperties(this,a,f);return a},toDatalessObject:function(f){return this.toObject(f)},_removeDefaultValues:function(f){var a=c.util.getKlass(f.type).prototype;a.stateProperties.forEach(function(b){f[b]===
a[b]&&delete f[b];"[object Array]"===Object.prototype.toString.call(f[b])&&"[object Array]"===Object.prototype.toString.call(a[b])&&0===f[b].length&&0===a[b].length&&delete f[b]});return f},toString:function(){return"#<fabric."+b(this.type)+">"},get:function(f){return this[f]},_setObject:function(f){for(var a in f)this._set(a,f[a])},set:function(f,a){"object"===typeof f?this._setObject(f):"function"===typeof a&&"clipTo"!==f?this._set(f,a(this.get(f))):this._set(f,a);return this},_set:function(f,a){if("scaleX"===
f||"scaleY"===f)a=this._constrainScale(a);"scaleX"===f&&0>a?(this.flipX=!this.flipX,a*=-1):"scaleY"===f&&0>a?(this.flipY=!this.flipY,a*=-1):"width"===f||"height"===f?this.minScaleLimit=d(Math.min(.1,1/Math.max(this.width,this.height)),2):"shadow"!==f||!a||a instanceof c.Shadow||(a=new c.Shadow(a));this[f]=a;return this},setOnGroup:function(){},toggle:function(f){var a=this.get(f);"boolean"===typeof a&&this.set(f,!a);return this},setSourcePath:function(f){this.sourcePath=f;return this},getViewportTransform:function(){return this.canvas&&
this.canvas.viewportTransform?this.canvas.viewportTransform:[1,0,0,1,0,0]},render:function(f,a){0===this.width&&0===this.height||!this.visible||(f.save(),this._setupCompositeOperation(f),a||this.transform(f),this._setStrokeStyles(f),this._setFillStyles(f),this.transformMatrix&&f.transform.apply(f,this.transformMatrix),this._setOpacity(f),this._setShadow(f),this.clipTo&&c.util.clipContext(this,f),this._render(f,a),this.clipTo&&f.restore(),f.restore())},_setOpacity:function(f){this.group&&this.group._setOpacity(f);
f.globalAlpha*=this.opacity},_setStrokeStyles:function(f){this.stroke&&(f.lineWidth=this.strokeWidth,f.lineCap=this.strokeLineCap,f.lineJoin=this.strokeLineJoin,f.miterLimit=this.strokeMiterLimit,f.strokeStyle=this.stroke.toLive?this.stroke.toLive(f,this):this.stroke)},_setFillStyles:function(f){this.fill&&(f.fillStyle=this.fill.toLive?this.fill.toLive(f,this):this.fill)},_renderControls:function(f,h){if(!(!this.active||h||this.group&&this.group!==this.canvas.getActiveGroup())){var b=this.getViewportTransform(),
k=this.calcTransformMatrix(),k=c.util.multiplyTransformMatrices(b,k),b=c.util.qrDecompose(k);f.save();f.translate(b.translateX,b.translateY);this.group&&this.group===this.canvas.getActiveGroup()?(f.rotate(a(b.angle)),this.drawBordersInGroup(f,b)):(f.rotate(a(this.angle)),this.drawBorders(f));this.drawControls(f);f.restore()}},_setShadow:function(f){if(this.shadow){var a=this.canvas&&this.canvas.viewportTransform[0]||1,b=this.canvas&&this.canvas.viewportTransform[3]||1;this.canvas&&this.canvas._isRetinaScaling()&&
(a*=c.devicePixelRatio,b*=c.devicePixelRatio);f.shadowColor=this.shadow.color;f.shadowBlur=this.shadow.blur*(a+b)*(this.scaleX+this.scaleY)/4;f.shadowOffsetX=this.shadow.offsetX*a*this.scaleX;f.shadowOffsetY=this.shadow.offsetY*b*this.scaleY}},_removeShadow:function(f){this.shadow&&(f.shadowColor="",f.shadowBlur=f.shadowOffsetX=f.shadowOffsetY=0)},_renderFill:function(f){this.fill&&(f.save(),this.fill.gradientTransform&&f.transform.apply(f,this.fill.gradientTransform),this.fill.toLive&&f.translate(-this.width/
2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0),"evenodd"===this.fillRule?f.fill("evenodd"):f.fill(),f.restore())},_renderStroke:function(f){this.stroke&&0!==this.strokeWidth&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(f),f.save(),this.strokeDashArray?(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),k?(f.setLineDash(this.strokeDashArray),this._stroke&&this._stroke(f)):this._renderDashedStroke&&this._renderDashedStroke(f),
f.stroke()):(this.stroke.gradientTransform&&f.transform.apply(f,this.stroke.gradientTransform),this._stroke?this._stroke(f):f.stroke()),f.restore())},clone:function(f,a){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(a),f):new c.Object(this.toObject(a))},cloneAsImage:function(f){var a=this.toDataURL();c.util.loadImage(a,function(a){f&&f(new c.Image(a))});return this},toDataURL:function(f){f||(f={});var a=c.util.createCanvasElement(),b=this.getBoundingRect();a.width=b.width;
a.height=b.height;c.util.wrapElement(a,"div");b=new c.StaticCanvas(a);"jpg"===f.format&&(f.format="jpeg");"jpeg"===f.format&&(b.backgroundColor="#fff");var k={active:this.get("active"),left:this.getLeft(),top:this.getTop()};this.set("active",!1);this.setPositionByOrigin(new c.Point(a.width/2,a.height/2),"center","center");a=this.canvas;b.add(this);f=b.toDataURL(f);this.set(k).setCoords();this.canvas=a;b.dispose();return f},isType:function(a){return this.type===a},complexity:function(){return 0},toJSON:function(a){return this.toObject(a)},
setGradient:function(a,h){h||(h={});var b={colorStops:[]};b.type=h.type||(h.r1||h.r2?"radial":"linear");b.coords={x1:h.x1,y1:h.y1,x2:h.x2,y2:h.y2};if(h.r1||h.r2)b.coords.r1=h.r1,b.coords.r2=h.r2;h.gradientTransform&&(b.gradientTransform=h.gradientTransform);for(var k in h.colorStops){var d=new c.Color(h.colorStops[k]);b.colorStops.push({offset:k,color:d.toRgb(),opacity:d.getAlpha()})}return this.set(a,c.Gradient.forObject(this,b))},setPatternFill:function(a){return this.set("fill",new c.Pattern(a))},
setShadow:function(a){return this.set("shadow",a?new c.Shadow(a):null)},setColor:function(a){this.set("fill",a);return this},setAngle:function(a){var h=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;h&&this._setOriginToCenter();this.set("angle",a);h&&this._resetOrigin();return this},centerH:function(){this.canvas.centerObjectH(this);return this},centerV:function(){this.canvas.centerObjectV(this);return this},center:function(){this.canvas.centerObject(this);return this},
remove:function(){this.canvas.remove(this);return this},getLocalPointer:function(a,h){h=h||this.canvas.getPointer(a);var b=new c.Point(h.x,h.y),k=this._getLeftTopCoords();this.angle&&(b=c.util.rotatePoint(b,k,c.util.degreesToRadians(-this.angle)));return{x:b.x-k.x,y:b.y-k.y}},_setupCompositeOperation:function(a){this.globalCompositeOperation&&(a.globalCompositeOperation=this.globalCompositeOperation)}}),c.util.createAccessors(c.Object),c.Object.prototype.rotate=c.Object.prototype.setAngle,e(c.Object.prototype,
c.Observable),c.Object.NUM_FRACTION_DIGITS=2,c.Object.__uid=0)})("undefined"!==typeof n?n:this);(function(){var e=g.util.degreesToRadians,c={left:-.5,center:0,right:.5},d={top:-.5,center:0,bottom:.5};g.util.object.extend(g.Object.prototype,{translateToGivenOrigin:function(b,a,k,f,h){var q=b.x,e=b.y;a=c[f]-c[a];k=d[h]-d[k];if(a||k)e=this._getTransformedDimensions(),q=b.x+a*e.x,e=b.y+k*e.y;return new g.Point(q,e)},translateToCenterPoint:function(b,a,c){a=this.translateToGivenOrigin(b,a,c,"center","center");
return this.angle?g.util.rotatePoint(a,b,e(this.angle)):a},translateToOriginPoint:function(b,a,c){a=this.translateToGivenOrigin(b,"center","center",a,c);return this.angle?g.util.rotatePoint(a,b,e(this.angle)):a},getCenterPoint:function(){var b=new g.Point(this.left,this.top);return this.translateToCenterPoint(b,this.originX,this.originY)},getPointByOrigin:function(b,a){var c=this.getCenterPoint();return this.translateToOriginPoint(c,b,a)},toLocalPoint:function(b,a,c){var f=this.getCenterPoint();a=
a&&c?this.translateToGivenOrigin(f,"center","center",a,c):new g.Point(this.left,this.top);b=new g.Point(b.x,b.y);this.angle&&(b=g.util.rotatePoint(b,f,-e(this.angle)));return b.subtractEquals(a)},setPositionByOrigin:function(b,a,c){b=this.translateToCenterPoint(b,a,c);b=this.translateToOriginPoint(b,this.originX,this.originY);this.set("left",b.x);this.set("top",b.y)},adjustPosition:function(b){var a=e(this.angle),k=this.getWidth(),f=Math.cos(a)*k,a=Math.sin(a)*k;this.left+=f*(c[b]-c[this.originX]);
this.top+=a*(c[b]-c[this.originX]);this.setCoords();this.originX=b},_setOriginToCenter:function(){this._originalOriginX=this.originX;this._originalOriginY=this.originY;var b=this.getCenterPoint();this.originY=this.originX="center";this.left=b.x;this.top=b.y},_resetOrigin:function(){var b=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX;this.originY=this._originalOriginY;this.left=b.x;this.top=b.y;this._originalOriginY=
this._originalOriginX=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})})();(function(){function e(b){return[new g.Point(b.tl.x,b.tl.y),new g.Point(b.tr.x,b.tr.y),new g.Point(b.br.x,b.br.y),new g.Point(b.bl.x,b.bl.y)]}var c=g.util.degreesToRadians,d=g.util.multiplyTransformMatrices;g.util.object.extend(g.Object.prototype,{oCoords:null,intersectsWithRect:function(b,a){var c=e(this.oCoords);return"Intersection"===g.Intersection.intersectPolygonRectangle(c,
b,a).status},intersectsWithObject:function(b){return"Intersection"===g.Intersection.intersectPolygonPolygon(e(this.oCoords),e(b.oCoords)).status},isContainedWithinObject:function(b){var a=b.getBoundingRect();b=new g.Point(a.left,a.top);a=new g.Point(a.left+a.width,a.top+a.height);return this.isContainedWithinRect(b,a)},isContainedWithinRect:function(b,a){var c=this.getBoundingRect();return c.left>=b.x&&c.left+c.width<=a.x&&c.top>=b.y&&c.top+c.height<=a.y},containsPoint:function(b){var a=this._getImageLines(this.oCoords);
b=this._findCrossPoints(b,a);return 0!==b&&1===b%2},_getImageLines:function(b){return{topline:{o:b.tl,d:b.tr},rightline:{o:b.tr,d:b.br},bottomline:{o:b.br,d:b.bl},leftline:{o:b.bl,d:b.tl}}},_findCrossPoints:function(b,a){var c,f,h,d=0,e;for(e in a)if(h=a[e],!(h.o.y<b.y&&h.d.y<b.y||h.o.y>=b.y&&h.d.y>=b.y)&&(h.o.x===h.d.x&&h.o.x>=b.x?c=h.o.x:(c=(h.d.y-h.o.y)/(h.d.x-h.o.x),f=b.y-0*b.x,h=h.o.y-c*h.o.x,c=-(f-h)/(0-c)),c>=b.x&&(d+=1),2===d))break;return d},getBoundingRectWidth:function(){return this.getBoundingRect().width},
getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();return g.util.makeBoundingBoxFromPoints([this.oCoords.tl,this.oCoords.tr,this.oCoords.br,this.oCoords.bl])},getWidth:function(){return this._getTransformedDimensions().x},getHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(b){return Math.abs(b)<this.minScaleLimit?0>b?-this.minScaleLimit:this.minScaleLimit:b},scale:function(b){b=this._constrainScale(b);
0>b&&(this.flipX=!this.flipX,this.flipY=!this.flipY,b*=-1);this.scaleY=this.scaleX=b;this.setCoords();return this},scaleToWidth:function(b){var a=this.getBoundingRect().width/this.getWidth();return this.scale(b/this.width/a)},scaleToHeight:function(b){var a=this.getBoundingRect().height/this.getHeight();return this.scale(b/this.height/a)},setCoords:function(){var b=c(this.angle),a=this.getViewportTransform(),k=this._calculateCurrentDimensions(),f=k.x,h=k.y;0>f&&(f=Math.abs(f));var k=Math.sin(b),d=
Math.cos(b),e=0<f?Math.atan(h/f):0,t=f/Math.cos(e)/2,r=Math.cos(e+b)*t,b=Math.sin(e+b)*t,e=g.util.transformPoint(this.getCenterPoint(),a),a=new g.Point(e.x-r,e.y-b),f=new g.Point(a.x+f*d,a.y+f*k),h=new g.Point(a.x-h*k,a.y+h*d),r=new g.Point(e.x+r,e.y+b),b=new g.Point((a.x+h.x)/2,(a.y+h.y)/2),e=new g.Point((f.x+a.x)/2,(f.y+a.y)/2),t=new g.Point((r.x+f.x)/2,(r.y+f.y)/2),m=new g.Point((r.x+h.x)/2,(r.y+h.y)/2),k=new g.Point(e.x+k*this.rotatingPointOffset,e.y-d*this.rotatingPointOffset);this.oCoords={tl:a,
tr:f,br:r,bl:h,ml:b,mt:e,mr:t,mb:m,mtr:k};this._setCornerCoords&&this._setCornerCoords();return this},_calcRotateMatrix:function(){if(this.angle){var b=c(this.angle),a=Math.cos(b),b=Math.sin(b);return[a,b,-b,a,0,0]}return[1,0,0,1,0,0]},calcTransformMatrix:function(){var b=this.getCenterPoint(),b=[1,0,0,1,b.x,b.y],a=this._calcRotateMatrix(),c=this._calcDimensionsTransformMatrix(this.skewX,this.skewY,!0),f=this.group?this.group.calcTransformMatrix():[1,0,0,1,0,0],f=d(f,b),f=d(f,a);return f=d(f,c)},
_calcDimensionsTransformMatrix:function(b,a,k){b=[1,0,Math.tan(c(b)),1];a=[1,Math.tan(c(a)),0,1];k=d([this.scaleX*(k&&this.flipX?-1:1),0,0,this.scaleY*(k&&this.flipY?-1:1)],b,!0);return d(k,a,!0)}})})();g.util.object.extend(g.Object.prototype,{sendToBack:function(){this.group?g.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this);return this},bringToFront:function(){this.group?g.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this);
return this},sendBackwards:function(e){this.group?g.StaticCanvas.prototype.sendBackwards.call(this.group,this,e):this.canvas.sendBackwards(this,e);return this},bringForward:function(e){this.group?g.StaticCanvas.prototype.bringForward.call(this.group,this,e):this.canvas.bringForward(this,e);return this},moveTo:function(e){this.group?g.StaticCanvas.prototype.moveTo.call(this.group,this,e):this.canvas.moveTo(this,e);return this}});g.util.object.extend(g.Object.prototype,{getSvgStyles:function(e){var c=
this.fill?this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill:"none",d=this.fillRule,b=this.stroke?this.stroke.toLive?"url(#SVGID_"+this.stroke.id+")":this.stroke:"none",a=this.strokeWidth?this.strokeWidth:"0",k=this.strokeDashArray?this.strokeDashArray.join(" "):"none",f=this.strokeLineCap?this.strokeLineCap:"butt",h=this.strokeLineJoin?this.strokeLineJoin:"miter",q=this.strokeMiterLimit?this.strokeMiterLimit:"4",p="undefined"!==typeof this.opacity?this.opacity:"1",g=this.visible?"":" visibility: hidden;";
e=e?"":this.getSvgFilter();return["stroke: ",b,"; stroke-width: ",a,"; stroke-dasharray: ",k,"; stroke-linecap: ",f,"; stroke-linejoin: ",h,"; stroke-miterlimit: ",q,"; fill: ",c,"; fill-rule: ",d,"; opacity: ",p,";",e,g].join("")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgTransform:function(){if(this.group&&"path-group"===this.group.type)return"";var e=g.util.toFixed,c=this.getAngle(),d=this.getSkewX()%360,b=this.getSkewY()%360,a=this.getCenterPoint(),
k=g.Object.NUM_FRACTION_DIGITS,a="path-group"===this.type?"":"translate("+e(a.x,k)+" "+e(a.y,k)+")",c=0!==c?" rotate("+e(c,k)+")":"",f=1===this.scaleX&&1===this.scaleY?"":" scale("+e(this.scaleX,k)+" "+e(this.scaleY,k)+")",d=0!==d?" skewX("+e(d,k)+")":"",e=0!==b?" skewY("+e(b,k)+")":"",b="path-group"===this.type?this.width:0,k="path-group"===this.type?this.height:0;return[a,c,f,this.flipX?" matrix(-1 0 0 1 "+b+" 0) ":"",this.flipY?" matrix(1 0 0 -1 0 "+k+")":"",d,e].join("")},getSvgTransformMatrix:function(){return this.transformMatrix?
" matrix("+this.transformMatrix.join(" ")+") ":""},_createBaseSVGMarkup:function(){var e=[];this.fill&&this.fill.toLive&&e.push(this.fill.toSVG(this,!1));this.stroke&&this.stroke.toLive&&e.push(this.stroke.toSVG(this,!1));this.shadow&&e.push(this.shadow.toSVG(this));return e}});g.util.object.extend(g.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(e){return this.get(e)!==this.originalState[e]},this)},saveState:function(e){this.stateProperties.forEach(function(c){this.originalState[c]=
this.get(c)},this);e&&e.stateProperties&&e.stateProperties.forEach(function(c){this.originalState[c]=this.get(c)},this);return this},setupState:function(){this.originalState={};this.saveState();return this}});(function(){var e=g.util.degreesToRadians;g.util.object.extend(g.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(c){if(!this.hasControls||!this.active)return!1;var d=c.x;c=c.y;var b;this.__corner=0;for(var a in this.oCoords)if(this.isControlVisible(a)&&("mtr"!==a||this.hasRotatingPoint)&&
(!this.get("lockUniScaling")||"mt"!==a&&"mr"!==a&&"mb"!==a&&"ml"!==a)&&(b=this._getImageLines(this.oCoords[a].corner),b=this._findCrossPoints({x:d,y:c},b),0!==b&&1===b%2))return this.__corner=a;return!1},_setCornerCoords:function(){var c=this.oCoords,d=e(45-this.angle),b=.707106*this.cornerSize,a=b*Math.cos(d),d=b*Math.sin(d),k,f;for(f in c)b=c[f].x,k=c[f].y,c[f].corner={tl:{x:b-d,y:k-a},tr:{x:b+a,y:k-d},bl:{x:b-a,y:k+d},br:{x:b+d,y:k+a}}},_getNonTransformedDimensions:function(){var c=this.strokeWidth,
d=this.width,b=this.height,a=!0,k=!0;"line"===this.type&&"butt"===this.strokeLineCap&&(k=d,a=b);k&&(b+=0>b?-c:c);a&&(d+=0>d?-c:c);return{x:d,y:b}},_getTransformedDimensions:function(c,d){"undefined"===typeof c&&(c=this.skewX);"undefined"===typeof d&&(d=this.skewY);for(var b=this._getNonTransformedDimensions(),a=b.x/2,b=b.y/2,a=[{x:-a,y:-b},{x:a,y:-b},{x:-a,y:b},{x:a,y:b}],k=this._calcDimensionsTransformMatrix(c,d,!1),b=0;b<a.length;b++)a[b]=g.util.transformPoint(a[b],k);a=g.util.makeBoundingBoxFromPoints(a);
return{x:a.width,y:a.height}},_calculateCurrentDimensions:function(){var c=this.getViewportTransform(),d=this._getTransformedDimensions(),b=d.x,d=d.y,b=b+2*this.padding,d=d+2*this.padding;return g.util.transformPoint(new g.Point(b,d),c,!0)},drawBorders:function(c){if(!this.hasBorders)return this;var d=this._calculateCurrentDimensions(),b=1/this.borderScaleFactor,a=d.x+b,d=d.y+b;c.save();c.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;c.strokeStyle=this.borderColor;c.lineWidth=b;c.strokeRect(-a/
2,-d/2,a,d);this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls&&(b=-d/2,c.beginPath(),c.moveTo(0,b),c.lineTo(0,b-this.rotatingPointOffset),c.closePath(),c.stroke());c.restore();return this},drawBordersInGroup:function(c,d){if(!this.hasBorders)return this;var b=this._getNonTransformedDimensions(),a=g.util.customTransformMatrix(d.scaleX,d.scaleY,d.skewX),k=g.util.transformPoint(b,a),b=1/this.borderScaleFactor,a=k.x+b+2*this.padding,k=k.y+b+2*this.padding;
c.save();c.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;c.strokeStyle=this.borderColor;c.lineWidth=b;c.strokeRect(-a/2,-k/2,a,k);c.restore();return this},drawControls:function(c){if(!this.hasControls)return this;var d=this._calculateCurrentDimensions(),b=d.x,d=d.y,a=this.cornerSize,k=-(b+a)/2,a=-(d+a)/2,f=this.transparentCorners?"strokeRect":"fillRect";c.save();c.lineWidth=1;c.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;c.strokeStyle=c.fillStyle=this.cornerColor;this._drawControl("tl",
c,f,k,a);this._drawControl("tr",c,f,k+b,a);this._drawControl("bl",c,f,k,a+d);this._drawControl("br",c,f,k+b,a+d);this.get("lockUniScaling")||(this._drawControl("mt",c,f,k+b/2,a),this._drawControl("mb",c,f,k+b/2,a+d),this._drawControl("mr",c,f,k+b,a+d/2),this._drawControl("ml",c,f,k,a+d/2));this.hasRotatingPoint&&this._drawControl("mtr",c,f,k+b/2,a-this.rotatingPointOffset);c.restore();return this},_drawControl:function(c,d,b,a,k){this.isControlVisible(c)&&(c=this.cornerSize,"undefined"!==typeof G_vmlCanvasManager||
this.transparentCorners||d.clearRect(a,k,c,c),d[b](a,k,c,c))},isControlVisible:function(c){return this._getControlsVisibility()[c]},setControlVisible:function(c,d){this._getControlsVisibility()[c]=d;return this},setControlsVisibility:function(c){c||(c={});for(var d in c)this.setControlVisible(d,c[d]);return this},_getControlsVisibility:function(){this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0});return this._controlsVisibility}})})();g.util.object.extend(g.StaticCanvas.prototype,
{FX_DURATION:500,fxCenterObjectH:function(e,c){c=c||{};var d=function(){},b=c.onComplete||d,a=c.onChange||d,k=this;g.util.animate({startValue:e.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(f){e.set("left",f);k.renderAll();a()},onComplete:function(){e.setCoords();b()}});return this},fxCenterObjectV:function(e,c){c=c||{};var d=function(){},b=c.onComplete||d,a=c.onChange||d,k=this;g.util.animate({startValue:e.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,
onChange:function(f){e.set("top",f);k.renderAll();a()},onComplete:function(){e.setCoords();b()}});return this},fxRemove:function(e,c){c=c||{};var d=function(){},b=c.onComplete||d,a=c.onChange||d,k=this;g.util.animate({startValue:e.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){e.set("active",!1)},onChange:function(f){e.set("opacity",f);k.renderAll();a()},onComplete:function(){k.remove(e);b()}});return this}});g.util.object.extend(g.Object.prototype,{animate:function(){if(arguments[0]&&
"object"===typeof arguments[0]){var e=[],c,d;for(c in arguments[0])e.push(c);for(var b=0,a=e.length;b<a;b++)c=e[b],d=b!==a-1,this._animate(c,arguments[0][c],arguments[1],d)}else this._animate.apply(this,arguments);return this},_animate:function(e,c,d,b){var a=this,k;c=c.toString();d=d?g.util.object.clone(d):{};~e.indexOf(".")&&(k=e.split("."));var f=k?this.get(k[0])[k[1]]:this.get(e);"from"in d||(d.from=f);c=~c.indexOf("=")?f+parseFloat(c.replace("=","")):parseFloat(c);g.util.animate({startValue:d.from,
endValue:c,byValue:d.by,easing:d.easing,duration:d.duration,abort:d.abort&&function(){return d.abort.call(a)},onChange:function(f){k?a[k[0]][k[1]]=f:a.set(e,f);b||d.onChange&&d.onChange()},onComplete:function(){b||(a.setCoords(),d.onComplete&&d.onComplete())}})}});(function(e){function c(a,h){var b=a.origin,c=a.axis1,k=a.axis2,d=a.dimension,e=h.nearest,g=h.center,E=h.farthest;return function(){switch(this.get(b)){case e:return Math.min(this.get(c),this.get(k));case g:return Math.min(this.get(c),this.get(k))+
.5*this.get(d);case E:return Math.max(this.get(c),this.get(k))}}}var d=e.fabric||(e.fabric={}),b=d.util.object.extend,a={x1:1,x2:1,y1:1,y2:1},k=d.StaticCanvas.supports("setLineDash");d.Line?d.warn("fabric.Line is already defined"):(d.Line=d.util.createClass(d.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(a,h){h=h||{};a||(a=[0,0,0,0]);this.callSuper("initialize",h);this.set("x1",a[0]);this.set("y1",a[1]);this.set("x2",a[2]);this.set("y2",a[3]);this._setWidthHeight(h)},_setWidthHeight:function(a){a||
(a={});this.width=Math.abs(this.x2-this.x1);this.height=Math.abs(this.y2-this.y1);this.left="left"in a?a.left:this._getLeftToOriginX();this.top="top"in a?a.top:this._getTopToOriginY()},_set:function(f,h){this.callSuper("_set",f,h);"undefined"!==typeof a[f]&&this._setWidthHeight();return this},_getLeftToOriginX:c({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:c({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},
{nearest:"top",center:"center",farthest:"bottom"}),_render:function(a,h){a.beginPath();if(h){var b=this.getCenterPoint();a.translate(b.x-this.strokeWidth/2,b.y-this.strokeWidth/2)}if(!this.strokeDashArray||this.strokeDashArray&&k)b=this.calcLinePoints(),a.moveTo(b.x1,b.y1),a.lineTo(b.x2,b.y2);a.lineWidth=this.strokeWidth;b=a.strokeStyle;a.strokeStyle=this.stroke||a.fillStyle;this.stroke&&this._renderStroke(a);a.strokeStyle=b},_renderDashedStroke:function(a){var h=this.calcLinePoints();a.beginPath();
d.util.drawDashedLine(a,h.x1,h.y1,h.x2,h.y2,this.strokeDashArray);a.closePath()},toObject:function(a){return b(this.callSuper("toObject",a),this.calcLinePoints())},calcLinePoints:function(){var a=this.x1<=this.x2?-1:1,h=this.y1<=this.y2?-1:1;return{x1:a*this.width*.5,x2:a*this.width*-.5,y1:h*this.height*.5,y2:h*this.height*-.5}},toSVG:function(a){var h=this._createBaseSVGMarkup(),b={x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};this.group&&"path-group"===this.group.type||(b=this.calcLinePoints());
h.push("<line ",'x1="',b.x1,'" y1="',b.y1,'" x2="',b.x2,'" y2="',b.y2,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return a?a(h.join("")):h.join("")},complexity:function(){return 1}}),d.Line.ATTRIBUTE_NAMES=d.SHARED_ATTRIBUTES.concat(["x1","y1","x2","y2"]),d.Line.fromElement=function(a,h){var c=d.parseAttributes(a,d.Line.ATTRIBUTE_NAMES);return new d.Line([c.x1||0,c.y1||0,c.x2||0,c.y2||0],b(c,h))},d.Line.fromObject=function(a){return new d.Line([a.x1,
a.y1,a.x2,a.y2],a)})})("undefined"!==typeof n?n:this);(function(e){var c=e.fabric||(e.fabric={}),d=Math.PI,b=c.util.object.extend;c.Circle?c.warn("fabric.Circle is already defined."):(c.Circle=c.util.createClass(c.Object,{type:"circle",radius:0,startAngle:0,endAngle:2*d,initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("radius",a.radius||0);this.startAngle=a.startAngle||this.startAngle;this.endAngle=a.endAngle||this.endAngle},_set:function(a,b){this.callSuper("_set",a,b);"radius"===
a&&this.setRadius(b);return this},toObject:function(a){return b(this.callSuper("toObject",a),{radius:this.get("radius"),startAngle:this.startAngle,endAngle:this.endAngle})},toSVG:function(a){var b=this._createBaseSVGMarkup(),f=0,h=0,c=(this.endAngle-this.startAngle)%(2*d);if(0===c)this.group&&"path-group"===this.group.type&&(f=this.left+this.radius,h=this.top+this.radius),b.push("<circle ",'cx="'+f+'" cy="'+h+'" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),
" ",this.getSvgTransformMatrix(),'"/>\n');else{var f=Math.cos(this.startAngle)*this.radius,h=Math.sin(this.startAngle)*this.radius,e=Math.cos(this.endAngle)*this.radius,g=Math.sin(this.endAngle)*this.radius;b.push('<path d="M '+f+" "+h," A "+this.radius+" "+this.radius," 0 ",+(c>d?1:0)+" 1"," "+e+" "+g,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n')}return a?a(b.join("")):b.join("")},_render:function(a,b){a.beginPath();a.arc(b?this.left+
this.radius:0,b?this.top+this.radius:0,this.radius,this.startAngle,this.endAngle,!1);this._renderFill(a);this._renderStroke(a)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(a){this.radius=a;return this.set("width",2*a).set("height",2*a)},complexity:function(){return 1}}),c.Circle.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(["cx","cy","r"]),c.Circle.fromElement=function(a,k){k||(k={});var f=
c.parseAttributes(a,c.Circle.ATTRIBUTE_NAMES);if(!("radius"in f&&0<=f.radius))throw Error("value of `r` attribute is required and can not be negative");f.left=f.left||0;f.top=f.top||0;f=new c.Circle(b(f,k));f.left-=f.radius;f.top-=f.radius;return f},c.Circle.fromObject=function(a){return new c.Circle(a)})})("undefined"!==typeof n?n:this);(function(e){var c=e.fabric||(e.fabric={});c.Triangle?c.warn("fabric.Triangle is already defined"):(c.Triangle=c.util.createClass(c.Object,{type:"triangle",initialize:function(c){c=
c||{};this.callSuper("initialize",c);this.set("width",c.width||100).set("height",c.height||100)},_render:function(c){var b=this.width/2,a=this.height/2;c.beginPath();c.moveTo(-b,a);c.lineTo(0,-a);c.lineTo(b,a);c.closePath();this._renderFill(c);this._renderStroke(c)},_renderDashedStroke:function(d){var b=this.width/2,a=this.height/2;d.beginPath();c.util.drawDashedLine(d,-b,a,0,-a,this.strokeDashArray);c.util.drawDashedLine(d,0,-a,b,a,this.strokeDashArray);c.util.drawDashedLine(d,b,a,-b,a,this.strokeDashArray);
d.closePath()},toSVG:function(c){var b=this._createBaseSVGMarkup(),a=this.width/2,k=this.height/2,a=[-a+" "+k,"0 "+-k,a+" "+k].join();b.push("<polygon ",'points="',a,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return c?c(b.join("")):b.join("")},complexity:function(){return 1}}),c.Triangle.fromObject=function(d){return new c.Triangle(d)})})("undefined"!==typeof n?n:this);(function(e){var c=e.fabric||(e.fabric={}),d=2*Math.PI,b=c.util.object.extend;c.Ellipse?c.warn("fabric.Ellipse is already defined."):
(c.Ellipse=c.util.createClass(c.Object,{type:"ellipse",rx:0,ry:0,initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("rx",a.rx||0);this.set("ry",a.ry||0)},_set:function(a,b){this.callSuper("_set",a,b);switch(a){case "rx":this.rx=b;this.set("width",2*b);break;case "ry":this.ry=b,this.set("height",2*b)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(a){return b(this.callSuper("toObject",
a),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(a){var b=this._createBaseSVGMarkup(),f=0,h=0;this.group&&"path-group"===this.group.type&&(f=this.left+this.rx,h=this.top+this.ry);b.push("<ellipse ",'cx="',f,'" cy="',h,'" ','rx="',this.rx,'" ry="',this.ry,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return a?a(b.join("")):b.join("")},_render:function(a,b){a.beginPath();a.save();a.transform(1,0,0,this.ry/this.rx,0,0);a.arc(b?this.left+
this.rx:0,b?(this.top+this.ry)*this.rx/this.ry:0,this.rx,0,d,!1);a.restore();this._renderFill(a);this._renderStroke(a)},complexity:function(){return 1}}),c.Ellipse.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(["cx","cy","rx","ry"]),c.Ellipse.fromElement=function(a,k){k||(k={});var f=c.parseAttributes(a,c.Ellipse.ATTRIBUTE_NAMES);f.left=f.left||0;f.top=f.top||0;f=new c.Ellipse(b(f,k));f.top-=f.ry;f.left-=f.rx;return f},c.Ellipse.fromObject=function(a){return new c.Ellipse(a)})})("undefined"!==typeof n?
n:this);(function(e){var c=e.fabric||(e.fabric={}),d=c.util.object.extend;c.Rect?c.warn("fabric.Rect is already defined"):(e=c.Object.prototype.stateProperties.concat(),e.push("rx","ry","x","y"),c.Rect=c.util.createClass(c.Object,{stateProperties:e,type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(b){b=b||{};this.callSuper("initialize",b);this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(b,a){if(1===this.width&&
1===this.height)b.fillRect(-.5,-.5,1,1);else{var c=this.rx?Math.min(this.rx,this.width/2):0,f=this.ry?Math.min(this.ry,this.height/2):0,h=this.width,d=this.height,e=a?this.left:-this.width/2,g=a?this.top:-this.height/2,r=0!==c||0!==f;b.beginPath();b.moveTo(e+c,g);b.lineTo(e+h-c,g);r&&b.bezierCurveTo(e+h-.4477152502*c,g,e+h,g+.4477152502*f,e+h,g+f);b.lineTo(e+h,g+d-f);r&&b.bezierCurveTo(e+h,g+d-.4477152502*f,e+h-.4477152502*c,g+d,e+h-c,g+d);b.lineTo(e+c,g+d);r&&b.bezierCurveTo(e+.4477152502*c,g+d,
e,g+d-.4477152502*f,e,g+d-f);b.lineTo(e,g+f);r&&b.bezierCurveTo(e,g+.4477152502*f,e+.4477152502*c,g,e+c,g);b.closePath();this._renderFill(b);this._renderStroke(b)}},_renderDashedStroke:function(b){var a=-this.width/2,k=-this.height/2,f=this.width,h=this.height;b.beginPath();c.util.drawDashedLine(b,a,k,a+f,k,this.strokeDashArray);c.util.drawDashedLine(b,a+f,k,a+f,k+h,this.strokeDashArray);c.util.drawDashedLine(b,a+f,k+h,a,k+h,this.strokeDashArray);c.util.drawDashedLine(b,a,k+h,a,k,this.strokeDashArray);
b.closePath()},toObject:function(b){b=d(this.callSuper("toObject",b),{rx:this.get("rx")||0,ry:this.get("ry")||0});this.includeDefaultValues||this._removeDefaultValues(b);return b},toSVG:function(b){var a=this._createBaseSVGMarkup(),c=this.left,f=this.top;this.group&&"path-group"===this.group.type||(c=-this.width/2,f=-this.height/2);a.push("<rect ",'x="',c,'" y="',f,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',
this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return b?b(a.join("")):a.join("")},complexity:function(){return 1}}),c.Rect.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),c.Rect.fromElement=function(b,a){if(!b)return null;a=a||{};var k=c.parseAttributes(b,c.Rect.ATTRIBUTE_NAMES);k.left=k.left||0;k.top=k.top||0;k=new c.Rect(d(a?c.util.object.clone(a):{},k));k.visible=0<k.width&&0<k.height;return k},c.Rect.fromObject=function(b){return new c.Rect(b)})})("undefined"!==
typeof n?n:this);(function(e){var c=e.fabric||(e.fabric={});c.Polyline?c.warn("fabric.Polyline is already defined"):(c.Polyline=c.util.createClass(c.Object,{type:"polyline",points:null,minX:0,minY:0,initialize:function(d,b){return c.Polygon.prototype.initialize.call(this,d,b)},_calcDimensions:function(){return c.Polygon.prototype._calcDimensions.call(this)},_applyPointOffset:function(){return c.Polygon.prototype._applyPointOffset.call(this)},toObject:function(d){return c.Polygon.prototype.toObject.call(this,
d)},toSVG:function(d){return c.Polygon.prototype.toSVG.call(this,d)},_render:function(d){c.Polygon.prototype.commonRender.call(this,d)&&(this._renderFill(d),this._renderStroke(d))},_renderDashedStroke:function(d){var b,a;d.beginPath();for(var k=0,f=this.points.length;k<f;k++)b=this.points[k],a=this.points[k+1]||b,c.util.drawDashedLine(d,b.x,b.y,a.x,a.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),c.Polyline.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(),c.Polyline.fromElement=
function(d,b){if(!d)return null;b||(b={});var a=c.parsePointsAttribute(d.getAttribute("points")),k=c.parseAttributes(d,c.Polyline.ATTRIBUTE_NAMES);return new c.Polyline(a,c.util.object.extend(k,b))},c.Polyline.fromObject=function(d){return new c.Polyline(d.points,d,!0)})})("undefined"!==typeof n?n:this);(function(e){var c=e.fabric||(e.fabric={}),d=c.util.object.extend,b=c.util.array.min,a=c.util.array.max,k=c.util.toFixed;c.Polygon?c.warn("fabric.Polygon is already defined"):(c.Polygon=c.util.createClass(c.Object,
{type:"polygon",points:null,minX:0,minY:0,initialize:function(a,h){h=h||{};this.points=a||[];this.callSuper("initialize",h);this._calcDimensions();"top"in h||(this.top=this.minY);"left"in h||(this.left=this.minX);this.pathOffset={x:this.minX+this.width/2,y:this.minY+this.height/2}},_calcDimensions:function(){var f=this.points,h=b(f,"x"),c=b(f,"y"),k=a(f,"x"),f=a(f,"y");this.width=k-h||0;this.height=f-c||0;this.minX=h||0;this.minY=c||0},toObject:function(a){return d(this.callSuper("toObject",a),{points:this.points.concat()})},
toSVG:function(a){for(var h=[],b,c=this._createBaseSVGMarkup(),d=0,e=this.points.length;d<e;d++)h.push(k(this.points[d].x,2),",",k(this.points[d].y,2)," ");this.group&&"path-group"===this.group.type||(b=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") ");c.push("<",this.type," ",'points="',h.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),b," ",this.getSvgTransformMatrix(),'"/>\n');return a?a(c.join("")):c.join("")},_render:function(a,h){this.commonRender(a,
h)&&(this._renderFill(a),this.stroke||this.strokeDashArray)&&(a.closePath(),this._renderStroke(a))},commonRender:function(a,h){var b,c=this.points.length;if(!c||isNaN(this.points[c-1].y))return!1;h||a.translate(-this.pathOffset.x,-this.pathOffset.y);a.beginPath();a.moveTo(this.points[0].x,this.points[0].y);for(var k=0;k<c;k++)b=this.points[k],a.lineTo(b.x,b.y);return!0},_renderDashedStroke:function(a){c.Polyline.prototype._renderDashedStroke.call(this,a);a.closePath()},complexity:function(){return this.points.length}}),
c.Polygon.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(),c.Polygon.fromElement=function(a,h){if(!a)return null;h||(h={});var b=c.parsePointsAttribute(a.getAttribute("points")),k=c.parseAttributes(a,c.Polygon.ATTRIBUTE_NAMES);return new c.Polygon(b,d(k,h))},c.Polygon.fromObject=function(a){return new c.Polygon(a.points,a,!0)})})("undefined"!==typeof n?n:this);(function(e){var c=e.fabric||(e.fabric={}),d=c.util.array.min,b=c.util.array.max,a=c.util.object.extend,k=Object.prototype.toString,f=c.util.drawArc,
h={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},q={m:"l",M:"L"};c.Path?c.warn("fabric.Path is already defined"):(c.Path=c.util.createClass(c.Object,{type:"path",path:null,minX:0,minY:0,initialize:function(a,f){f=f||{};this.setOptions(f);a||(a=[]);var h="[object Array]"===k.call(a);if(this.path=h?a:a.match&&a.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi))h||(this.path=this._parsePath()),this._setPositionDimensions(f),f.sourcePath&&this.setSourcePath(f.sourcePath)},_setPositionDimensions:function(a){var f=this._parseDimensions();
this.minX=f.left;this.minY=f.top;this.width=f.width;this.height=f.height;"undefined"===typeof a.left&&(this.left=f.left+("center"===this.originX?this.width/2:"right"===this.originX?this.width:0));"undefined"===typeof a.top&&(this.top=f.top+("center"===this.originY?this.height/2:"bottom"===this.originY?this.height:0));this.pathOffset=this.pathOffset||{x:this.minX+this.width/2,y:this.minY+this.height/2}},_render:function(a){var h,b=null,c=0,k=0,d=0,q=0,e=0,g=0,I,l,n=-this.pathOffset.x,w=-this.pathOffset.y;
this.group&&"path-group"===this.group.type&&(w=n=0);a.beginPath();for(var C=0,A=this.path.length;C<A;++C){h=this.path[C];switch(h[0]){case "l":d+=h[1];q+=h[2];a.lineTo(d+n,q+w);break;case "L":d=h[1];q=h[2];a.lineTo(d+n,q+w);break;case "h":d+=h[1];a.lineTo(d+n,q+w);break;case "H":d=h[1];a.lineTo(d+n,q+w);break;case "v":q+=h[1];a.lineTo(d+n,q+w);break;case "V":q=h[1];a.lineTo(d+n,q+w);break;case "m":d+=h[1];q+=h[2];c=d;k=q;a.moveTo(d+n,q+w);break;case "M":d=h[1];q=h[2];c=d;k=q;a.moveTo(d+n,q+w);break;
case "c":I=d+h[5];l=q+h[6];e=d+h[3];g=q+h[4];a.bezierCurveTo(d+h[1]+n,q+h[2]+w,e+n,g+w,I+n,l+w);d=I;q=l;break;case "C":d=h[5];q=h[6];e=h[3];g=h[4];a.bezierCurveTo(h[1]+n,h[2]+w,e+n,g+w,d+n,q+w);break;case "s":I=d+h[3];l=q+h[4];null===b[0].match(/[CcSs]/)?(e=d,g=q):(e=2*d-e,g=2*q-g);a.bezierCurveTo(e+n,g+w,d+h[1]+n,q+h[2]+w,I+n,l+w);e=d+h[1];g=q+h[2];d=I;q=l;break;case "S":I=h[3];l=h[4];null===b[0].match(/[CcSs]/)?(e=d,g=q):(e=2*d-e,g=2*q-g);a.bezierCurveTo(e+n,g+w,h[1]+n,h[2]+w,I+n,l+w);d=I;q=l;e=
h[1];g=h[2];break;case "q":I=d+h[3];l=q+h[4];e=d+h[1];g=q+h[2];a.quadraticCurveTo(e+n,g+w,I+n,l+w);d=I;q=l;break;case "Q":I=h[3];l=h[4];a.quadraticCurveTo(h[1]+n,h[2]+w,I+n,l+w);d=I;q=l;e=h[1];g=h[2];break;case "t":I=d+h[1];l=q+h[2];null===b[0].match(/[QqTt]/)?(e=d,g=q):(e=2*d-e,g=2*q-g);a.quadraticCurveTo(e+n,g+w,I+n,l+w);d=I;q=l;break;case "T":I=h[1];l=h[2];null===b[0].match(/[QqTt]/)?(e=d,g=q):(e=2*d-e,g=2*q-g);a.quadraticCurveTo(e+n,g+w,I+n,l+w);d=I;q=l;break;case "a":f(a,d+n,q+w,[h[1],h[2],h[3],
h[4],h[5],h[6]+d+n,h[7]+q+w]);d+=h[6];q+=h[7];break;case "A":f(a,d+n,q+w,[h[1],h[2],h[3],h[4],h[5],h[6]+n,h[7]+w]);d=h[6];q=h[7];break;case "z":case "Z":d=c,q=k,a.closePath()}b=h}this._renderFill(a);this._renderStroke(a)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(f){f=a(this.callSuper("toObject",f),{path:this.path.map(function(a){return a.slice()}),pathOffset:this.pathOffset});this.sourcePath&&(f.sourcePath=
this.sourcePath);this.transformMatrix&&(f.transformMatrix=this.transformMatrix);return f},toDatalessObject:function(a){a=this.toObject(a);this.sourcePath&&(a.path=this.sourcePath);delete a.sourcePath;return a},toSVG:function(a){for(var f=[],h=this._createBaseSVGMarkup(),b="",c=0,k=this.path.length;c<k;c++)f.push(this.path[c].join(" "));f=f.join(" ");this.group&&"path-group"===this.group.type||(b=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") ");h.push("<path ",'d="',f,'" style="',this.getSvgStyles(),
'" transform="',this.getSvgTransform(),b,this.getSvgTransformMatrix(),'" stroke-linecap="round" ',"/>\n");return a?a(h.join("")):h.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var a=[],f=[],b,c,k=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/ig,d,e=0,g=this.path.length;e<g;e++){b=this.path[e];d=b.slice(1).trim();for(f.length=0;c=k.exec(d);)f.push(c[0]);b=[b.charAt(0)];d=0;for(var H=f.length;d<H;d++)c=parseFloat(f[d]),isNaN(c)||b.push(c);c=b[0];d=h[c.toLowerCase()];
H=q[c]||c;if(b.length-1>d)for(var I=1,l=b.length;I<l;I+=d)a.push([c].concat(b.slice(I,I+d))),c=H;else a.push(b)}return a},_parseDimensions:function(){for(var a=[],f=[],h,k=null,q=0,e=0,g=0,x=0,H=0,I=0,l,n,w,C=0,A=this.path.length;C<A;++C){h=this.path[C];switch(h[0]){case "l":g+=h[1];x+=h[2];w=[];break;case "L":g=h[1];x=h[2];w=[];break;case "h":g+=h[1];w=[];break;case "H":g=h[1];w=[];break;case "v":x+=h[1];w=[];break;case "V":x=h[1];w=[];break;case "m":g+=h[1];x+=h[2];q=g;e=x;w=[];break;case "M":g=
h[1];x=h[2];q=g;e=x;w=[];break;case "c":l=g+h[5];n=x+h[6];H=g+h[3];I=x+h[4];w=c.util.getBoundsOfCurve(g,x,g+h[1],x+h[2],H,I,l,n);g=l;x=n;break;case "C":g=h[5];x=h[6];H=h[3];I=h[4];w=c.util.getBoundsOfCurve(g,x,h[1],h[2],H,I,g,x);break;case "s":l=g+h[3];n=x+h[4];null===k[0].match(/[CcSs]/)?(H=g,I=x):(H=2*g-H,I=2*x-I);w=c.util.getBoundsOfCurve(g,x,H,I,g+h[1],x+h[2],l,n);H=g+h[1];I=x+h[2];g=l;x=n;break;case "S":l=h[3];n=h[4];null===k[0].match(/[CcSs]/)?(H=g,I=x):(H=2*g-H,I=2*x-I);w=c.util.getBoundsOfCurve(g,
x,H,I,h[1],h[2],l,n);g=l;x=n;H=h[1];I=h[2];break;case "q":l=g+h[3];n=x+h[4];H=g+h[1];I=x+h[2];w=c.util.getBoundsOfCurve(g,x,H,I,H,I,l,n);g=l;x=n;break;case "Q":H=h[1];I=h[2];w=c.util.getBoundsOfCurve(g,x,H,I,H,I,h[3],h[4]);g=h[3];x=h[4];break;case "t":l=g+h[1];n=x+h[2];null===k[0].match(/[QqTt]/)?(H=g,I=x):(H=2*g-H,I=2*x-I);w=c.util.getBoundsOfCurve(g,x,H,I,H,I,l,n);g=l;x=n;break;case "T":l=h[1];n=h[2];null===k[0].match(/[QqTt]/)?(H=g,I=x):(H=2*g-H,I=2*x-I);w=c.util.getBoundsOfCurve(g,x,H,I,H,I,l,
n);g=l;x=n;break;case "a":w=c.util.getBoundsOfArc(g,x,h[1],h[2],h[3],h[4],h[5],h[6]+g,h[7]+x);g+=h[6];x+=h[7];break;case "A":w=c.util.getBoundsOfArc(g,x,h[1],h[2],h[3],h[4],h[5],h[6],h[7]);g=h[6];x=h[7];break;case "z":case "Z":g=q,x=e}k=h;w.forEach(function(h){a.push(h.x);f.push(h.y)});a.push(g);f.push(x)}h=d(a)||0;k=d(f)||0;q=b(a)||0;e=b(f)||0;return{left:h,top:k,width:q-h,height:e-k}}}),c.Path.fromObject=function(a,f){"string"===typeof a.path?c.loadSVGFromURL(a.path,function(h){h=h[0];var b=a.path;
delete a.path;c.util.object.extend(h,a);h.setSourcePath(b);f(h)}):f(new c.Path(a.path,a))},c.Path.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(["d"]),c.Path.fromElement=function(f,h,b){f=c.parseAttributes(f,c.Path.ATTRIBUTE_NAMES);h&&h(new c.Path(f.d,a(f,b)))},c.Path.async=!0)})("undefined"!==typeof n?n:this);(function(e){var c=e.fabric||(e.fabric={}),d=c.util.object.extend,b=c.util.array.invoke,a=c.Object.prototype.toObject;c.PathGroup?c.warn("fabric.PathGroup is already defined"):(c.PathGroup=c.util.createClass(c.Path,
{type:"path-group",fill:"",initialize:function(a,f){f=f||{};this.paths=a||[];for(var h=this.paths.length;h--;)this.paths[h].group=this;f.toBeParsed&&(this.parseDimensionsFromPaths(f),delete f.toBeParsed);this.setOptions(f);this.setCoords();f.sourcePath&&this.setSourcePath(f.sourcePath)},parseDimensionsFromPaths:function(a){for(var f,h,b=[],d=[],e,g=this.paths.length;g--;){f=this.paths[g];h=f.height+f.strokeWidth;e=f.width+f.strokeWidth;f=[{x:f.left,y:f.top},{x:f.left+e,y:f.top},{x:f.left,y:f.top+
h},{x:f.left+e,y:f.top+h}];e=this.paths[g].transformMatrix;for(var m=0;m<f.length;m++)h=f[m],e&&(h=c.util.transformPoint(h,e,!1)),b.push(h.x),d.push(h.y)}a.width=Math.max.apply(null,b);a.height=Math.max.apply(null,d)},render:function(a){if(this.visible){a.save();this.transformMatrix&&a.transform.apply(a,this.transformMatrix);this.transform(a);this._setShadow(a);this.clipTo&&c.util.clipContext(this,a);a.translate(-this.width/2,-this.height/2);for(var f=0,h=this.paths.length;f<h;++f)this.paths[f].render(a,
!0);this.clipTo&&a.restore();a.restore()}},_set:function(a,f){if("fill"===a&&f&&this.isSameColor())for(var h=this.paths.length;h--;)this.paths[h]._set(a,f);return this.callSuper("_set",a,f)},toObject:function(c){c=d(a.call(this,c),{paths:b(this.getObjects(),"toObject",c)});this.sourcePath&&(c.sourcePath=this.sourcePath);return c},toDatalessObject:function(a){a=this.toObject(a);this.sourcePath&&(a.paths=this.sourcePath);return a},toSVG:function(a){var f=this.getObjects(),h=this.getPointByOrigin("left",
"top"),b="translate("+h.x+" "+h.y+")",h=this._createBaseSVGMarkup();h.push("<g ",'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransformMatrix(),b,this.getSvgTransform(),'" ',">\n");for(var b=0,c=f.length;b<c;b++)h.push("\t",f[b].toSVG(a));h.push("</g>\n");return a?a(h.join("")):h.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var a=this.getObjects()[0].get("fill")||"";if("string"!==
typeof a)return!1;a=a.toLowerCase();return this.getObjects().every(function(f){f=f.get("fill")||"";return"string"===typeof f&&f.toLowerCase()===a})},complexity:function(){return this.paths.reduce(function(a,f){return a+(f&&f.complexity?f.complexity():0)},0)},getObjects:function(){return this.paths}}),c.PathGroup.fromObject=function(a,f){"string"===typeof a.paths?c.loadSVGFromURL(a.paths,function(h){var b=a.paths;delete a.paths;h=c.util.groupSVGElements(h,a,b);f(h)}):c.util.enlivenObjects(a.paths,
function(h){delete a.paths;f(new c.PathGroup(h,a))})},c.PathGroup.async=!0)})("undefined"!==typeof n?n:this);(function(e){var c=e.fabric||(e.fabric={}),d=c.util.object.extend,b=c.util.array.min,a=c.util.array.max,k=c.util.array.invoke;if(!c.Group){var f={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};c.Group=c.util.createClass(c.Object,c.Collection,{type:"group",strokeWidth:0,initialize:function(a,f,b){f=f||{};this._objects=[];b&&this.callSuper("initialize",
f);this._objects=a||[];for(a=this._objects.length;a--;)this._objects[a].group=this;this.originalState={};f.originX&&(this.originX=f.originX);f.originY&&(this.originY=f.originY);b?this._updateObjectsCoords(!0):(this._calcBounds(),this._updateObjectsCoords(),this.callSuper("initialize",f));this.setCoords();this.saveCoords()},_updateObjectsCoords:function(a){for(var f=this._objects.length;f--;)this._updateObjectCoords(this._objects[f],a)},_updateObjectCoords:function(a,f){a.__origHasControls=a.hasControls;
a.hasControls=!1;if(!f){var b=a.getLeft(),c=a.getTop(),k=this.getCenterPoint();a.set({originalLeft:b,originalTop:c,left:b-k.x,top:c-k.y});a.setCoords()}},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(a){this._restoreObjectsState();c.util.resetObjectTransform(this);a&&(this._objects.push(a),a.group=this,a._set("canvas",this.canvas));this.forEachObject(this._setObjectActive,this);this._calcBounds();this._updateObjectsCoords();return this},_setObjectActive:function(a){a.set("active",
!0);a.group=this},removeWithUpdate:function(a){this._restoreObjectsState();c.util.resetObjectTransform(this);this.forEachObject(this._setObjectActive,this);this.remove(a);this._calcBounds();this._updateObjectsCoords();return this},_onObjectAdded:function(a){a.group=this;a._set("canvas",this.canvas)},_onObjectRemoved:function(a){delete a.group;a.set("active",!1)},delegatedProperties:{fill:!0,stroke:!0,strokeWidth:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,
textAlign:!0,backgroundColor:!0},_set:function(a,f){var b=this._objects.length;if(this.delegatedProperties[a]||"canvas"===a)for(;b--;)this._objects[b].set(a,f);else for(;b--;)this._objects[b].setOnGroup(a,f);this.callSuper("_set",a,f)},toObject:function(a){return d(this.callSuper("toObject",a),{objects:k(this._objects,"toObject",a)})},render:function(a){if(this.visible){a.save();this.transformMatrix&&a.transform.apply(a,this.transformMatrix);this.transform(a);this._setShadow(a);this.clipTo&&c.util.clipContext(this,
a);for(var f=0,b=this._objects.length;f<b;f++)this._renderObject(this._objects[f],a);this.clipTo&&a.restore();a.restore()}},_renderControls:function(a,f){this.callSuper("_renderControls",a,f);for(var b=0,c=this._objects.length;b<c;b++)this._objects[b]._renderControls(a)},_renderObject:function(a,f){if(a.visible){var b=a.hasRotatingPoint;a.hasRotatingPoint=!1;a.render(f);a.hasRotatingPoint=b}},_restoreObjectsState:function(){this._objects.forEach(this._restoreObjectState,this);return this},realizeTransform:function(a){var f=
a.calcTransformMatrix(),f=c.util.qrDecompose(f),b=new c.Point(f.translateX,f.translateY);a.scaleX=f.scaleX;a.scaleY=f.scaleY;a.skewX=f.skewX;a.skewY=f.skewY;a.angle=f.angle;a.flipX=!1;a.flipY=!1;a.setPositionByOrigin(b,"center","center");return a},_restoreObjectState:function(a){this.realizeTransform(a);a.setCoords();a.hasControls=a.__origHasControls;delete a.__origHasControls;a.set("active",!1);delete a.group;return this},destroy:function(){return this._restoreObjectsState()},saveCoords:function(){this._originalLeft=
this.get("left");this._originalTop=this.get("top");return this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){this.forEachObject(function(a){a.setCoords()});return this},_calcBounds:function(a){for(var f=[],b=[],c,k,d=["tr","br","bl","tl"],e=0,g=this._objects.length,D,x=d.length;e<g;++e)for(c=this._objects[e],c.setCoords(),D=0;D<x;D++)k=d[D],f.push(c.oCoords[k].x),b.push(c.oCoords[k].y);this.set(this._getBounds(f,
b,a))},_getBounds:function(f,k,d){var e=c.util.invertTransform(this.getViewportTransform()),g=c.util.transformPoint(new c.Point(b(f),b(k)),e);f=c.util.transformPoint(new c.Point(a(f),a(k)),e);f={width:f.x-g.x||0,height:f.y-g.y||0};d||(f.left=g.x||0,f.top=g.y||0,"center"===this.originX&&(f.left+=f.width/2),"right"===this.originX&&(f.left+=f.width),"center"===this.originY&&(f.top+=f.height/2),"bottom"===this.originY&&(f.top+=f.height));return f},toSVG:function(a){var f=this._createBaseSVGMarkup();f.push('<g transform="',
this.getSvgTransform(),this.getSvgTransformMatrix(),'" style="',this.getSvgFilter(),'">\n');for(var b=0,c=this._objects.length;b<c;b++)f.push("\t",this._objects[b].toSVG(a));f.push("</g>\n");return a?a(f.join("")):f.join("")},get:function(a){if(a in f){if(this[a])return this[a];for(var b=0,c=this._objects.length;b<c;b++)if(this._objects[b][a])return!0;return!1}return a in this.delegatedProperties?this._objects[0]&&this._objects[0].get(a):this[a]}});c.Group.fromObject=function(a,f){c.util.enlivenObjects(a.objects,
function(b){delete a.objects;f&&f(new c.Group(b,a,!0))})};c.Group.async=!0}})("undefined"!==typeof n?n:this);(function(e){var c=g.util.object.extend;e.fabric||(e.fabric={});e.fabric.Image?g.warn("fabric.Image is already defined."):(g.Image=g.util.createClass(g.Object,{type:"image",crossOrigin:"",alignX:"none",alignY:"none",meetOrSlice:"meet",strokeWidth:0,_lastScaleX:1,_lastScaleY:1,initialize:function(c,b){b||(b={});this.filters=[];this.resizeFilters=[];this.callSuper("initialize",b);this._initElement(c,
b)},getElement:function(){return this._element},setElement:function(c,b,a){this._originalElement=this._element=c;this._initConfig(a);0!==this.filters.length?this.applyFilters(b):b&&b();return this},setCrossOrigin:function(c){this.crossOrigin=c;this._element.crossOrigin=c;return this},getOriginalSize:function(){var c=this.getElement();return{width:c.width,height:c.height}},_stroke:function(c){c.save();this._setStrokeStyles(c);c.beginPath();c.strokeRect(-this.width/2,-this.height/2,this.width,this.height);
c.closePath();c.restore()},_renderDashedStroke:function(c){var b=-this.width/2,a=-this.height/2,k=this.width,f=this.height;c.save();this._setStrokeStyles(c);c.beginPath();g.util.drawDashedLine(c,b,a,b+k,a,this.strokeDashArray);g.util.drawDashedLine(c,b+k,a,b+k,a+f,this.strokeDashArray);g.util.drawDashedLine(c,b+k,a+f,b,a+f,this.strokeDashArray);g.util.drawDashedLine(c,b,a+f,b,a,this.strokeDashArray);c.closePath();c.restore()},toObject:function(d){var b=[];this.filters.forEach(function(a){a&&b.push(a.toObject())});
d=c(this.callSuper("toObject",d),{src:this._originalElement.src||this._originalElement._src,filters:b,crossOrigin:this.crossOrigin,alignX:this.alignX,alignY:this.alignY,meetOrSlice:this.meetOrSlice});0<this.resizeFilters.length&&(d.resizeFilters=this.resizeFilters.map(function(a){return a&&a.toObject()}));this.includeDefaultValues||this._removeDefaultValues(d);return d},toSVG:function(c){var b=this._createBaseSVGMarkup(),a=-this.width/2,k=-this.height/2,f="none";this.group&&"path-group"===this.group.type&&
(a=this.left,k=this.top);"none"!==this.alignX&&"none"!==this.alignY&&(f="x"+this.alignX+"Y"+this.alignY+" "+this.meetOrSlice);b.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n','<image xlink:href="',this.getSvgSrc(),'" x="',a,'" y="',k,'" style="',this.getSvgStyles(),'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="',f,'"',"></image>\n");if(this.stroke||this.strokeDashArray)f=this.fill,this.fill=null,b.push("<rect ",'x="',a,'" y="',k,'" width="',
this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'),this.fill=f;b.push("</g>\n");return c?c(b.join("")):b.join("")},getSrc:function(){if(this.getElement())return this.getElement().src||this.getElement()._src},setSrc:function(c,b,a){g.util.loadImage(c,function(c){return this.setElement(c,b,a)},this,a&&a.crossOrigin)},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(c,b){this.constructor.fromObject(this.toObject(b),c)},applyFilters:function(c,
b,a,k){b=b||this.filters;if(a=a||this._originalElement){var f=a,h=g.util.createCanvasElement(),q=g.util.createImage(),e=this;h.width=f.width;h.height=f.height;h.getContext("2d").drawImage(f,0,0,f.width,f.height);if(0===b.length)return this._element=a,c&&c(),h;b.forEach(function(a){a&&a.applyTo(h,a.scaleX||e.scaleX,a.scaleY||e.scaleY);!k&&a&&"Resize"===a.type&&(e.width*=a.scaleX,e.height*=a.scaleY)});q.width=h.width;q.height=h.height;g.isLikelyNode?(q.src=h.toBuffer(u,g.Image.pngCompression),e._element=
q,!k&&(e._filteredEl=q),c&&c()):(q.onload=function(){e._element=q;!k&&(e._filteredEl=q);c&&c();q.onload=h=f=null},q.src=h.toDataURL("image/png"));return h}},_render:function(c,b){var a,k,f=this._findMargins(),h;a=b?this.left:-this.width/2;k=b?this.top:-this.height/2;"slice"===this.meetOrSlice&&(c.beginPath(),c.rect(a,k,this.width,this.height),c.clip());!1===this.isMoving&&this.resizeFilters.length&&this._needsResize()?(this._lastScaleX=this.scaleX,this._lastScaleY=this.scaleY,h=this.applyFilters(null,
this.resizeFilters,this._filteredEl||this._originalElement,!0)):h=this._element;h&&c.drawImage(h,a+f.marginX,k+f.marginY,f.width,f.height);this._renderStroke(c)},_needsResize:function(){return this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY},_findMargins:function(){var c=this.width,b=this.height,a=0,k=0;if("none"!==this.alignX||"none"!==this.alignY)c=[this.width/this._element.width,this.height/this._element.height],b="meet"===this.meetOrSlice?Math.min.apply(null,c):Math.max.apply(null,
c),c=this._element.width*b,b*=this._element.height,"Mid"===this.alignX&&(a=(this.width-c)/2),"Max"===this.alignX&&(a=this.width-c),"Mid"===this.alignY&&(k=(this.height-b)/2),"Max"===this.alignY&&(k=this.height-b);return{width:c,height:b,marginX:a,marginY:k}},_resetWidthHeight:function(){var c=this.getElement();this.set("width",c.width);this.set("height",c.height)},_initElement:function(c,b){this.setElement(g.util.getById(c),null,b);g.util.addClass(this.getElement(),g.Image.CSS_CANVAS)},_initConfig:function(c){c||
(c={});this.setOptions(c);this._setWidthHeight(c);this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(c,b){c&&c.length?g.util.enlivenObjects(c,function(a){b&&b(a)},"fabric.Image.filters"):b&&b()},_setWidthHeight:function(c){this.width="width"in c?c.width:this.getElement()?this.getElement().width||0:0;this.height="height"in c?c.height:this.getElement()?this.getElement().height||0:0},complexity:function(){return 1}}),g.Image.CSS_CANVAS="canvas-img",g.Image.prototype.getSvgSrc=
g.Image.prototype.getSrc,g.Image.fromObject=function(c,b){g.util.loadImage(c.src,function(a){g.Image.prototype._initFilters.call(c,c.filters,function(k){c.filters=k||[];g.Image.prototype._initFilters.call(c,c.resizeFilters,function(f){c.resizeFilters=f||[];f=new g.Image(a,c);b&&b(f)})})},null,c.crossOrigin)},g.Image.fromURL=function(c,b,a){g.util.loadImage(c,function(c){b&&b(new g.Image(c,a))},null,a&&a.crossOrigin)},g.Image.ATTRIBUTE_NAMES=g.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href".split(" ")),
g.Image.fromElement=function(d,b,a){d=g.parseAttributes(d,g.Image.ATTRIBUTE_NAMES);var k;d.preserveAspectRatio&&(k=g.util.parsePreserveAspectRatioAttribute(d.preserveAspectRatio),c(d,k));g.Image.fromURL(d["xlink:href"],b,c(a?g.util.object.clone(a):{},d))},g.Image.async=!0,g.Image.pngCompression=1)})("undefined"!==typeof n?n:this);g.util.object.extend(g.Object.prototype,{_getAngleValueForStraighten:function(){var e=this.getAngle()%360;return 0<e?90*Math.round((e-1)/90):90*Math.round(e/90)},straighten:function(){this.setAngle(this._getAngleValueForStraighten());
return this},fxStraighten:function(e){e=e||{};var c=function(){},d=e.onComplete||c,b=e.onChange||c,a=this;g.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(c){a.setAngle(c);b()},onComplete:function(){a.setCoords();d()},onStart:function(){a.set("active",!1)}});return this}});g.util.object.extend(g.StaticCanvas.prototype,{straightenObject:function(e){e.straighten();this.renderAll();return this},fxStraightenObject:function(e){e.fxStraighten({onChange:this.renderAll.bind(this)});
return this}});g.Image.filters=g.Image.filters||{};g.Image.filters.BaseFilter=g.util.createClass({type:"BaseFilter",initialize:function(e){e&&this.setOptions(e)},setOptions:function(e){for(var c in e)this[c]=e[c]},toObject:function(){return{type:this.type}},toJSON:function(){return this.toObject()}});(function(e){var c=e.fabric||(e.fabric={}),d=c.util.object.extend;c.Image.filters.Brightness=c.util.createClass(c.Image.filters.BaseFilter,{type:"Brightness",initialize:function(b){b=b||{};this.brightness=
b.brightness||0},applyTo:function(b){var a=b.getContext("2d");b=a.getImageData(0,0,b.width,b.height);for(var c=b.data,f=this.brightness,h=0,d=c.length;h<d;h+=4)c[h]+=f,c[h+1]+=f,c[h+2]+=f;a.putImageData(b,0,0)},toObject:function(){return d(this.callSuper("toObject"),{brightness:this.brightness})}});c.Image.filters.Brightness.fromObject=function(b){return new c.Image.filters.Brightness(b)}})("undefined"!==typeof n?n:this);(function(e){var c=e.fabric||(e.fabric={}),d=c.util.object.extend;c.Image.filters.Convolute=
c.util.createClass(c.Image.filters.BaseFilter,{type:"Convolute",initialize:function(b){b=b||{};this.opaque=b.opaque;this.matrix=b.matrix||[0,0,0,0,1,0,0,0,0]},applyTo:function(b){var a=this.matrix,c=b.getContext("2d"),f=c.getImageData(0,0,b.width,b.height);b=Math.round(Math.sqrt(a.length));for(var h=Math.floor(b/2),d=f.data,e=f.width,f=f.height,g=c.createImageData(e,f),r=g.data,m=this.opaque?1:0,v,E,D,x,H,I,l,n=0;n<f;n++)for(var w=0;w<e;w++){H=4*(n*e+w);for(var C=x=D=E=v=0;C<b;C++)for(var A=0;A<b;A++)l=
n+C-h,I=w+A-h,0>l||l>f||0>I||I>e||(I=4*(l*e+I),l=a[C*b+A],v+=d[I]*l,E+=d[I+1]*l,D+=d[I+2]*l,x+=d[I+3]*l);r[H]=v;r[H+1]=E;r[H+2]=D;r[H+3]=x+m*(255-x)}c.putImageData(g,0,0)},toObject:function(){return d(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}});c.Image.filters.Convolute.fromObject=function(b){return new c.Image.filters.Convolute(b)}})("undefined"!==typeof n?n:this);(function(e){var c=e.fabric||(e.fabric={}),d=c.util.object.extend;c.Image.filters.GradientTransparency=c.util.createClass(c.Image.filters.BaseFilter,
{type:"GradientTransparency",initialize:function(b){b=b||{};this.threshold=b.threshold||100},applyTo:function(b){var a=b.getContext("2d");b=a.getImageData(0,0,b.width,b.height);for(var c=b.data,f=this.threshold,h=c.length,d=0,e=c.length;d<e;d+=4)c[d+3]=f+255*(h-d)/h;a.putImageData(b,0,0)},toObject:function(){return d(this.callSuper("toObject"),{threshold:this.threshold})}});c.Image.filters.GradientTransparency.fromObject=function(b){return new c.Image.filters.GradientTransparency(b)}})("undefined"!==
typeof n?n:this);(function(e){var c=e.fabric||(e.fabric={});c.Image.filters.Grayscale=c.util.createClass(c.Image.filters.BaseFilter,{type:"Grayscale",applyTo:function(c){var b=c.getContext("2d");c=b.getImageData(0,0,c.width,c.height);for(var a=c.data,k=c.width*c.height*4,f=0,h;f<k;)h=(a[f]+a[f+1]+a[f+2])/3,a[f]=h,a[f+1]=h,a[f+2]=h,f+=4;b.putImageData(c,0,0)}});c.Image.filters.Grayscale.fromObject=function(){return new c.Image.filters.Grayscale}})("undefined"!==typeof n?n:this);(function(e){var c=
e.fabric||(e.fabric={});c.Image.filters.Invert=c.util.createClass(c.Image.filters.BaseFilter,{type:"Invert",applyTo:function(c){var b=c.getContext("2d");c=b.getImageData(0,0,c.width,c.height);var a=c.data,k=a.length,f;for(f=0;f<k;f+=4)a[f]=255-a[f],a[f+1]=255-a[f+1],a[f+2]=255-a[f+2];b.putImageData(c,0,0)}});c.Image.filters.Invert.fromObject=function(){return new c.Image.filters.Invert}})("undefined"!==typeof n?n:this);(function(e){var c=e.fabric||(e.fabric={}),d=c.util.object.extend;c.Image.filters.Mask=
c.util.createClass(c.Image.filters.BaseFilter,{type:"Mask",initialize:function(b){b=b||{};this.mask=b.mask;this.channel=-1<[0,1,2,3].indexOf(b.channel)?b.channel:0},applyTo:function(b){if(this.mask){var a=b.getContext("2d"),k=a.getImageData(0,0,b.width,b.height),f=k.data,h=this.mask.getElement(),d=c.util.createCanvasElement(),e=this.channel,g=k.width*k.height*4;d.width=b.width;d.height=b.height;d.getContext("2d").drawImage(h,0,0,b.width,b.height);h=d.getContext("2d").getImageData(0,0,b.width,b.height).data;
for(b=0;b<g;b+=4)f[b+3]=h[b+e];a.putImageData(k,0,0)}},toObject:function(){return d(this.callSuper("toObject"),{mask:this.mask.toObject(),channel:this.channel})}});c.Image.filters.Mask.fromObject=function(b,a){c.util.loadImage(b.mask.src,function(k){b.mask=new c.Image(k,b.mask);a&&a(new c.Image.filters.Mask(b))})};c.Image.filters.Mask.async=!0})("undefined"!==typeof n?n:this);(function(e){var c=e.fabric||(e.fabric={}),d=c.util.object.extend;c.Image.filters.Noise=c.util.createClass(c.Image.filters.BaseFilter,
{type:"Noise",initialize:function(b){b=b||{};this.noise=b.noise||0},applyTo:function(b){var a=b.getContext("2d");b=a.getImageData(0,0,b.width,b.height);for(var c=b.data,f=this.noise,h,d=0,e=c.length;d<e;d+=4)h=(.5-Math.random())*f,c[d]+=h,c[d+1]+=h,c[d+2]+=h;a.putImageData(b,0,0)},toObject:function(){return d(this.callSuper("toObject"),{noise:this.noise})}});c.Image.filters.Noise.fromObject=function(b){return new c.Image.filters.Noise(b)}})("undefined"!==typeof n?n:this);(function(e){var c=e.fabric||
(e.fabric={}),d=c.util.object.extend;c.Image.filters.Pixelate=c.util.createClass(c.Image.filters.BaseFilter,{type:"Pixelate",initialize:function(b){b=b||{};this.blocksize=b.blocksize||4},applyTo:function(b){var a=b.getContext("2d");b=a.getImageData(0,0,b.width,b.height);var c=b.data,f=b.height,h=b.width,d,e,g,r,m,v,E;for(e=0;e<f;e+=this.blocksize)for(g=0;g<h;g+=this.blocksize){d=4*e*h+4*g;r=c[d];m=c[d+1];v=c[d+2];E=c[d+3];for(var D=e,x=e+this.blocksize;D<x;D++)for(var H=g,I=g+this.blocksize;H<I;H++)d=
4*D*h+4*H,c[d]=r,c[d+1]=m,c[d+2]=v,c[d+3]=E}a.putImageData(b,0,0)},toObject:function(){return d(this.callSuper("toObject"),{blocksize:this.blocksize})}});c.Image.filters.Pixelate.fromObject=function(b){return new c.Image.filters.Pixelate(b)}})("undefined"!==typeof n?n:this);(function(e){var c=e.fabric||(e.fabric={}),d=c.util.object.extend;c.Image.filters.RemoveWhite=c.util.createClass(c.Image.filters.BaseFilter,{type:"RemoveWhite",initialize:function(b){b=b||{};this.threshold=b.threshold||30;this.distance=
b.distance||20},applyTo:function(b){var a=b.getContext("2d");b=a.getImageData(0,0,b.width,b.height);for(var c=b.data,f=this.distance,h=255-this.threshold,d=Math.abs,e,g,r,m=0,v=c.length;m<v;m+=4)e=c[m],g=c[m+1],r=c[m+2],e>h&&g>h&&r>h&&d(e-g)<f&&d(e-r)<f&&d(g-r)<f&&(c[m+3]=0);a.putImageData(b,0,0)},toObject:function(){return d(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}});c.Image.filters.RemoveWhite.fromObject=function(b){return new c.Image.filters.RemoveWhite(b)}})("undefined"!==
typeof n?n:this);(function(e){var c=e.fabric||(e.fabric={});c.Image.filters.Sepia=c.util.createClass(c.Image.filters.BaseFilter,{type:"Sepia",applyTo:function(c){var b=c.getContext("2d");c=b.getImageData(0,0,c.width,c.height);var a=c.data,k=a.length,f,h;for(f=0;f<k;f+=4)h=.3*a[f]+.59*a[f+1]+.11*a[f+2],a[f]=h+100,a[f+1]=h+50,a[f+2]=h+255;b.putImageData(c,0,0)}});c.Image.filters.Sepia.fromObject=function(){return new c.Image.filters.Sepia}})("undefined"!==typeof n?n:this);(function(e){var c=e.fabric||
(e.fabric={});c.Image.filters.Sepia2=c.util.createClass(c.Image.filters.BaseFilter,{type:"Sepia2",applyTo:function(c){var b=c.getContext("2d");c=b.getImageData(0,0,c.width,c.height);var a=c.data,k=a.length,f,h,q,e;for(f=0;f<k;f+=4)h=a[f],q=a[f+1],e=a[f+2],a[f]=(.393*h+.769*q+.189*e)/1.351,a[f+1]=(.349*h+.686*q+.168*e)/1.203,a[f+2]=(.272*h+.534*q+.131*e)/2.14;b.putImageData(c,0,0)}});c.Image.filters.Sepia2.fromObject=function(){return new c.Image.filters.Sepia2}})("undefined"!==typeof n?n:this);(function(e){var c=
e.fabric||(e.fabric={}),d=c.util.object.extend;c.Image.filters.Tint=c.util.createClass(c.Image.filters.BaseFilter,{type:"Tint",initialize:function(b){b=b||{};this.color=b.color||"#000000";this.opacity="undefined"!==typeof b.opacity?b.opacity:(new c.Color(this.color)).getAlpha()},applyTo:function(b){var a=b.getContext("2d");b=a.getImageData(0,0,b.width,b.height);var k=b.data,f=k.length,h,d,e,g,r,m,v,E;h=(new c.Color(this.color)).getSource();d=h[0]*this.opacity;e=h[1]*this.opacity;g=h[2]*this.opacity;
E=1-this.opacity;for(h=0;h<f;h+=4)r=k[h],m=k[h+1],v=k[h+2],k[h]=d+r*E,k[h+1]=e+m*E,k[h+2]=g+v*E;a.putImageData(b,0,0)},toObject:function(){return d(this.callSuper("toObject"),{color:this.color,opacity:this.opacity})}});c.Image.filters.Tint.fromObject=function(b){return new c.Image.filters.Tint(b)}})("undefined"!==typeof n?n:this);(function(e){var c=e.fabric||(e.fabric={}),d=c.util.object.extend;c.Image.filters.Multiply=c.util.createClass(c.Image.filters.BaseFilter,{type:"Multiply",initialize:function(b){b=
b||{};this.color=b.color||"#000000"},applyTo:function(b){var a=b.getContext("2d");b=a.getImageData(0,0,b.width,b.height);var k=b.data,f=k.length,h,d;d=(new c.Color(this.color)).getSource();for(h=0;h<f;h+=4)k[h]*=d[0]/255,k[h+1]*=d[1]/255,k[h+2]*=d[2]/255;a.putImageData(b,0,0)},toObject:function(){return d(this.callSuper("toObject"),{color:this.color})}});c.Image.filters.Multiply.fromObject=function(b){return new c.Image.filters.Multiply(b)}})("undefined"!==typeof n?n:this);(function(e){var c=e.fabric;
c.Image.filters.Blend=c.util.createClass({type:"Blend",initialize:function(c){c=c||{};this.color=c.color||"#000";this.image=c.image||!1;this.mode=c.mode||"multiply";this.alpha=c.alpha||1},applyTo:function(d){var b=d.getContext("2d");d=b.getImageData(0,0,d.width,d.height);var a=d.data,k,f,h,q,e,g,r,m=!1;this.image?(m=!0,r=c.util.createCanvasElement(),r.width=this.image.width,r.height=this.image.height,r=new c.StaticCanvas(r),r.add(this.image),r=r.getContext("2d").getImageData(0,0,r.width,r.height).data):
(r=(new c.Color(this.color)).getSource(),k=r[0]*this.alpha,f=r[1]*this.alpha,h=r[2]*this.alpha);for(var v=0,E=a.length;v<E;v+=4)switch(q=a[v],e=a[v+1],g=a[v+2],m&&(k=r[v]*this.alpha,f=r[v+1]*this.alpha,h=r[v+2]*this.alpha),this.mode){case "multiply":a[v]=q*k/255;a[v+1]=e*f/255;a[v+2]=g*h/255;break;case "screen":a[v]=1-(1-q)*(1-k);a[v+1]=1-(1-e)*(1-f);a[v+2]=1-(1-g)*(1-h);break;case "add":a[v]=Math.min(255,q+k);a[v+1]=Math.min(255,e+f);a[v+2]=Math.min(255,g+h);break;case "diff":case "difference":a[v]=
Math.abs(q-k);a[v+1]=Math.abs(e-f);a[v+2]=Math.abs(g-h);break;case "subtract":q-=k;e-=f;g-=h;a[v]=0>q?0:q;a[v+1]=0>e?0:e;a[v+2]=0>g?0:g;break;case "darken":a[v]=Math.min(q,k);a[v+1]=Math.min(e,f);a[v+2]=Math.min(g,h);break;case "lighten":a[v]=Math.max(q,k),a[v+1]=Math.max(e,f),a[v+2]=Math.max(g,h)}b.putImageData(d,0,0)},toObject:function(){return{color:this.color,image:this.image,mode:this.mode,alpha:this.alpha}}});c.Image.filters.Blend.fromObject=function(d){return new c.Image.filters.Blend(d)}})("undefined"!==
typeof n?n:this);(function(e){var c=e.fabric||(e.fabric={}),d=Math.pow,b=Math.floor,a=Math.sqrt,k=Math.abs,f=Math.max,h=Math.round,q=Math.sin,p=Math.ceil;c.Image.filters.Resize=c.util.createClass(c.Image.filters.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:0,scaleY:0,lanczosLobes:3,applyTo:function(a,f,b){this.rcpScaleX=1/f;this.rcpScaleY=1/b;var c=a.width,k=a.height;f=h(c*f);b=h(k*b);var d;"sliceHack"===this.resizeType&&(d=this.sliceByTwo(a,c,k,f,b));"hermite"===this.resizeType&&(d=this.hermiteFastResize(a,
c,k,f,b));"bilinear"===this.resizeType&&(d=this.bilinearFiltering(a,c,k,f,b));"lanczos"===this.resizeType&&(d=this.lanczosResize(a,c,k,f,b));a.width=f;a.height=b;a.getContext("2d").putImageData(d,0,0)},sliceByTwo:function(a,h,k,d,q){var e=a.getContext("2d"),p,g=.5,I=.5,l=1,n=1,w=!1,C=!1,A=h,G=k,N=c.util.createCanvasElement(),F=N.getContext("2d");d=b(d);q=b(q);N.width=f(d,h);N.height=f(q,k);d>h&&(g=2,l=-1);q>k&&(I=2,n=-1);p=e.getImageData(0,0,h,k);a.width=f(d,h);a.height=f(q,k);for(e.putImageData(p,
0,0);!w||!C;)h=A,k=G,d*l<b(A*g*l)?A=b(A*g):(A=d,w=!0),q*n<b(G*I*n)?G=b(G*I):(G=q,C=!0),p=e.getImageData(0,0,h,k),F.putImageData(p,0,0),e.clearRect(0,0,A,G),e.drawImage(N,0,0,h,k,0,0,A,G);return e.getImageData(0,0,d,q)},lanczosResize:function(f,h,c,e,g){var D,x,H,I;function l(f){var q,p,t,n,y,u,z,B,S,P;H=(f+.5)*N;D=b(H);for(q=0;q<g;q++){I=(q+.5)*F;x=b(I);S=B=z=u=y=0;for(p=D-Q;p<=D+Q;p++)if(!(0>p||p>=h)){P=b(1E3*k(p-H));M[P]||(M[P]={});for(var R=x-U;R<=x+U;R++)0>R||R>=c||(t=b(1E3*k(R-I)),M[P][t]||(M[P][t]=
G(a(d(P*K,2)+d(t*L,2))/1E3)),t=M[P][t],0<t&&(n=4*(R*h+p),y+=t,u+=t*C[n],z+=t*C[n+1],B+=t*C[n+2],S+=t*C[n+3]))}n=4*(q*e+f);A[n]=u/y;A[n+1]=z/y;A[n+2]=B/y;A[n+3]=S/y}return++f<e?l(f):w}f=f.getContext("2d");var n=f.getImageData(0,0,h,c),w=f.getImageData(0,0,e,g),C=n.data,A=w.data,G=function(a){return function(f){if(f>a)return 0;f*=Math.PI;if(1E-16>k(f))return 1;var h=f/a;return q(f)*q(h)/f/h}}(this.lanczosLobes),N=this.rcpScaleX,F=this.rcpScaleY,K=2/this.rcpScaleX,L=2/this.rcpScaleY,Q=p(N*this.lanczosLobes/
2),U=p(F*this.lanczosLobes/2),M={};x=D=I=H=void 0;return l(0)},bilinearFiltering:function(a,f,h,c,k){var d,q,e,p,g,l,w,n,A,G,N=0,F=this.rcpScaleX,K=this.rcpScaleY;w=a.getContext("2d");a=4*(f-1);h=w.getImageData(0,0,f,h).data;var L=w.getImageData(0,0,c,k),Q=L.data;for(w=0;w<k;w++)for(n=0;n<c;n++)for(g=b(F*n),l=b(K*w),A=F*n-g,G=K*w-l,l=4*(l*f+g),g=0;4>g;g++)d=h[l+g],q=h[l+4+g],e=h[l+a+g],p=h[l+a+4+g],d=d*(1-A)*(1-G)+q*A*(1-G)+e*G*(1-A)+p*A*G,Q[N++]=d;return L},hermiteFastResize:function(f,h,c,d,q){var e=
this.rcpScaleX,g=this.rcpScaleY,H=p(e/2),I=p(g/2);f=f.getContext("2d");c=f.getImageData(0,0,h,c).data;f=f.getImageData(0,0,d,q);for(var l=f.data,n=0;n<q;n++)for(var w=0;w<d;w++){for(var C=4*(w+n*d),A=0,G=0,N=0,F=0,K=0,L=0,Q=0,U=(n+.5)*g,M=b(n*g);M<(n+1)*g;M++)for(var T=k(U-(M+.5))/I,Y=(w+.5)*e,T=T*T,V=b(w*e);V<(w+1)*e;V++){var O=k(Y-(V+.5))/H,A=a(T+O*O);1<A&&-1>A||(A=2*A*A*A-3*A*A+1,0<A&&(O=4*(V+M*h),Q+=A*c[O+3],N+=A,255>c[O+3]&&(A=A*c[O+3]/250),F+=A*c[O],K+=A*c[O+1],L+=A*c[O+2],G+=A))}l[C]=F/G;l[C+
1]=K/G;l[C+2]=L/G;l[C+3]=Q/N}return f},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}});c.Image.filters.Resize.fromObject=function(a){return new c.Image.filters.Resize(a)}})("undefined"!==typeof n?n:this);(function(e){var c=e.fabric||(e.fabric={}),d=c.util.object.extend,b=c.util.object.clone,a=c.util.toFixed,k=c.StaticCanvas.supports("setLineDash"),f=c.Object.NUM_FRACTION_DIGITS;c.Text?c.warn("fabric.Text is already defined"):
(e=c.Object.prototype.stateProperties.concat(),e.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor"),c.Text=c.util.createClass(c.Object,{_dimensionAffectingProps:{fontSize:!0,fontWeight:!0,fontFamily:!0,fontStyle:!0,lineHeight:!0,stroke:!0,strokeWidth:!0,text:!0,textAlign:!0},_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",
fontStyle:"",lineHeight:1.16,textBackgroundColor:"",stateProperties:e,stroke:null,shadow:null,_fontSizeFraction:.25,_fontSizeMult:1.13,initialize:function(a,f){f=f||{};this.text=a;this.__skipDimension=!0;this.setOptions(f);this.__skipDimension=!1;this._initDimensions()},_initDimensions:function(a){this.__skipDimension||(a||(a=c.util.createCanvasElement().getContext("2d"),this._setTextStyles(a)),this._textLines=this._splitTextIntoLines(),this._clearCache(),this._cacheLinesWidth="justify"!==this.textAlign,
this.width=this._getTextWidth(a),this._cacheLinesWidth=!0,this.height=this._getTextHeight(a))},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(a){this.clipTo&&c.util.clipContext(this,a);this._setOpacity(a);this._setShadow(a);this._setupCompositeOperation(a);this._renderTextBackground(a);this._setStrokeStyles(a);this._setFillStyles(a);this._renderText(a);this._renderTextDecoration(a);this.clipTo&&
a.restore()},_renderText:function(a){this._translateForTextAlign(a);this._renderTextFill(a);this._renderTextStroke(a);this._translateForTextAlign(a,!0)},_translateForTextAlign:function(a,f){if("left"!==this.textAlign&&"justify"!==this.textAlign){var b=f?-1:1;a.translate("center"===this.textAlign?b*this.width/2:b*this.width,0)}},_setTextStyles:function(a){a.textBaseline="alphabetic";this.skipTextAlign||(a.textAlign=this.textAlign);a.font=this._getFontDeclaration()},_getTextHeight:function(){return this._textLines.length*
this._getHeightOfLine()},_getTextWidth:function(a){for(var f=this._getLineWidth(a,0),b=1,c=this._textLines.length;b<c;b++){var k=this._getLineWidth(a,b);k>f&&(f=k)}return f},_renderChars:function(a,f,b,c,k){var d=a.slice(0,-4);if(this[d].toLive){var e=-this.width/2+this[d].offsetX||0,g=-this.height/2+this[d].offsetY||0;f.save();f.translate(e,g);c-=e;k-=g}f[a](b,c,k);this[d].toLive&&f.restore()},_renderTextLine:function(a,f,b,c,k,d){k-=this.fontSize*this._fontSizeFraction;var e=this._getLineWidth(f,
d);if("justify"!==this.textAlign||this.width<e)this._renderChars(a,f,b,c,k,d);else for(var e=b.split(/\s+/),g=0,D=this._getWidthOfWords(f,b,d,0),D=this.width-D,x=e.length-1,D=0<x?D/x:0,x=0,H,I=0,l=e.length;I<l;I++){for(;" "===b[g]&&g<b.length;)g++;H=e[I];this._renderChars(a,f,H,c+x,k,d,g);x+=this._getWidthOfWords(f,H,d,g)+D;g+=H.length}},_getWidthOfWords:function(a,f){return a.measureText(f.replace(/\s+/g,"")).width},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/
2},isEmptyStyles:function(){return!0},_renderTextFill:function(a){if(this.fill||!this.isEmptyStyles())for(var f=0,b=0,c=this._textLines.length;b<c;b++){var k=this._getHeightOfLine(a,b),d=k/this.lineHeight;this._renderTextLine("fillText",a,this._textLines[b],this._getLeftOffset(),this._getTopOffset()+f+d,b);f+=k}},_renderTextStroke:function(a){if(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles()){var f=0;this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a);a.save();this.strokeDashArray&&
(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),k&&a.setLineDash(this.strokeDashArray));a.beginPath();for(var b=0,c=this._textLines.length;b<c;b++){var d=this._getHeightOfLine(a,b),e=d/this.lineHeight;this._renderTextLine("strokeText",a,this._textLines[b],this._getLeftOffset(),this._getTopOffset()+f+e,b);f+=d}a.closePath();a.restore()}},_getHeightOfLine:function(){return this.fontSize*this._fontSizeMult*this.lineHeight},_renderTextBackground:function(a){this._renderTextBoxBackground(a);
this._renderTextLinesBackground(a)},_renderTextBoxBackground:function(a){this.backgroundColor&&(a.fillStyle=this.backgroundColor,a.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height),this._removeShadow(a))},_renderTextLinesBackground:function(a){if(this.textBackgroundColor){var f=0,b,c,k;a.fillStyle=this.textBackgroundColor;for(var d=0,e=this._textLines.length;d<e;d++)b=this._getHeightOfLine(a,d),""!==this._textLines[d]&&(c="justify"===this.textAlign?this.width:this._getLineWidth(a,
d),k=this._getLineLeftOffset(c),a.fillRect(this._getLeftOffset()+k,this._getTopOffset()+f,c,b/this.lineHeight)),f+=b;this._removeShadow(a)}},_getLineLeftOffset:function(a){return"center"===this.textAlign?(this.width-a)/2:"right"===this.textAlign?this.width-a:0},_clearCache:function(){this.__lineWidths=[];this.__lineHeights=[]},_shouldClearCache:function(){var a=!1;if(this._forceClearCache)return this._forceClearCache=!1,!0;for(var f in this._dimensionAffectingProps)this["__"+f]!==this[f]&&(this["__"+
f]=this[f],a=!0);return a},_getLineWidth:function(a,f){if(this.__lineWidths[f])return this.__lineWidths[f];var b,c=this._textLines[f];""===c?b=0:"justify"===this.textAlign&&this._cacheLinesWidth?(b=c.split(/\s+/),b=1<b.length?this.width:a.measureText(c).width):b=a.measureText(c).width;this._cacheLinesWidth&&(this.__lineWidths[f]=b);return b},_renderTextDecoration:function(a){if(this.textDecoration){var f=this.height/2,b=[];-1<this.textDecoration.indexOf("underline")&&b.push(.85);-1<this.textDecoration.indexOf("line-through")&&
b.push(.43);-1<this.textDecoration.indexOf("overline")&&b.push(-.12);if(0<b.length){var c,k=0,d,e,g,D,x,H;c=0;for(d=this._textLines.length;c<d;c++){D=this._getLineWidth(a,c);x=this._getLineLeftOffset(D);H=this._getHeightOfLine(a,c);e=0;for(g=b.length;e<g;e++)a.fillRect(this._getLeftOffset()+x,k+(this._fontSizeMult-1+b[e])*this.fontSize-f,D,this.fontSize/15);k+=H}}}},_getFontDeclaration:function(){return[c.isLikelyNode?this.fontWeight:this.fontStyle,c.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+
"px",c.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(a,f){this.visible&&(a.save(),this._setTextStyles(a),this._shouldClearCache()&&this._initDimensions(a),f||this.transform(a),this.transformMatrix&&a.transform.apply(a,this.transformMatrix),this.group&&"path-group"===this.group.type&&a.translate(this.left,this.top),this._render(a),a.restore())},_splitTextIntoLines:function(){return this.text.split(this._reNewline)},toObject:function(a){a=d(this.callSuper("toObject",
a),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,textBackgroundColor:this.textBackgroundColor});this.includeDefaultValues||this._removeDefaultValues(a);return a},toSVG:function(a){var f=this._createBaseSVGMarkup(),b=this._getSVGLeftTopOffsets(this.ctx),b=this._getSVGTextAndBg(b.textTop,b.textLeft);this._wrapSVGTextAndBg(f,b);return a?a(f.join("")):
f.join("")},_getSVGLeftTopOffsets:function(a){a=this._getHeightOfLine(a,0);return{textLeft:-this.width/2+(this.group&&"path-group"===this.group.type?this.left:0),textTop:0+(this.group&&"path-group"===this.group.type?-this.top:0),lineTop:a}},_wrapSVGTextAndBg:function(a,f){var b=this.getSvgFilter(),b=""===b?"":' style="'+b+'"';a.push('\t<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"',b,">\n",f.textBgRects.join(""),"\t\t<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,
"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(!0),'" >\n',f.textSpans.join(""),"\t\t</text>\n","\t</g>\n")},_getSVGTextAndBg:function(a,f){var b=[],c=[],k=0;this._setSVGBg(c);for(var d=0,e=this._textLines.length;d<e;d++)this.textBackgroundColor&&this._setSVGTextLineBg(c,d,f,a,k),
this._setSVGTextLineText(d,b,k,f,a,c),k+=this._getHeightOfLine(this.ctx,d);return{textSpans:b,textBgRects:c}},_setSVGTextLineText:function(h,b,k,d,e){k=this.fontSize*(this._fontSizeMult-this._fontSizeFraction)-e+k-this.height/2;"justify"===this.textAlign?this._setSVGTextLineJustifed(h,b,k,d):b.push('\t\t\t<tspan x="',a(d+this._getLineLeftOffset(this._getLineWidth(this.ctx,h)),f),'" ','y="',a(k,f),'" ',this._getFillAttributes(this.fill),">",c.util.string.escapeXml(this._textLines[h]),"</tspan>\n")},
_setSVGTextLineJustifed:function(h,b,k,d){var e=c.util.createCanvasElement().getContext("2d");this._setTextStyles(e);var m=this._textLines[h],g=m.split(/\s+/),m=this._getWidthOfWords(e,m),m=this.width-m,E=g.length-1,m=0<E?m/E:0,D=this._getFillAttributes(this.fill),x;d+=this._getLineLeftOffset(this._getLineWidth(e,h));h=0;for(x=g.length;h<x;h++)E=g[h],b.push('\t\t\t<tspan x="',a(d,f),'" ','y="',a(k,f),'" ',D,">",c.util.string.escapeXml(E),"</tspan>\n"),d+=this._getWidthOfWords(e,E)+m},_setSVGTextLineBg:function(h,
b,c,k,d){h.push("\t\t<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',a(c+this._getLineLeftOffset(this._getLineWidth(this.ctx,b)),f),'" y="',a(d-this.height/2,f),'" width="',a(this._getLineWidth(this.ctx,b),f),'" height="',a(this._getHeightOfLine(this.ctx,b)/this.lineHeight,f),'"></rect>\n')},_setSVGBg:function(h){this.backgroundColor&&h.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',a(-this.width/2,f),'" y="',a(-this.height/2,f),'" width="',a(this.width,f),
'" height="',a(this.height,f),'"></rect>\n')},_getFillAttributes:function(a){var f=a&&"string"===typeof a?new c.Color(a):"";return f&&f.getSource()&&1!==f.getAlpha()?'opacity="'+f.getAlpha()+'" fill="'+f.setAlpha(1).toRgb()+'"':'fill="'+a+'"'},_set:function(a,f){this.callSuper("_set",a,f);a in this._dimensionAffectingProps&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}}),c.Text.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" ")),
c.Text.DEFAULT_SVG_FONT_SIZE=16,c.Text.fromElement=function(a,f){if(!a)return null;var b=c.parseAttributes(a,c.Text.ATTRIBUTE_NAMES);f=c.util.object.extend(f?c.util.object.clone(f):{},b);f.top=f.top||0;f.left=f.left||0;"dx"in b&&(f.left+=b.dx);"dy"in b&&(f.top+=b.dy);"fontSize"in f||(f.fontSize=c.Text.DEFAULT_SVG_FONT_SIZE);f.originX||(f.originX="left");b="";"textContent"in a?b=a.textContent:"firstChild"in a&&null!==a.firstChild&&"data"in a.firstChild&&null!==a.firstChild.data&&(b=a.firstChild.data);
var b=b.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," "),b=new c.Text(b,f),k=0;"left"===b.originX&&(k=b.getWidth()/2);"right"===b.originX&&(k=-b.getWidth()/2);b.set({left:b.getLeft()+k,top:b.getTop()-b.getHeight()/2+b.fontSize*(.18+b._fontSizeFraction)});return b},c.Text.fromObject=function(a){return new c.Text(a.text,b(a))},c.util.createAccessors(c.Text))})("undefined"!==typeof n?n:this);(function(){var e=g.util.object.clone;g.IText=g.util.createClass(g.Text,g.Observable,{type:"i-text",selectionStart:0,
selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1E3,cursorDuration:600,styles:null,caching:!0,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,_charWidthsCache:{},__widthOfSpace:[],initialize:function(c,d){this.styles=d?d.styles||{}:{};this.callSuper("initialize",c,d);this.initBehavior()},_clearCache:function(){this.callSuper("_clearCache");
this.__widthOfSpace=[]},isEmptyStyles:function(){if(!this.styles)return!0;var c=this.styles,d;for(d in c)for(var b in c[d])for(var a in c[d][b])return!1;return!0},setSelectionStart:function(c){c=Math.max(c,0);this.selectionStart!==c&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this}),this.selectionStart=c);this._updateTextarea()},setSelectionEnd:function(c){c=Math.min(c,this.text.length);this.selectionEnd!==c&&(this.fire("selection:changed"),this.canvas&&
this.canvas.fire("text:selection:changed",{target:this}),this.selectionEnd=c);this._updateTextarea()},getSelectionStyles:function(c,d){if(2===arguments.length){for(var b=[],a=c;a<d;a++)b.push(this.getSelectionStyles(a));return b}b=this.get2DCursorLocation(c);return this._getStyleDeclaration(b.lineIndex,b.charIndex)||{}},setSelectionStyles:function(c){if(this.selectionStart===this.selectionEnd)this._extendStyles(this.selectionStart,c);else for(var d=this.selectionStart;d<this.selectionEnd;d++)this._extendStyles(d,
c);this._forceClearCache=!0;return this},_extendStyles:function(c,d){var b=this.get2DCursorLocation(c);this._getLineStyle(b.lineIndex)||this._setLineStyle(b.lineIndex,{});this._getStyleDeclaration(b.lineIndex,b.charIndex)||this._setStyleDeclaration(b.lineIndex,b.charIndex,{});g.util.object.extend(this._getStyleDeclaration(b.lineIndex,b.charIndex),d)},_render:function(c){this.callSuper("_render",c);this.ctx=c;this.isEditing&&this.renderCursorOrSelection()},renderCursorOrSelection:function(){if(this.active){var c=
this.text.split(""),d,b;this.canvas.contextTop?(b=this.canvas.contextTop,b.save(),b.transform.apply(b,this.canvas.viewportTransform),this.transform(b),this.transformMatrix&&b.transform.apply(b,this.transformMatrix)):(b=this.ctx,b.save());this.selectionStart===this.selectionEnd?(d=this._getCursorBoundaries(c,"cursor"),this.renderCursor(d,b)):(d=this._getCursorBoundaries(c,"selection"),this.renderSelection(c,d,b));b.restore()}},get2DCursorLocation:function(c){"undefined"===typeof c&&(c=this.selectionStart);
for(var d=this._textLines.length,b=0;b<d;b++){if(c<=this._textLines[b].length)return{lineIndex:b,charIndex:c};c-=this._textLines[b].length+1}return{lineIndex:b-1,charIndex:this._textLines[b-1].length<c?this._textLines[b-1].length:c}},getCurrentCharStyle:function(c,d){var b=this._getStyleDeclaration(c,0===d?0:d-1);return{fontSize:b&&b.fontSize||this.fontSize,fill:b&&b.fill||this.fill,textBackgroundColor:b&&b.textBackgroundColor||this.textBackgroundColor,textDecoration:b&&b.textDecoration||this.textDecoration,
fontFamily:b&&b.fontFamily||this.fontFamily,fontWeight:b&&b.fontWeight||this.fontWeight,fontStyle:b&&b.fontStyle||this.fontStyle,stroke:b&&b.stroke||this.stroke,strokeWidth:b&&b.strokeWidth||this.strokeWidth}},getCurrentCharFontSize:function(c,d){var b=this._getStyleDeclaration(c,0===d?0:d-1);return b&&b.fontSize?b.fontSize:this.fontSize},getCurrentCharColor:function(c,d){var b=this._getStyleDeclaration(c,0===d?0:d-1);return b&&b.fill?b.fill:this.cursorColor},_getCursorBoundaries:function(c,d){var b=
Math.round(this._getLeftOffset()),a=this._getTopOffset(),k=this._getCursorBoundariesOffsets(c,d);return{left:b,top:a,leftOffset:k.left+k.lineLeft,topOffset:k.top}},_getCursorBoundariesOffsets:function(c,d){for(var b=0,a=0,k=0,f=0,h=0,q=0;q<this.selectionStart;q++)"\n"===c[q]?(h=0,f+=this._getHeightOfLine(this.ctx,a),a++,k=0):(h+=this._getWidthOfChar(this.ctx,c[q],a,k),k++),b=this._getLineLeftOffset(this._getLineWidth(this.ctx,a));"cursor"===d&&(f+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,
a)/this.lineHeight-this.getCurrentCharFontSize(a,k)*(1-this._fontSizeFraction));return{top:f,left:h,lineLeft:b}},renderCursor:function(c,d){var b=this.get2DCursorLocation(),a=b.lineIndex,b=b.charIndex,k=this.getCurrentCharFontSize(a,b),f=0===a&&0===b?this._getLineLeftOffset(this._getLineWidth(d,a)):c.leftOffset;d.fillStyle=this.getCurrentCharColor(a,b);d.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity;d.fillRect(c.left+f,c.top+c.topOffset,this.cursorWidth/this.scaleX,k)},renderSelection:function(c,
d,b){b.fillStyle=this.selectionColor;c=this.get2DCursorLocation(this.selectionStart);for(var a=this.get2DCursorLocation(this.selectionEnd),k=c.lineIndex,f=a.lineIndex,h=k;h<=f;h++){var q=this._getLineLeftOffset(this._getLineWidth(b,h))||0,e=this._getHeightOfLine(this.ctx,h),g=0,r=this._textLines[h];if(h===k)for(var m=0,v=r.length;m<v;m++)m>=c.charIndex&&(h!==f||m<a.charIndex)&&(g+=this._getWidthOfChar(b,r[m],h,m)),m<c.charIndex&&(q+=this._getWidthOfChar(b,r[m],h,m));else if(h>k&&h<f)g+=this._getLineWidth(b,
h)||5;else if(h===f)for(m=0,v=a.charIndex;m<v;m++)g+=this._getWidthOfChar(b,r[m],h,m);b.fillRect(d.left+q,d.top+d.topOffset,g,e);d.topOffset+=e}},_renderChars:function(c,d,b,a,k,f,h){if(this.isEmptyStyles())return this._renderCharsFast(c,d,b,a,k);h=h||0;this.skipTextAlign=!0;a-="center"===this.textAlign?this.width/2:"right"===this.textAlign?this.width:0;var q=this._getHeightOfLine(d,f),e=this._getLineLeftOffset(this._getLineWidth(d,f)),g,r="";a+=e||0;d.save();k-=q/this.lineHeight*this._fontSizeFraction;
for(var m=h,v=b.length+h;m<=v;m++){g=g||this.getCurrentCharStyle(f,m);e=this.getCurrentCharStyle(f,m+1);if(this._hasStyleChanged(g,e)||m===v)this._renderChar(c,d,f,m-1,r,a,k,q),r="",g=e;r+=b[m-h]}d.restore()},_renderCharsFast:function(c,d,b,a,k){this.skipTextAlign=!1;"fillText"===c&&this.fill&&this.callSuper("_renderChars",c,d,b,a,k);"strokeText"===c&&(this.stroke&&0<this.strokeWidth||this.skipFillStrokeCheck)&&this.callSuper("_renderChars",c,d,b,a,k)},_renderChar:function(c,d,b,a,k,f,h,q){var e,
g,r,m=this._getStyleDeclaration(b,a),v;m?(e=this._getHeightOfChar(d,k,b,a),r=m.stroke,g=m.fill,v=m.textDecoration):e=this.fontSize;r=(r||this.stroke)&&"strokeText"===c;g=(g||this.fill)&&"fillText"===c;m&&d.save();c=this._applyCharStylesGetWidth(d,k,b,a,m||{});v=v||this.textDecoration;m&&m.textBackgroundColor&&this._removeShadow(d);g&&d.fillText(k,f,h);r&&d.strokeText(k,f,h);if(v||""!==v)k=this._fontSizeFraction*q/this.lineHeight,this._renderCharDecoration(d,v,f,h,k,c,e);m&&d.restore();d.translate(c,
0)},_hasStyleChanged:function(c,d){return c.fill!==d.fill||c.fontSize!==d.fontSize||c.textBackgroundColor!==d.textBackgroundColor||c.textDecoration!==d.textDecoration||c.fontFamily!==d.fontFamily||c.fontWeight!==d.fontWeight||c.fontStyle!==d.fontStyle||c.stroke!==d.stroke||c.strokeWidth!==d.strokeWidth},_renderCharDecoration:function(c,d,b,a,k,f,h){if(d){k=h/15;a={underline:a+h/10,"line-through":a-h*(this._fontSizeFraction+this._fontSizeMult-1)+k,overline:a-(this._fontSizeMult-this._fontSizeFraction)*
h};h=["underline","line-through","overline"];var q,e;for(q=0;q<h.length;q++)e=h[q],-1<d.indexOf(e)&&c.fillRect(b,a[e],f,k)}},_renderTextLine:function(c,d,b,a,k,f){this.isEmptyStyles()||(k+=this.fontSize*(this._fontSizeFraction+.03));this.callSuper("_renderTextLine",c,d,b,a,k,f)},_renderTextDecoration:function(c){if(this.isEmptyStyles())return this.callSuper("_renderTextDecoration",c)},_renderTextLinesBackground:function(c){this.callSuper("_renderTextLinesBackground",c);for(var d=0,b,a,k=this._getLeftOffset(),
f=this._getTopOffset(),h,q,e,g=0,r=this._textLines.length;g<r;g++){b=this._getHeightOfLine(c,g);h=this._textLines[g];if(""!==h&&this.styles&&this._getLineStyle(g)){a=this._getLineWidth(c,g);a=this._getLineLeftOffset(a);for(var m=0,v=h.length;m<v;m++)(e=this._getStyleDeclaration(g,m))&&e.textBackgroundColor&&(q=h[m],c.fillStyle=e.textBackgroundColor,c.fillRect(k+a+this._getWidthOfCharsAt(c,g,m),f+d,this._getWidthOfChar(c,q,g,m)+1,b/this.lineHeight))}d+=b}},_getCacheProp:function(c,d){return c+d.fontFamily+
d.fontSize+d.fontWeight+d.fontStyle+d.shadow},_applyCharStylesGetWidth:function(c,d,b,a,k){b=this._getStyleDeclaration(b,a);a=k&&e(k)||e(b);this._applyFontStyles(a);k=this._getCacheProp(d,a);if(!b&&this._charWidthsCache[k]&&this.caching)return this._charWidthsCache[k];"string"===typeof a.shadow&&(a.shadow=new g.Shadow(a.shadow));b=a.fill||this.fill;c.fillStyle=b.toLive?b.toLive(c,this):b;a.stroke&&(c.strokeStyle=a.stroke&&a.stroke.toLive?a.stroke.toLive(c,this):a.stroke);c.lineWidth=a.strokeWidth||
this.strokeWidth;c.font=this._getFontDeclaration.call(a);a.shadow&&(a.scaleX=this.scaleX,a.scaleY=this.scaleY,a.canvas=this.canvas,this._setShadow.call(a,c));this.caching&&this._charWidthsCache[k]||(c=c.measureText(d).width,this.caching&&(this._charWidthsCache[k]=c));return this._charWidthsCache[k]},_applyFontStyles:function(c){c.fontFamily||(c.fontFamily=this.fontFamily);c.fontSize||(c.fontSize=this.fontSize);c.fontWeight||(c.fontWeight=this.fontWeight);c.fontStyle||(c.fontStyle=this.fontStyle)},
_getStyleDeclaration:function(c,d,b){return b?this.styles[c]&&this.styles[c][d]?e(this.styles[c][d]):{}:this.styles[c]&&this.styles[c][d]?this.styles[c][d]:null},_setStyleDeclaration:function(c,d,b){this.styles[c][d]=b},_deleteStyleDeclaration:function(c,d){delete this.styles[c][d]},_getLineStyle:function(c){return this.styles[c]},_setLineStyle:function(c,d){this.styles[c]=d},_deleteLineStyle:function(c){delete this.styles[c]},_getWidthOfChar:function(c,d,b,a){if("justify"===this.textAlign&&this._reSpacesAndTabs.test(d))return this._getWidthOfSpace(c,
b);var k=this._getStyleDeclaration(b,a,!0);this._applyFontStyles(k);k=this._getCacheProp(d,k);if(this._charWidthsCache[k]&&this.caching)return this._charWidthsCache[k];if(c)return c.save(),d=this._applyCharStylesGetWidth(c,d,b,a),c.restore(),d},_getHeightOfChar:function(c,d,b){return(c=this._getStyleDeclaration(d,b))&&c.fontSize?c.fontSize:this.fontSize},_getWidthOfCharsAt:function(c,d,b){var a=0,k,f;for(k=0;k<b;k++)f=this._textLines[d][k],a+=this._getWidthOfChar(c,f,d,k);return a},_getLineWidth:function(c,
d){if(this.__lineWidths[d])return this.__lineWidths[d];this.__lineWidths[d]=this._getWidthOfCharsAt(c,d,this._textLines[d].length);return this.__lineWidths[d]},_getWidthOfSpace:function(c,d){if(this.__widthOfSpace[d])return this.__widthOfSpace[d];var b=this._textLines[d],a=this._getWidthOfWords(c,b,d,0),a=this.width-a,b=b.length-b.replace(this._reSpacesAndTabs,"").length,b=a/b;return this.__widthOfSpace[d]=b},_getWidthOfWords:function(c,d,b,a){for(var k=0,f=0;f<d.length;f++){var h=d[f];h.match(/\s/)||
(k+=this._getWidthOfChar(c,h,b,f+a))}return k},_getHeightOfLine:function(c,d){if(this.__lineHeights[d])return this.__lineHeights[d];for(var b=this._textLines[d],a=this._getHeightOfChar(c,d,0),k=1,b=b.length;k<b;k++){var f=this._getHeightOfChar(c,d,k);f>a&&(a=f)}this.__lineHeights[d]=a*this.lineHeight*this._fontSizeMult;return this.__lineHeights[d]},_getTextHeight:function(c){for(var d=0,b=0,a=this._textLines.length;b<a;b++)d+=this._getHeightOfLine(c,b);return d},toObject:function(c){var d={},b,a,
k;for(b in this.styles)for(a in k=this.styles[b],d[b]={},k)d[b][a]=e(k[a]);return g.util.object.extend(this.callSuper("toObject",c),{styles:d})}});g.IText.fromObject=function(c){return new g.IText(c.text,e(c))}})();(function(){var e=g.util.object.clone;g.util.object.extend(g.IText.prototype,{initBehavior:function(){this.initAddedHandler();this.initRemovedHandler();this.initCursorSelectionHandlers();this.initDoubleClickSimulation()},initSelectedHandler:function(){this.on("selected",function(){var c=
this;setTimeout(function(){c.selected=!0},100)})},initAddedHandler:function(){var c=this;this.on("added",function(){this.canvas&&!this.canvas._hasITextHandlers&&(this.canvas._hasITextHandlers=!0,this._initCanvasHandlers());c.canvas&&(c.canvas._iTextInstances=c.canvas._iTextInstances||[],c.canvas._iTextInstances.push(c))})},initRemovedHandler:function(){var c=this;this.on("removed",function(){c.canvas&&(c.canvas._iTextInstances=c.canvas._iTextInstances||[],g.util.removeFromArray(c.canvas._iTextInstances,
c))})},_initCanvasHandlers:function(){var c=this;this.canvas.on("selection:cleared",function(){g.IText.prototype.exitEditingOnOthers(c.canvas)});this.canvas.on("mouse:up",function(){c.canvas._iTextInstances&&c.canvas._iTextInstances.forEach(function(c){c.__isMousedown=!1})});this.canvas.on("object:selected",function(){g.IText.prototype.exitEditingOnOthers(c.canvas)})},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(c,
d,b,a){var k;k={isAborted:!1,abort:function(){this.isAborted=!0}};c.animate("_currentCursorOpacity",d,{duration:b,onComplete:function(){if(!k.isAborted)c[a]()},onChange:function(){c.canvas&&(c.canvas.clearContext(c.canvas.contextTop||c.ctx),c.renderCursorOrSelection())},abort:function(){return k.isAborted}});return k},_onTickComplete:function(){var c=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1);this._cursorTimeout1=setTimeout(function(){c._currentTickCompleteState=c._animateCursor(c,
0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(c){var d=this;c=c?0:this.cursorDelay;this._currentTickState&&this._currentTickState.abort();this._currentTickCompleteState&&this._currentTickCompleteState.abort();clearTimeout(this._cursorTimeout1);this._currentCursorOpacity=1;this.canvas&&(this.canvas.clearContext(this.canvas.contextTop||this.ctx),this.renderCursorOrSelection());this._cursorTimeout2&&clearTimeout(this._cursorTimeout2);this._cursorTimeout2=setTimeout(function(){d._tick()},
c)},abortCursorAnimation:function(){this._currentTickState&&this._currentTickState.abort();this._currentTickCompleteState&&this._currentTickCompleteState.abort();clearTimeout(this._cursorTimeout1);clearTimeout(this._cursorTimeout2);this._currentCursorOpacity=0;this.canvas&&this.canvas.clearContext(this.canvas.contextTop||this.ctx)},selectAll:function(){this.setSelectionStart(0);this.setSelectionEnd(this.text.length)},getSelectedText:function(){return this.text.slice(this.selectionStart,this.selectionEnd)},
findWordBoundaryLeft:function(c){var d=0,b=c-1;if(this._reSpace.test(this.text.charAt(b)))for(;this._reSpace.test(this.text.charAt(b));)d++,b--;for(;/\S/.test(this.text.charAt(b))&&-1<b;)d++,b--;return c-d},findWordBoundaryRight:function(c){var d=0,b=c;if(this._reSpace.test(this.text.charAt(b)))for(;this._reSpace.test(this.text.charAt(b));)d++,b++;for(;/\S/.test(this.text.charAt(b))&&b<this.text.length;)d++,b++;return c+d},findLineBoundaryLeft:function(c){for(var d=0,b=c-1;!/\n/.test(this.text.charAt(b))&&
-1<b;)d++,b--;return c-d},findLineBoundaryRight:function(c){for(var d=0,b=c;!/\n/.test(this.text.charAt(b))&&b<this.text.length;)d++,b++;return c+d},getNumNewLinesInSelectedText:function(){for(var c=this.getSelectedText(),d=0,b=0,a=c.length;b<a;b++)"\n"===c[b]&&d++;return d},searchWordBoundary:function(c,d){for(var b=this._reSpace.test(this.text.charAt(c))?c-1:c,a=this.text.charAt(b),k=/[ \n\.,;!\?\-]/;!k.test(a)&&0<b&&b<this.text.length;)b+=d,a=this.text.charAt(b);k.test(a)&&"\n"!==a&&(b+=1===d?
0:1);return b},selectWord:function(c){var d=this.searchWordBoundary(c,-1);c=this.searchWordBoundary(c,1);this.setSelectionStart(d);this.setSelectionEnd(c)},selectLine:function(c){var d=this.findLineBoundaryLeft(c);c=this.findLineBoundaryRight(c);this.setSelectionStart(d);this.setSelectionEnd(c)},enterEditing:function(c){if(!this.isEditing&&this.editable){this.canvas&&this.exitEditingOnOthers(this.canvas);this.isEditing=!0;this.initHiddenTextarea(c);this.hiddenTextarea.focus();this._updateTextarea();
this._saveEditingProps();this._setEditingProps();this._tick();this.fire("editing:entered");if(!this.canvas)return this;this.canvas.renderAll();this.canvas.fire("text:editing:entered",{target:this});this.initMouseMoveHandler();return this}},exitEditingOnOthers:function(c){c._iTextInstances&&c._iTextInstances.forEach(function(c){c.selected=!1;c.isEditing&&c.exitEditing()})},initMouseMoveHandler:function(){var c=this;this.canvas.on("mouse:move",function(d){c.__isMousedown&&c.isEditing&&(d=c.getSelectionStartFromPointer(d.e),
d>=c.__selectionStartOnMouseDown?(c.setSelectionStart(c.__selectionStartOnMouseDown),c.setSelectionEnd(d)):(c.setSelectionStart(d),c.setSelectionEnd(c.__selectionStartOnMouseDown)))})},_setEditingProps:function(){this.hoverCursor="text";this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text");this.borderColor=this.editingBorderColor;this.hasControls=this.selectable=!1;this.lockMovementX=this.lockMovementY=!0},_updateTextarea:function(){if(this.hiddenTextarea&&!this.inCompositionMode&&
(this.hiddenTextarea.value=this.text,this.hiddenTextarea.selectionStart=this.selectionStart,this.hiddenTextarea.selectionEnd=this.selectionEnd,this.selectionStart===this.selectionEnd)){var c=this._calcTextareaPosition();this.hiddenTextarea.style.left=c.x+"px";this.hiddenTextarea.style.top=c.y+"px"}},_calcTextareaPosition:function(){var c=this.text.split(""),c=this._getCursorBoundaries(c,"cursor"),d=this.get2DCursorLocation(),b=d.lineIndex,a=d.charIndex,d=this.getCurrentCharFontSize(b,a),a=0===b&&
0===a?this._getLineLeftOffset(this._getLineWidth(this.ctx,b)):c.leftOffset,b=this.calcTransformMatrix(),c={x:c.left+a,y:c.top+c.topOffset+d};this.hiddenTextarea.style.fontSize=d+"px";return g.util.transformPoint(c,b)},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},
_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.overCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){this.isEditing=this.selected=!1;this.selectable=!0;this.selectionEnd=
this.selectionStart;this.hiddenTextarea&&this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea);this.hiddenTextarea=null;this.abortCursorAnimation();this._restoreEditingProps();this._currentCursorOpacity=0;this.fire("editing:exited");this.canvas&&this.canvas.fire("text:editing:exited",{target:this});return this},_removeExtraneousStyles:function(){for(var c in this.styles)this._textLines[c]||delete this.styles[c]},_removeCharsFromTo:function(c,d){for(;d!==c;)this._removeSingleCharAndStyle(c+
1),d--;this.setSelectionStart(c)},_removeSingleCharAndStyle:function(c){var d="\n"===this.text[c-1];this.removeStyleObject(d,d?c:c-1);this.text=this.text.slice(0,c-1)+this.text.slice(c);this._textLines=this._splitTextIntoLines()},insertChars:function(c,d){var b;1<this.selectionEnd-this.selectionStart&&(this._removeCharsFromTo(this.selectionStart,this.selectionEnd),this.setSelectionEnd(this.selectionStart));if(!d&&this.isEmptyStyles())this.insertChar(c,!1);else for(var a=0,k=c.length;a<k;a++)d&&(b=
g.copiedTextStyle[a]),this.insertChar(c[a],a<k-1,b)},insertChar:function(c,d,b){var a="\n"===this.text[this.selectionStart];this.text=this.text.slice(0,this.selectionStart)+c+this.text.slice(this.selectionEnd);this._textLines=this._splitTextIntoLines();this.insertStyleObjects(c,a,b);this.selectionEnd=this.selectionStart+=c.length;d||(this._updateTextarea(),this.canvas&&this.canvas.renderAll(),this.setCoords(),this.fire("changed"),this.canvas&&this.canvas.fire("text:changed",{target:this}))},insertNewlineStyleObject:function(c,
d,b){this.shiftLineStyles(c,1);this.styles[c+1]||(this.styles[c+1]={});var a={},k={};this.styles[c]&&this.styles[c][d-1]&&(a=this.styles[c][d-1]);if(b)k[0]=e(a);else for(var f in this.styles[c])parseInt(f,10)>=d&&(k[parseInt(f,10)-d]=this.styles[c][f],delete this.styles[c][f]);this.styles[c+1]=k;this._forceClearCache=!0},insertCharStyleObject:function(c,d,b){var a=this.styles[c],k=e(a);0!==d||b||(d=1);for(var f in k){var h=parseInt(f,10);h>=d&&(a[h+1]=k[h],k[h-1]||delete a[h])}this.styles[c][d]=b||
e(a[d-1]);this._forceClearCache=!0},insertStyleObjects:function(c,d,b){var a=this.get2DCursorLocation(),k=a.lineIndex,a=a.charIndex;this._getLineStyle(k)||this._setLineStyle(k,{});"\n"===c?this.insertNewlineStyleObject(k,a,d):this.insertCharStyleObject(k,a,b)},shiftLineStyles:function(c,d){var b=e(this.styles),a;for(a in this.styles){var k=parseInt(a,10);k>c&&(this.styles[k+d]=b[k],b[k-d]||delete this.styles[k])}},removeStyleObject:function(c,d){var b=this.get2DCursorLocation(d);this._removeStyleObject(c,
b,b.lineIndex,b.charIndex)},_getTextOnPreviousLine:function(c){return this._textLines[c-1]},_removeStyleObject:function(c,d,b,a){if(c){var k=this._getTextOnPreviousLine(d.lineIndex),k=k?k.length:0;this.styles[b-1]||(this.styles[b-1]={});for(a in this.styles[b])this.styles[b-1][parseInt(a,10)+k]=this.styles[b][a];this.shiftLineStyles(d.lineIndex,-1)}else for(k in(d=this.styles[b])&&delete d[a],b=e(d),b)c=parseInt(k,10),c>=a&&0!==c&&(d[c-1]=b[c],delete d[c])},insertNewline:function(){this.insertChars("\n")}})})();
g.util.object.extend(g.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date;this.__lastLastClickTime=+new Date;this.__lastPointer={};this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(e){this.__newClickTime=+new Date;var c=this.canvas.getPointer(e.e);this.isTripleClick(c)?(this.fire("tripleclick",e),this._stopEvent(e.e)):this.isDoubleClick(c)&&(this.fire("dblclick",e),this._stopEvent(e.e));this.__lastLastClickTime=this.__lastClickTime;this.__lastClickTime=
this.__newClickTime;this.__lastPointer=c;this.__lastIsEditing=this.isEditing;this.__lastSelected=this.selected},isDoubleClick:function(e){return 500>this.__newClickTime-this.__lastClickTime&&this.__lastPointer.x===e.x&&this.__lastPointer.y===e.y&&this.__lastIsEditing},isTripleClick:function(e){return 500>this.__newClickTime-this.__lastClickTime&&500>this.__lastClickTime-this.__lastLastClickTime&&this.__lastPointer.x===e.x&&this.__lastPointer.y===e.y},_stopEvent:function(e){e.preventDefault&&e.preventDefault();
e.stopPropagation&&e.stopPropagation()},initCursorSelectionHandlers:function(){this.initSelectedHandler();this.initMousedownHandler();this.initMouseupHandler();this.initClicks()},initClicks:function(){this.on("dblclick",function(e){this.selectWord(this.getSelectionStartFromPointer(e.e))});this.on("tripleclick",function(e){this.selectLine(this.getSelectionStartFromPointer(e.e))})},initMousedownHandler:function(){this.on("mousedown",function(e){if(this.editable){var c=this.canvas.getPointer(e.e);this.__mousedownX=
c.x;this.__mousedownY=c.y;this.__isMousedown=!0;this.hiddenTextarea&&this.canvas&&this.canvas.wrapperEl.appendChild(this.hiddenTextarea);this.selected&&this.setCursorByClick(e.e);this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.initDelayedCursor(!0))}})},_isObjectMoved:function(e){e=this.canvas.getPointer(e);return this.__mousedownX!==e.x||this.__mousedownY!==e.y},initMouseupHandler:function(){this.on("mouseup",function(e){this.__isMousedown=!1;this.editable&&!this._isObjectMoved(e.e)&&
(this.__lastSelected&&!this.__corner&&(this.enterEditing(e.e),this.initDelayedCursor(!0)),this.selected=!0)})},setCursorByClick:function(e){var c=this.getSelectionStartFromPointer(e);e.shiftKey?c<this.selectionStart?(this.setSelectionEnd(this.selectionStart),this.setSelectionStart(c)):this.setSelectionEnd(c):(this.setSelectionStart(c),this.setSelectionEnd(c))},getSelectionStartFromPointer:function(e){e=this.getLocalPointer(e);for(var c=0,d=0,b=0,a=0,k,f=0,h=this._textLines.length;f<h;f++){k=this._textLines[f];
for(var b=b+this._getHeightOfLine(this.ctx,f)*this.scaleY,d=this._getLineWidth(this.ctx,f),d=this._getLineLeftOffset(d)*this.scaleX,q=0,p=k.length;q<p;q++)if(c=d,d+=this._getWidthOfChar(this.ctx,k[q],f,this.flipX?p-q:q)*this.scaleX,b<=e.y||d<=e.x)a++;else return this._getNewSelectionStartFromOffset(e,c,d,a+f,p);if(e.y<b)return this._getNewSelectionStartFromOffset(e,c,d,a+f-1,p)}return this.text.length},_getNewSelectionStartFromOffset:function(e,c,d,b,a){e=b+(d-e.x>e.x-c?0:1);this.flipX&&(e=a-e);e>
this.text.length&&(e=this.text.length);return e}});g.util.object.extend(g.IText.prototype,{initHiddenTextarea:function(e){e&&this.canvas?e=this.canvas.getPointer(e):(this.oCoords||this.setCoords(),e=this.oCoords.tl);this.hiddenTextarea=g.document.createElement("textarea");this.hiddenTextarea.setAttribute("autocapitalize","off");this.hiddenTextarea.style.cssText="position: absolute; top: "+e.y+"px; left: "+e.x+"px; opacity: 0; width: 0px; height: 0px; z-index: -999;";this.canvas?this.canvas.lowerCanvasEl.parentNode.appendChild(this.hiddenTextarea):
g.document.body.appendChild(this.hiddenTextarea);g.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this));g.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this));g.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this));g.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this));g.util.addListener(this.hiddenTextarea,"cut",this.cut.bind(this));g.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this));g.util.addListener(this.hiddenTextarea,
"compositionstart",this.onCompositionStart.bind(this));g.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this));g.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this));!this._clickHandlerInitialized&&this.canvas&&(g.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},_keysMap:{8:"removeChars",9:"exitEditing",27:"exitEditing",13:"insertNewline",33:"moveCursorUp",34:"moveCursorDown",
35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",46:"forwardDelete"},_ctrlKeysMap:{65:"selectAll",67:"copy",88:"cut"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(e){this.isEditing&&e.keyCode in this._keysMap&&(this[this._keysMap[e.keyCode]](e),e.stopImmediatePropagation(),e.preventDefault(),this.canvas&&this.canvas.renderAll())},onKeyUp:function(e){!this.isEditing||this._copyDone?this._copyDone=
!1:e.keyCode in this._ctrlKeysMap&&(e.ctrlKey||e.metaKey)&&(this[this._ctrlKeysMap[e.keyCode]](e),e.stopImmediatePropagation(),e.preventDefault(),this.canvas&&this.canvas.renderAll())},onInput:function(e){if(this.isEditing&&!this.inCompositionMode){var c=this.selectionStart||0,d=this.selectionEnd||0,b=this.text.length,a=this.hiddenTextarea.value.length;a>b?(c="left"===this._selectionDirection?d:c,b=this.hiddenTextarea.value.slice(c,c+(a-b))):b=this.hiddenTextarea.value.slice(c,c+(a-b+d-c));this.insertChars(b);
e.stopPropagation()}},onCompositionStart:function(){this.inCompositionMode=!0;this.prevCompositionLength=0;this.compositionStart=this.selectionStart},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(e){e=e.data;this.selectionStart=this.compositionStart;this.selectionEnd=this.selectionEnd===this.selectionStart?this.compositionStart+this.prevCompositionLength:this.selectionEnd;this.insertChars(e,!1);this.prevCompositionLength=e.length},forwardDelete:function(e){if(this.selectionStart===
this.selectionEnd){if(this.selectionStart===this.text.length)return;this.moveCursorRight(e)}this.removeChars(e)},copy:function(e){if(this.selectionStart!==this.selectionEnd){var c=this.getSelectedText(),d=this._getClipboardData(e);d&&d.setData("text",c);g.copiedText=c;g.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd);e.stopImmediatePropagation();e.preventDefault();this._copyDone=!0}},paste:function(e){var c=null,c=this._getClipboardData(e),d=!0;c?(c=c.getData("text").replace(/\r/g,
""),g.copiedTextStyle&&g.copiedText===c||(d=!1)):c=g.copiedText;c&&this.insertChars(c,d);e.stopImmediatePropagation();e.preventDefault()},cut:function(e){this.selectionStart!==this.selectionEnd&&(this.copy(e),this.removeChars(e))},_getClipboardData:function(e){return e&&e.clipboardData||g.window.clipboardData},getDownCursorOffset:function(e,c){var d=c?this.selectionEnd:this.selectionStart,b=this.get2DCursorLocation(d),a=b.lineIndex,k=this._textLines[a].slice(0,b.charIndex),f=this._textLines[a].slice(b.charIndex),
h=this._textLines[a+1]||"";if(a===this._textLines.length-1||e.metaKey||34===e.keyCode)return this.text.length-d;for(var d=this._getLineWidth(this.ctx,a),q=this._getLineLeftOffset(d),p=0,g=k.length;p<g;p++)d=k[p],q+=this._getWidthOfChar(this.ctx,d,a,p);b=this._getIndexOnNextLine(b,h,q);return f.length+1+b},_getIndexOnNextLine:function(e,c,d){var b=e.lineIndex+1;e=this._getLineWidth(this.ctx,b);var a=this._getLineLeftOffset(e),k=0,f;e=0;for(var h=c.length;e<h;e++){var q=this._getWidthOfChar(this.ctx,
c[e],b,e),a=a+q;if(a>d){f=!0;b=a;a=Math.abs(a-q-d);k=Math.abs(b-d)<a?e+1:e;break}}f||(k=c.length);return k},moveCursorDown:function(e){this.abortCursorAnimation();this._currentCursorOpacity=1;var c=this.getDownCursorOffset(e,"right"===this._selectionDirection);e.shiftKey?this.moveCursorDownWithShift(c):this.moveCursorDownWithoutShift(c);this.initDelayedCursor()},moveCursorDownWithoutShift:function(e){this._selectionDirection="right";this.setSelectionStart(this.selectionStart+e);this.setSelectionEnd(this.selectionStart)},
swapSelectionPoints:function(){var e=this.selectionEnd;this.setSelectionEnd(this.selectionStart);this.setSelectionStart(e)},moveCursorDownWithShift:function(e){this.selectionEnd===this.selectionStart&&(this._selectionDirection="right");"right"===this._selectionDirection?this.setSelectionEnd(this.selectionEnd+e):this.setSelectionStart(this.selectionStart+e);this.selectionEnd<this.selectionStart&&"left"===this._selectionDirection&&(this.swapSelectionPoints(),this._selectionDirection="right");this.selectionEnd>
this.text.length&&this.setSelectionEnd(this.text.length)},getUpCursorOffset:function(e,c){var d=c?this.selectionEnd:this.selectionStart,b=this.get2DCursorLocation(d),a=b.lineIndex;if(0===a||e.metaKey||33===e.keyCode)return d;var d=this._textLines[a].slice(0,b.charIndex),k=this._textLines[a-1]||"",f;f=this._getLineWidth(this.ctx,b.lineIndex);for(var h=this._getLineLeftOffset(f),q=0,p=d.length;q<p;q++)f=d[q],h+=this._getWidthOfChar(this.ctx,f,a,q);b=this._getIndexOnPrevLine(b,k,h);return k.length-b+
d.length},_getIndexOnPrevLine:function(e,c,d){var b=e.lineIndex-1;e=this._getLineWidth(this.ctx,b);var a=this._getLineLeftOffset(e),k=0,f;e=0;for(var h=c.length;e<h;e++){var q=this._getWidthOfChar(this.ctx,c[e],b,e),a=a+q;if(a>d){f=!0;b=a;a=Math.abs(a-q-d);k=Math.abs(b-d)<a?e:e-1;break}}f||(k=c.length-1);return k},moveCursorUp:function(e){this.abortCursorAnimation();this._currentCursorOpacity=1;var c=this.getUpCursorOffset(e,"right"===this._selectionDirection);e.shiftKey?this.moveCursorUpWithShift(c):
this.moveCursorUpWithoutShift(c);this.initDelayedCursor()},moveCursorUpWithShift:function(e){this.selectionEnd===this.selectionStart&&(this._selectionDirection="left");"right"===this._selectionDirection?this.setSelectionEnd(this.selectionEnd-e):this.setSelectionStart(this.selectionStart-e);this.selectionEnd<this.selectionStart&&"right"===this._selectionDirection&&(this.swapSelectionPoints(),this._selectionDirection="left")},moveCursorUpWithoutShift:function(e){this.selectionStart===this.selectionEnd&&
this.setSelectionStart(this.selectionStart-e);this.setSelectionEnd(this.selectionStart);this._selectionDirection="left"},moveCursorLeft:function(e){if(0!==this.selectionStart||0!==this.selectionEnd)this.abortCursorAnimation(),this._currentCursorOpacity=1,e.shiftKey?this.moveCursorLeftWithShift(e):this.moveCursorLeftWithoutShift(e),this.initDelayedCursor()},_move:function(e,c,d){var b="selectionStart"===c?"setSelectionStart":"setSelectionEnd";if(e.altKey)this[b](this["findWordBoundary"+d](this[c]));
else if(e.metaKey||35===e.keyCode||36===e.keyCode)this[b](this["findLineBoundary"+d](this[c]));else this[b](this[c]+("Left"===d?-1:1))},_moveLeft:function(e,c){this._move(e,c,"Left")},_moveRight:function(e,c){this._move(e,c,"Right")},moveCursorLeftWithoutShift:function(e){this._selectionDirection="left";this.selectionEnd===this.selectionStart&&this._moveLeft(e,"selectionStart");this.setSelectionEnd(this.selectionStart)},moveCursorLeftWithShift:function(e){"right"===this._selectionDirection&&this.selectionStart!==
this.selectionEnd?this._moveLeft(e,"selectionEnd"):(this._selectionDirection="left",this._moveLeft(e,"selectionStart"))},moveCursorRight:function(e){this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length||(this.abortCursorAnimation(),this._currentCursorOpacity=1,e.shiftKey?this.moveCursorRightWithShift(e):this.moveCursorRightWithoutShift(e),this.initDelayedCursor())},moveCursorRightWithShift:function(e){"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?
this._moveRight(e,"selectionStart"):(this._selectionDirection="right",this._moveRight(e,"selectionEnd"))},moveCursorRightWithoutShift:function(e){this._selectionDirection="right";this.selectionStart===this.selectionEnd?(this._moveRight(e,"selectionStart"),this.setSelectionEnd(this.selectionStart)):(this.setSelectionEnd(this.selectionEnd+this.getNumNewLinesInSelectedText()),this.setSelectionStart(this.selectionEnd))},removeChars:function(e){this.selectionStart===this.selectionEnd?this._removeCharsNearCursor(e):
this._removeCharsFromTo(this.selectionStart,this.selectionEnd);this.setSelectionEnd(this.selectionStart);this._removeExtraneousStyles();this.canvas&&this.canvas.renderAll();this.setCoords();this.fire("changed");this.canvas&&this.canvas.fire("text:changed",{target:this})},_removeCharsNearCursor:function(e){0!==this.selectionStart&&(e.metaKey?(e=this.findLineBoundaryLeft(this.selectionStart),this._removeCharsFromTo(e,this.selectionStart),this.setSelectionStart(e)):e.altKey?(e=this.findWordBoundaryLeft(this.selectionStart),
this._removeCharsFromTo(e,this.selectionStart),this.setSelectionStart(e)):(this._removeSingleCharAndStyle(this.selectionStart),this.setSelectionStart(this.selectionStart-1)))}});(function(){var e=g.util.toFixed,c=g.Object.NUM_FRACTION_DIGITS;g.util.object.extend(g.IText.prototype,{_setSVGTextLineText:function(c,b,a,k,f,h){this._getLineStyle(c)?this._setSVGTextLineChars(c,b,a,k,h):g.Text.prototype._setSVGTextLineText.call(this,c,b,a,k,f)},_setSVGTextLineChars:function(c,b,a,k,f){a=this._textLines[c];
k=0;for(var h=this._getLineLeftOffset(this._getLineWidth(this.ctx,c))-this.width/2,q=this._getSVGLineTopOffset(c),e=this._getHeightOfLine(this.ctx,c),g=0,r=a.length;g<r;g++){var m=this._getStyleDeclaration(c,g)||{};b.push(this._createTextCharSpan(a[g],m,h,q.lineTop+q.offset,k));var v=this._getWidthOfChar(this.ctx,a[g],c,g);m.textBackgroundColor&&f.push(this._createTextCharBg(m,h,q.lineTop,e,v,k));k+=v}},_getSVGLineTopOffset:function(c){for(var b=0,a=0,a=0;a<c;a++)b+=this._getHeightOfLine(this.ctx,
a);a=this._getHeightOfLine(this.ctx,a);return{lineTop:b,offset:(this._fontSizeMult-this._fontSizeFraction)*a/(this.lineHeight*this._fontSizeMult)}},_createTextCharBg:function(d,b,a,k,f,h){return['\t\t<rect fill="',d.textBackgroundColor,'" x="',e(b+h,c),'" y="',e(a-this.height/2,c),'" width="',e(f,c),'" height="',e(k/this.lineHeight,c),'"></rect>\n'].join("")},_createTextCharSpan:function(d,b,a,k,f){var h=this.getSvgStyles.call(g.util.object.extend({visible:!0,fill:this.fill,stroke:this.stroke,type:"text",
getSvgFilter:g.Object.prototype.getSvgFilter},b));return['\t\t\t<tspan x="',e(a+f,c),'" y="',e(k-this.height/2,c),'" ',b.fontFamily?'font-family="'+b.fontFamily.replace(/"/g,"'")+'" ':"",b.fontSize?'font-size="'+b.fontSize+'" ':"",b.fontStyle?'font-style="'+b.fontStyle+'" ':"",b.fontWeight?'font-weight="'+b.fontWeight+'" ':"",b.textDecoration?'text-decoration="'+b.textDecoration+'" ':"",'style="',h,'">',g.util.string.escapeXml(d),"</tspan>\n"].join("")}})})();(function(e){var c=e.fabric||(e.fabric=
{}),d=c.util.object.clone;c.Textbox=c.util.createClass(c.IText,c.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:0,__cachedLines:null,initialize:function(b,a){this.ctx=c.util.createCanvasElement().getContext("2d");this.callSuper("initialize",b,a);this.set({lockUniScaling:!1,lockScalingY:!0,lockScalingFlip:!0,hasBorders:!0});this.setControlsVisibility(c.Textbox.getTextboxControlVisibility());this._dimensionAffectingProps.width=!0},_initDimensions:function(b){this.__skipDimension||(b||(b=c.util.createCanvasElement().getContext("2d"),
this._setTextStyles(b)),this.dynamicMinWidth=0,this._textLines=this._splitTextIntoLines(),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this._clearCache(),this.height=this._getTextHeight(b))},_generateStyleMap:function(){for(var b=0,a=0,c=0,f={},h=0;h<this._textLines.length;h++)"\n"===this.text[c]?(a=0,c++,b++):" "===this.text[c]&&(a++,c++),f[h]={line:b,offset:a},c+=this._textLines[h].length,a+=this._textLines[h].length;return f},_getStyleDeclaration:function(b,a,c){if(this._styleMap){var f=
this._styleMap[b];if(!f)return c?{}:null;b=f.line;a=f.offset+a}return this.callSuper("_getStyleDeclaration",b,a,c)},_setStyleDeclaration:function(b,a,c){var f=this._styleMap[b];b=f.line;a=f.offset+a;this.styles[b][a]=c},_deleteStyleDeclaration:function(b,a){var c=this._styleMap[b];b=c.line;a=c.offset+a;delete this.styles[b][a]},_getLineStyle:function(b){return this.styles[this._styleMap[b].line]},_setLineStyle:function(b,a){this.styles[this._styleMap[b].line]=a},_deleteLineStyle:function(b){delete this.styles[this._styleMap[b].line]},
_wrapText:function(b,a){var c=a.split(this._reNewline),f=[],h;for(h=0;h<c.length;h++)f=f.concat(this._wrapLine(b,c[h],h));return f},_measureText:function(b,a,c,f){var h=0;f=f||0;for(var d=0,e=a.length;d<e;d++)h+=this._getWidthOfChar(b,a[d],c,d+f);return h},_wrapLine:function(b,a,c){var f=0,h=[],d="";a=a.split(" ");for(var e="",g=0,r=0,m=0,v=0,E=!0,D=0;D<a.length;D++)e=a[D],r=this._measureText(b,e,c,g),g+=e.length,f+=m+r,f>=this.width&&!E&&(h.push(d),d="",f=r,E=!0),E||(d+=" "),d+=e,m=this._measureText(b,
" ",c,g),g++,E=!1,r>v&&(v=r);D&&h.push(d);v>this.dynamicMinWidth&&(this.dynamicMinWidth=v);return h},_splitTextIntoLines:function(){var b=this.textAlign;this.ctx.save();this._setTextStyles(this.ctx);this.textAlign="left";var a=this._wrapText(this.ctx,this.text);this.textAlign=b;this.ctx.restore();this._textLines=a;this._styleMap=this._generateStyleMap();return a},setOnGroup:function(b,a){"scaleX"===b&&(this.set("scaleX",Math.abs(1/a)),this.set("width",this.get("width")*a/("undefined"===typeof this.__oldScaleX?
1:this.__oldScaleX)),this.__oldScaleX=a)},get2DCursorLocation:function(b){"undefined"===typeof b&&(b=this.selectionStart);for(var a=this._textLines.length,c=0,f=0;f<a;f++){var h=this._textLines[f].length;if(b<=c+h)return{lineIndex:f,charIndex:b-c};c+=h;"\n"!==this.text[c]&&" "!==this.text[c]||c++}return{lineIndex:a-1,charIndex:this._textLines[a-1].length}},_getCursorBoundariesOffsets:function(b,a){for(var c=0,f=0,h=this.get2DCursorLocation(),d=this._textLines[h.lineIndex].split(""),e=this._getLineLeftOffset(this._getLineWidth(this.ctx,
h.lineIndex)),g=0;g<h.charIndex;g++)f+=this._getWidthOfChar(this.ctx,d[g],h.lineIndex,g);for(g=0;g<h.lineIndex;g++)c+=this._getHeightOfLine(this.ctx,g);"cursor"===a&&(c+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,h.lineIndex)/this.lineHeight-this.getCurrentCharFontSize(h.lineIndex,h.charIndex)*(1-this._fontSizeFraction));return{top:c,left:f,lineLeft:e}},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},toObject:function(b){return c.util.object.extend(this.callSuper("toObject",
b),{minWidth:this.minWidth})}});c.Textbox.fromObject=function(b){return new c.Textbox(b.text,d(b))};c.Textbox.getTextboxControlVisibility=function(){return{tl:!1,tr:!1,br:!1,bl:!1,ml:!0,mt:!1,mr:!0,mb:!1,mtr:!0}};c.Textbox.instances=[]})("undefined"!==typeof n?n:this);(function(){var e=g.Canvas.prototype._setObjectScale;g.Canvas.prototype._setObjectScale=function(c,b,a,k,f,h,q){var p=b.target;p instanceof g.Textbox?(c=c.x/b.scaleX/(p.width+p.strokeWidth)*p.width,c>=p.getMinWidth()&&p.set("width",
c)):e.call(g.Canvas.prototype,c,b,a,k,f,h,q)};g.Group.prototype._refreshControlsVisibility=function(){if("undefined"!==typeof g.Textbox)for(var c=this._objects.length;c--;)if(this._objects[c]instanceof g.Textbox){this.setControlsVisibility(g.Textbox.getTextboxControlVisibility());break}};var c=g.util.object.clone;g.util.object.extend(g.Textbox.prototype,{_removeExtraneousStyles:function(){for(var c in this._styleMap)this._textLines[c]||delete this.styles[this._styleMap[c].line]},insertCharStyleObject:function(c,
b,a){var k=this._styleMap[c];c=k.line;b=k.offset+b;g.IText.prototype.insertCharStyleObject.apply(this,[c,b,a])},insertNewlineStyleObject:function(c,b,a){var k=this._styleMap[c];c=k.line;b=k.offset+b;g.IText.prototype.insertNewlineStyleObject.apply(this,[c,b,a])},shiftLineStyles:function(d,b){var a=c(this.styles);d=this._styleMap[d].line;for(var k in this.styles){var f=parseInt(k,10);f>d&&(this.styles[f+b]=a[f],a[f-b]||delete this.styles[f])}},_getTextOnPreviousLine:function(c){for(var b=this._textLines[c-
1];this._styleMap[c-2]&&this._styleMap[c-2].line===this._styleMap[c-1].line;)b=this._textLines[c-2]+b,c--;return b},removeStyleObject:function(c,b){var a=this.get2DCursorLocation(b),k=this._styleMap[a.lineIndex];this._removeStyleObject(c,a,k.line,k.offset+a.charIndex)}})})();(function(){var e=g.IText.prototype._getNewSelectionStartFromOffset;g.IText.prototype._getNewSelectionStartFromOffset=function(c,d,b,a,k){a=e.call(this,c,d,b,a,k);for(b=d=c=0;b<this._textLines.length;b++){c+=this._textLines[b].length;
if(c+d>=a)break;"\n"!==this.text[c+d]&&" "!==this.text[c+d]||d++}return a-b+d}})();(function(){function e(f,h,c){var d=b.parse(f);d.port||(d.port=0===d.protocol.indexOf("https:")?443:80);f=(0===d.protocol.indexOf("https:")?k:a).request({hostname:d.hostname,port:d.port,path:d.path,method:"GET"},function(a){var f="";h&&a.setEncoding(h);a.on("end",function(){c(f)});a.on("data",function(h){200===a.statusCode&&(f+=h)})});f.on("error",function(a){a.errno===process.ECONNREFUSED?g.log("ECONNREFUSED: connection refused to "+
d.hostname+":"+d.port):g.log(a.message);c(null)});f.end()}function c(a,f){require("fs").readFile(a,function(a,h){if(a)throw g.log(a),a;f(h)})}if("undefined"===typeof document||"undefined"===typeof B){var d=require("xmldom").DOMParser,b=require("url"),a=require("http"),k=require("https"),f=require("canvas"),h=require("canvas").Image;g.util.loadImage=function(a,f,b){function k(h){h?(d.src=new Buffer(h,"binary"),d._src=a,f&&f.call(b,d)):(d=null,f&&f.call(b,null,!0))}var d=new h;a&&(a instanceof Buffer||
0===a.indexOf("data"))?(d.src=d._src=a,f&&f.call(b,d)):a&&0!==a.indexOf("http")?c(a,k):a?e(a,"binary",k):f&&f.call(b,a)};g.loadSVGFromURL=function(a,f,h){a=a.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim();0!==a.indexOf("http")?c(a,function(a){g.loadSVGFromString(a.toString(),f,h)}):e(a,"",function(a){g.loadSVGFromString(a,f,h)})};g.loadSVGFromString=function(a,f,h){a=(new d).parseFromString(a);g.parseSVGDocument(a.documentElement,function(a,h){f&&f(a,h)},h)};g.util.getScript=function(a,f){e(a,"",
function(a){eval(a);f&&f()})};g.Image.fromObject=function(a,f){g.util.loadImage(a.src,function(h){var b=new g.Image(h);b._initConfig(a);b._initFilters(a.filters,function(h){b.filters=h||[];b._initFilters(a.resizeFilters,function(a){b.resizeFilters=a||[];f&&f(b)})})})};g.createCanvasForNode=function(a,h,b,c){c=c||b;var k=g.document.createElement("canvas");a=new f(a||600,h||600,c);k.style={};k.width=a.width;k.height=a.height;b=new (g.Canvas||g.StaticCanvas)(k,b);b.contextContainer=a.getContext("2d");
b.nodeCanvas=a;b.Font=f.Font;return b};g.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()};g.StaticCanvas.prototype.createJPEGStream=function(a){return this.nodeCanvas.createJPEGStream(a)};var q=g.StaticCanvas.prototype.setWidth;g.StaticCanvas.prototype.setWidth=function(a,f){q.call(this,a,f);this.nodeCanvas.width=a;return this};g.Canvas&&(g.Canvas.prototype.setWidth=g.StaticCanvas.prototype.setWidth);var p=g.StaticCanvas.prototype.setHeight;g.StaticCanvas.prototype.setHeight=
function(a,f){p.call(this,a,f);this.nodeCanvas.height=a;return this};g.Canvas&&(g.Canvas.prototype.setHeight=g.StaticCanvas.prototype.setHeight)}})();g.Object.prototype.drawBorders=function(e){if(!this.hasBorders)return this;var c=this._calculateCurrentDimensions(),d=1/this.borderScaleFactor,b=c.x+d,c=c.y+d;e.save();e.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;e.strokeStyle=this.borderColor;e.lineWidth=d;d=this.borderStrokeDashArray?this.borderStrokeDashArray:[1E3,0];e.beginPath();g.util.drawDashedLine(e,
-b/2,-c/2,-b/2,+c/2,d);g.util.drawDashedLine(e,-b/2,+c/2,+b/2,+c/2,d);g.util.drawDashedLine(e,+b/2,+c/2,+b/2,-c/2,d);g.util.drawDashedLine(e,+b/2,-c/2,-b/2,-c/2,d);e.closePath();e.stroke();this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls&&(b=-c/2,e.beginPath(),g.util.drawDashedLine(e,0,b-this.rotatingPointOffset,0,b,d),e.closePath(),e.stroke());e.restore();return this};return g})});
(function(z){var B=window.AmazonUIPageJS||window.P,u=B._namespace||B.attributeErrors,l=u?u("AmazonCustomCommonAssets"):B;l.guardFatal?l.guardFatal(z)(l,window):l.execute(function(){z(l,window)})})(function(z,B,u){z.when("A","ready").register("acc-util",function(l){return{}});z.when("A","ready").register("acc-font",function(l){(function(){var n=l.$,g=[],e=l.state("ctsStateData");if(l.objectIsEmpty(e))for(e=0;3>e;e++){var c=l.state("ctsStateInfo"+e);l.objectIsEmpty(c)||g.push(c)}else g=
e.surfaces;g.length&&l.each(g,function(c){if(c.FontSettings&&c.FontSettings.fonts){var b=c.FontSettings.fonts;l.each(b,function(a){if(a.fontURL&&a.isActive){var c;c=b.length;a=a.fontURL.split("/");1>a.length?c=null:(a=a[a.length-1].split("."),c=1>a.length?null:"ac_"+c+"_"+a[0].substring(0,20));c&&n("<span>&nbsp;</span>").css("font-family",c).appendTo("body")}})}})})()});z.when("A","acc-weblab-bbq-updates","acc-weblab-configurator","acc-weblab-enable-tabletapp","acc-weblab-configurator-mobile",
"acc-weblab-new-thumbnail","ready").register("acc-weblab",function(l,n,g,e,c,d){var b={},a={};a[n.name]=n.treatment;a[e.name]=e.treatment;a[g.name]=g.treatment;a[c.name]=c.treatment;a[d.name]=d.treatment;b.getTreatment=function(b){var f=a[b];return l.objectIsEmpty(f)?(B.console&&console.log("Weblab "+b+" not found"),u):f};b.isT1=function(a){return"T1"===b.getTreatment(a)};return b});z.when("A").register("acc-weblab-bbq-updates",function(l){return{name:"AMAZON_CUSTOM_BBQ_UPDATES_70086",
treatment:"T1"}});z.when("A").register("acc-weblab-enable-tabletapp",function(l){return{name:"AC_PRODUCT_TABLETAPP_75334",treatment:"T1"}});z.when("A").register("acc-weblab-configurator",function(l){return{name:"AC_PRODUCT_CONFIGURATOR_DP_75265",treatment:"T1"}});z.when("A").register("acc-weblab-configurator-mobile",function(l){return{name:"AC_PRODUCT_CONFIGURATOR_DP_MOBILE_83123",treatment:"T1"}});z.when("A").register("acc-weblab-new-thumbnail",
function(l){return{name:"AC_THUMBNAIL_NEW_84598",treatment:"T1"}})});
(function(z){var B=window.AmazonUIPageJS||window.P,u=B._namespace||B.attributeErrors,l=u?u("AmazonCustomBuyBoxAssets"):B;l.guardFatal?l.guardFatal(z)(l,window):l.execute(function(){z(l,window)})})(function(z,B,u){(function(){z.when("A","acc-weblab","ready").register("BuyBox",function(l,n){return function(g){function e(){var a={},f={},h=!1;p.controller!==u&&(a=p.controller.getJSON());f.customizationData=JSON.stringify(a);g("#amazonCustomUseCaseId").length&&(f.clientId=g("#amazonCustomUseCaseId").val());
g(".pc-error-container").hide();h=E(a);l.post("/gp/product/features/callSetCustomizationDatav2.html",{dataType:"json",params:f,contentType:"application/x-www-form-urlencoded;charset=utf-8",success:function(a){h&&l.trigger("amazon-custom-log-ref-tag","hasNonASCII",{msg:a.result.pcToken});"OK"===a.result.Status&&a.result.pcToken!==u?(l.trigger("amazon-custom-log-ref-tag","AddToCartClick"),g("#UNIQ-pcToken",g(".pc-buy-box")).val(a.result.pcToken),g("#addToCart").submit()):g(".pc-error-container").show()},
error:function(a){g(".pc-error-container").show()}})}function c(a){var f=g("#pc-atc"),h=g(".pc-atc-wrapper");a?(f.prop("disabled",!1),h.removeClass("a-button-disabled")):(f.prop("disabled",!0),h.addClass("a-button-disabled"))}function d(a,f){k(g(".pc-atc-missing-customization"),a,f)}function b(a,f){k(g(".pc-atc-missing-required-text"),a,f)}function a(a,f){k(g(".pc-atc-containing-emoji"),a,f)}function k(a,f,h){f?a.show():a.hide();h&&h.error?a.addClass("a-color-error"):a.removeClass("a-color-error")}
function f(a){t=!0;a&&(r=a.callback)}function h(){t=!1;r=null}var q={$el:u,showLabel:!0,controller:u},p={},t=!1,r=null,m=function(a){p=g.extend({},q,a);return this};m.prototype.getComponentName=function(){return"BuyBox"};m.prototype.Init=function(){v.Bind();d(!1);b(!1);a(!1)};var v={Bind:function(){l.declarative("upload-metadata","click",function(a){a.$event.preventDefault();g("#pc-atc").is(":disabled")||(t?g.isFunction(r)&&r():(l.trigger("amazon-custom-popup-close",new Date),e()))});l.on("enableBuybox",
function(){c(!0)});l.on("disableBuybox",function(){c(!1)});l.on("showMissingCustomization",function(a){d(!0,a)});l.on("hideMissingCustomization",function(){d(!1)});l.on("showMissingRequiredFields",function(a){b(!0,a)});l.on("hideMissingRequiredFields",function(){b(!1)});l.on("showContainingEmoji",function(f){a(!0,f)});l.on("hideContainingEmoji",function(){a(!1)});l.on("blockBuybox",f);l.on("unblockBuybox",h)}},E=function(a){a=a.customizationInfo["version3.0"].surfaces;for(var f=new RegExp(/[^\x00-\x7F]+/g),
h=0;h<a.length;h++)for(var b=0;b<a[h].areas.length;b++)if("TextPrinting"===a[h].areas[b].customizationType&&f.test(a[h].areas[b].text))return!0;return!1};return m}(l.$)})})();z.when("a-modal","ac-ajax-customizer","acc-weblab").execute(function(l,n,g){g.isT1("AMAZON_CUSTOM_BBQ_UPDATES_70086")&&(new n({viewFactory:l,viewName:"pc-popover-content",deviceType:"web"})).init(!0)})});